function t(t,e,i,s){Object.defineProperty(t,e,{get:i,set:s,enumerable:!0,configurable:!0})}function e(t){return t&&t.__esModule?t.default:t}var i="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},s={},n={},r=i.parcelRequired274;function o(t,e=""){let i=document.createElement(t);return i.className=e,i}function a(t,e=!0){if(e){["optimizeSpeed","crisp-edges","-moz-crisp-edges","-webkit-optimize-contrast","optimize-contrast","pixelated"].forEach((e=>t.style["image-rendering"]=e))}else t.style["image-rendering"]=""}function h(t,e){let i=document.createElement("option");return i.innerText=t,i.value=e,i}function l(t){t.style.display="none"}function d(t){t.style.display=""}function c(t,e){let i=t.indexOf(e);return-1!==i?(t.splice(i,1),{item:e,index:i,existed:!0}):{item:e,index:-1,existed:!1}}function p(t,e,i){if("number"==typeof i)return t.splice(i,0,e),{item:e,index:i};for(let s=0;s<t.length;s++)if(i(e,t[s]))return t.splice(s,0,e),{item:e,index:s};return t.push(e),{item:e,index:t.length-1}}function u(t){t.stopPropagation()}null==r&&((r=function(t){if(t in s)return s[t].exports;if(t in n){var e=n[t];delete n[t];var i={id:t,exports:{}};return s[t]=i,e.call(i.exports,i,i.exports),i.exports}var r=new Error("Cannot find module '"+t+"'");throw r.code="MODULE_NOT_FOUND",r}).register=function(t,e){n[t]=e},i.parcelRequired274=r),r.register("27Lyk",(function(e,i){var s,n;t(e.exports,"register",(()=>s),(t=>s=t)),t(e.exports,"resolve",(()=>n),(t=>n=t));var r={};s=function(t){for(var e=Object.keys(t),i=0;i<e.length;i++)r[e[i]]=t[e[i]]},n=function(t){var e=r[t];if(null==e)throw new Error("Could not resolve bundle with id "+t);return e}})),r.register("1DpLL",(function(t,e){t.exports=new URL(r("27Lyk").resolve("lebXy"),import.meta.url).toString()})),r("27Lyk").register(JSON.parse('{"e4llg":"index.3e6cdede.js","lebXy":"tut.5ffefec4.png"}'));class g{constructor(){this.events=new Map}createEvent(t){this.events.has(t)||this.events.set(t,[])}emitEvent(t,...e){this.events.has(t)||(console.warn("event not yet created: "+t),this.events.set(t,[])),this.events.get(t).forEach((t=>t.fn(...e)))}on(t,e,i="[unidentified]"){this.events.has(t)||(console.warn("event not yet created: "+t),this.events.set(t,[])),this.events.get(t).push({fn:e,id:i})}once(t,e,i="[unidentified oneshot]"){this.events.has(t)||(console.warn("event not yet created: "+t),this.events.set(t,[]));let s={fn:()=>{e(),c(this.events.get(t),s)},id:i};this.events.get(t).push(s)}debugEvent(t){this.events.has(t)||(console.warn("event not yet created: "+t),this.events.set(t,[])),console.log("ids registered to event `"+t+"`:"),this.events.get(t).forEach((t=>console.log(t.id)))}}let m=new g;class f extends g{constructor(t){super(),this.container=t?"string"==typeof t?o("div",t):t:o("div"),this.contentContainer=this.container}show(){this.container.style.display=""}hide(){this.container.style.display="none"}set innerHTML(t){this.contentContainer.innerHTML=t}get innerHTML(){return this.contentContainer.innerHTML}set innerText(t){this.contentContainer.innerText=t}get innerText(){return this.contentContainer.innerText}appendChild(...t){if(1===t.length)this.appendHelper(this.contentContainer,t[0]);else{let e=document.createDocumentFragment();t.forEach((t=>{this.appendHelper(e,t)})),this.contentContainer.appendChild(e)}}appendHelper(t,e){e instanceof HTMLElement?t.appendChild(e):e&&t.appendChild(e.container)}removeChild(t){return!!this.hasChild(t)&&(t instanceof HTMLElement?this.contentContainer.removeChild(t):this.contentContainer.removeChild(t.container),!0)}hasChild(t){return t instanceof HTMLElement?this.contentContainer.contains(t):this.contentContainer.contains(t.container)}}class v{constructor(t,e){this.position=t,this.size=e}static fromClientRect(t){return new v(new w(t.left,t.top),w.fromSizeLike(t))}expand(t){let e=this.copy(),i=e.size.times(t),s=e.center,n=i.minus(e.size);return e.position.subtract(n.dividedBy(2)),e.size.add(n),e.center=s,e}get isSquare(){return this.width===this.height}plus(t){return new v(this.position.plus(t.position),this.size.plus(t.size))}times(t){return"number"==typeof t?new v(this.position.times(t),this.size.times(t)):new v(this.position.times(t.position),this.size.times(t.size))}translated(t){return new v(this.position.plus(t),this.size.copy())}toString(){return"("+this.x+", "+this.y+", "+this.width+", "+this.height+")"}fitInside(t,e){let i=t.aspectRatio,s=this.getPointFromAnchor(e).copy();i>this.aspectRatio?(this.width*=t.height/this.height,this.height=t.height):(this.height*=t.width/this.width,this.width=t.width),this.setPointFromAnchor(e,s)}setWidthKeepAR(t){let e=this.width/t;this.width=t,this.height=this.height/e}setHeightKeepAR(t){let e=this.height/t;this.height=t,this.width=this.width/e}expandToward(t,e){switch(t){case"ne":let t=this.bottomLeft;this.size.multiply(e),this.bottomLeft=t;break;case"nw":let i=this.bottomRight;this.size.multiply(e),this.bottomRight=i;break;case"se":let s=this.topLeft;this.size.multiply(e),this.topLeft=s;break;case"sw":let n=this.topRight;this.size.multiply(e),this.topRight=n}}fitInsideGreedyCenter(t,e){let i=t.aspectRatio,s=this.center.copy();this.size.copy();i>1?(this.height*=t.width/this.width,this.width=t.width):(this.width*=t.height/this.height,this.height=t.height),this.center=s,e.containsRect(this)||(this.right>e.right&&(this.setWidthKeepAR(2*(e.right-s.x)),this.center=s),this.bottom>e.bottom&&(this.setHeightKeepAR(2*(e.bottom-s.y)),this.center=s),this.left<e.left&&(this.setWidthKeepAR(2*(s.x-e.left)),this.center=s),this.top<e.top&&(this.setHeightKeepAR(2*(s.y-e.top)),this.center=s))}fitInsideGreedy(t,e,i){let s=t.aspectRatio,n=this.getPointFromAnchor(e).copy();s>1?(this.height*=t.width/this.width,this.width=t.width):(this.width*=t.height/this.height,this.height=t.height),this.setPointFromAnchor(e,n),i.containsRect(this)||(this.right>i.right&&(this.setWidthKeepAR(i.right-this.left),this.setPointFromAnchor(e,n)),this.bottom>i.bottom&&(this.setHeightKeepAR(i.bottom-this.top),this.setPointFromAnchor(e,n)),this.left<i.left&&(this.setWidthKeepAR(this.right-i.left),this.setPointFromAnchor(e,n)),this.top<i.top&&(this.setHeightKeepAR(this.bottom-i.top),this.setPointFromAnchor(e,n)))}copy(){return new v(this.position.copy(),this.size.copy())}mirror(t){this.position=t.position,this.size=t.size}getPointFromAnchor(t){switch(t){case"nw":return this.topLeft;case"ne":return this.topRight;case"sw":return this.bottomLeft;case"se":return this.bottomRight}}setPointFromAnchor(t,e){switch(t){case"nw":this.topLeft=e;break;case"ne":this.topRight=e;break;case"sw":this.bottomLeft=e;break;case"se":this.bottomRight=e}}static anchorOpposite(t){switch(t){case"nw":return"se";case"ne":return"sw";case"sw":return"ne";case"se":return"nw"}}get aspectRatio(){return this.width/this.height}round(t=!1){if(t){let t=this.center;this.size.round(),this.center=t.rounded}else this.position.round(),this.size.round()}get rounded(){return new v(this.position.rounded,this.size.rounded)}get local(){return new v(new w(0),this.size.copy())}get x(){return this.position.x}set x(t){this.position.x=t}get y(){return this.position.y}set y(t){this.position.y=t}get left(){return this.position.x}set left(t){this.position.x=t}get top(){return this.position.y}set top(t){this.position.y=t}get width(){return this.size.x}set width(t){this.size.x=t}get height(){return this.size.y}set height(t){this.size.y=t}get right(){return this.x+this.width}set right(t){this.x=t-this.width}get bottom(){return this.y+this.height}set bottom(t){this.y=t-this.height}get topLeft(){return this.position}set topLeft(t){this.position=t}get topRight(){return this.position.plus(new w(this.width,0))}set topRight(t){this.position=t.minus(new w(this.width,0))}get bottomLeft(){return this.position.plus(new w(0,this.height))}set bottomLeft(t){this.position=t.minus(new w(0,this.height))}get bottomRight(){return this.position.plus(this.size)}set bottomRight(t){this.position=t.minus(this.size)}get center(){return this.position.plus(this.size.times(.5))}set center(t){this.position=t.minus(this.size.times(.5))}get cx(){return this.center.x}set cx(t){this.position.x=t-this.size.x/2}get cy(){return this.center.y}set cy(t){this.position.y=t-this.size.y/2}containsPoint(t){return t.x>=this.x&&t.x<=this.right&&t.y>=this.y&&t.y<=this.bottom}containsRect(t){return this.containsPoint(t.topLeft)&&this.containsPoint(t.bottomRight)}intersects(t){return!(t.left>=this.right||t.right<=this.left||t.top>=this.bottom||t.bottom<=this.top)}static between(t,e){let i=new w(Math.min(t.x,e.x),Math.min(t.y,e.y)),s=new w(Math.abs(t.x-e.x),Math.abs(t.y-e.y));return new v(i,s)}}class w{constructor(t,e){void 0===t?(this.x=0,this.y=0):void 0===e?(this.x=t,this.y=t):(this.x=t,this.y=e)}static fromSizeLike(t){return new w(t.width,t.height)}static fromPointLike(t){return new w(t.x,t.y)}toRectangle(t){return new v(t||new w(0),this.copy())}get xOnly(){return new w(this.x,0)}get yOnly(){return new w(0,this.y)}get unitX(){return new w(this.x>0?1:-1,this.y/this.x)}get unitY(){return new w(this.x/this.y,this.y>0?1:-1)}get inverted(){return this.times(-1)}reverseByX(t){let e=this.unitX.inverted.times(t);this.x=e.x,this.y=e.y}reverseByY(t){let e=this.unitY.inverted.times(t);this.x=e.x,this.y=e.y}static fromArray(t){return new w(...t)}static fromIndex(t,e){return new w(t%e,~~(t/e))}static fromAngle(t){return new w(Math.cos(t),Math.sin(t))}equals(t){return this.x===t.x&&this.y===t.y}copy(){return new w(this.x,this.y)}round(){this.x=Math.round(this.x),this.y=Math.round(this.y)}get rounded(){return new w(Math.round(this.x),Math.round(this.y))}times(t){let e=this.copy();return e.multiply(t),e}multiply(t){t instanceof w?(this.x*=t.x,this.y*=t.y):(this.x*=t,this.y*=t)}dividedBy(t){let e=this.copy();return e.divideBy(t),e}divideBy(t){t instanceof w?(this.x/=t.x,this.y/=t.y):(this.x/=t,this.y/=t)}plus(t){let e=this.copy();return e.add(t),e}add(t){t instanceof w?(this.x+=t.x,this.y+=t.y):(this.x+=t,this.y+=t)}minus(t){let e=this.copy();return e.subtract(t),e}subtract(t){t instanceof w?(this.x-=t.x,this.y-=t.y):(this.x-=t,this.y-=t)}get squared(){return this.times(this)}get sum(){return this.x+this.y}get min(){return Math.min(this.x,this.y)}get max(){return Math.max(this.x,this.y)}distanceTo(t){return Math.sqrt(this.minus(t).squared.sum)}toString(){return"("+this.x+", "+this.y+")"}toArray(){return[this.x,this.y]}}class y{constructor(t={}){(t=t||{}).canvasElement?"string"==typeof t.canvasElement&&(t.canvasElement=document.querySelector(t.canvasElement)):t.canvasElement=document.createElement("canvas"),this.canvas=t.canvasElement,this.context=this.canvas.getContext("2d",{alpha:!t.opaque}),t.size=t.size||new w(1),this.resize(t.size,!1),this.translation=new w(0),this.align={horizontal:t.align&&t.align.horizontal||!1,vertical:t.align&&t.align.vertical||!1},this.align.horizontal||this.align.vertical||(this.canvas.style.transformOrigin="top left"),this.usingDeepCalc=t.deepCalc||!1,this.pixelated=t.pixelated||!1,this.usingDeepCalc&&(this.deepCalcPosition(),window.addEventListener("resize",this.deepCalcPosition)),this.mouse={isDown:!1,lastPos:null,originalPos:{x:-1,y:-1},events:{move:[],down:[],up:[],leave:[]}},this.canvas.addEventListener("mousemove",this.mouseMove.bind(this)),this.canvas.addEventListener("touchmove",this.mouseMove.bind(this)),this.canvas.addEventListener("mousedown",this.mouseDown.bind(this)),this.canvas.addEventListener("touchstart",this.mouseDown.bind(this)),this.canvas.addEventListener("mouseup",this.mouseUp.bind(this)),this.canvas.addEventListener("touchend",this.mouseUp.bind(this)),this.canvas.addEventListener("mouseleave",this.mouseLeave.bind(this)),this.canvas.addEventListener("touchcancel",this.mouseLeave.bind(this))}addEventListener(t,e){-1!==["mouseup","mousedown","mousemove","mouseleave"].indexOf(t)&&this.mouse.events[t.substr(5)].push(e)}resize(t,e){let i;e&&(i=this.canvas.cloneNode()),this.canvas.width=t.x,this.canvas.height=t.y,e&&this.drawImage(i,new w(0))}zoom(t){let e,i;"number"==typeof t?(e=t,i=t):(e=t.x,i=t.y),this.canvas.style.transform="scale("+e+", "+i+")"}zoomToFit(t){let e=t.x/this.width,i=t.y/this.height;e<i?this.zoom(e):this.zoom(i)}scale(t){return this.zoom(t)}clear(){this.context.clearRect(-this.translation.x,-this.translation.y,this.canvas.width,this.canvas.height)}deepCalcPosition(){let t,e=this.canvas,i=0,s=0;for(;e&&!isNaN(e.offsetLeft)&&!isNaN(e.offsetTop);)t=window.getComputedStyle(e,null),i+=e.offsetLeft-e.scrollLeft+(t?parseInt(t.getPropertyValue("border-left-width"),10):0),s+=e.offsetTop-e.scrollTop+(t?parseInt(t.getPropertyValue("border-top-width"),10):0),e=e.offsetParent;this.offset=new w(i,s)}posFromEvent(t){let e=new w;e=t instanceof MouseEvent?new w(t.pageX,t.pageY):new w(t.changedTouches[0].pageX,t.changedTouches[0].pageY),this.usingDeepCalc&&this.deepCalcPosition();let i=this.canvas.getBoundingClientRect(),s=this.usingDeepCalc?this.offset.copy():new w(i.left,i.top);return this.align.horizontal&&s.x>0&&(s.x=(2*s.x-i.width)/2),this.align.vertical&&s.y>0&&(s.y=(2*s.y-i.height)/2),e.subtract(s),e.multiply(this.size.dividedBy(new w(i.width,i.height))),e}get size(){return new w(this.canvas.width,this.canvas.height)}mouseMove(t){let e=this.posFromEvent(t);this.mouse.lastPos||(this.mouse.lastPos=e),this.mouse.isDown||(this.mouse.originalPos=e),this.mouse.events.move.forEach((i=>{!1!==i.call(this,e.x,e.y,this.mouse.isDown,this.mouse.lastPos.x,this.mouse.lastPos.y,this.mouse.originalPos.x,this.mouse.originalPos.y,t)&&(this.mouse.lastPos=e)}))}mouseDown(t){let e=this.posFromEvent(t);this.mouse.isDown=!0,this.mouse.lastPos=e,this.mouse.originalPos=e,this.mouse.events.down.forEach((i=>{i.call(this,e.x,e.y,t)}))}mouseUp(t){let e=this.posFromEvent(t);this.mouse.isDown=!1,this.mouse.events.up.forEach((i=>{i.call(this,e.x,e.y,this.mouse.originalPos.x,this.mouse.originalPos.y,t)})),this.mouse.lastPos=e}mouseLeave(t){let e=this.posFromEvent(t);this.mouse.events.leave.forEach((i=>{i.call(this,e.x,e.y,t)}))}set pixelated(t){t=!t;let e=this.context;if(e.mozImageSmoothingEnabled=t,e.webkitImageSmoothingEnabled=t,e.imageSmoothingEnabled=t,t)this.canvas.style["image-rendering"]="";else{["optimizeSpeed","crisp-edges","-moz-crisp-edges","-webkit-optimize-contrast","optimize-contrast","pixelated"].forEach((t=>this.canvas.style["image-rendering"]=t))}}get width(){return this.canvas.width}get height(){return this.canvas.height}get opacity(){return this.context.globalAlpha}set opacity(t){this.context.globalAlpha=t}get color(){return this.context.fillStyle}set color(t){void 0!==t&&(this.context.fillStyle=t,this.context.strokeStyle=t)}get font(){return this.context.font}set font(t){void 0!==t&&(this.context.font=t)}get lineWidth(){return this.context.lineWidth}set lineWidth(t){void 0!==t&&(this.context.lineWidth=t)}get blendMode(){return this.context.globalCompositeOperation}set blendMode(t){this.context.globalCompositeOperation=t}get lineDash(){return this.context.getLineDash()}set lineDash(t){this.context.setLineDash(t)}createBlob(t,e){this.canvas.toBlob((function(e){t(e)}),e)}createImage(t,e,i=!0){this.canvas.toBlob((function(e){let s=new Image;s.onload=()=>{t(s),s.onload=null,i&&URL.revokeObjectURL(s.src)};let n=URL.createObjectURL(e);s.src=n}),e)}get imageData(){return this.context.getImageData(0,0,this.width,this.height)}drawImage(t,e){t instanceof y&&(t=t.canvas),e instanceof w?this.context.drawImage(t,e.x,e.y):this.context.drawImage(t,e.x,e.y,e.width,e.height)}drawCroppedImage(t,e,i){t instanceof y&&(t=t.canvas),e instanceof w?this.context.drawImage(t,i.x,i.y,i.width,i.height,e.x,e.y,i.width,i.height):this.context.drawImage(t,i.x,i.y,i.width,i.height,e.x,e.y,e.width,e.height)}drawRotatedCroppedImage(t,e,i,s,n){t instanceof y&&(t=t.canvas);var r=this.context;r.save(),r.translate(s.x+i.x,s.y+i.y),r.rotate(e),s instanceof w?r.drawImage(t,n.x,n.y,n.width,n.height,-i.x,-i.y,t.width,t.height):r.drawImage(t,n.x,n.y,n.width,n.height,-i.x,-i.y,s.width,s.height),r.restore()}fillWithImage(t,e){e&&this.resize(new w(t.width,t.height),!1),this.drawImage(t,new w(0))}drawLine(t,e,i,s){this.color=i,this.lineWidth=s,this.context.beginPath(),this.context.moveTo(t.x,t.y),this.context.lineTo(e.x,e.y),this.context.stroke()}drawArc(t,e,i,s,n,r){this.color=n,this.lineWidth=r,this.context.beginPath(),this.context.arc(t.x,t.y,e,i,s),this.context.stroke()}drawRect(t,e,i,s=!0){this.color=e,this.lineWidth=i,s&&(t=t.translated(new w(.5))),this.context.strokeRect(t.x,t.y,t.width,t.height)}fillRect(t,e){this.color=e,this.context.fillRect(t.x,t.y,t.width,t.height)}drawBanner(t,e){this.context.beginPath(),this.context.moveTo(t.left-(t.width/5+t.width/13.33),t.cy),this.context.lineTo(t.left,t.cy),this.context.arc(t.center.x,t.center.y,t.width/2,Math.PI,1.5*Math.PI,!1),this.context.arc(t.center.x,t.center.y,t.width/2,1.5*Math.PI,2*Math.PI,!1),this.context.lineTo(t.right+2.4*t.width+t.width/13.33,t.cy),this.context.lineTo(t.right+2.4*t.width+t.width/13.33,t.cy-1.5*t.width),this.context.lineTo(t.left-(t.width/5+t.width/13.33),t.cy-1.5*t.width),this.context.lineTo(t.left-(t.width/5+t.width/13.33),t.cy),this.context.lineWidth=e,this.context.strokeStyle="yellow",this.context.stroke(),this.context.beginPath(),this.context.moveTo(t.left-t.width/13.33,t.cy),this.context.arc(t.center.x,t.center.y,t.width/2+t.width/13.33,Math.PI,1.5*Math.PI,!1),this.context.arc(t.center.x,t.center.y,t.width/2+t.width/13.33,1.5*Math.PI,2*Math.PI,!1),this.context.strokeStyle="red",this.context.stroke()}drawRoundedRect(t,e,i,s,n=!0){this.color=i,this.lineWidth=s,n&&(t=t.translated(new w(.5))),t.width<2*e&&(e=t.width/2),t.height<2*e&&(e=t.height/2),this.context.beginPath(),this.context.moveTo(t.x+e,t.y),this.context.arcTo(t.right,t.y,t.right,t.bottom,e),this.context.arcTo(t.right,t.bottom,t.x,t.bottom,e),this.context.arcTo(t.x,t.bottom,t.x,t.y,e),this.context.arcTo(t.x,t.y,t.right,t.y,e),this.context.closePath(),this.context.stroke()}fillRoundedRect(t,e,i,s=!0){this.color=i,s&&(t=t.translated(new w(.5))),t.width<2*e&&(e=t.width/2),t.height<2*e&&(e=t.height/2),this.context.beginPath(),this.context.moveTo(t.x+e,t.y),this.context.arcTo(t.right,t.y,t.right,t.bottom,e),this.context.arcTo(t.right,t.bottom,t.x,t.bottom,e),this.context.arcTo(t.x,t.bottom,t.x,t.y,e),this.context.arcTo(t.x,t.y,t.right,t.y,e),this.context.closePath(),this.context.fill()}fill(t){this.fillRect(new v(new w(0),this.size),t)}fillText(t,e,i,s,n,r){this.color=i,r&&(this.font=r),s&&(this.context.textBaseline=s),n&&(this.context.textAlign=n),this.context.fillText(t,e.x,e.y)}fillCircle(t,e,i){this.color=i,this.context.beginPath(),this.context.arc(t.x,t.y,e,0,2*Math.PI,!1),this.context.fill()}fillCircleInSquare(t,e,i){this.color=i,this.context.beginPath(),this.context.arc(t.x+e/2,t.y+e/2,e/2,0,2*Math.PI,!1),this.context.fill()}drawCircleInSquare(t,e,i,s){this.color=i,this.lineWidth=s,this.context.beginPath(),this.context.arc(t.x+e/2,t.y+e/2,e/2,0,2*Math.PI,!1),this.context.stroke()}fillCircleInRect(t,e){if(t.isSquare)return this.fillCircleInSquare(t.position,t.width,e);this.color=e,this.context.beginPath(),this.context.ellipse(t.x,t.y,t.width/2,t.height/2,0,0,2*Math.PI),this.context.fill()}drawCircleInRect(t,e,i){if(t.isSquare)return this.drawCircleInSquare(t.position,t.width,e,i);this.color=e,this.lineWidth=i,this.context.beginPath(),this.context.ellipse(t.x,t.y,t.width/2,t.height/2,0,0,2*Math.PI),this.context.stroke()}drawRotatedImage(t,e,i){let s,n;t instanceof y&&(t=t.canvas),i instanceof w?(s=t.width,n=t.height):(s=i.width,n=i.height),this.context.save(),this.context.translate(i.x+s/2,i.y+n/2),this.context.rotate(e),this.context.drawImage(t,-s/2,-n/2,s,n),this.context.restore()}static fileToImage(t,e,i=!0){let s=new Image;s.onload=()=>{e(s),i&&window.URL.revokeObjectURL(s.src)},s.src=window.URL.createObjectURL(t)}}HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(t,e,i){var s=this;setTimeout((function(){for(var n=atob(s.toDataURL(e,i).split(",")[1]),r=n.length,o=new Uint8Array(r),a=0;a<r;a++)o[a]=n.charCodeAt(a);t(new Blob([o],{type:e||"image/png"}))}))}});class x extends f{constructor(){super(o("div","progressBar")),this.progressElement=o("div","progress"),this.progressElement.style.height="100%",this.progress=0,this.appendChild(this.progressElement)}set progress(t){this._progress=t,this.progressElement.style.width=100*t+"%"}get progress(){return this._progress}}class b extends x{constructor(){super(),this.fractionParts=[],this.totalFractions=0}addFractionPart(t,e){this.fractionParts.push({fractionsOfWhole:t,internalSteps:e,counter:0}),this.totalFractions+=t}step(){this.fractionParts.length>0&&(this.fractionParts[0].counter++,this.progress+=1/this.fractionParts[0].internalSteps*this.fractionParts[0].fractionsOfWhole,this.fractionParts[0].counter===this.fractionParts[0].internalSteps&&this.fractionParts.shift())}reset(){this.fractionParts=[],this.progress=0}}class E extends f{constructor(){super("dialog-backdrop"),this.dialog=o("div","dialog"),this.dialog.addEventListener("click",u),this.container.appendChild(this.dialog),this.contentContainer=this.dialog,this.container.addEventListener("click",(()=>{this.dismiss()})),this.hide()}show(){super.show(),this.contentContainer.scrollTop=0}}class z extends E{constructor(){super(),this.dialog.classList.add("closable");let t=o("div","close");t.innerText="❌",t.addEventListener("click",(()=>{this.hide()})),this.appendChild(t),this.innerContent=o("div","innerContent"),this.appendChild(this.innerContent),this.contentContainer=this.innerContent}dismiss(){this.hide()}}class C{static get defaults(){return[{name:"LGBT Pride",angle:0,gradient:[{pos:0,color:"#FF0018"},{pos:.2,color:"#FFA52C"},{pos:.4,color:"#FFFF41"},{pos:.6,color:"#008018"},{pos:.8,color:"#0000F9"},{pos:1,color:"#86007D"}]},{name:"Trans Pride",angle:0,gradient:[{pos:0,color:"#55CDFC"},{pos:.25,color:"#F7A8B8"},{pos:.5,color:"#FFFFFF"},{pos:.75,color:"#F7A8B8"},{pos:1,color:"#55CDFC"}]},{name:"Nonbinary Pride",angle:0,gradient:[{pos:0,color:"#FFF430"},{pos:1/3,color:"#FFFFFF"},{pos:2/3,color:"#9C59D1"},{pos:1,color:"#000000"}]}]}static get type(){return this._type}static set type(t){this._type=t,m.emitEvent("borderchange")}static get size(){return this._size}static set size(t){this._size=t,m.emitEvent("borderchange")}static set color(t){this._color=t,m.emitEvent("borderchange")}static get color(){return this._color}static set gradient(t){this._gradient=t,m.emitEvent("borderchange")}static get gradient(){return this._gradient}static set shape(t){this._shape=t,m.emitEvent("borderchange")}static get shape(){return this._shape}static applyGradientToCanvas(t,e){let i=(-270-t.angle)*Math.PI/180,s=(-270-(t.angle+180))*Math.PI/180,n=new w(.5/Math.max(Math.abs(Math.cos(i)),Math.abs(Math.sin(i)))*Math.cos(i),.5/Math.max(Math.abs(Math.cos(i)),Math.abs(Math.sin(i)))*Math.sin(i)).times(e.size).plus(e.size.dividedBy(2)),r=new w(.5/Math.max(Math.abs(Math.cos(s)),Math.abs(Math.sin(s)))*Math.cos(s),.5/Math.max(Math.abs(Math.cos(s)),Math.abs(Math.sin(s)))*Math.sin(s)).times(e.size).plus(e.size.dividedBy(2)),o=e.context.createLinearGradient(n.x,r.y,r.x,n.y);t.gradient.forEach((t=>{o.addColorStop(t.pos,t.color)})),e.context.fillStyle=o,e.context.fillRect(0,0,e.width,e.height)}static apply(t){t.clear(),"none"!==this.type&&0!==this.size&&("solid"===this.type?(t.fill(this.color),t.blendMode="destination-out",t.fillCircleInRect(t.size.toRectangle().expand(1-this.size),"white"),t.blendMode="source-over"):"gradient"===this.type&&(this.applyGradientToCanvas(this.gradient,t),t.blendMode="destination-out","circle"===this.shape?t.fillCircleInRect(t.size.toRectangle().expand(1-this.size),"white"):t.fillRect(t.size.toRectangle().expand(1-this.size),"white"),t.blendMode="source-over"))}}C._type="none",C._size=.05,C._color="#FFAA00",C._gradient=C.defaults[0],C._shape="circle";var L,S,k={};L=k,S=function(){var t=!1,e=null,i=function(t){return t.reduce((function(t,e){return 2*t+e}),0)},s=function(t){for(var e=[],i=7;i>=0;i--)e.push(!!(t&1<<i));return e},n=function(t){this.data=t,this.len=this.data.length,this.pos=0,this.readByte=function(){if(this.pos>=this.data.length)throw new Error("Attempted to read past end of stream.");return t instanceof Uint8Array?t[this.pos++]:255&t.charCodeAt(this.pos++)},this.readBytes=function(t){for(var e=[],i=0;i<t;i++)e.push(this.readByte());return e},this.read=function(t){for(var e="",i=0;i<t;i++)e+=String.fromCharCode(this.readByte());return e},this.readUnsigned=function(){var t=this.readBytes(2);return(t[1]<<8)+t[0]}},r=function(n,r){r||(r={});var o=function(t){for(var e=[],i=0;i<t;i++)e.push(n.readBytes(3));return e},a=function(){var t,e;e="";do{t=n.readByte(),e+=n.read(t)}while(0!==t);return e},h=function(t){t.leftPos=n.readUnsigned(),t.topPos=n.readUnsigned(),t.width=n.readUnsigned(),t.height=n.readUnsigned();var e=s(n.readByte());t.lctFlag=e.shift(),t.interlaced=e.shift(),t.sorted=e.shift(),t.reserved=e.splice(0,2),t.lctSize=i(e.splice(0,3)),t.lctFlag&&(t.lct=o(1<<t.lctSize+1)),t.lzwMinCodeSize=n.readByte();var h=a();t.pixels=function(t,e){for(var i,s,n=0,r=function(t){for(var i=0,s=0;s<t;s++)e.charCodeAt(n>>3)&1<<(7&n)&&(i|=1<<s),n++;return i},o=[],a=1<<t,h=a+1,l=t+1,d=[],c=function(){d=[],l=t+1;for(var e=0;e<a;e++)d[e]=[e];d[a]=[],d[h]=null};;)if(s=i,(i=r(l))!==a){if(i===h)break;if(i<d.length)s!==a&&d.push(d[s].concat(d[i][0]));else{if(i!==d.length)throw new Error("Invalid LZW code.");d.push(d[s].concat(d[s][0]))}o.push.apply(o,d[i]),d.length===1<<l&&l<12&&l++}else c();return o}(t.lzwMinCodeSize,h),t.interlaced&&(t.pixels=function(t,e){for(var i,s,n,r=new Array(t.length),o=t.length/e,a=[0,4,2,1],h=[8,8,4,2],l=0,d=0;d<4;d++)for(var c=a[d];c<o;c+=h[d])i=c,s=l,n=void 0,n=t.slice(s*e,(s+1)*e),r.splice.apply(r,[i*e,e].concat(n)),l++;return r}(t.pixels,t.width)),r.img&&r.img(t)},l=function(){var o={};switch(o.sentinel=n.readByte(),String.fromCharCode(o.sentinel)){case"!":o.type="ext",function(t){var e;switch(t.label=n.readByte(),t.label){case 249:t.extType="gce",function(t){n.readByte();var e=s(n.readByte());t.reserved=e.splice(0,3),t.disposalMethod=i(e.splice(0,3)),t.userInput=e.shift(),t.transparencyGiven=e.shift(),t.delayTime=n.readUnsigned(),t.transparencyIndex=n.readByte(),t.terminator=n.readByte(),r.gce&&r.gce(t)}(t);break;case 254:t.extType="com",(e=t).comment=a(),r.com&&r.com(e);break;case 1:t.extType="pte",function(t){n.readByte(),t.ptHeader=n.readBytes(12),t.ptData=a(),r.pte&&r.pte(t)}(t);break;case 255:t.extType="app",function(t){var e;n.readByte(),t.identifier=n.read(8),t.authCode=n.read(3),"NETSCAPE"===t.identifier?(e=t,n.readByte(),e.unknown=n.readByte(),e.iterations=n.readUnsigned(),e.terminator=n.readByte(),r.app&&r.app.NETSCAPE&&r.app.NETSCAPE(e)):function(t){t.appData=a(),r.app&&r.app[t.identifier]&&r.app[t.identifier](t)}(t)}(t);break;default:t.extType="unknown",function(t){t.data=a(),r.unknown&&r.unknown(t)}(t)}}(o);break;case",":o.type="img",h(o);break;case";":o.type="eof",r.eof&&r.eof(o);break;default:throw new Error("Unknown block: 0x"+o.sentinel.toString(16))}if(t)return e&&e(),void(t=!1);"eof"!==o.type&&setTimeout(l,0)};!function(){var t={};if(t.sig=n.read(3),t.ver=n.read(3),"GIF"!==t.sig)throw new Error("Not a GIF file.");t.width=n.readUnsigned(),t.height=n.readUnsigned();var e=s(n.readByte());t.gctFlag=e.shift(),t.colorRes=i(e.splice(0,3)),t.sorted=e.shift(),t.gctSize=i(e.splice(0,3)),t.bgColor=n.readByte(),t.pixelAspectRatio=n.readByte(),t.gctFlag&&(t.gct=o(1<<t.gctSize+1)),r.hdr&&r.hdr(t)}(),setTimeout(l,0)};return function(i){var s,o,a={vp_l:0,vp_t:0,vp_w:null,vp_h:null,c_w:null,c_h:null};for(var h in i)a[h]=i[h];a.vp_w&&a.vp_h&&(a.is_vp=!0);var l=null,d=!1,c=null,p=null,u=null,g=null,m=null,f=null,v=null,w=!0,y=!1,x=[],b=[],E=a.gif;void 0===a.auto_play&&(a.auto_play=!E.getAttribute("rel:auto_play")||"1"==E.getAttribute("rel:auto_play"));var z,C,L,S,k,T,_,I,R,M,B,A,P=a.hasOwnProperty("on_end")?a.on_end:null,F=a.hasOwnProperty("loop_delay")?a.loop_delay:0,O=a.hasOwnProperty("loop_mode")?a.loop_mode:"auto",V=!a.hasOwnProperty("draw_while_loading")||a.draw_while_loading,D=!!V&&(!a.hasOwnProperty("show_progress_bar")||a.show_progress_bar),W=a.hasOwnProperty("progressbar_height")?a.progressbar_height:25,N=a.hasOwnProperty("progressbar_background_color")?a.progressbar_background_color:"rgba(255,255,255,0.4)",H=a.hasOwnProperty("progressbar_foreground_color")?a.progressbar_foreground_color:"rgba(255,0,22,.8)",U=function(){c=null,p=null,m=u,u=null,f=null},q=function(){try{r(s,Q)}catch(t){K("parse")}},G=function(t,e){R.width=t*et(),R.height=e*et(),B.style.minWidth=t*et()+"px",A.width=t,A.height=e,A.style.width=t+"px",A.style.height=e+"px",A.getContext("2d").setTransform(1,0,0,1,0,0)},j=function(t,e,i){if(i&&D){var s,n,r,o=W;a.is_vp?y?(n=(a.vp_t+a.vp_h-o)/et(),o/=et(),s=a.vp_l/et()+t/e*(a.vp_w/et()),r=R.width/et()):(n=a.vp_t+a.vp_h-o,s=a.vp_l+t/e*a.vp_w,r=R.width):(n=(R.height-o)/(y?et():1),s=t/e*R.width/(y?et():1),r=R.width/(y?et():1),o/=y?et():1),M.fillStyle=N,M.fillRect(s,n,r-s,o),M.fillStyle=H,M.fillRect(0,n,s,o)}},K=function(t){l=t,o={width:E.width,height:E.height},x=[],M.fillStyle="black",M.fillRect(0,0,a.c_w?a.c_w:o.width,a.c_h?a.c_h:o.height),M.strokeStyle="red",M.lineWidth=3,M.moveTo(0,0),M.lineTo(a.c_w?a.c_w:o.width,a.c_h?a.c_h:o.height),M.moveTo(0,a.c_h?a.c_h:o.height),M.lineTo(a.c_w?a.c_w:o.width,0),M.stroke()},X=function(){f&&(x.push({data:f.getImageData(0,0,o.width,o.height),delay:p}),b.push({x:0,y:0}))},J=(S=-1,k=0,T=function(t){S+=t,I()},z=!1,C=function(){null!==P&&P(E),k++,!1!==O||k<0?L():(z=!1,w=!1)},L=function(){if(z=w){T(1);var t=10*x[S].delay;t||(t=100),0==(S+1+x.length)%x.length?(t+=F,setTimeout(C,t)):setTimeout(L,t)}},I=function(){var t;(S=parseInt(S,10))>x.length-1&&(S=0),S<0&&(S=0),t=b[S],A.getContext("2d").putImageData(x[S].data,t.x,t.y),M.globalCompositeOperation="copy",M.drawImage(A,0,0)},{init:function(){l||(a.c_w&&a.c_h||M.scale(et(),et()),a.auto_play?_():(S=0,I()))},step:_=function(){z||setTimeout(L,0)},play:function(){w=!0,_()},pause:function(){w=!1},playing:w,move_relative:T,current_frame:function(){return S},frames:function(){return x},length:function(){return x.length},move_to:function(t){S=t,I()}}),Z=function(t){j(s.pos,s.data.length,t)},Y=function(){},$=function(t,e){return function(i){t(i),Z(e)}},Q={hdr:$((function(t){G((o=t).width,o.height)})),gce:$((function(t){X(),U(),c=t.transparencyGiven?t.transparencyIndex:null,p=t.delayTime,u=t.disposalMethod})),com:$(Y),app:{NETSCAPE:$(Y)},img:$((function(t){f||(f=A.getContext("2d"));var e=x.length,i=t.lctFlag?t.lct:o.gct;e>0&&(3===m?null!==g?f.putImageData(x[g].data,0,0):f.clearRect(v.leftPos,v.topPos,v.width,v.height):g=e-1,2===m&&f.clearRect(v.leftPos,v.topPos,v.width,v.height));var s=f.getImageData(t.leftPos,t.topPos,t.width,t.height);t.pixels.forEach((function(t,e){t!==c&&(s.data[4*e+0]=i[t][0],s.data[4*e+1]=i[t][1],s.data[4*e+2]=i[t][2],s.data[4*e+3]=255)})),f.putImageData(s,t.leftPos,t.topPos),y||(M.scale(et(),et()),y=!0),V&&(M.drawImage(A,0,0),V=a.auto_play),v=t}),!0),eof:function(t){X(),Z(!1),a.c_w&&a.c_h||(R.width=o.width*et(),R.height=o.height*et()),J.init(),d=!1,st&&st(E)}},tt=function(){var t=E.parentNode,e=document.createElement("div");R=document.createElement("canvas"),M=R.getContext("2d"),B=document.createElement("div"),A=document.createElement("canvas"),e.width=R.width=E.width,e.height=R.height=E.height,B.style.minWidth=E.width+"px",e.className="jsgif",B.className="jsgif_toolbar",e.appendChild(R),e.appendChild(B),t&&(t.insertBefore(e,E),t.removeChild(E)),a.c_w&&a.c_h&&G(a.c_w,a.c_h),it=!0},et=function(){return a.max_width&&o&&o.width>a.max_width?a.max_width/o.width:1},it=!1,st=!1,nt=function(t){return!d&&(st=t||!1,d=!0,x=[],U(),g=null,m=null,f=null,v=null,!0)};return{play:J.play,pause:J.pause,move_relative:J.move_relative,move_to:J.move_to,get_frames:function(){return J.frames()},get_playing:function(){return w},get_canvas:function(){return R},get_canvas_scale:function(){return et()},get_loading:function(){return d},get_auto_play:function(){return a.auto_play},get_length:function(){return J.length()},get_current_frame:function(){return J.current_frame()},load_url:function(i,r,o,a){if(nt(r)){e=a,t=!1;var h=new XMLHttpRequest;h.open("GET",i,!0),"overrideMimeType"in h?h.overrideMimeType("text/plain; charset=x-user-defined"):"responseType"in h?h.responseType="arraybuffer":h.setRequestHeader("Accept-Charset","x-user-defined"),h.onloadstart=function(){it||tt()},h.onload=function(t){200!=this.status&&K("xhr - response"),"response"in this||(this.response=new VBArray(this.responseText).toArray().map(String.fromCharCode).join(""));var e=this.response;e.toString().indexOf("ArrayBuffer")>0&&(e=new Uint8Array(e)),s=new n(e),setTimeout(q,0)},h.onprogress=function(t){t.lengthComputable&&j(t.loaded,t.total,!0),o&&o(t)},h.onerror=function(){K("xhr")},h.send()}},load:function(t,e,i){this.load_url(E.getAttribute("rel:animated_src")||E.src,t,e,i)},load_raw:function(t,e){nt(e)&&(it||tt(),s=new n(t),setTimeout(q,0))},abort:function(){t=!0},set_frame_offset:function(t,e){b[t]?(void 0!==e.x&&(b[t].x=e.x),void 0!==e.y&&(b[t].y=e.y)):b[t]=e}}}},"function"==typeof define&&define.amd?define([],S):"object"==typeof k?k=S():L.SuperGif=S();var T={};!function(t){if("object"==typeof T)T=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:void 0!==i?i:"undefined"!=typeof self?self:this).GIF=t()}}((function(){return function t(e,i,s){function n(o,a){if(!i[o]){if(!e[o]){var h=void 0;if(!a&&h)return h(o,!0);if(r)return r(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var d=i[o]={exports:{}};e[o][0].call(d.exports,(function(t){var i=e[o][1][t];return n(i||t)}),d,d.exports,t,e,i,s)}return i[o].exports}for(var r=void 0,o=0;o<s.length;o++)n(s[o]);return n}({1:[function(t,e,i){function s(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function n(t){return"function"==typeof t}function r(t){return"object"==typeof t&&null!==t}function o(t){return void 0===t}e.exports=s,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._maxListeners=void 0,s.defaultMaxListeners=10,s.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},s.prototype.emit=function(t){var e,i,s,a,h,l;if(this._events||(this._events={}),"error"===t&&(!this._events.error||r(this._events.error)&&!this._events.error.length)){if((e=arguments[1])instanceof Error)throw e;var d=new Error('Uncaught, unspecified "error" event. ('+e+")");throw d.context=e,d}if(o(i=this._events[t]))return!1;if(n(i))switch(arguments.length){case 1:i.call(this);break;case 2:i.call(this,arguments[1]);break;case 3:i.call(this,arguments[1],arguments[2]);break;default:a=Array.prototype.slice.call(arguments,1),i.apply(this,a)}else if(r(i))for(a=Array.prototype.slice.call(arguments,1),s=(l=i.slice()).length,h=0;h<s;h++)l[h].apply(this,a);return!0},s.prototype.addListener=function(t,e){var i;if(!n(e))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,n(e.listener)?e.listener:e),this._events[t]?r(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,r(this._events[t])&&!this._events[t].warned&&(i=o(this._maxListeners)?s.defaultMaxListeners:this._maxListeners)&&i>0&&this._events[t].length>i&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace()),this},s.prototype.on=s.prototype.addListener,s.prototype.once=function(t,e){if(!n(e))throw TypeError("listener must be a function");var i=!1;function s(){this.removeListener(t,s),i||(i=!0,e.apply(this,arguments))}return s.listener=e,this.on(t,s),this},s.prototype.removeListener=function(t,e){var i,s,o,a;if(!n(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(o=(i=this._events[t]).length,s=-1,i===e||n(i.listener)&&i.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(r(i)){for(a=o;a-- >0;)if(i[a]===e||i[a].listener&&i[a].listener===e){s=a;break}if(s<0)return this;1===i.length?(i.length=0,delete this._events[t]):i.splice(s,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},s.prototype.removeAllListeners=function(t){var e,i;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(n(i=this._events[t]))this.removeListener(t,i);else if(i)for(;i.length;)this.removeListener(t,i[i.length-1]);return delete this._events[t],this},s.prototype.listeners=function(t){return this._events&&this._events[t]?n(this._events[t])?[this._events[t]]:this._events[t].slice():[]},s.prototype.listenerCount=function(t){if(this._events){var e=this._events[t];if(n(e))return 1;if(e)return e.length}return 0},s.listenerCount=function(t,e){return t.listenerCount(e)}},{}],2:[function(t,e,i){var s,n,r,o,a;a=navigator.userAgent.toLowerCase(),o=navigator.platform.toLowerCase(),r="ie"===(s=a.match(/(opera|ie|firefox|chrome|version)[\s\/:]([\w\d\.]+)?.*?(safari|version[\s\/:]([\w\d\.]+)|$)/)||[null,"unknown",0])[1]&&document.documentMode,(n={name:"version"===s[1]?s[3]:s[1],version:r||parseFloat("opera"===s[1]&&s[4]?s[4]:s[2]),platform:{name:a.match(/ip(?:ad|od|hone)/)?"ios":(a.match(/(?:webos|android)/)||o.match(/mac|win|linux/)||["other"])[0]}})[n.name]=!0,n[n.name+parseInt(n.version,10)]=!0,n.platform[n.platform.name]=!0,e.exports=n},{}],3:[function(t,e,i){var s,n,r,o={}.hasOwnProperty,a=[].indexOf||function(t){for(var e=0,i=this.length;e<i;e++)if(e in this&&this[e]===t)return e;return-1},h=[].slice;s=t("events").EventEmitter,r=t("./browser.coffee"),n=function(t){var e,i;function s(t){var i,s,n;for(s in this.running=!1,this.options={},this.frames=[],this.freeWorkers=[],this.activeWorkers=[],this.setOptions(t),e)n=e[s],null==(i=this.options)[s]&&(i[s]=n)}return function(t,e){for(var i in e)o.call(e,i)&&(t[i]=e[i]);function s(){this.constructor=t}s.prototype=e.prototype,t.prototype=new s,t.__super__=e.prototype}(s,t),e={workerScript:"gif.worker.js",workers:2,repeat:0,background:"#00ff00",quality:10,width:null,height:null,transparent:65280,debug:!1,dither:!1},i={delay:500,copy:!1},s.prototype.setOption=function(t,e){if(this.options[t]=e,null!=this._canvas&&("width"===t||"height"===t))return this._canvas[t]=e},s.prototype.setOptions=function(t){var e,i,s;for(e in i=[],t)o.call(t,e)&&(s=t[e],i.push(this.setOption(e,s)));return i},s.prototype.addFrame=function(t,e){var s,n;for(n in null==e&&(e={}),(s={}).transparent=this.options.transparent,i)s[n]=e[n]||i[n];if(null==this.options.width&&this.setOption("width",t.width),null==this.options.height&&this.setOption("height",t.height),"undefined"!=typeof ImageData&&null!==ImageData&&t instanceof ImageData)s.data=t.data;else if("undefined"!=typeof CanvasRenderingContext2D&&null!==CanvasRenderingContext2D&&t instanceof CanvasRenderingContext2D||"undefined"!=typeof WebGLRenderingContext&&null!==WebGLRenderingContext&&t instanceof WebGLRenderingContext)e.copy?s.data=this.getContextData(t):s.context=t;else{if(null==t.childNodes)throw new Error("Invalid image");if(e.copy){var r=this.getImageData(t);s.data=r.data,s.transparent=r.transparent}else s.image=t}return this.frames.push(s)},s.prototype.render=function(){var t,e,i;if(this.running)throw new Error("Already running");if(null==this.options.width||null==this.options.height)throw new Error("Width and height must be set prior to rendering");if(this.running=!0,this.nextFrame=0,this.finishedFrames=0,this.imageParts=function(){var t,e,i;for(i=[],t=0,e=this.frames.length;0<=e?t<e:t>e;0<=e?++t:--t)i.push(null);return i}.call(this),e=this.spawnWorkers(),!0===this.options.globalPalette)this.renderNextFrame();else for(t=0,i=e;0<=i?t<i:t>i;0<=i?++t:--t)this.renderNextFrame();return this.emit("start"),this.emit("progress",0)},s.prototype.abort=function(){return this.activeWorkers.forEach((function(t){t.terminate()})),this.activeWorkers=[],this.freeWorkers.forEach((function(t){t.terminate()})),this.freeWorkers=[],this.running=!1,this.emit("abort")},s.prototype.spawnWorkers=function(){var t,e,i,s;return t=Math.min(this.options.workers,this.frames.length),function(){i=[];for(var s=e=this.freeWorkers.length;e<=t?s<t:s>t;e<=t?s++:s--)i.push(s);return i}.apply(this).forEach((s=this,function(t){var e;return s.log("spawning worker "+t),(e=new Worker(s.options.workerScript)).onmessage=function(t){return s.activeWorkers.splice(s.activeWorkers.indexOf(e),1),s.freeWorkers.push(e),s.frameFinished(t.data)},s.freeWorkers.push(e)})),t},s.prototype.frameFinished=function(t){var e,i;if(this.log("frame "+t.index+" finished - "+this.activeWorkers.length+" active"),this.finishedFrames++,this.emit("progress",this.finishedFrames/this.frames.length),this.imageParts[t.index]=t,!0===this.options.globalPalette&&(this.options.globalPalette=t.globalPalette,this.log("global palette analyzed"),this.frames.length>2))for(e=1,i=this.freeWorkers.length;1<=i?e<i:e>i;1<=i?++e:--e)this.renderNextFrame();return a.call(this.imageParts,null)>=0?this.renderNextFrame():this.finishRendering()},s.prototype.finishRendering=function(){var t,e,i,s,n,r,o,a,h,l,d,c,p,u,g,m;for(a=0,n=0,h=(u=this.imageParts).length;n<h;n++)a+=((e=u[n]).data.length-1)*e.pageSize+e.cursor;for(a+=e.pageSize-e.cursor,this.log("rendering finished - filesize "+Math.round(a/1e3)+"kb"),t=new Uint8Array(a),c=0,r=0,l=(g=this.imageParts).length;r<l;r++)for(i=o=0,d=(m=(e=g[r]).data).length;o<d;i=++o)p=m[i],t.set(p,c),i===e.data.length-1?c+=e.cursor:c+=e.pageSize;return s=new Blob([t],{type:"image/gif"}),this.activeWorkers.forEach((function(t){t.terminate()})),this.activeWorkers=[],this.freeWorkers.forEach((function(t){t.terminate()})),this.freeWorkers=[],this.emit("finished",s,t)},s.prototype.renderNextFrame=function(){var t,e,i;if(0!==this.freeWorkers.length&&!(this.nextFrame>=this.frames.length))return t=this.frames[this.nextFrame++],i=this.freeWorkers.shift(),e=this.getTask(t),this.log("starting frame "+(e.index+1)+" of "+this.frames.length),this.activeWorkers.push(i),i.postMessage(e)},s.prototype.getContextData=function(t){return t.getImageData(0,0,this.options.width,this.options.height).data},s.prototype.getImageData=function(t){var e;null==this._canvas&&(this._canvas=document.createElement("canvas"),this._canvas.width=this.options.width,this._canvas.height=this.options.height),e=this._canvas.getContext("2d");var i=[];void 0===window.colors&&(window.colors=[]),e.clearRect(0,0,this._canvas.width,this._canvas.height),e.drawImage(t,0,0);for(var s=this.getContextData(e),n=0,r=!1,o=0,a=0,h=0;h<s.length;h+=4){var l=s[h+0]<<16|s[h+1]<<8|s[h+2];o+=s[h+1],a+=(s[h]+s[h+2])/2,-1===i.indexOf(l)&&i.push(l),-1===window.colors.indexOf(l)&&window.colors.push(l),255!==s[h+3]&&(r=!0)}return r&&(n=o<a?65280:16711935),e.fillStyle="#"+n.toString(16).padStart(6,"0"),e.fillRect(0,0,this.options.width,this.options.height),e.drawImage(t,0,0),{data:this.getContextData(e),transparent:r?n:null}},s.prototype.getTask=function(t){var e,i;if(i={index:e=this.frames.indexOf(t),last:e===this.frames.length-1,delay:t.delay,transparent:t.transparent,width:this.options.width,height:this.options.height,quality:this.options.quality,dither:this.options.dither,globalPalette:this.options.globalPalette,repeat:this.options.repeat,canTransfer:"chrome"===r.name},null!=t.data)i.data=t.data;else if(null!=t.context)i.data=this.getContextData(t.context);else{if(null==t.image)throw new Error("Invalid frame");var s=this.getImageData(t.image);i.data=s.data,i.transparent=s.transparent}return i},s.prototype.log=function(){var t;if(t=1<=arguments.length?h.call(arguments,0):[],this.options.debug)return console.log.apply(console,t)},s}(s),e.exports=n},{"./browser.coffee":2,events:1}]},{},[3])(3)}));class _ extends z{constructor(t){super(),this.renderedString="Rendered! yayy",this.renderingString="Rendering...",this.shouldStopRendering=!1,this.currentlyRendering=!1,this.initialized=!1,this.dialog.classList.add("dialog-render"),this.createEvent("close"),this.cropView=t,this.headerElement=o("h1","header"),this.headerElement.innerText=this.renderingString,this.progressBar=new b,this.imageElement=o("img","image"),this.noteElement=o("div","note"),this.noteElement.innerText="Save as a square for Discord!!",this.pleaseWaitElement=o("div","pleaseWait"),this.pleaseWaitElement.innerText="Aborting render... please wait...",this.optionBar=o("div","optionBar"),this.saveButton=o("a","save"),this.saveButton.innerText="Save",this.saveButton.addEventListener("mouseover",(()=>{this.saveButton.href=this.imageElement.src})),this.appendChild(this.headerElement,this.progressBar,this.imageElement,this.noteElement,this.pleaseWaitElement,this.optionBar,this.saveButton),this.initialized=!0}render(t){this.currentlyRendering=!0,this.shouldStopRendering=!1,this.show(),"gif"===this.cropView.currentFileType?this.renderGif(t):(this.getFrameURLs(this.cropView.image,!1,!0,t,this.display.bind(this)),this.currentlyRendering=!1)}renderGif(t){let i=new(e(k))({gif:this.cropView.image.cloneNode()});this.loadGif=i;i.load((()=>{this.loadGif=null,this.shouldStopRendering&&(this.currentlyRendering=!1,this.tryClose());const s=this.cropView.Circle,n=new v(new w(s.left-(s.width/5+s.width/13.33),s.cy-1.5*s.width),new w(3.75*s.width,1.5*s.width));let r=new(e(T))({workers:3,quality:1,dither:!1,width:t?n.width:this.cropView.cropArea.width,height:t?n.height:this.cropView.cropArea.height,debug:!1,copy:!0}),o=i.get_length();this.progressBar.addFractionPart(1/6,o);let a=e=>{i.move_to(e),this.getFrameURLs(i.get_canvas(),!0,!1,t,(t=>{let s=new Image;s.addEventListener("load",(()=>{if(this.shouldStopRendering)return this.currentlyRendering=!1,void this.tryClose();r.addFrame(s,{delay:10*i.get_frames()[e].delay||10}),this.progressBar.step(),++e===o?r.render():a(e)})),s.src=t[0].url}))};r.on("finished",(t=>{let e=URL.createObjectURL(t);this.display([{label:"GIF",url:e}]),this.currentlyRendering=!1})),r.on("abort",(()=>{this.currentlyRendering=!1,this.tryClose()})),r.on("progress",(t=>{this.progressBar.progress=1/6+5*t/6,this.shouldStopRendering&&r.abort()})),a(0)}),void 0,(()=>{this.loadGif=null,this.currentlyRendering=!1,this.tryClose()}))}getFrameURLs(t,e,i,s,n){let r=[],o=i?2:1,a=0,h=(t,e,i)=>{a++,r[i]={url:t,label:e},a===o&&n(r)},l=new y({size:this.cropView.cropArea.size,pixelated:e});C.apply(l);let d=new y({size:this.cropView.outerSize,pixelated:e});d.drawRotatedImage(t,this.cropView.rotation/180*Math.PI,this.cropView.outerSize.dividedBy(2).minus(this.cropView.innerSize.dividedBy(2)));var c=this.cropView.Circle;let p=new y({size:s?new w(3.75*c.width,1.5*c.width):this.cropView.cropArea.size,pixelated:e});if(1==s?p.drawCroppedImage(d,new w(0),new v(new w(c.left-(c.width/5+c.width/13.33),c.cy-1.5*c.width),new w(3.75*c.width,1.5*c.width))):p.drawCroppedImage(d,new w(0),this.cropView.cropArea),p.drawImage(l,new w(0)),p.createBlob((t=>{h(URL.createObjectURL(t),"Square",0)})),i){let t=new y({size:this.cropView.cropArea.size,pixelated:e});t.drawCroppedImage(d,new w(0),this.cropView.cropArea),t.drawImage(l,new w(0)),t.blendMode="destination-in",t.fillCircleInSquare(new w(0),t.width,"white"),t.createBlob((t=>{h(URL.createObjectURL(t),"Circle",1)}))}}display(t){let e;this.progressBar.hide(),d(this.optionBar),d(this.saveButton),this.headerElement.innerText=this.renderedString,this.optionBar.innerHTML="",t.forEach(((i,s)=>{let n=o("button","option");n.style.width=1/t.length*100+"%",n.innerText=i.label,n.url=i.url,n.addEventListener("click",(()=>{this.imageElement.src=i.url;let t=this.optionBar.children;for(let e=0;e<t.length;e++)t[e].classList.remove("toggled");n.classList.add("toggled")})),this.optionBar.appendChild(n),0===s&&(e=n)})),this.imageElement.onload=()=>{this.contentContainer.scrollTop=this.contentContainer.scrollHeight,this.imageElement.onload=null},e.click()}show(){this.progressBar.show(),this.progressBar.reset(),this.headerElement.innerText=this.renderingString,l(this.optionBar),l(this.saveButton),l(this.pleaseWaitElement),this.imageElement.src="",this.saveButton.setAttribute("download",this.cropView.filename),a(this.imageElement,!this.cropView.antialias),super.show()}hide(t=!1){t||!this.initialized?super.hide():this.tryClose()}tryClose(){if(this.currentlyRendering)return this.shouldStopRendering=!0,this.loadGif&&this.loadGif.abort(),d(this.pleaseWaitElement),!1;let t=this.optionBar.children;for(let e=0;e<t.length;e++)t[e].url&&URL.revokeObjectURL(t[e].url);return this.emitEvent("close"),this.hide(!0),!0}}let I;!function(t){t[t.left=37]="left",t[t.up=38]="up",t[t.right=39]="right",t[t.down=40]="down"}(I||(I={}));class R{static initialize(){window.addEventListener("keydown",(t=>R.keysDown[t.keyCode]=!0)),window.addEventListener("keyup",(t=>R.keysDown[t.keyCode]=!1))}static isDown(t){return this.keysDown[t]||!1}static axis(t,e){return+this.isDown(t)-+this.isDown(e)}static isArrowKey(t){return t>=37&&t<=40}}R.keysDown={};class M extends f{constructor(t){super(t),this.dirty=!1,this.frameWaiting=!1}update(t){this.dirty=!0,this.frameWaiting||this.requestAnimationFrame()}_draw(){this.dirty?(this.draw(),this.dirty=!1,this.requestAnimationFrame()):this.frameWaiting=!1}requestAnimationFrame(){this.frameWaiting=!0,requestAnimationFrame(this._draw.bind(this))}}class B extends v{constructor(t){super(new w,new w),this.cropView=t,this.saveOrigin()}get radius(){return this.size.dividedBy(2)}set radius(t){this.size=t.times(2)}reset(){this.position=new w(0),this.size=new w(this.cropView.outerRect.size.min/2)}get rectangle(){return this.copy()}saveOrigin(){this._origin=this.copy()}get origin(){return this._origin}validate(){let t=0;return this.width>this.cropView.outerSize.x&&(this.setWidthKeepAR(this.cropView.outerSize.x),t|=1),this.height>this.cropView.outerSize.y&&(this.setHeightKeepAR(this.cropView.outerSize.y),t|=2),this.x<0&&(this.x=0,t|=4),this.y<0&&(this.y=0,t|=8),this.bottom>this.cropView.outerSize.y&&(this.bottom=this.cropView.outerSize.y,t|=16),this.right>this.cropView.outerSize.x&&(this.right=this.cropView.outerSize.x,t|=32),t}}class A extends M{constructor(t){super(o("div","cropView")),this._isZoomFitted=!1,this._zoomFactor=1,this.currentRotation=0,this.currentAction="none",this.loadingImage=!1,this.createEvent("update"),this.createEvent("imagechange"),this.createEvent("antialiaschange"),this.createEvent("actionstart"),this.createEvent("actionend"),this.settings=t,this.circle=new B(this),this.renderer=new _(this),this.image=o("img","image"),this.image.style.transformOrigin="top left",this.overlay=new y({deepCalc:!0}),this.appendChild(this.image,this.overlay.canvas),document.body.appendChild(this.renderer.container),this.overlay.addEventListener("mousemove",this.mouseMove.bind(this)),this.overlay.addEventListener("mousedown",this.mouseDown.bind(this)),this.overlay.canvas.addEventListener("touchmove",(t=>{"new"!==this.currentAction&&"none"!==this.currentAction&&t.preventDefault()})),document.body.addEventListener("mouseup",(()=>{let t=this.currentAction;this.currentAction="none","none"!==t&&(this.update("mouseup"),this.emitEvent("actionend"))})),document.body.addEventListener("touchend",(()=>{let t=this.currentAction;this.currentAction="none","none"!==t&&(this.update("touchend"),this.emitEvent("actionend"))})),window.addEventListener("keydown",(t=>this.handleKeypress(t.keyCode))),this.antialias=this.settings.antialias}handleKeypress(t){R.isArrowKey(t)&&(this.circle.x+=R.axis(I.right,I.left),this.circle.y+=R.axis(I.down,I.up),this.circle.validate(),this.update("ketypress"))}get rotation(){return this.currentRotation}get cropArea(){return this.circle.rectangle}get Circle(){return this.circle}get zoomFactor(){return this._zoomFactor}update(t){super.update(t),this.emitEvent("update",t)}reactTMToRefresh(){this.isZoomFitted&&this.zoomFit()}draw(){1!==this.settings.maskOpacity&&this.overlay.clear(),0!==this.settings.maskOpacity&&(this.overlay.fill("rgba(0,0,0,"+this.settings.maskOpacity+")"),this.overlay.blendMode="destination-out","circle"===this.settings.previewMode?this.overlay.fillCircleInRect(this.circle,"white"):"square"===this.settings.previewMode&&this.overlay.fillRect(this.circle,"white")),this.overlay.blendMode="source-over";let t=1+~~(1/this.zoomFactor);if(this.settings.outlinesEnabled){let e=t%2==1;this.overlay.lineDash=[Math.min(this.overlay.width,this.overlay.height)/100],"circle"===this.settings.previewMode&&this.overlay.drawCircleInRect(this.circle,"white",t),this.overlay.drawRect(new v(this.circle.position.minus(t),this.circle.size.plus(t)),"white",t,e)}this.settings.guidesEnabled&&(this.overlay.drawBanner(this.circle,t),this.overlay.context.lineDashOffset=0)}get innerRect(){return new v(new w(0),this.innerSize)}get innerSize(){return new w(this.image.width,this.image.height)}get outerRect(){return new v(new w(0),this.outerSize)}get outerSize(){return new w(this.overlay.width,this.overlay.height)}get apparentSize(){return w.fromSizeLike(this.container.getBoundingClientRect())}get isZoomFitted(){return this._isZoomFitted}set isZoomFitted(t){this._isZoomFitted=t,this.container.style.overflow=t?"hidden":""}zoom(t,e=!0){let i=this.container.scrollTop/this.container.scrollHeight;this.container.scrollLeft,this.container.scrollWidth;this.container.scrollTop=0,this.container.scrollLeft=0;let s="";-1!==this.image.style.transform.indexOf(" rotate")&&(s=this.image.style.transform.substr(this.image.style.transform.indexOf(" rotate"))),t=t||this.zoomFactor,this._zoomFactor=t,this.overlay.zoom(t),this.image.style.transform="scale("+t+","+t+")",this.image.style.transform+=s;let n=this.image.getBoundingClientRect();if(0!==n.left){let t=parseFloat(this.image.style.left||"0px");t-=n.left,this.image.style.left=t+"px"}if(0!==n.top){let t=parseFloat(this.image.style.top||"0px");t-=n.top,this.image.style.top=t+"px"}e&&this.update("zoom"),this.container.scrollTop=i*this.container.scrollHeight,this.container.scrollLeft=i*this.contentContainer.scrollWidth}zoomIn(){this.isZoomFitted=!1,this.zoom(1.1*this.zoomFactor)}zoomOut(){this.isZoomFitted=!1,this.zoom(this.zoomFactor/1.1)}zoomFit(t=!0,e=!0){if(this.image&&(this.isZoomFitted||t)){this.isZoomFitted=!0;var i=this.container.getBoundingClientRect(),s=this.overlay.width,n=this.overlay.height,r=i.width/s,o=i.height/n,a=Math.min(r,o);this.zoom(a,e)}}rotate(t,e=!0){this.currentRotation;void 0===t&&(t=this.currentRotation),this.currentRotation=t,-1!==this.image.style.transform.indexOf(" rotate")&&(this.image.style.transform=this.image.style.transform.substr(0,this.image.style.transform.indexOf(" rotate")));let i=this.image.style.transform;this.image.style.left="0px",this.image.style.top="0px";let s=w.fromSizeLike(this.image),n=w.fromSizeLike(this.image.getBoundingClientRect());this.image.style.transform=i+" rotate("+t+"deg)";let r=v.fromClientRect(this.image.getBoundingClientRect()),o=r.topLeft.inverted.minus(new w(this.container.scrollLeft,this.container.scrollTop));this.image.style.left=o.x+"px",this.image.style.top=o.y+"px",s.multiply(r.size.dividedBy(n)),this.overlay.resize(s,!1),this.zoomFit(!1,e),this.circle.validate(),e&&this.update("rotate")}set antialias(t){a(this.image,!t),this.overlay.pixelated=!t,this.antialiased=t,this.emitEvent("antialiaschange",this.antialiased)}get antialias(){return this.antialiased}setImageFromFile(t){return!(!t||"image"!==t.type.split("/")[0]||this.loadingImage)&&(this.currentFileType="gif"===t.type.split("/")[1]?"gif":"png",this._filename=t.name.substring(0,t.name.lastIndexOf("."))+"_cropped."+this.currentFileType,this.loadingImage=!0,y.fileToImage(t,this.setImageFromFileHelper.bind(this),!1),!0)}setImageFromFileHelper(t){this.image.src&&URL.revokeObjectURL(this.image.src),this.overlay.resize(w.fromSizeLike(t),!1),this.overlay.clear(),this.image.width=t.width,this.image.height=t.height,this.image.src=t.src,this.circle.reset(),this.zoomFit(!0,!1),this.rotate(0,!1),this.emitEvent("imagechange",this.image.src),this.update("image change"),this.loadingImage=!1}flipHorizontal(){let t=new y({size:w.fromSizeLike(this.image)});t.context.scale(-1,1),t.drawImage(this.image,new v(new w(0),w.fromSizeLike(this.image).times(new w(-1,1)))),t.context.setTransform(1,0,0,1,0,0),this.loadingImage=!0,t.createImage((t=>{this.flipHelper(t,!0)}),void 0,!1)}flipVertical(){let t=new y({size:w.fromSizeLike(this.image)});t.context.scale(1,-1),t.drawImage(this.image,new v(new w(0),w.fromSizeLike(this.image).times(new w(1,-1)))),t.context.setTransform(1,0,0,1,0,0),this.loadingImage=!0,t.createImage((t=>{this.flipHelper(t,!1)}),void 0,!1)}flipHelper(t,e){this.image.src&&URL.revokeObjectURL(this.image.src),this.image.onload=()=>{this.rotate(-this.rotation,!1),e?this.circle.cx=this.outerSize.x-this.circle.cx:this.circle.cy=this.outerSize.y-this.circle.cy,this.emitEvent("imagechange",this.image.src),this.update("flippy"),this.loadingImage=!1},this.image.src=t.src}renderCroppedImage(){this.renderer.render(!1)}renderBanner(){this.renderer.render(!0)}get filename(){return this._filename}get src(){return this.image.src||null}centerCropArea(){this.circle.center=this.outerRect.center,this.circle.validate(),this.update("center crop")}setCropSize(t){this.circle.size=new w(t),this.circle.validate(),this.update("set crop size")}getCropSize(){return this.circle.size}setCropArea(t){this.circle.center=t,this.update("set crop area")}setCropSizewithoutcheck(t){this.circle.size=t,this.update("set crop size")}getMouseAction(t,e){new w(t,e);if(this.circle.containsPoint(new w(t,e))){return this.circle.center.distanceTo(new w(t,e))>=this.circle.radius.x?"resize":"move"}return"new"}mouseDown(t,e){var i=this.getMouseAction(t,e);this.currentAction=i,"none"!==this.currentAction&&this.emitEvent("actionstart"),this.mouseOrigin=new w(t,e),this.circle.saveOrigin(),this.resizeOffset=this.circle.getPointFromAnchor(this.getCircleAnchor(this.mouseOrigin)).minus(this.mouseOrigin)}mouseMove(t,e){let i=this.currentAction;if("none"===i&&(i=this.getMouseAction(t,e)),"move"===i)this.overlay.canvas.style.cursor="move";else if("resize"===i){let i=t<this.circle.cx,s=e<this.circle.cy,n=+i^+s;this.overlay.canvas.style.cursor=n?"nesw-resize":"nwse-resize"}else this.overlay.canvas.style.cursor="default";if("none"!==this.currentAction){if("move"===this.currentAction){let i=new w(t,e).minus(this.mouseOrigin);this.circle.position=this.circle.origin.position.plus(i),this.circle.validate(),this.mouseOrigin=new w(t,e),this.circle.saveOrigin()}else"resize"===this.currentAction&&this.performResize(t,e);this.circle.round(this.settings.resizeLock),this.update("mouse move")}}getCircleAnchor(t){let e=t.x,i=t.y;return e>this.circle.cx?i>this.circle.cy?"se":"ne":i>this.circle.cy?"sw":"nw"}performResize(t,e){let i=v.anchorOpposite(this.getCircleAnchor(new w(t,e)));if(this.settings.resizeLock){let s=v.between(new w(t,e).plus(this.resizeOffset),this.circle.center);s.expandToward(i,2),this.circle.fitInsideGreedyCenter(s,this.outerRect),this.circle.validate()}else{this.resizeAnchor=this.circle.getPointFromAnchor(i).minus(this.resizeOffset);this.circle.size.copy();let s=v.between(new w(t,e),this.resizeAnchor);this.circle.fitInsideGreedy(s,i,this.outerRect),this.circle.validate()}}}class P extends M{constructor(t,e){super(o("div","preview")),this.lastMode="none",this.createEvent("requestremove"),m.on("borderchange",(()=>this.applyGradient())),this.cropView=e,this.cropView.on("update",(t=>{this.update("preview: "+t)})),this.cropView.on("imagechange",(t=>{this.image.src=t})),this.cropView.on("antialiaschange",(t=>{this.antialias=t})),this._size=t,this.container.style.width=t.x+"px",this.container.style.height=t.y+2+"px",this.container.style.zIndex=(-t).toString(),this.mask=new y({size:t.plus(new w(0,2))}),this.mask.canvas.className="mask",this.mask.canvas.style.zIndex="2",this.mask.canvas.style.position="absolute",this.border=new y({size:t}),this.border.canvas.className="border",this.mask.canvas.style.zIndex="1",this.border.canvas.style.position="absolute",this.image=o("img","image"),this.image.style.position="absolute",this.image.style.transformOrigin="top left",e.src&&(this.image.src=e.src),this.image.style.position="absolute",t.equals(new w(30))&&(this.onlineIndicator=new y({size:new w(14)}),this.onlineIndicator.fillCircleInSquare(new w(0,0),14,"#2F3136"),this.onlineIndicator.fillCircleInSquare(new w(2,2),10,"rgb(67,181,129)"),this.onlineIndicator.canvas.className="onlineIndicator"),this.bottomBar=o("div","bottomBar"),this.sizeDisplay=o("div","size"),this.sizeDisplay.innerText=t.x+"x"+t.y,this.container.title=this.sizeDisplay.innerText,this.removeButton=o("button","remove"),this.removeButton.innerText="✖",this.removeButton.addEventListener("click",(()=>{this.emitEvent("requestremove")})),this.bottomBar.appendChild(this.sizeDisplay),this.bottomBar.appendChild(this.removeButton),this.appendChild(this.image,this.mask.canvas,this.border.canvas,this.onlineIndicator&&this.onlineIndicator.canvas||null,this.bottomBar),this.container.addEventListener("mouseenter",(()=>{d(this.bottomBar)})),this.container.addEventListener("mouseleave",(()=>{l(this.bottomBar)})),l(this.bottomBar),this.antialias=!0}get size(){return this._size}applyGradient(){C.apply(this.border)}draw(){Z.settings.previewMode!==this.lastMode&&(this.lastMode=this.cropView.settings.previewMode,this.applyGradient(),"square"===this.lastMode?(this.mask.clear(),this.mask.fillRect(new v(new w(0,this.size.y),new w(this.size.x,2)),"#2F3136"),this.onlineIndicator&&l(this.onlineIndicator.canvas)):(this.mask.fill("#2F3136"),this.mask.blendMode="destination-out",this.mask.fillCircleInRect(new v(new w(0),this.size),"white"),this.mask.blendMode="source-over",this.onlineIndicator&&d(this.onlineIndicator.canvas)));let t=this.size.dividedBy(this.cropView.cropArea.size);this.image.style.transform="scale("+t.x+","+t.y+") rotate("+this.cropView.rotation+"deg)";let e=new w(0);e.subtract(this.cropView.cropArea.position.times(t));let i=new w(parseFloat(this.cropView.image.style.left||"0px"),parseFloat(this.cropView.image.style.top||"0px"));i.multiply(1/this.cropView.zoomFactor),e.add(i.times(t)),this.image.style.left=e.x+"px",this.image.style.top=e.y+"px"}set antialias(t){a(this.image,!t),this.antialiased=t}get antialias(){return this.antialiased}}class F extends f{constructor(t){super(o("div","previews")),this.previews=[],this.padding=16,this._size=0,this.createEvent("sizechange"),this.createEvent("sizeArrayChange"),this.cropView=t}get sizeArray(){let t=[];return this.previews.forEach((e=>{t.push(e.size.x)})),t}addPreviewSize(t){let e=new P(t,this.cropView);e.on("requestremove",this.removePreview.bind(this,e)),e.container.style.position="absolute",this.appendChild(e),p(this.previews,e,((t,e)=>t.size.y>e.size.y)),this.render(),this.emitEvent("sizeArrayChange",this.sizeArray)}removePreview(t){c(this.previews,t),this.removeChild(t),this.render(),this.emitEvent("sizeArrayChange",this.sizeArray)}get width(){return this._size}get height(){return this.previews[0]?this.previews[0].size.y:0}render(){let t=this.padding;this.previews.forEach((e=>{e.container.style.right=t+"px",t+=e.size.x+this.padding})),this._size=t,this.emitEvent("sizechange",t)}}class O extends f{constructor(t,e,i,s="",n=""){super(o("div","labelSlider "+n)),this.createEvent("slide"),this.createEvent("change"),this.labelElement=o("div","labelSlider-label"),this.labelElement.innerText=s,this.labelElement.style.position="absolute",this.sliderElement=o("input","labelSlider-slider"),this.sliderElement.type="range",this.sliderElement.min=t.toString(),this.sliderElement.max=e.toString(),this.sliderElement.step=i.toString(),this.sliderElement.style.position="absolute",this.sliderElement.addEventListener("input",(()=>{this.emitEvent("slide",parseFloat(this.sliderElement.value))})),this.sliderElement.addEventListener("change",(()=>{this.emitEvent("change",parseFloat(this.sliderElement.value))})),this.appendChild(this.labelElement,this.sliderElement)}get value(){return parseFloat(this.sliderElement.value)}set value(t){this.sliderElement.value=t.toString()}}let V=window;V.localStorage||(V.localStorage={getItem:function(t){return t&&this.hasOwnProperty(t)?unescape(document.cookie.replace(new RegExp("(?:^|.*;\\s*)"+escape(t).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*((?:[^;](?!;))*[^;]?).*"),"$1")):null},key:function(t){return unescape(document.cookie.replace(/\s*\=(?:.(?!;))*$/,"").split(/\s*\=(?:[^;](?!;))*[^;]?;\s*/)[t])},setItem:function(t,e){t&&(document.cookie=escape(t)+"="+escape(e)+"; expires=Tue, 19 Jan 2038 03:14:07 GMT; path=/",this.length=document.cookie.match(/\=/g).length)},length:0,removeItem:function(t){t&&this.hasOwnProperty(t)&&(document.cookie=escape(t)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/",this.length--)},hasOwnProperty:function(t){return new RegExp("(?:^|;\\s*)"+escape(t).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(document.cookie)}},V.localStorage.length=(document.cookie.match(/\=/g)||V.localStorage).length);var D={get:function(t,e){return void 0===e||localStorage.hasOwnProperty(t)?JSON.parse(localStorage.getItem(t)):(localStorage.setItem(t,JSON.stringify(e)),e)},set:function(t,e){localStorage.setItem(t,JSON.stringify(e))},remove:function(t){localStorage.removeItem(t)},hasKey:function(t){return localStorage.hasOwnProperty(t)},clear:function(){localStorage.clear()}};class W extends z{constructor(){super(),this.list={"Feburary 2022":["Bug fixes and preformance improvements","wow, such update"],"October 2019":["Added borders for LGBT frends... more/custom borders coming soon","Added support for custom colored borders, import/export feature coming soon","Updated some styling"],"July 2019":["Added functionality for centering, setting size manually, and resize locking","Bug fixes and performance improvements"],"May 2019":["Made it so you can move the crop area pixel-by-pixel using arrow keys","Also I can't make it so you can just put a url of a pic without having a dedicated server which i don't got the munz for sorry"],"April 2019":["Changed mask to be pixel-accurate","Added option to show guidelines"],"February 2019":["rewrote the whole dang thing so its not all in one file anymore lol","flip image horizontally or vertically (gifs soon)","antialias toggle (won't affect rendering, which just crops the image directly)","online indicator preview for discord","bugfixes and quality of life improvements","please tell me if you find bugs they probably exist and please tell me how you made them happen"],"December 2018":["You can remove preview sizes now by clicking in the bottom-right area. The web site will also magically remember your preview sizes between visits.","Zoom-fit should be imperceptibly faster... also shouldn't show phantom scroll bars anymore"],"November 2018":["Rotation! Please let me know if u find any bugs with this."],"August 2018":["Helpful tutorial","Better Mask Outline","Updated Canvas Backend","Updated Preview Image Backend","So tell me if you find any weird bugs","Loading screen so you can't open a file before it's ready for you to"],"July 2018":["Drag & Drop support - thanx TheRebelG0d","New rendering where you can pick circle or square after rendering... revolutionary...","Zoom functionality","Other stuff probaly"],"June 2018":["bugfixes cool"],"May 2018":["GIF support!! wow did you know GIFs work on this ??? at least i hope they do"],Earlier:["other stuff"]},this.dialog.classList.add("dialog-whatsNew");let t=[],e=o("h1");e.innerText="What's New...",t.push(e);for(let e in this.list){let i=o("h2");i.innerText=e;let s=o("ul");this.list[e].forEach((t=>{let e=o("li");e.innerText=t,s.appendChild(e)})),t.push(i),t.push(s)}this.appendChild(...t)}}let N;class H extends z{constructor(){super(),this.dialog.classList.add("dialog-tutorial")}show(){this.innerHTML="",this.contentContainer.style.userSelect="";let t=o("h1");t.innerText="Tutorial..";let e=o("span","link");e.addEventListener("click",(()=>{this.contentContainer.style.userSelect="text",this.innerText="tl;dr = i use google analytics to see how many people use the site, including how many people use a certain browser, whether people use desktops or phones, etc to help me get an idea of what to focus on when developing/testing the site\n\nmy awesome Privacy Policy\n\nThis Privacy Policy describes how your personal information is collected, used, and shared when you visit https://songsing.github.io/avatarcropper/ (the “Site”).\n\nPERSONAL INFORMATION WE COLLECT\n\nWhen you visit the Site, we automatically collect certain information about your device, including information about your web browser, and some of the cookies that are installed on your device. Additionally, as you browse the Site, we collect information about the individual web pages that you view (on the Site), what websites or search terms referred you to the Site, and information about how you interact with the Site. We refer to this automatically-collected information as “Device Information.”\n\nWe collect Device Information using the following technologies:\n\n    - “Cookies” are data files that are placed on your device or computer and often include an anonymous unique identifier. For more information about cookies, and how to disable cookies, visit http://www.allaboutcookies.org.\n    - “Log files” track actions occurring on the Site, and collect data including your browser type, Internet service provider, referring/exit pages, and date/time stamps.\n    - “Web beacons,” “tags,” and “pixels” are electronic files used to record information about how you browse the Site.\n\nHOW DO WE USE YOUR PERSONAL INFORMATION?\n\ni just like to see how many users on the site\n\nSHARING YOUR PERSONAL INFORMATION\n\ni use google analytics\nyou can read more about how Google uses your Personal Information here:  https://www.google.com/intl/en/policies/privacy/.  You can also opt-out of Google Analytics here:  https://tools.google.com/dlpage/gaoptout.\n\nFinally, we may also share your Personal Information to comply with applicable laws and regulations, to respond to a subpoena, search warrant or other lawful request for information we receive, or to otherwise protect our rights.\n\nDO NOT TRACK\nPlease note that we do not alter our Site’s data collection and use practices when we see a Do Not Track signal from your browser.\n\nYOUR RIGHTS\nIf you are a European resident, you have the right to access personal information we hold about you and to ask that your personal information be corrected, updated, or deleted. If you would like to exercise this right, please contact us through the contact information below.\n\nidk how that will work tho bc all the info is anonymous ??\n\nCHANGES\nWe may update this privacy policy from time to time in order to reflect, for example, changes to our practices or for other operational, legal or regulatory reasons.\n\nCONTACT US\nFor more information about our privacy practices, if you have questions, or if you would like to make a complaint, please contact us by e-mail at songsingfeedback@gmail.com",this.contentContainer.scrollTop=0})),e.innerText="learn more";let i=o("div");i.innerHTML='Hello, you can resize the cropping area by dragging on the "corners" of the circle/square.<br><img src=\''+r("1DpLL")+"' class='image'><br>Thank you, this has been the tutorial.<br>Please leave feedback or donate with the links at the bottom!",i.innerHTML+="<br><br><b>also this site use cookie if u use it u agree to cookie ",i.appendChild(e),this.appendChild(t,i),super.show()}}class U extends z{constructor(){super(),this.patrons=["henby","Jenny","xPraisexAphroditex"],this.donors=["Glen Cathey","Betty Glez","Max Abbot","MetalSonicDash","Almxg Levi","Tenkay","PanPan","wtx","Néć[Ř]ø /A/","HabLover22","Anna X. Young","and 4 anons:)"],this.dialog.classList.add("dialog-supporters"),this.innerHTML="<h1>Supporters</h1>",this.innerHTML+="Thanks to these people for donating and contributing to my work!!<br><br>",this.innerHTML+=this.patrons.concat(this.donors).join("<br>"),this.innerHTML+="<br><br>I always ask before publishing a name so just let me know if you'd prefer to stay anonymous!<br>ok thx love u"}}function q(){N.show()}class G extends g{constructor(t){super(),this.tempText=null,this.createEvent("drop"),this.createEvent("dragleave"),document.addEventListener("dragover",(t=>{t.preventDefault(),t.stopPropagation()})),document.addEventListener("dragend",(t=>{t.preventDefault(),t.stopPropagation()})),document.addEventListener("dragenter",(e=>{e.preventDefault(),e.stopPropagation(),this.tempText||(this.tempText=t.innerText),d(t),t.innerText="Drop file",t.style.zIndex="9999",console.log(this.tempText)})),document.addEventListener("dragleave",(e=>{e.preventDefault(),e.stopPropagation(),e.target===t&&(l(t),t.innerText=this.tempText,t.style.zIndex="",this.tempText=null,this.emitEvent("dragleave"))})),document.addEventListener("drop",(e=>{e.preventDefault(),e.stopPropagation(),e.dataTransfer.files.length&&this.emitEvent("drop",e.dataTransfer.files[0]),l(t),t.innerText=this.tempText,t.style.zIndex="",this.tempText=null}))}}class j extends E{constructor(t){super(),this.container.classList.add("input"),this.createEvent("return"),t&&this.on("return",t),this.container.addEventListener("click",(()=>{this.emitEvent("return",null)}))}}class K extends f{constructor(t){super(),this.canvas=new y({size:t}),this.container=this.canvas.canvas,this.createEvent("update"),this.container.addEventListener("click",(()=>{let t=new X(this.gradient);t.on("return",(t=>{this.emitEvent("update",t)})),document.getElementById("container").appendChild(t.container),t.show()}))}set gradient(t){null!==t&&(this._gradient=t,C.applyGradientToCanvas(t,this.canvas))}get gradient(){return this._gradient}}class X extends j{constructor(t){super(),this.dirty=!0,this.container.classList.add("gradientEdit"),this.gradientInfo=t;let e=o("div","leftCol"),i=o("div","rightCol");this.previewCanvas=new y({size:new w(500)}),this.previewCanvas.canvas.classList.add("preview"),C.applyGradientToCanvas(this.gradientInfo,this.previewCanvas),e.appendChild(this.previewCanvas.canvas);let s=o("div","row"),n=o("span","label");n.innerText="Preset:",s.appendChild(n);let r=o("select");r.add(h("Select one...","")),Z.settings.borderPresets.forEach((t=>{r.add(h(t.name,JSON.stringify(t)))})),s.appendChild(r);let a=o("button");a.innerText="Load this preset",a.addEventListener("click",(()=>{r.value&&(this.gradientInfo=JSON.parse(r.value),this.gradientSlider.stops=this.gradientInfo.gradient,this.dirty=!0)})),s.appendChild(a);let l=o("button");l.innerText="Overwrite this preset",l.addEventListener("click",(()=>{r.value?(Z.settings.borderPresets[r.selectedIndex-1]=this.gradientInfo,r.selectedOptions[0].value=JSON.stringify(this.gradientInfo),Z.saveSettings()):alert("Please select a valid preset or save as new preset.")})),s.appendChild(l);let d=o("button");d.innerText="Save as new preset",d.addEventListener("click",(()=>{let t=prompt("Name the new preset:");null===t||(t?Z.settings.borderPresets.some((e=>e.name.toLowerCase()===t.toLowerCase()))?alert("That name is already taken."):(this.gradientInfo.name=t,Z.settings.borderPresets.push(this.gradientInfo),Z.saveSettings(),r.add(h(t,JSON.stringify(this.gradientInfo))),r.selectedIndex=Z.settings.borderPresets.length):alert("That name is invalid."))})),s.appendChild(d);let c=o("button");c.innerText="Delete this preset",c.addEventListener("click",(()=>{if(r.value&&confirm("Are you sure you want to delete this preset?")){let t=r.selectedIndex-1;Z.settings.borderPresets.splice(t,1),Z.saveSettings(),r.remove(t+1)}})),s.appendChild(c),i.appendChild(s),this.gradientSlider=new J(new w(500,28),this.gradientInfo),this.gradientSlider.on("update",(t=>{this.gradientInfo.gradient=t})),this.gradientSlider.on("colorchange",(t=>{this.colorSelect.value=t})),i.appendChild(this.gradientSlider.container),this.colorSelect=o("input"),this.colorSelect.type="color",this.colorSelect.value=this.gradientSlider.currentStopColor,this.colorSelect.addEventListener("change",(()=>{this.gradientSlider.currentStopColor=this.colorSelect.value})),i.appendChild(this.colorSelect);let p=o("div","row"),u=o("button");u.innerText="Add stop",u.addEventListener("click",(()=>{this.gradientSlider.addStop()})),p.appendChild(u);let g=o("button");g.innerText="Remove stop",g.addEventListener("click",(()=>{this.gradientSlider.removeStop()})),p.appendChild(g);let m=o("button");m.innerText="Make stops equidistant",m.addEventListener("click",(()=>{this.gradientSlider.makeEquidistant()})),p.appendChild(m),i.appendChild(p),this.angleSlider=new O(0,360,1,"Angle","angleSlider"),this.angleSlider.value=t.angle,this.angleSlider.on("slide",(()=>{this.gradientInfo.angle=this.angleSlider.value,this.dirty=!0})),i.appendChild(this.angleSlider.container);let f=o("div","row"),v=o("button","ok");v.innerText="OK",v.addEventListener("click",(()=>{this.emitEvent("return",this.gradientInfo),this.hide()}));let x=o("button","cancel");x.innerText="Cancel",x.addEventListener("click",(()=>{this.hide()})),f.appendChild(x),f.appendChild(v),i.appendChild(f),this.appendChild(e,i),this._draw()}dismiss(){this.gradientSlider.isDragging||this.hide()}_draw(){(this.gradientSlider.dirty||this.dirty)&&(C.applyGradientToCanvas(this.gradientInfo,this.previewCanvas),this.gradientSlider.draw(),this.dirty=!1),requestAnimationFrame((()=>this._draw()))}}class J extends f{constructor(t,e){super("gradientSlider"),this.stopElements=[],this.dirty=!0,this._stops=[],this.createEvent("update"),this.createEvent("currentstopchange"),this.gradientCanvas=new y({size:t}),document.addEventListener("mouseup",(()=>{setTimeout((()=>this.dragging=null),1)})),document.addEventListener("touchend",(()=>{setTimeout((()=>this.dragging=null),1)})),document.addEventListener("mousemove",this.drag.bind(this)),document.addEventListener("touchmove",this.drag.bind(this)),this.appendChild(this.gradientCanvas.canvas),this.stops=e.gradient.sort(((t,e)=>t.pos-e.pos))}set stops(t){this._stops=t,this.stopElements.forEach((t=>{this.removeChild(t)})),this.stopElements=this.stops.map(this.createStop.bind(this)),this.makeLastTouched(this.stopElements[0]),this.appendChild(...this.stopElements)}get stops(){return this._stops}get width(){return this.gradientCanvas.width}get height(){return this.gradientCanvas.height}get trackWidth(){return this.width-this.height}applyMousedown(t,e){this.dragging=t,this.dragOriginX=e,this.elementOriginX=parseInt(t.style.left),this.makeLastTouched(t)}makeLastTouched(t){this.lastTouched&&(this.lastTouched.classList.remove("current"),this.lastTouched.style.zIndex="0"),this.lastTouched=t,this.lastTouched.classList.add("current"),this.lastTouched.style.zIndex="1",this.emitEvent("colorchange",this.lastTouched.getAttribute("color"))}createStop(t){let e=this.gradientCanvas.size.x-this.gradientCanvas.size.y,i=o("div","stop");return i.style.left=(e*t.pos).toString()+"px",i.setAttribute("color",t.color),i.style.backgroundColor=t.color,i.addEventListener("mousedown",(t=>{this.applyMousedown(i,t.clientX)})),i.addEventListener("touchstart",(t=>{this.applyMousedown(i,t.touches[0].clientX)})),i}set currentStopColor(t){this.lastTouched&&(this.lastTouched.setAttribute("color",t),this.lastTouched.style.backgroundColor=t,this.update())}get currentStopColor(){return this.lastTouched.getAttribute("color")}get isDragging(){return!!this.dragging}drag(t){if(this.dragging){let e=t instanceof MouseEvent?t.clientX:t.touches[0].clientX;t instanceof TouchEvent&&t.preventDefault();let i=this.dragOriginX-e,s=this.elementOriginX-i;s=Math.max(0,s),s=Math.min(this.trackWidth,s),this.dragging.style.left=s.toString()+"px",this.update()}}update(){this._stops=this.stopElements.map((t=>({pos:parseInt(t.style.left)/this.trackWidth,color:t.getAttribute("color")}))),this.dirty=!0,this.emitEvent("update",this.stops)}draw(){C.applyGradientToCanvas({angle:270,gradient:this.stops,name:""},this.gradientCanvas),this.dirty=!1}addStop(){this.stopElements.sort(((t,e)=>parseInt(t.style.left)-parseInt(e.style.left)));let t=this.lastTouched||this.stopElements[0],e=this.stopElements.indexOf(t),i=e<this.stopElements.length-1?1:-1,s=this.createStop({color:"white",pos:(parseInt(t.style.left)+parseInt(this.stopElements[e+i].style.left))/2/this.trackWidth});this.stopElements.push(s),this.appendChild(s),this.makeLastTouched(s),this.update()}removeStop(){if(2===this.stopElements.length)return;this.stopElements.sort(((t,e)=>parseInt(t.style.left)-parseInt(e.style.left)));let t=this.lastTouched||(e=this.stopElements)[e.length-1];var e;c(this.stopElements,t),this.removeChild(t),this.makeLastTouched(this.stopElements[0]),this.update()}makeEquidistant(){this.stopElements.sort(((t,e)=>parseInt(t.style.left)-parseInt(e.style.left))),this.stopElements.forEach(((t,e)=>{t.style.left=(e/(this.stopElements.length-1)*this.trackWidth).toString()+"px"})),this.update()}}class Z extends f{constructor(t){super(t),this.menuToggle=!0,this.firstOpened=!1,this.loadSettings(),C.size=Z.settings.borderSize,console.log(Z.settings.borderSize),this.constructMenu(),this.cropView=new A(Z.settings),this.previews=new F(this.cropView),this.appendChild(this.cropView,this.previews),Z.settings.previewSizes.forEach((t=>{this.previews.addPreviewSize(new w(t))})),this.previews.on("sizeArrayChange",(t=>{Z.settings.previewSizes=t,Z.saveSettings()})),window.addEventListener("resize",this.handleResize.bind(this)),this.previews.on("sizechange",this.handleResize.bind(this)),m.on("resize",this.handleResize.bind(this)),this.cropView.on("antialiaschange",(t=>{t?this.antialiasButton.classList.add("toggled"):this.antialiasButton.classList.remove("toggled"),Z.settings.antialias=t,Z.saveSettings()})),this.handleResize(),this.textOverlay=o("label","bigOverlay"),this.textOverlay.innerText="Open file",this.textOverlay.style.cursor="pointer",this.textOverlay.setAttribute("for","openInput");let e=new G(this.textOverlay);e.on("drop",(t=>{this.openFile(t)})),e.on("dragleave",(()=>{this.firstOpened||d(this.textOverlay)})),document.body.appendChild(this.textOverlay),!1===function(){var t=window.navigator.userAgent,e=t.indexOf("MSIE ");if(e>0)return parseInt(t.substring(e+5,t.indexOf(".",e)),10);if(t.indexOf("Trident/")>0){var i=t.indexOf("rv:");return parseInt(t.substring(i+3,t.indexOf(".",i)),10)}var s=t.indexOf("Edge/");return s>0&&parseInt(t.substring(s+5,t.indexOf(".",s)),10)}()||Z.settings.dismissedIE||(window.alert("hey so your browser isn't really supported ... things should still work but they will be slower/ugly due to how internet explorer/edge function (They don't conform to web standards). i'd recommend switching to firefox or chrome!! but you don't have to if you don't want to. this is the only time you'll see this message unless u clear ur cache or something. ok bye"),Z.settings.dismissedIE=!0,Z.saveSettings())}loadFromFile(t){this.cropView.setImageFromFile(t)}static saveSettings(){D.set("settings",Z.settings)}loadSettings(){let t=D.get("settings",{});for(let e in Z.settings)t.hasOwnProperty(e)&&null!==t[e]&&(Z.settings[e]=t[e]);Z.saveSettings()}constructMenu(){this.menu=o("div","menu");let t=o("input","openInput show");t.id="openInput",t.type="file",t.addEventListener("change",(e=>{t.files&&t.files[0]&&this.openFile(t.files[0])})),this.openFileLabel=o("label","open half item show"),this.openFileLabel.innerText="Open File...",this.openFileLabel.appendChild(t),this.menu.appendChild(this.openFileLabel),this.toggleMenuButton=o("button","half item show"),this.toggleMenuButton.setAttribute("uptext","Collapse Menu"),this.toggleMenuButton.setAttribute("downtext","▼"),this.toggleMenuButton.innerText=this.toggleMenuButton.getAttribute("uptext"),this.toggleMenuButton.addEventListener("click",this.toggleMenu.bind(this)),this.menu.appendChild(this.toggleMenuButton);let e=o("button","open item half"),i=o("button","open item half");e.innerText="Circle",i.innerText="Squaré",e.classList.toggle("toggled","circle"===Z.settings.previewMode),i.classList.toggle("toggled","square"===Z.settings.previewMode),e.addEventListener("click",(()=>{e.classList.add("toggled"),i.classList.remove("toggled"),Z.settings.previewMode="circle",this.cropView&&this.cropView.update("circle toggle"),Z.saveSettings()})),i.addEventListener("click",(()=>{e.classList.remove("toggled"),i.classList.add("toggled"),Z.settings.previewMode="square",this.cropView&&this.cropView.update("square toggle"),Z.saveSettings()})),this.menu.appendChild(e),this.menu.appendChild(i);let s=new O(0,1,.01,"Mask Transparency","item transparency");s.on("slide",this.setTransparency.bind(this)),s.on("change",(()=>Z.saveSettings())),s.value=1-Z.settings.maskOpacity,this.menu.appendChild(s.container);let n=o("div","item zoomBar"),r=o("div","zoomLabel");r.innerText="Zoom:",n.appendChild(r);let a=o("button","zoomOut");a.innerText="-",a.addEventListener("click",(()=>this.cropView.zoomOut()));let c=o("button","zoomIn");c.innerText="+",c.addEventListener("click",(()=>this.cropView.zoomIn()));let p=o("button","zoomFit");p.innerText="Fit",p.addEventListener("click",(()=>this.cropView.zoomFit())),n.appendChild(p),n.appendChild(c),n.appendChild(a),this.menu.appendChild(n);let u=new O(-180,180,1,"Rotation","item rotation");u.on("slide",(t=>{Math.abs(t-90)<=2?t=90:Math.abs(t+90)<=2?t=-90:Math.abs(t)<=2?t=0:Math.abs(t-180)<=2?t=180:Math.abs(t+180)<=2&&(t=-180),this.setRotation(t)})),u.value=0,this.menu.appendChild(u.container),this.flipHButton=o("button","half item"),this.flipHButton.innerText="Flip Horiz.",this.flipHButton.addEventListener("click",this.flipHorizontal.bind(this)),this.menu.appendChild(this.flipHButton),this.flipVButton=o("button","half item"),this.flipVButton.innerText="Flip Vertical",this.flipVButton.addEventListener("click",this.flipVertical.bind(this)),this.menu.appendChild(this.flipVButton),this.antialiasButton=o("button","half item"),this.antialiasButton.innerText="Antialias",this.antialiasButton.addEventListener("click",(()=>{this.cropView.antialias=!this.cropView.antialias})),Z.settings.antialias&&this.antialiasButton.classList.add("toggled"),this.menu.appendChild(this.antialiasButton),this.maskOutlineButton=o("button","half item"),this.maskOutlineButton.innerText="Mask Outline",this.maskOutlineButton.addEventListener("click",this.toggleMaskOutline.bind(this,!0)),this.toggleMaskOutline(!1),this.menu.appendChild(this.maskOutlineButton);let g=o("button","half item");g.innerText="Add Preview Size",g.addEventListener("click",this.promptAddPreview.bind(this)),this.menu.appendChild(g),this.guidesButton=o("button","half item"),this.guidesButton.innerText="Guidelines",this.guidesButton.addEventListener("click",this.toggleGuides.bind(this,!0)),this.toggleGuides(!1),this.menu.appendChild(this.guidesButton);let f=o("button","half item");f.innerText="Center",f.addEventListener("click",this.centerCropArea.bind(this)),this.menu.appendChild(f);let v=o("button","half item");v.innerText="Set Size",v.addEventListener("click",this.setCropSize.bind(this)),this.menu.appendChild(v);let y=o("button","item");y.innerText="Lock Center During Resize",y.addEventListener("click",this.toggleResizeLock.bind(this)),this.menu.appendChild(y),m.on("resizelockchange",(()=>{Z.settings.resizeLock?y.classList.add("toggled"):y.classList.remove("toggled")})),m.emitEvent("resizelockchange"),this.borderSelect=o("select","item"),this.borderSelect.id="borderSelect",this.menu.appendChild(this.borderSelect);let x=()=>{let t=this.borderSelect.options.length;for(let e=0;e<t;e++)this.borderSelect.options.remove(0);this.borderSelect.add(h("No Border","none")),this.borderSelect.add(h("Solid Border","solid")),Z.settings.borderPresets.forEach((t=>{this.borderSelect.add(h(t.name,JSON.stringify(t)))})),this.borderSelect.add(h("Custom Gradient Border","gradient"))};x();let b=o("input","item borderEdit");b.type="color",b.value=C.color,b.addEventListener("change",(()=>{C.color=b.value})),l(b),this.menu.appendChild(b);let E=new K(new w(32));E.gradient=C.gradient,E.container.className="item borderEdit",E.on("update",(t=>{E.gradient=t,C.gradient=t,x(),this.borderSelect.selectedIndex=this.borderSelect.options.length-1})),E.hide(),this.menu.appendChild(E.container),this.borderSelect.addEventListener("change",(()=>{"solid"===this.borderSelect.value?(d(b),E.hide(),this.borderSelect.classList.add("edit"),C.type="solid"):"gradient"===this.borderSelect.value?(l(b),E.show(),this.borderSelect.classList.add("edit"),C.type="gradient"):"none"===this.borderSelect.value?(l(b),E.hide(),this.borderSelect.classList.remove("edit"),C.type="none"):(l(b),E.hide(),this.borderSelect.classList.remove("edit"),C.type="gradient",C.gradient=JSON.parse(this.borderSelect.selectedOptions[0].value),E.gradient=C.gradient)}));let z=new O(0,.5,.01,"Border Size","item");z.value=C.size,z.on("slide",(t=>{C.size=t})),z.on("change",(()=>{Z.settings.borderSize=z.value,Z.saveSettings()})),this.menu.appendChild(z.container);let L=o("button","item render show half item");L.innerText="Render Banner",L.addEventListener("click",this.renderBanner.bind(this)),this.menu.appendChild(L),this.appendChild(this.menu);let S=o("button","item render show half item");S.innerText="Render Avatar",S.addEventListener("click",this.renderCroppedImage.bind(this)),this.menu.appendChild(S),this.appendChild(this.menu)}flipHorizontal(){this.cropView.flipHorizontal()}flipVertical(){this.cropView.flipVertical()}centerCropArea(){this.cropView.centerCropArea()}setCropSize(){let t="The current picture is "+this.cropView.innerSize.x.toString()+"x"+this.cropView.innerSize.y.toString()+"\nThe current croparea is "+this.cropView.cropArea.width+"x"+this.cropView.cropArea.height+"\nEnter in a size either by specifying a number (like 64) or a percentage of width (50%w) or height (50%h)",e=window.prompt(t);if(null===e||isNaN(parseInt(e)))return;let i=parseInt(e);e.endsWith("%w")?i=this.cropView.innerSize.x*(i/100):e.endsWith("%h")&&(i=this.cropView.innerSize.y*(i/100)),this.cropView.setCropSize(i)}toggleResizeLock(){Z.settings.resizeLock=!Z.settings.resizeLock,Z.saveSettings(),m.emitEvent("resizelockchange")}toggleMenu(){this.menuToggle?(Array.from(this.menu.children).forEach((t=>{t.classList.contains("show")||(t.style.display="none")})),this.toggleMenuButton.classList.add("toggled"),this.toggleMenuButton.innerText=this.toggleMenuButton.getAttribute("downtext")):(Array.from(this.menu.children).forEach((t=>{t.style.display=""})),l(document.querySelector("input.borderEdit")),l(document.querySelector("canvas.borderEdit")),"solid"===this.borderSelect.value?d(document.querySelector("input.borderEdit")):"gradient"===this.borderSelect.value&&d(document.querySelector("canvas.borderEdit")),this.toggleMenuButton.classList.remove("toggled"),this.toggleMenuButton.innerText=this.toggleMenuButton.getAttribute("uptext")),this.menuToggle=!this.menuToggle}renderCroppedImage(){this.cropView.renderCroppedImage()}renderBanner(){this.cropView.renderBanner()}toggleMaskOutline(t=!0){t&&(Z.settings.outlinesEnabled=!Z.settings.outlinesEnabled),Z.settings.outlinesEnabled?this.maskOutlineButton.classList.add("toggled"):this.maskOutlineButton.classList.remove("toggled"),this.cropView&&this.cropView.update("mask outline"),Z.saveSettings()}toggleGuides(t=!0){t&&(Z.settings.guidesEnabled=!Z.settings.guidesEnabled),Z.settings.guidesEnabled?this.guidesButton.classList.add("toggled"):this.guidesButton.classList.remove("toggled"),this.cropView&&this.cropView.update("guide toggle"),Z.saveSettings()}setTransparency(t){Z.settings.maskOpacity=1-t,this.cropView.update("set transparenty")}setRotation(t){this.cropView.rotate(t)}promptAddPreview(){let t=window.prompt("Enter a custom size\nDefault sizes are 30, 40, 64, and 128\nNote: 30 will come with a discord online indicator");if(null===t)return;let e=parseInt(t);isNaN(e)||e<=0?alert("Bad size make sure it's a number over 0"):this.previews.addPreviewSize(new w(e))}openFile(t){this.cropView.setImageFromFile(t)&&(this.firstOpened||(this.firstOpened=!0,this.show(),l(this.textOverlay),this.textOverlay.removeAttribute("for"),this.textOverlay.style.cursor=""),"gif"===this.cropView.currentFileType?(l(this.flipHButton),l(this.flipVButton)):(d(this.flipHButton),d(this.flipVButton)),Z.settings.dismissedTutorial&&Z.settings.dismissedCookie||(q(),Z.settings.dismissedTutorial=!0,Z.settings.dismissedCookie=!0,Z.saveSettings()))}handleResize(){let t=Math.max(this.previews.width,this.menu.getBoundingClientRect().width);this.cropView.container.style.width="calc(100% - "+t+"px)",this.cropView.reactTMToRefresh();this.previews.height,this.previews.padding}}Z.settings={previewSizes:[30,40,64,128],maskOpacity:.5,previewMode:"circle",outlinesEnabled:!0,antialias:!0,dismissedTutorial:!1,dismissedIE:!1,dismissedCookie:!1,guidesEnabled:!0,resizeLock:!1,borderSize:.05,borderPresets:C.defaults,bannerEnabled:!1},window.addEventListener("load",(function(){R.initialize(),window.a=new Z(document.getElementById("container")),function(){N=new H,document.body.appendChild(N.container),document.getElementById("link-help").addEventListener("click",(()=>{q()}));let t=new W;document.getElementById("link-whatsNew").addEventListener("click",(()=>{t.show()})),document.body.appendChild(t.container),document.getElementById("closeFooter").addEventListener("click",(()=>{document.getElementById("container").style.height="100%",document.querySelector(".bigOverlay").style.height="100%",l(document.getElementById("footer")),m.emitEvent("resize")}));let e=new U;document.getElementById("link-supporters").addEventListener("click",(()=>{e.show()})),document.body.appendChild(e.container)}()}));
//# sourceMappingURL=index.3e6cdede.js.map
