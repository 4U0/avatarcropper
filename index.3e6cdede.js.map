{"mappings":"0UAEgBA,EAAcC,EAAcC,EAAoB,IAC5D,IAAIC,EAAMC,SAASC,cAAcJ,GAEjC,OADAE,EAAID,UAAYA,EACTC,WA4CKG,EAAcC,EAAyCC,GAAoB,GACvF,GAAIA,EAAU,CACE,CAAC,gBAAiB,cAAe,mBAAoB,4BAA6B,oBAAqB,aAC7GC,SAAQR,GAAQM,EAAEG,MAAM,mBAAqBT,SAGnDM,EAAEG,MAAM,mBAAqB,YAIrBC,EAAoBC,EAAcC,GAC9C,IAAIV,EAAMC,SAASC,cAAc,UAIjC,OAHAF,EAAIW,UAAYF,EAChBT,EAAIU,MAAQA,EAELV,WAGKY,EAAYC,GACxBA,EAAQN,MAAMO,QAAU,gBAGZC,EAAYF,GACxBA,EAAQN,MAAMO,QAAU,YA8DZE,EAAgBC,EAAYC,GACxC,IAAIC,EAAQF,EAAMG,QAAQF,GAC1B,OAAc,IAAVC,GACAF,EAAMI,OAAOF,EAAO,GACb,MAAED,QAAMC,EAAOG,SAAS,IAG5B,MAAEJ,EAAMC,OAAO,EAAIG,SAAS,YAoCvBC,EAAgBN,EAAYC,EAASM,GACjD,GAA2B,iBAAhBA,EAEP,OADAP,EAAMI,OAAOG,EAAa,EAAGN,GACtB,CAAEA,KAAMA,EAAMC,MAAOK,GAG5B,IAAK,IAAIC,EAAI,EAAGA,EAAIR,EAAMS,OAAQD,IAC9B,GAAID,EAAYN,EAAMD,EAAMQ,IAExB,OADAR,EAAMI,OAAOI,EAAG,EAAGP,GACZ,CAAEA,KAAMA,EAAMC,MAAOM,GAKpC,OADAR,EAAMU,KAAKT,GACJ,CAAEA,KAAMA,EAAMC,MAAOF,EAAMS,OAAS,YA6CnCE,EAASxB,GACrBA,EAAEyB,mWCvNN,IAAuBC,EACDC,mFArBtB,IAAIC,EAAU,GAoBdF,WAlBkBG,GAGhB,IAFA,IAAIC,EAAOC,OAAOD,KAAKD,GAEdR,EAAI,EAAGA,EAAIS,EAAKR,OAAQD,IAC/BO,EAAQE,EAAKT,IAAMQ,EAAMC,EAAKT,KAelCM,WAXiBK,GACf,IAAIC,EAAWL,EAAQI,GAEvB,GAAgB,MAAZC,EACF,MAAM,IAAIC,MAAM,oCAAsCF,GAGxD,OAAOC,wCCnBTE,EAAAC,QAAc,IAAAC,IAAuBC,EAAA,SAAAC,QAA6C,SAAOC,OAAAC,KAAAC,KAAGC,cCA5FL,EAAA,SAAAM,SAA8CC,KAAKC,MAAM,qGCE5CC,gBAANC,KACKC,OAAsD,IAAIC,IAMxDC,YAAYC,GACbJ,KAAKC,OAAOI,IAAID,IACjBJ,KAAKC,OAAOK,IAAIF,EAAO,IAIxBG,UAAUH,KAAkBI,GAC1BR,KAAKC,OAAOI,IAAID,KACjBK,QAAQC,KAAK,0BAA4BN,GACzCJ,KAAKC,OAAOK,IAAIF,EAAO,KAG3BJ,KAAKC,OAAOU,IAAIP,GAAOlD,SAAQ0D,GAAKA,EAAEC,MAAML,KAGzCM,GAAGV,EAAeS,EAAc7B,EAAa,kBAC3CgB,KAAKC,OAAOI,IAAID,KACjBK,QAAQC,KAAK,0BAA4BN,GACzCJ,KAAKC,OAAOK,IAAIF,EAAO,KAG3BJ,KAAKC,OAAOU,IAAIP,GAAO7B,KAAK,IAAEsC,KAAI7B,IAG/B+B,KAAKX,EAAeS,EAAc7B,EAAa,0BAC7CgB,KAAKC,OAAOI,IAAID,KACjBK,QAAQC,KAAK,0BAA4BN,GACzCJ,KAAKC,OAAOK,IAAIF,EAAO,KAG3B,IAAIY,EACJ,CACIH,GAAE,KACEA,IACAjD,EAAaoC,KAAKC,OAAOU,IAAIP,GAAQY,OAEzChC,GAGJgB,KAAKC,OAAOU,IAAIP,GAAO7B,KAAKyC,GAGzBC,WAAWb,GACTJ,KAAKC,OAAOI,IAAID,KACjBK,QAAQC,KAAK,0BAA4BN,GACzCJ,KAAKC,OAAOK,IAAIF,EAAO,KAG3BK,QAAQS,IAAI,4BAA8Bd,EAAQ,MAClDJ,KAAKC,OAAOU,IAAIP,GAAOlD,SAAQ0D,GAAKH,QAAQS,IAAIN,EAAE5B,OAInD,IAAImC,EAAe,IAAIpB,QC3DjBqB,UAAerB,cAIZsB,GACRC,QAIQtB,KAAKuB,UAFTF,EACwC,iBAA5BA,EACS5E,EAAc,MAAO4E,GAGrBA,EAIJ5E,EAAc,OAGnCuD,KAAKwB,iBAAmBxB,KAAKuB,UAG1BE,OACHzB,KAAKuB,UAAUpE,MAAMO,QAAU,GAG5BgE,OACH1B,KAAKuB,UAAUpE,MAAMO,QAAU,OAGxBiE,cAAUA,GACjB3B,KAAKwB,iBAAiBG,UAAYA,EAG3BA,gBACP,OAAO3B,KAAKwB,iBAAiBG,UAGtBpE,cAAUA,GACjByC,KAAKwB,iBAAiBjE,UAAYA,EAG3BA,gBACP,OAAOyC,KAAKwB,iBAAiBjE,UAG1BqE,eAAeC,GAClB,GAAwB,IAApBA,EAASvD,OACT0B,KAAK8B,aAAa9B,KAAKwB,iBAAkBK,EAAS,QAEjD,CACD,IAAIE,EAAOlF,SAASmF,yBAEpBH,EAAS3E,SAAQ+E,IACbjC,KAAK8B,aAAaC,EAAME,MAG5BjC,KAAKwB,iBAAiBI,YAAYG,IAIlCD,aAAaI,EAAcD,GAC3BA,aAAiBE,YACjBD,EAAON,YAAYK,GAEdA,GACLC,EAAON,YAAYK,EAAMV,WAI1Ba,YAAYH,GACf,QAAKjC,KAAKqC,SAASJ,KAIfA,aAAiBE,YACjBnC,KAAKwB,iBAAiBY,YAAYH,GAGlCjC,KAAKwB,iBAAiBY,YAAYH,EAAMV,YAGrC,GAGJc,SAASJ,GACZ,OAAIA,aAAiBE,YACVnC,KAAKwB,iBAAiBc,SAASL,GAG/BjC,KAAKwB,iBAAiBc,SAASL,EAAMV,kBCzF3CgB,cAKGC,EAAkBC,GAE1BzC,KAAKwC,SAAWA,EAChBxC,KAAKyC,KAAOA,wBAGaC,GACzB,OAAO,IAAIH,EAAU,IAAII,EAAMD,EAAKE,KAAMF,EAAKG,KAAMF,EAAMG,aAAaJ,IAGrEK,OAAOC,GAEV,IAAIC,EAAIjD,KAAKkD,OACTC,EAAUF,EAAER,KAAKW,MAAMJ,GACvBK,EAASJ,EAAEI,OACXC,EAAOH,EAAQI,MAAMN,EAAER,MAI3B,OAHAQ,EAAET,SAASgB,SAASF,EAAKG,UAAU,IACnCR,EAAER,KAAKiB,IAAIJ,GACXL,EAAEI,OAASA,EACJJ,EAGAU,eAEP,OAAO3D,KAAK4D,QAAU5D,KAAK6D,OAGxBC,KAAKC,GAER,OAAO,IAAIxB,EAAUvC,KAAKwC,SAASsB,KAAKC,EAAQvB,UAAWxC,KAAKyC,KAAKqB,KAAKC,EAAQtB,OAG/EW,MAAMW,GAET,MAAwB,iBAAbA,EAEA,IAAIxB,EAAUvC,KAAKwC,SAASY,MAAMW,GAAU/D,KAAKyC,KAAKW,MAAMW,IAI5D,IAAIxB,EAAUvC,KAAKwC,SAASY,MAAMW,EAAQvB,UAAWxC,KAAKyC,KAAKW,MAAMW,EAAQtB,OAIrFuB,WAAWC,GAEd,OAAO,IAAI1B,EAAUvC,KAAKwC,SAASsB,KAAKG,GAASjE,KAAKyC,KAAKS,QAGxDvD,WAEH,MAAO,IAAMK,KAAKkE,EAAI,KAAOlE,KAAKmE,EAAI,KAAOnE,KAAK4D,MAAQ,KAAO5D,KAAK6D,OAAS,IAG5EO,UAAU1B,EAAkB2B,GAE/B,IAAIC,EAAK5B,EAAK6B,YACVC,EAAaxE,KAAKyE,mBAAmBJ,GAAQnB,OAE7CoB,EAAKtE,KAAKuE,aAGVvE,KAAK4D,OAASlB,EAAKmB,OAAS7D,KAAK6D,OACjC7D,KAAK6D,OAASnB,EAAKmB,SAKnB7D,KAAK6D,QAAUnB,EAAKkB,MAAQ5D,KAAK4D,MACjC5D,KAAK4D,MAAQlB,EAAKkB,OAGtB5D,KAAK0E,mBAAmBL,EAAQG,GAG7BG,eAAef,GAElB,IAAIU,EAAKtE,KAAK4D,MAAQA,EACtB5D,KAAK4D,MAAQA,EACb5D,KAAK6D,OAAS7D,KAAK6D,OAASS,EAGzBM,gBAAgBf,GAEnB,IAAIS,EAAKtE,KAAK6D,OAASA,EACvB7D,KAAK6D,OAASA,EACd7D,KAAK4D,MAAQ5D,KAAK4D,MAAQU,EAGvBO,aAAaR,EAAqBS,GAErC,OAAQT,GAEJ,IAAK,KACD,IAAIU,EAAK/E,KAAKgF,WACdhF,KAAKyC,KAAKwC,SAASH,GACnB9E,KAAKgF,WAAaD,EAClB,MACJ,IAAK,KACD,IAAIG,EAAKlF,KAAKmF,YACdnF,KAAKyC,KAAKwC,SAASH,GACnB9E,KAAKmF,YAAcD,EACnB,MACJ,IAAK,KACD,IAAIE,EAAKpF,KAAKqF,QACdrF,KAAKyC,KAAKwC,SAASH,GACnB9E,KAAKqF,QAAUD,EACf,MACJ,IAAK,KACD,IAAIE,EAAKtF,KAAKuF,SACdvF,KAAKyC,KAAKwC,SAASH,GACnB9E,KAAKuF,SAAWD,GAKrBE,sBAAsB9C,EAAkB+C,GAE3C,IAAInB,EAAK5B,EAAK6B,YACVlB,EAASrD,KAAKqD,OAAOH,OACdlD,KAAKyC,KAAKS,OAEjBoB,EAAK,GAGLtE,KAAK6D,QAAUnB,EAAKkB,MAAQ5D,KAAK4D,MACjC5D,KAAK4D,MAAQlB,EAAKkB,QAKlB5D,KAAK4D,OAASlB,EAAKmB,OAAS7D,KAAK6D,OACjC7D,KAAK6D,OAASnB,EAAKmB,QAGvB7D,KAAKqD,OAASA,EAEToC,EAAaC,aAAa1F,QAEvBA,KAAK2F,MAAQF,EAAaE,QAE1B3F,KAAK2E,eAAiD,GAAjCc,EAAaE,MAAQtC,EAAOa,IACjDlE,KAAKqD,OAASA,GAEdrD,KAAK4F,OAASH,EAAaG,SAE3B5F,KAAK4E,gBAAmD,GAAlCa,EAAaG,OAASvC,EAAOc,IACnDnE,KAAKqD,OAASA,GAEdrD,KAAK4C,KAAO6C,EAAa7C,OAEzB5C,KAAK2E,eAAgD,GAAhCtB,EAAOa,EAAIuB,EAAa7C,OAC7C5C,KAAKqD,OAASA,GAEdrD,KAAK6C,IAAM4C,EAAa5C,MAExB7C,KAAK4E,gBAAgD,GAA/BvB,EAAOc,EAAIsB,EAAa5C,MAC9C7C,KAAKqD,OAASA,IAKnBwC,gBAAgBnD,EAAkB2B,EAAqBoB,GAE1D,IAAInB,EAAK5B,EAAK6B,YACVC,EAAaxE,KAAKyE,mBAAmBJ,GAAQnB,OAE7CoB,EAAK,GAGLtE,KAAK6D,QAAUnB,EAAKkB,MAAQ5D,KAAK4D,MACjC5D,KAAK4D,MAAQlB,EAAKkB,QAKlB5D,KAAK4D,OAASlB,EAAKmB,OAAS7D,KAAK6D,OACjC7D,KAAK6D,OAASnB,EAAKmB,QAGvB7D,KAAK0E,mBAAmBL,EAAQG,GAE3BiB,EAAaC,aAAa1F,QAEvBA,KAAK2F,MAAQF,EAAaE,QAE1B3F,KAAK2E,eAAec,EAAaE,MAAQ3F,KAAK4C,MAC9C5C,KAAK0E,mBAAmBL,EAAQG,IAEhCxE,KAAK4F,OAASH,EAAaG,SAE3B5F,KAAK4E,gBAAgBa,EAAaG,OAAS5F,KAAK6C,KAChD7C,KAAK0E,mBAAmBL,EAAQG,IAEhCxE,KAAK4C,KAAO6C,EAAa7C,OAEzB5C,KAAK2E,eAAe3E,KAAK2F,MAAQF,EAAa7C,MAC9C5C,KAAK0E,mBAAmBL,EAAQG,IAEhCxE,KAAK6C,IAAM4C,EAAa5C,MAExB7C,KAAK4E,gBAAgB5E,KAAK4F,OAASH,EAAa5C,KAChD7C,KAAK0E,mBAAmBL,EAAQG,KAKrCtB,OAEH,OAAO,IAAIX,EAAUvC,KAAKwC,SAASU,OAAQlD,KAAKyC,KAAKS,QAGlD4C,OAAO7C,GAEVjD,KAAKwC,SAAWS,EAAET,SAClBxC,KAAKyC,KAAOQ,EAAER,KAGXgC,mBAAmBJ,GAEtB,OAAQA,GAEJ,IAAK,KAAM,OAAOrE,KAAKqF,QACvB,IAAK,KAAM,OAAOrF,KAAKuF,SACvB,IAAK,KAAM,OAAOvF,KAAKgF,WACvB,IAAK,KAAM,OAAOhF,KAAKmF,aAIxBT,mBAAmBL,EAAqB0B,GAE3C,OAAQ1B,GAEJ,IAAK,KAAMrE,KAAKqF,QAAUU,EAAO,MACjC,IAAK,KAAM/F,KAAKuF,SAAWQ,EAAO,MAClC,IAAK,KAAM/F,KAAKgF,WAAae,EAAO,MACpC,IAAK,KAAM/F,KAAKmF,YAAcY,yBAIT1B,GAEzB,OAAQA,GAEJ,IAAK,KAAM,MAAO,KAClB,IAAK,KAAM,MAAO,KAClB,IAAK,KAAM,MAAO,KAClB,IAAK,KAAM,MAAO,MAIfE,kBAEP,OAAOvE,KAAK4D,MAAQ5D,KAAK6D,OAGtBmC,MAAMC,GAAwB,GAEjC,GAAIA,EACJ,CACI,IAAIC,EAAIlG,KAAKqD,OACbrD,KAAKyC,KAAKuD,QACVhG,KAAKqD,OAAS6C,EAAEC,aAIhBnG,KAAKwC,SAASwD,QACdhG,KAAKyC,KAAKuD,QAIPG,cAEP,OAAO,IAAI5D,EAAUvC,KAAKwC,SAAS2D,QAASnG,KAAKyC,KAAK0D,SAG/CC,YAEP,OAAO,IAAI7D,EAAU,IAAII,EAAM,GAAI3C,KAAKyC,KAAKS,QAGtCgB,QAEP,OAAOlE,KAAKwC,SAAS0B,EAGdA,MAAEA,GAETlE,KAAKwC,SAAS0B,EAAIA,EAGXC,QAEP,OAAOnE,KAAKwC,SAAS2B,EAGdA,MAAEA,GAETnE,KAAKwC,SAAS2B,EAAIA,EAGXvB,WAEP,OAAO5C,KAAKwC,SAAS0B,EAGdtB,SAAKA,GAEZ5C,KAAKwC,SAAS0B,EAAItB,EAGXC,UAEP,OAAO7C,KAAKwC,SAAS2B,EAGdtB,QAAIA,GAEX7C,KAAKwC,SAAS2B,EAAItB,EAGXe,YAEP,OAAO5D,KAAKyC,KAAKyB,EAGVN,UAAMA,GAEb5D,KAAKyC,KAAKyB,EAAIN,EAGPC,aAEP,OAAO7D,KAAKyC,KAAK0B,EAGVN,WAAOA,GAEd7D,KAAKyC,KAAK0B,EAAIN,EAGP8B,YAEP,OAAO3F,KAAKkE,EAAIlE,KAAK4D,MAGd+B,UAAMA,GAEb3F,KAAKkE,EAAIyB,EAAQ3F,KAAK4D,MAGfgC,aAEP,OAAO5F,KAAKmE,EAAInE,KAAK6D,OAGd+B,WAAOA,GAEd5F,KAAKmE,EAAIyB,EAAS5F,KAAK6D,OAGhBwB,cAEP,OAAOrF,KAAKwC,SAGL6C,YAAQA,GAEfrF,KAAKwC,SAAW6C,EAGTE,eAEP,OAAOvF,KAAKwC,SAASsB,KAAK,IAAInB,EAAM3C,KAAK4D,MAAO,IAGzC2B,aAASA,GAEhBvF,KAAKwC,SAAW+C,EAAShC,MAAM,IAAIZ,EAAM3C,KAAK4D,MAAO,IAG9CoB,iBAEP,OAAOhF,KAAKwC,SAASsB,KAAK,IAAInB,EAAM,EAAG3C,KAAK6D,SAGrCmB,eAAWA,GAElBhF,KAAKwC,SAAWwC,EAAWzB,MAAM,IAAIZ,EAAM,EAAG3C,KAAK6D,SAG5CsB,kBAEP,OAAOnF,KAAKwC,SAASsB,KAAK9D,KAAKyC,MAGxB0C,gBAAYA,GAEnBnF,KAAKwC,SAAW2C,EAAY5B,MAAMvD,KAAKyC,MAGhCY,aAEP,OAAOrD,KAAKwC,SAASsB,KAAK9D,KAAKyC,KAAKW,MAAM,KAGnCC,WAAOA,GAEdrD,KAAKwC,SAAWa,EAAOE,MAAMvD,KAAKyC,KAAKW,MAAM,KAGtCiD,SAEP,OAAOrG,KAAKqD,OAAOa,EAGZmC,OAAGA,GAEVrG,KAAKwC,SAAS0B,EAAImC,EAAKrG,KAAKyC,KAAKyB,EAAI,EAG9BoC,SAEP,OAAOtG,KAAKqD,OAAOc,EAGZmC,OAAGA,GAEVtG,KAAKwC,SAAS2B,EAAImC,EAAKtG,KAAKyC,KAAK0B,EAAI,EAGlCoC,cAAcC,GAEjB,OACIA,EAAEtC,GAAKlE,KAAKkE,GAAKsC,EAAEtC,GAAKlE,KAAK2F,OAC7Ba,EAAErC,GAAKnE,KAAKmE,GAAKqC,EAAErC,GAAKnE,KAAK4F,OAI9BF,aAAazC,GAEhB,OAAOjD,KAAKuG,cAActD,EAAEoC,UAAYrF,KAAKuG,cAActD,EAAEkC,aAO1DsB,WAAWxD,GAEd,QAASA,EAAEL,MAAQ5C,KAAK2F,OACpB1C,EAAE0C,OAAS3F,KAAK4C,MAChBK,EAAEJ,KAAO7C,KAAK4F,QACd3C,EAAE2C,QAAU5F,KAAK6C,oBAGH6D,EAAYC,GAE9B,IAAIC,EAAM,IAAIjE,EAAMkE,KAAKC,IAAIJ,EAAGxC,EAAGyC,EAAGzC,GAAI2C,KAAKC,IAAIJ,EAAGvC,EAAGwC,EAAGxC,IACxD1B,EAAO,IAAIE,EAAMkE,KAAKE,IAAIL,EAAGxC,EAAIyC,EAAGzC,GAAI2C,KAAKE,IAAIL,EAAGvC,EAAIwC,EAAGxC,IAC/D,OAAO,IAAI5B,EAAUqE,EAAKnE,UC5crBE,EAYNqE,YACS9C,EAAaC,QAEX8C,IAAN/C,GAEAlE,KAAKkE,EAAI,EACTlE,KAAKmE,EAAI,QAEE8C,IAAN9C,GAELnE,KAAKkE,EAAIA,EACTlE,KAAKmE,EAAID,IAITlE,KAAKkE,EAAIA,EACTlE,KAAKmE,EAAIA,uBAIU+C,GAEvB,OAAO,IAAIvE,EAAMuE,EAAStD,MAAOsD,EAASrD,6BAGlBsD,GAExB,OAAO,IAAIxE,EAAMwE,EAAUjD,EAAGiD,EAAUhD,GAGrCiD,YAAYnD,GAEf,OAAO,IAAI1B,EAAU0B,GAAU,IAAItB,EAAM,GAAI3C,KAAKkD,QAM3CmE,YAEP,OAAO,IAAI1E,EAAM3C,KAAKkE,EAAG,GAMlBoD,YAEP,OAAO,IAAI3E,EAAM,EAAG3C,KAAKmE,GAMlBoD,YAEP,OAAO,IAAI5E,EAAM3C,KAAKkE,EAAI,EAAI,GAAI,EAAIlE,KAAKmE,EAAInE,KAAKkE,GAM7CsD,YAEP,OAAO,IAAI7E,EAAM3C,KAAKkE,EAAIlE,KAAKmE,EAAGnE,KAAKmE,EAAI,EAAI,GAAI,GAM5CsD,eAEP,OAAOzH,KAAKoD,OAAM,GAOfsE,WAAWxD,GAEd,IAAID,EAASjE,KAAKuH,MAAME,SAASrE,MAAMc,GACvClE,KAAKkE,EAAID,EAAOC,EAChBlE,KAAKmE,EAAIF,EAAOE,EAObwD,WAAWxD,GAEd,IAAIF,EAASjE,KAAKwH,MAAMC,SAASrE,MAAMe,GACvCnE,KAAKkE,EAAID,EAAOC,EAChBlE,KAAKmE,EAAIF,EAAOE,EAMjByD,iBACqB/J,GAEpB,OAAO,IAAI8E,KAAS9E,GAOrB+J,iBACqB7J,EAAgB6F,GAEpC,OAAO,IAAIjB,EAAM5E,EAAQ6F,KAAU7F,EAAQ6F,IAM5CgE,iBACqBC,GAEpB,OAAO,IAAIlF,EAAMkE,KAAKiB,IAAID,GAAUhB,KAAKkB,IAAIF,IAO1CG,OAAOxB,GAEV,OAAOxG,KAAKkE,IAAMsC,EAAEtC,GAAKlE,KAAKmE,IAAMqC,EAAErC,EAMnCjB,OAEH,OAAO,IAAIP,EAAM3C,KAAKkE,EAAGlE,KAAKmE,GAM3B6B,QAEHhG,KAAKkE,EAAI2C,KAAKb,MAAMhG,KAAKkE,GACzBlE,KAAKmE,EAAI0C,KAAKb,MAAMhG,KAAKmE,GAMlBgC,cAEP,OAAO,IAAIxD,EAAMkE,KAAKb,MAAMhG,KAAKkE,GAAI2C,KAAKb,MAAMhG,KAAKmE,IAOlDf,MAAM6E,GAET,IAAIrL,EAAMoD,KAAKkD,OAEf,OADAtG,EAAIqI,SAASgD,GACNrL,EAOJqI,SAASgD,GAERA,aAAatF,GAEb3C,KAAKkE,GAAK+D,EAAE/D,EACZlE,KAAKmE,GAAK8D,EAAE9D,IAIZnE,KAAKkE,GAAK+D,EACVjI,KAAKmE,GAAK8D,GAQXxE,UAAUwE,GAEb,IAAIrL,EAAMoD,KAAKkD,OAEf,OADAtG,EAAIsL,SAASD,GACNrL,EAOJsL,SAASD,GAERA,aAAatF,GAEb3C,KAAKkE,GAAK+D,EAAE/D,EACZlE,KAAKmE,GAAK8D,EAAE9D,IAIZnE,KAAKkE,GAAK+D,EACVjI,KAAKmE,GAAK8D,GAQXnE,KAAKmE,GAER,IAAIrL,EAAMoD,KAAKkD,OAEf,OADAtG,EAAI8G,IAAIuE,GACDrL,EAOJ8G,IAAIuE,GAEHA,aAAatF,GAEb3C,KAAKkE,GAAK+D,EAAE/D,EACZlE,KAAKmE,GAAK8D,EAAE9D,IAIZnE,KAAKkE,GAAK+D,EACVjI,KAAKmE,GAAK8D,GAQX1E,MAAM0E,GAET,IAAIrL,EAAMoD,KAAKkD,OAEf,OADAtG,EAAI4G,SAASyE,GACNrL,EAOJ4G,SAASyE,GAERA,aAAatF,GAEb3C,KAAKkE,GAAK+D,EAAE/D,EACZlE,KAAKmE,GAAK8D,EAAE9D,IAIZnE,KAAKkE,GAAK+D,EACVjI,KAAKmE,GAAK8D,GAOPE,cAEP,OAAOnI,KAAKoD,MAAMpD,MAMXoI,UAEP,OAAOpI,KAAKkE,EAAIlE,KAAKmE,EAMd2C,UAEP,OAAOD,KAAKC,IAAI9G,KAAKkE,EAAGlE,KAAKmE,GAMtBkE,UAEP,OAAOxB,KAAKwB,IAAIrI,KAAKkE,EAAGlE,KAAKmE,GAO1BmE,WAAW9B,GAEd,OAAOK,KAAK0B,KAAKvI,KAAKuD,MAAMiD,GAAG2B,QAAQC,KAMpCzI,WAEH,MAAO,IAAMK,KAAKkE,EAAI,KAAOlE,KAAKmE,EAAI,IAMnCqE,UAEH,MAAO,CAAExI,KAAKkE,EAAGlE,KAAKmE,UCpTjBsE,cASGC,EAAyB,KACjCA,EAAUA,GAAW,IAERC,cAG+B,iBAA3BD,EAAQC,gBACrBD,EAAQC,cAAgB9L,SAAS+L,cAAcF,EAAQC,gBAHvDD,EAAQC,cAAgB9L,SAASC,cAAc,UAMnDkD,KAAK6I,OAASH,EAAQC,cACtB3I,KAAK8I,QAAU9I,KAAK6I,OAAOE,WAAW,KAAM,CAAEC,OAAQN,EAAQO,SAE9DP,EAAQjG,KAAOiG,EAAQjG,MAAQ,IAAIE,EAAM,GACzC3C,KAAKkJ,OAAOR,EAAQjG,MAAM,GAE1BzC,KAAKmJ,YAAc,IAAIxG,EAAM,GAE7B3C,KAAKoJ,MACL,CACIC,WAAaX,EAAQU,OAASV,EAAQU,MAAMC,aAAe,EAC3DC,SAAWZ,EAAQU,OAASV,EAAQU,MAAME,WAAa,GAGvDtJ,KAAKoJ,MAAMC,YAAcrJ,KAAKoJ,MAAME,WAsBpCtJ,KAAK6I,OAAO1L,MAAMoM,gBAAkB,YAGxCvJ,KAAKwJ,cAAgBd,EAAQe,WAAY,EACzCzJ,KAAK0J,UAAYhB,EAAQgB,YAAa,EAElC1J,KAAKwJ,gBACLxJ,KAAK2J,mBACLC,OAAOC,iBAAiB,SAAU7J,KAAK2J,mBAG3C3J,KAAK8J,MACL,CACIC,QAAQ,EACRC,QAAS,KACTC,YAAa,CAAE/F,GAAG,EAAIC,GAAG,GACzBlE,OACA,CACIiK,KAAM,GACNC,KAAM,GACNC,GAAI,GACJC,MAAO,KAIfrK,KAAK6I,OAAOgB,iBAAiB,YAAa7J,KAAKsK,UAAUC,KAAKvK,OAC9DA,KAAK6I,OAAOgB,iBAAiB,YAAa7J,KAAKsK,UAAUC,KAAKvK,OAC9DA,KAAK6I,OAAOgB,iBAAiB,YAAa7J,KAAKwK,UAAUD,KAAKvK,OAC9DA,KAAK6I,OAAOgB,iBAAiB,aAAc7J,KAAKwK,UAAUD,KAAKvK,OAC/DA,KAAK6I,OAAOgB,iBAAiB,UAAW7J,KAAKyK,QAAQF,KAAKvK,OAC1DA,KAAK6I,OAAOgB,iBAAiB,WAAY7J,KAAKyK,QAAQF,KAAKvK,OAC3DA,KAAK6I,OAAOgB,iBAAiB,aAAc7J,KAAK0K,WAAWH,KAAKvK,OAChEA,KAAK6I,OAAOgB,iBAAiB,cAAe7J,KAAK0K,WAAWH,KAAKvK,OAO9D6J,iBAAiBc,EAAmB9J,IRLZ,IQMR,CAAC,UAAW,YAAa,YAAa,cRNhD7C,QQM+D2M,IACpE3K,KAAK8J,MAAM7J,OAAO0K,EAAUC,OAAO,IAAIrM,KAAKsC,GAI7CqI,OAAOzG,EAAaoI,GACvB,IAAI3E,EAEA2E,IACA3E,EAAuBlG,KAAK6I,OAAOiC,aAGvC9K,KAAK6I,OAAOjF,MAAQnB,EAAKyB,EACzBlE,KAAK6I,OAAOhF,OAASpB,EAAK0B,EAEtB0G,GACA7K,KAAK+K,UAAU7E,EAAG,IAAIvD,EAAM,IAI7BqI,KAAKC,GACR,IAAI/G,EACAC,EAEoB,iBAAZ8G,GACR/G,EAAI+G,EACJ9G,EAAI8G,IAGJ/G,EAAI+G,EAAO/G,EACXC,EAAI8G,EAAO9G,GAGfnE,KAAK6I,OAAO1L,MAAiB,UAAI,SAAW+G,EAAI,KAAOC,EAAI,IAGxD+G,UAAUzI,GACb,IAAI0I,EAAS1I,EAAKyB,EAAIlE,KAAK4D,MACvBwH,EAAS3I,EAAK0B,EAAInE,KAAK6D,OAEvBsH,EAASC,EACTpL,KAAKgL,KAAKG,GAGVnL,KAAKgL,KAAKI,GAIXC,MAAMJ,GACT,OAAOjL,KAAKgL,KAAKC,GAGdK,QACHtL,KAAK8I,QAAQyC,WAAWvL,KAAKmJ,YAAYjF,GAAIlE,KAAKmJ,YAAYhF,EAAGnE,KAAK6I,OAAOjF,MAAO5D,KAAK6I,OAAOhF,QAG5F8F,mBACJ,IAAgDzD,EAA5CsF,EAAiBxL,KAAK6I,OAAQ3E,EAAI,EAAGC,EAAI,OAEtCqH,IAAMC,MAAMD,EAAEE,cAAgBD,MAAMD,EAAEG,YACzCzF,EAAI0D,OAAOgC,iBAAiBJ,EAAG,MAC/BtH,GAAKsH,EAAEE,WAAaF,EAAEK,YAAc3F,EAAI4F,SAAS5F,EAAE6F,iBAAiB,qBAAsB,IAAM,GAChG5H,GAAKqH,EAAEG,UAAYH,EAAEQ,WAAa9F,EAAI4F,SAAS5F,EAAE6F,iBAAiB,oBAAqB,IAAM,GAC7FP,EAAiBA,EAAES,aAGvBjM,KAAKiE,OAAS,IAAItB,EAAMuB,EAAGC,GAGvB+H,aAAalP,GACjB,IAAIJ,EAAM,IAAI+F,EAGV/F,EADAI,aAAamP,WACP,IAAIxJ,EAAM3F,EAAEoP,MAAOpP,EAAEqP,OAGrB,IAAI1J,EAAM3F,EAAEsP,eAAe,GAAGF,MAAOpP,EAAEsP,eAAe,GAAGD,OAG/DrM,KAAKwJ,eACLxJ,KAAK2J,mBAGT,IAAI4C,EAASvM,KAAK6I,OAAO2D,wBAErB5L,EAAIZ,KAAKwJ,cAAgBxJ,KAAKiE,OAAOf,OAAS,IAAIP,EAAM4J,EAAO3J,KAAM2J,EAAO1J,KAahF,OAXI7C,KAAKoJ,MAAMC,YAAczI,EAAEsD,EAAI,IAC/BtD,EAAEsD,GAAK,EAAItD,EAAEsD,EAAIqI,EAAO3I,OAAS,GAGjC5D,KAAKoJ,MAAME,UAAY1I,EAAEuD,EAAI,IAC7BvD,EAAEuD,GAAK,EAAIvD,EAAEuD,EAAIoI,EAAO1I,QAAU,GAGtCjH,EAAI4G,SAAS5C,GACbhE,EAAIqI,SAASjF,KAAKyC,KAAKgB,UAAU,IAAId,EAAM4J,EAAO3I,MAAO2I,EAAO1I,UAEzDjH,EAGA6F,WACP,OAAO,IAAIE,EAAM3C,KAAK6I,OAAOjF,MAAO5D,KAAK6I,OAAOhF,QAG5CyG,UAAUtN,GACd,IAAI4J,EAAM5G,KAAKkM,aAAalP,GACvBgD,KAAK8J,MAAME,UAAShK,KAAK8J,MAAME,QAAUpD,GACzC5G,KAAK8J,MAAMC,SAAQ/J,KAAK8J,MAAMG,YAAcrD,GAEjD5G,KAAK8J,MAAM7J,OAAOiK,KAAKhN,SAAQ2D,KAab,IAZFA,EAAG4L,KACXzM,KACA4G,EAAI1C,EACJ0C,EAAIzC,EACJnE,KAAK8J,MAAMC,OACX/J,KAAK8J,MAAME,QAAQ9F,EACnBlE,KAAK8J,MAAME,QAAQ7F,EACnBnE,KAAK8J,MAAMG,YAAY/F,EACvBlE,KAAK8J,MAAMG,YAAY9F,EACvBnH,KAIAgD,KAAK8J,MAAME,QAAUpD,MAKzB4D,UAAUxN,GACd,IAAI4J,EAAM5G,KAAKkM,aAAalP,GAC5BgD,KAAK8J,MAAMC,QAAS,EACpB/J,KAAK8J,MAAME,QAAUpD,EACrB5G,KAAK8J,MAAMG,YAAcrD,EAEzB5G,KAAK8J,MAAM7J,OAAOkK,KAAKjN,SAAQ2D,IAC3BA,EAAG4L,KAAKzM,KAAM4G,EAAI1C,EAAG0C,EAAIzC,EAAGnH,MAI5ByN,QAAQzN,GACZ,IAAI4J,EAAM5G,KAAKkM,aAAalP,GAC5BgD,KAAK8J,MAAMC,QAAS,EAEpB/J,KAAK8J,MAAM7J,OAAOmK,GAAGlN,SAAQ2D,IACzBA,EAAG4L,KAAKzM,KAAM4G,EAAI1C,EAAG0C,EAAIzC,EAAGnE,KAAK8J,MAAMG,YAAY/F,EAAGlE,KAAK8J,MAAMG,YAAY9F,EAAGnH,MAGpFgD,KAAK8J,MAAME,QAAUpD,EAGjB8D,WAAW1N,GACf,IAAI4J,EAAM5G,KAAKkM,aAAalP,GAE5BgD,KAAK8J,MAAM7J,OAAOoK,MAAMnN,SAAQ2D,IAC5BA,EAAG4L,KAAKzM,KAAM4G,EAAI1C,EAAG0C,EAAIzC,EAAGnH,MAIzB0M,cAAUgD,GACjBA,GAAQA,EAER,IAAIC,EAAM3M,KAAK8I,QAMf,GALM6D,EAAKC,yBAA2BF,EAChCC,EAAKE,4BAA8BH,EAEnCC,EAAKG,sBAAwBJ,EAE9BA,EAMD1M,KAAK6I,OAAO1L,MAAM,mBAAqB,OANhC,CACK,CAAC,gBAAiB,cAAe,mBAAoB,4BAA6B,oBAAqB,aAE7GD,SAAQR,GAAQsD,KAAK6I,OAAO1L,MAAM,mBAAqBT,KAQ1DkH,YAAkB,OAAO5D,KAAK6I,OAAOjF,MACrCC,aAAmB,OAAO7D,KAAK6I,OAAOhF,OAEtCkJ,cAAoB,OAAO/M,KAAK8I,QAAQkE,YACxCD,YAAQA,GAAmB/M,KAAK8I,QAAQkE,YAAcD,EAEtDE,YAAkB,OAAejN,KAAK8I,QAAQoE,UAC9CD,UAAME,QACDlG,IAARkG,IAEJnN,KAAK8I,QAAQoE,UAAYC,EACzBnN,KAAK8I,QAAQsE,YAAcD,GAGpBE,WAAiB,OAAOrN,KAAK8I,QAAQuE,KACrCA,SAAKF,QACAlG,IAARkG,IAEJnN,KAAK8I,QAAQuE,KAAOF,GAGbG,gBAAsB,OAAOtN,KAAK8I,QAAQwE,UAC1CA,cAAUH,QACLlG,IAARkG,IAEJnN,KAAK8I,QAAQwE,UAAYH,GAGlBI,gBAAsB,OAAOvN,KAAK8I,QAAQ0E,yBAC1CD,cAAUJ,GAAenN,KAAK8I,QAAQ0E,yBAA2BL,EAEjEM,eAAuB,OAAOzN,KAAK8I,QAAQ4E,cAC3CD,aAASE,GAAkB3N,KAAK8I,QAAQ8E,YAAYD,GAExDE,WAAWC,EAA+BC,GAC7C/N,KAAK6I,OAAOmF,QAAO,SAAUC,GACzBH,EAASG,KACVF,GAGAG,YAAYJ,EAA4CC,EAAmBI,GAAsB,GACpGnO,KAAK6I,OAAOmF,QAAO,SAAUC,GACzB,IAAIrR,EAAM,IAAIwR,MAEdxR,EAAIyR,OAAM,KACNP,EAASlR,GACTA,EAAIyR,OAAS,KACbF,GAAc9O,IAAIiP,gBAAgB1R,EAAI2R,MAG1C,IAAI7O,EAAML,IAAImP,gBAAgBP,GAC9BrR,EAAI2R,IAAM7O,IACXqO,GAGIU,gBACP,OAAOzO,KAAK8I,QAAQ4F,aAAa,EAAG,EAAG1O,KAAK4D,MAAO5D,KAAK6D,QAGrDkH,UAAU4D,EAAiBnM,GAC1BmM,aAAiBlG,IACjBkG,EAAQA,EAAM9F,QAGdrG,aAAoBG,EACpB3C,KAAK8I,QAAQiC,UAAU4D,EAAOnM,EAAS0B,EAAG1B,EAAS2B,GAGnDnE,KAAK8I,QAAQiC,UAAU4D,EAAOnM,EAAS0B,EAAG1B,EAAS2B,EAAG3B,EAASoB,MAAOpB,EAASqB,QAIhF+K,iBAAiBD,EAAiBnM,EAA6BqM,GAC9DF,aAAiBlG,IACjBkG,EAAQA,EAAM9F,QAGdrG,aAAoBG,EACpB3C,KAAK8I,QAAQiC,UAAU4D,EAAOE,EAAW3K,EAAG2K,EAAW1K,EAAG0K,EAAWjL,MAAOiL,EAAWhL,OAAQrB,EAAS0B,EAAG1B,EAAS2B,EAAG0K,EAAWjL,MAAOiL,EAAWhL,QAGpJ7D,KAAK8I,QAAQiC,UAAU4D,EAAOE,EAAW3K,EAAG2K,EAAW1K,EAAG0K,EAAWjL,MAAOiL,EAAWhL,OAAQrB,EAAS0B,EAAG1B,EAAS2B,EAAG3B,EAASoB,MAAOpB,EAASqB,QAIjJiL,wBAAwBH,EAAiBI,EAAgB1K,EAAe7B,EAA6BqM,GACpGF,aAAiBlG,IACjBkG,EAAQA,EAAM9F,QAGlB,IAAI8D,EAAM3M,KAAK8I,QAEf6D,EAAIqC,OACJrC,EAAIsC,UAAUzM,EAAS0B,EAAIG,EAAOH,EAAG1B,EAAS2B,EAAIE,EAAOF,GACzDwI,EAAIoC,OAAOA,GAEPvM,aAAoBG,EACpBgK,EAAI5B,UAAU4D,EAAOE,EAAW3K,EAAG2K,EAAW1K,EAAG0K,EAAWjL,MAAOiL,EAAWhL,QAASQ,EAAOH,GAAIG,EAAOF,EAAGwK,EAAM/K,MAAO+K,EAAM9K,QAG/H8I,EAAI5B,UAAU4D,EAAOE,EAAW3K,EAAG2K,EAAW1K,EAAG0K,EAAWjL,MAAOiL,EAAWhL,QAASQ,EAAOH,GAAIG,EAAOF,EAAG3B,EAASoB,MAAOpB,EAASqB,QAGzI8I,EAAIuC,UAGDC,cAAcR,EAAiBS,GAC9BA,GACApP,KAAKkJ,OAAO,IAAIvG,EAAMgM,EAAM/K,MAAO+K,EAAM9K,SAAS,GAGtD7D,KAAK+K,UAAU4D,EAAO,IAAIhM,EAAM,IAG7B0M,SAASC,EAAcC,EAAYtC,EAAgBK,GACtDtN,KAAKiN,MAAQA,EACbjN,KAAKsN,UAAYA,EAEjBtN,KAAK8I,QAAQ0G,YACbxP,KAAK8I,QAAQ2G,OAAOH,EAAMpL,EAAGoL,EAAMnL,GACnCnE,KAAK8I,QAAQ4G,OAAOH,EAAIrL,EAAGqL,EAAIpL,GAC/BnE,KAAK8I,QAAQ6G,SAEVC,QAAQvM,EAAewM,EAAgBC,EAAoBC,EAAkB9C,EAAgBK,GAChGtN,KAAKiN,MAAQA,EACbjN,KAAKsN,UAAYA,EAEjBtN,KAAK8I,QAAQ0G,YACbxP,KAAK8I,QAAQkH,IAAI3M,EAAOa,EAAGb,EAAOc,EAAG0L,EAAQC,EAAYC,GACzD/P,KAAK8I,QAAQ6G,SAEVM,SAASvN,EAAiBuK,EAAeK,EAAmB4C,GAAiB,GAChFlQ,KAAKiN,MAAQA,EACbjN,KAAKsN,UAAYA,EAEb4C,IACAxN,EAAOA,EAAKsB,WAAW,IAAIrB,EAAM,MAGrC3C,KAAK8I,QAAQqH,WAAWzN,EAAKwB,EAAGxB,EAAKyB,EAAGzB,EAAKkB,MAAOlB,EAAKmB,QAEtDuM,SAAS1N,EAAiBuK,GAC7BjN,KAAKiN,MAAQA,EAEbjN,KAAK8I,QAAQsH,SAAS1N,EAAKwB,EAAGxB,EAAKyB,EAAGzB,EAAKkB,MAAOlB,EAAKmB,QAGpDwM,WAAWC,EAAahD,GAQ3BtN,KAAK8I,QAAQ0G,YACbxP,KAAK8I,QAAQ2G,OAAOa,EAAO1N,MAAQ0N,EAAO1M,MAAQ,EAAI0M,EAAO1M,MAAQ,OAAQ0M,EAAOhK,IACpFtG,KAAK8I,QAAQ4G,OAAOY,EAAO1N,KAAM0N,EAAOhK,IACxCtG,KAAK8I,QAAQkH,IAAIM,EAAOjN,OAAOa,EAAGoM,EAAOjN,OAAOc,EAAGmM,EAAO1M,MAAQ,EAAGiD,KAAK0J,GAAI,IAAM1J,KAAK0J,IAAI,GAC7FvQ,KAAK8I,QAAQkH,IAAIM,EAAOjN,OAAOa,EAAGoM,EAAOjN,OAAOc,EAAGmM,EAAO1M,MAAQ,EAAG,IAAMiD,KAAK0J,GAAI,EAAI1J,KAAK0J,IAAI,GACjGvQ,KAAK8I,QAAQ4G,OAAOY,EAAO3K,MAAwB,IAAf2K,EAAO1M,MAAgB0M,EAAO1M,MAAQ,MAAQ0M,EAAOhK,IACzFtG,KAAK8I,QAAQ4G,OAAOY,EAAO3K,MAAwB,IAAf2K,EAAO1M,MAAgB0M,EAAO1M,MAAQ,MAAQ0M,EAAOhK,GAAqB,IAAfgK,EAAO1M,OACtG5D,KAAK8I,QAAQ4G,OAAOY,EAAO1N,MAAQ0N,EAAO1M,MAAQ,EAAI0M,EAAO1M,MAAQ,OAAQ0M,EAAOhK,GAAqB,IAAfgK,EAAO1M,OACjG5D,KAAK8I,QAAQ4G,OAAOY,EAAO1N,MAAQ0N,EAAO1M,MAAQ,EAAI0M,EAAO1M,MAAQ,OAAQ0M,EAAOhK,IACpFtG,KAAK8I,QAAQwE,UAAYA,EACzBtN,KAAK8I,QAAQsE,YAAc,SAC3BpN,KAAK8I,QAAQ6G,SAEb3P,KAAK8I,QAAQ0G,YACbxP,KAAK8I,QAAQ2G,OAAOa,EAAO1N,KAAQ0N,EAAO1M,MAAQ,MAAQ0M,EAAOhK,IACjEtG,KAAK8I,QAAQkH,IAAIM,EAAOjN,OAAOa,EAAGoM,EAAOjN,OAAOc,EAAGmM,EAAO1M,MAAQ,EAAK0M,EAAO1M,MAAQ,MAAQiD,KAAK0J,GAAI,IAAM1J,KAAK0J,IAAI,GACtHvQ,KAAK8I,QAAQkH,IAAIM,EAAOjN,OAAOa,EAAGoM,EAAOjN,OAAOc,EAAGmM,EAAO1M,MAAQ,EAAK0M,EAAO1M,MAAQ,MAAQ,IAAMiD,KAAK0J,GAAI,EAAI1J,KAAK0J,IAAI,GAC1HvQ,KAAK8I,QAAQsE,YAAc,MAC3BpN,KAAK8I,QAAQ6G,SAKVa,gBAAgB9N,EAAiBmN,EAAgB5C,EAAeK,EAAmB4C,GAAiB,GACvGlQ,KAAKiN,MAAQA,EACbjN,KAAKsN,UAAYA,EAEb4C,IACAxN,EAAOA,EAAKsB,WAAW,IAAIrB,EAAM,MAGjCD,EAAKkB,MAAQ,EAAIiM,IAAQA,EAASnN,EAAKkB,MAAQ,GAC/ClB,EAAKmB,OAAS,EAAIgM,IAAQA,EAASnN,EAAKmB,OAAS,GAErD7D,KAAK8I,QAAQ0G,YACbxP,KAAK8I,QAAQ2G,OAAO/M,EAAKwB,EAAI2L,EAAQnN,EAAKyB,GAC1CnE,KAAK8I,QAAQ2H,MAAM/N,EAAKiD,MAAOjD,EAAKyB,EAAGzB,EAAKiD,MAAOjD,EAAKkD,OAAQiK,GAChE7P,KAAK8I,QAAQ2H,MAAM/N,EAAKiD,MAAOjD,EAAKkD,OAAQlD,EAAKwB,EAAGxB,EAAKkD,OAAQiK,GACjE7P,KAAK8I,QAAQ2H,MAAM/N,EAAKwB,EAAGxB,EAAKkD,OAAQlD,EAAKwB,EAAGxB,EAAKyB,EAAG0L,GACxD7P,KAAK8I,QAAQ2H,MAAM/N,EAAKwB,EAAGxB,EAAKyB,EAAGzB,EAAKiD,MAAOjD,EAAKyB,EAAG0L,GACvD7P,KAAK8I,QAAQ4H,YACb1Q,KAAK8I,QAAQ6G,SAEVgB,gBAAgBjO,EAAiBmN,EAAgB5C,EAAeiD,GAAiB,GACpFlQ,KAAKiN,MAAQA,EAETiD,IACAxN,EAAOA,EAAKsB,WAAW,IAAIrB,EAAM,MAGjCD,EAAKkB,MAAQ,EAAIiM,IAAQA,EAASnN,EAAKkB,MAAQ,GAC/ClB,EAAKmB,OAAS,EAAIgM,IAAQA,EAASnN,EAAKmB,OAAS,GAErD7D,KAAK8I,QAAQ0G,YACbxP,KAAK8I,QAAQ2G,OAAO/M,EAAKwB,EAAI2L,EAAQnN,EAAKyB,GAC1CnE,KAAK8I,QAAQ2H,MAAM/N,EAAKiD,MAAOjD,EAAKyB,EAAGzB,EAAKiD,MAAOjD,EAAKkD,OAAQiK,GAChE7P,KAAK8I,QAAQ2H,MAAM/N,EAAKiD,MAAOjD,EAAKkD,OAAQlD,EAAKwB,EAAGxB,EAAKkD,OAAQiK,GACjE7P,KAAK8I,QAAQ2H,MAAM/N,EAAKwB,EAAGxB,EAAKkD,OAAQlD,EAAKwB,EAAGxB,EAAKyB,EAAG0L,GACxD7P,KAAK8I,QAAQ2H,MAAM/N,EAAKwB,EAAGxB,EAAKyB,EAAGzB,EAAKiD,MAAOjD,EAAKyB,EAAG0L,GACvD7P,KAAK8I,QAAQ4H,YACb1Q,KAAK8I,QAAQ8H,OAGVA,KAAK3D,GACRjN,KAAKoQ,SAAS,IAAI7N,EAAU,IAAII,EAAM,GAAI3C,KAAKyC,MAAOwK,GAGnD4D,SAASxT,EAAcmF,EAAiByK,EAAe6D,EAA+B1H,EAAyBiE,GAClHrN,KAAKiN,MAAQA,EAETI,IACArN,KAAKqN,KAAOA,GAEZyD,IACA9Q,KAAK8I,QAAQiI,aAAeD,GAE5B1H,IACApJ,KAAK8I,QAAQkI,UAAY5H,GAG7BpJ,KAAK8I,QAAQ+H,SAASxT,EAAMmF,EAAS0B,EAAG1B,EAAS2B,GAG9C8M,WAAWzO,EAAiBqN,EAAgB5C,GAC/CjN,KAAKiN,MAAQA,EAEbjN,KAAK8I,QAAQ0G,YACbxP,KAAK8I,QAAQkH,IAAIxN,EAAS0B,EAAG1B,EAAS2B,EAAG0L,EAAQ,EAAG,EAAIhJ,KAAK0J,IAAI,GACjEvQ,KAAK8I,QAAQ8H,OAGVM,mBAAmB1O,EAAiB2O,EAAkBlE,GACzDjN,KAAKiN,MAAQA,EAEbjN,KAAK8I,QAAQ0G,YACbxP,KAAK8I,QAAQkH,IAAIxN,EAAS0B,EAAIiN,EAAW,EAAG3O,EAAS2B,EAAIgN,EAAW,EAAGA,EAAW,EAAG,EAAG,EAAItK,KAAK0J,IAAI,GACrGvQ,KAAK8I,QAAQ8H,OAGVQ,mBAAmB5O,EAAiB2O,EAAkBlE,EAAOK,GAChEtN,KAAKiN,MAAQA,EACbjN,KAAKsN,UAAYA,EAEjBtN,KAAK8I,QAAQ0G,YACbxP,KAAK8I,QAAQkH,IAAIxN,EAAS0B,EAAIiN,EAAW,EAAG3O,EAAS2B,EAAIgN,EAAW,EAAGA,EAAW,EAAG,EAAG,EAAItK,KAAK0J,IAAI,GACrGvQ,KAAK8I,QAAQ6G,SAGV0B,iBAAiB3O,EAAiBuK,GACrC,GAAIvK,EAAKiB,SACL,OAAO3D,KAAKkR,mBAAmBxO,EAAKF,SAAUE,EAAKkB,MAAOqJ,GAG9DjN,KAAKiN,MAAQA,EAEbjN,KAAK8I,QAAQ0G,YACbxP,KAAK8I,QAAQwI,QAAQ5O,EAAKwB,EAAGxB,EAAKyB,EAAGzB,EAAKkB,MAAQ,EAAGlB,EAAKmB,OAAS,EAAG,EAAG,EAAa,EAAVgD,KAAK0J,IACjFvQ,KAAK8I,QAAQ8H,OAGVW,iBAAiB7O,EAAiBuK,EAAgBK,GACrD,GAAI5K,EAAKiB,SACL,OAAO3D,KAAKoR,mBAAmB1O,EAAKF,SAAUE,EAAKkB,MAAOqJ,EAAOK,GAGrEtN,KAAKiN,MAAQA,EACbjN,KAAKsN,UAAYA,EAEjBtN,KAAK8I,QAAQ0G,YACbxP,KAAK8I,QAAQwI,QAAQ5O,EAAKwB,EAAGxB,EAAKyB,EAAGzB,EAAKkB,MAAQ,EAAGlB,EAAKmB,OAAS,EAAG,EAAG,EAAa,EAAVgD,KAAK0J,IACjFvQ,KAAK8I,QAAQ6G,SAGV6B,iBAAiB7C,EAAiBI,EAAgBvM,GAKrD,IAAIiP,EACAC,EALA/C,aAAiBlG,IACjBkG,EAAQA,EAAM9F,QAMdrG,aAAoBG,GACpB8O,EAAI9C,EAAM/K,MACV8N,EAAI/C,EAAM9K,SAGV4N,EAAIjP,EAASoB,MACb8N,EAAIlP,EAASqB,QAGjB7D,KAAK8I,QAAQkG,OACbhP,KAAK8I,QAAQmG,UAAUzM,EAAS0B,EAAIuN,EAAI,EAAGjP,EAAS2B,EAAIuN,EAAI,GAC5D1R,KAAK8I,QAAQiG,OAAOA,GACpB/O,KAAK8I,QAAQiC,UAAU4D,GAAQ8C,EAAI,GAAIC,EAAI,EAAGD,EAAGC,GACjD1R,KAAK8I,QAAQoG,6BAGSyC,EAAY7D,EAA4CK,GAAsB,GACpG,IAAIyD,EAAM,IAAIxD,MAEdwD,EAAIvD,OAAM,KACNP,EAAS8D,GACLzD,GACAvE,OAAOvK,IAAIiP,gBAAgBsD,EAAIrD,MAIvCqD,EAAIrD,IAAM3E,OAAOvK,IAAImP,gBAAgBmD,IAKxCE,kBAAkBC,UAAU9D,QAC7BjP,OAAOgT,eAAeF,kBAAkBC,UAAW,SAAU,CACzDxU,MAAO,SAAUwQ,EAAUpR,EAAMsV,GAC7B,IAAInJ,EAAS7I,KACbiS,YAAW,WAKP,IAJA,IAAIC,EAASC,KAAKtJ,EAAOuJ,UAAU1V,EAAMsV,GAASK,MAAM,KAAK,IACzDC,EAAMJ,EAAO5T,OACbiU,EAAM,IAAIC,WAAWF,GAEhBjU,EAAI,EAAGA,EAAIiU,EAAKjU,IACrBkU,EAAIlU,GAAK6T,EAAOO,WAAWpU,GAG/ByP,EAAS,IAAI4E,KAAK,CAACH,GAAM,CAAE7V,KAAMA,GAAQ,2BC7oB5CiW,UAAoBvR,gBAKzBE,MAAM7E,EAAc,MAAO,gBAE3BuD,KAAK4S,gBAAkBnW,EAAc,MAAO,YAC5CuD,KAAK4S,gBAAgBzV,MAAM0G,OAAS,OAEpC7D,KAAK6S,SAAW,EAEhB7S,KAAK4B,YAAY5B,KAAK4S,iBAIfC,aAASA,GAChB7S,KAAK8S,UAAYD,EACjB7S,KAAK4S,gBAAgBzV,MAAMyG,MAAoB,IAAXiP,EAAkB,IAG/CA,eACP,OAAO7S,KAAK8S,iBCjBPC,UAA8BJ,gBAKnCrR,QALDtB,KACKgT,cAAgC,GADrChT,KAEKiT,eAAyB,EAM1BC,gBAAgBC,EAA0BC,GAC7CpT,KAAKgT,cAAczU,KAAK,kBAAE4U,gBAAkBC,EAAeC,QAAS,IACpErT,KAAKiT,gBAAkBE,EAGpBG,OACCtT,KAAKgT,cAAc1U,OAAS,IAC5B0B,KAAKgT,cAAc,GAAGK,UACtBrT,KAAK6S,UAAa,EAAI7S,KAAKgT,cAAc,GAAGI,cAAkBpT,KAAKgT,cAAc,GAAGG,iBAChFnT,KAAKgT,cAAc,GAAGK,UAAYrT,KAAKgT,cAAc,GAAGI,eACxDpT,KAAKgT,cAAcO,SAKxBC,QACHxT,KAAKgT,cAAgB,GACrBhT,KAAK6S,SAAW,SC9BFY,UAAerS,gBAI7BE,MAAM,mBAENtB,KAAK0T,OAASjX,EAAc,MAAO,UACnCuD,KAAK0T,OAAO7J,iBAAiB,QAASrL,GACtCwB,KAAKuB,UAAUK,YAAY5B,KAAK0T,QAChC1T,KAAKwB,iBAAmBxB,KAAK0T,OAE7B1T,KAAKuB,UAAUsI,iBAAiB,SAAO,KACnC7J,KAAK2T,aAGT3T,KAAK0B,OAGFD,OACHH,MAAMG,OACNzB,KAAKwB,iBAAiBwK,UAAY,SCpB7B4H,UAAuBH,gBAI5BnS,QAEAtB,KAAK0T,OAAOG,UAAUnQ,IAAI,YAE1B,IAAIoQ,EAAQrX,EAAc,MAAO,SACjCqX,EAAMvW,UAAY,IAClBuW,EAAMjK,iBAAiB,SAAO,KAC1B7J,KAAK0B,UAET1B,KAAK4B,YAAYkS,GAEjB9T,KAAK+T,aAAetX,EAAc,MAAO,gBACzCuD,KAAK4B,YAAY5B,KAAK+T,cACtB/T,KAAKwB,iBAAmBxB,KAAK+T,aAG1BJ,UACH3T,KAAK0B,cCTAsS,EACSC,sBACd,MAAO,CACH,CACIC,KAAM,aACNC,MAAO,EACPC,SAAU,CACN,CAAExN,IAAK,EAAKqG,MAAO,WACnB,CAAErG,IAAK,GAAKqG,MAAO,WACnB,CAAErG,IAAK,GAAKqG,MAAO,WACnB,CAAErG,IAAK,GAAKqG,MAAO,WACnB,CAAErG,IAAK,GAAKqG,MAAO,WACnB,CAAErG,IAAK,EAAKqG,MAAO,aAG3B,CACIiH,KAAM,cACNC,MAAO,EACPC,SAAU,CACN,CAAExN,IAAK,EAAGqG,MAAO,WACjB,CAAErG,IAAK,IAAMqG,MAAO,WACpB,CAAErG,IAAK,GAAKqG,MAAO,WACnB,CAAErG,IAAK,IAAMqG,MAAO,WACpB,CAAErG,IAAK,EAAGqG,MAAO,aAGzB,CACIiH,KAAM,kBACNC,MAAO,EACPC,SAAU,CACN,CAAExN,IAAK,EAAKqG,MAAO,WACnB,CAAErG,IAAK,EAAE,EAAGqG,MAAO,WACnB,CAAErG,IAAK,EAAE,EAAGqG,MAAO,WACnB,CAAErG,IAAK,EAAKqG,MAAO,cAYjBvQ,kBACd,OAAOsD,KAAKqU,MAGE3X,gBAAKA,GACnBsD,KAAKqU,MAAQ3X,EACbyE,EAAaZ,UAAU,gBAGTkC,kBACd,OAAOzC,KAAKsU,MAGE7R,gBAAKA,GACnBzC,KAAKsU,MAAQ7R,EACbtB,EAAaZ,UAAU,gBAGT0M,iBAAMA,GACpBjN,KAAKuU,OAAStH,EACd9L,EAAaZ,UAAU,gBAGT0M,mBACd,OAAOjN,KAAKuU,OAGEH,oBAASA,GACvBpU,KAAKwU,UAAYJ,EACjBjT,EAAaZ,UAAU,gBAGT6T,sBACd,OAAOpU,KAAKwU,UAGEC,iBAAMA,GACpBzU,KAAK0U,OAASD,EACdtT,EAAaZ,UAAU,gBAGTkU,mBACd,OAAOzU,KAAK0U,oCAGoBC,EAA6B9L,GAC7D,IAAI+L,IAAM,IAAOD,EAAaR,OAAStN,KAAK0J,GAAK,IAC7CsE,IAAM,KAAQF,EAAaR,MAAQ,MAAQtN,KAAK0J,GAAK,IAGrD7J,EAAK,IAAI/D,EACT,GAAMkE,KAAKwB,IAAIxB,KAAKE,IAAIF,KAAKiB,IAAI8M,IAAM/N,KAAKE,IAAIF,KAAKkB,IAAI6M,KAAQ/N,KAAKiB,IAAI8M,GAC1E,GAAM/N,KAAKwB,IAAIxB,KAAKE,IAAIF,KAAKiB,IAAI8M,IAAM/N,KAAKE,IAAIF,KAAKkB,IAAI6M,KAAQ/N,KAAKkB,IAAI6M,IAC5ExR,MAAMyF,EAAOpG,MAAMqB,KAAK+E,EAAOpG,KAAKgB,UAAU,IAE5CkD,EAAK,IAAIhE,EACT,GAAMkE,KAAKwB,IAAIxB,KAAKE,IAAIF,KAAKiB,IAAI+M,IAAMhO,KAAKE,IAAIF,KAAKkB,IAAI8M,KAAQhO,KAAKiB,IAAI+M,GAC1E,GAAMhO,KAAKwB,IAAIxB,KAAKE,IAAIF,KAAKiB,IAAI+M,IAAMhO,KAAKE,IAAIF,KAAKkB,IAAI8M,KAAQhO,KAAKkB,IAAI8M,IAC5EzR,MAAMyF,EAAOpG,MAAMqB,KAAK+E,EAAOpG,KAAKgB,UAAU,IAG5C2Q,EAAWvL,EAAOC,QAAQgM,qBAAqBpO,EAAGxC,EAAGyC,EAAGxC,EAAGwC,EAAGzC,EAAGwC,EAAGvC,GACxEwQ,EAAaP,SAASlX,SAAS6X,IAC3BX,EAASY,aAAaD,EAAInO,IAAKmO,EAAI9H,UAEvCpE,EAAOC,QAAQoE,UAAYkH,EAC3BvL,EAAOC,QAAQsH,SAAS,EAAG,EAAGvH,EAAOjF,MAAOiF,EAAOhF,qBAGnCgF,GAChBA,EAAOyC,QAEW,SAAdtL,KAAKtD,MAAiC,IAAdsD,KAAKyC,OAER,UAAdzC,KAAKtD,MACZmM,EAAO+H,KAAK5Q,KAAKiN,OACjBpE,EAAO0E,UAAY,kBACnB1E,EAAOwI,iBAAiBxI,EAAOpG,KAAK2E,cAAcrE,OAAO,EAAI/C,KAAKyC,MAAO,SACzEoG,EAAO0E,UAAY,eACE,aAAdvN,KAAKtD,OACZsD,KAAKiV,sBAAsBjV,KAAKoU,SAAUvL,GAC1CA,EAAO0E,UAAY,kBACA,WAAfvN,KAAKyU,MACL5L,EAAOwI,iBAAiBxI,EAAOpG,KAAK2E,cAAcrE,OAAO,EAAI/C,KAAKyC,MAAO,SAEzEoG,EAAOuH,SAASvH,EAAOpG,KAAK2E,cAAcrE,OAAO,EAAI/C,KAAKyC,MAAO,SAErEoG,EAAO0E,UAAY,iBApIlByG,EAuCMK,MAAuC,OAvC7CL,EAwCMM,MAAgB,IAxCtBN,EAyCMO,OAAiB,UAzCvBP,EA0CMQ,UA1CNR,EA0CuCC,SAAS,GA1ChDD,EA2CMU,OAA8B,aCMtCQ,EAAMC,OAAND,EAQTE,EAReD,EAQT,WACJ,IAAIE,GAAc,EACdC,EAAU,KAGVC,EAAY,SAAUC,GACtB,OAAOA,EAAGC,QAAO,SAAUC,EAAGzN,GAC1B,OAAW,EAAJyN,EAAQzN,IAChB,IAGH0N,EAAe,SAAUC,GAEzB,IADA,IAAIC,EAAI,GACCxX,EAAI,EAAGA,GAAK,EAAGA,IACpBwX,EAAEtX,QAAUqX,EAAQ,GAAKvX,IAE7B,OAAOwX,GAQPC,EAAS,SAAUC,GACnB/V,KAAK+V,KAAOA,EACZ/V,KAAKsS,IAAMtS,KAAK+V,KAAKzX,OACrB0B,KAAK4G,IAAM,EAEX5G,KAAKgW,SAAW,WACZ,GAAIhW,KAAK4G,KAAO5G,KAAK+V,KAAKzX,OACtB,MAAM,IAAIY,MAAM,yCAEpB,OAAI6W,aAAgBvD,WACTuD,EAAK/V,KAAK4G,OAEoB,IAA9BmP,EAAKtD,WAAWzS,KAAK4G,QAGpC5G,KAAKiW,UAAY,SAAUhO,GAEvB,IADA,IAAIiO,EAAQ,GACH7X,EAAI,EAAGA,EAAI4J,EAAG5J,IACnB6X,EAAM3X,KAAKyB,KAAKgW,YAEpB,OAAOE,GAGXlW,KAAKmW,KAAO,SAAUlO,GAElB,IADA,IAAIyN,EAAI,GACCrX,EAAI,EAAGA,EAAI4J,EAAG5J,IACnBqX,GAAKU,OAAOC,aAAarW,KAAKgW,YAElC,OAAON,GAGX1V,KAAKsW,aAAe,WAChB,IAAIT,EAAI7V,KAAKiW,UAAU,GACvB,OAAQJ,EAAE,IAAM,GAAKA,EAAE,KA2E3BU,EAAW,SAAUC,EAAIC,GACzBA,IAAYA,EAAU,IAGtB,IAAIC,EAAU,SAAUC,GAEpB,IADA,IAAIC,EAAK,GACAvY,EAAI,EAAGA,EAAIsY,EAAStY,IACzBuY,EAAGrY,KAAKiY,EAAGP,UAAU,IAEzB,OAAOW,GAGPC,EAAgB,WAChB,IAAIpU,EAAMsT,EACVA,EAAO,MAEHtT,EAAO+T,EAAGR,WACVD,GAAQS,EAAGL,KAAK1T,SACF,IAATA,GACT,OAAOsT,GAkHPe,EAAW,SAAUlF,GA0BrBA,EAAImF,QAAUP,EAAGF,eACjB1E,EAAIoF,OAASR,EAAGF,eAChB1E,EAAIhO,MAAQ4S,EAAGF,eACf1E,EAAI/N,OAAS2S,EAAGF,eAEhB,IAAIW,EAAOtB,EAAaa,EAAGR,YAC3BpE,EAAIsF,QAAUD,EAAK1D,QACnB3B,EAAIuF,WAAaF,EAAK1D,QACtB3B,EAAIwF,OAASH,EAAK1D,QAClB3B,EAAIyF,SAAWJ,EAAKhZ,OAAO,EAAG,GAC9B2T,EAAI0F,QAAU/B,EAAU0B,EAAKhZ,OAAO,EAAG,IAEnC2T,EAAIsF,UACJtF,EAAI2F,IAAMb,EAAQ,GAAM9E,EAAI0F,QAAU,IAG1C1F,EAAI4F,eAAiBhB,EAAGR,WAExB,IAAIyB,EAAUZ,IAEdjF,EAAI8F,OA1PI,SAAUC,EAAa5B,OAEnC,IAgCI6B,EACAC,EAjCAjR,EAAM,EACNkR,EAAW,SAAUrV,GAErB,IADA,IAAIsV,EAAO,EACF1Z,EAAI,EAAGA,EAAIoE,EAAMpE,IAClB0X,EAAKtD,WAAW7L,GAAO,GAAM,IAAY,EAANA,KACnCmR,GAAQ,GAAK1Z,GAEjBuI,IAEJ,OAAOmR,GAGPC,EAAS,GAETC,EAAY,GAAKN,EACjBO,EAAUD,EAAY,EAEtBE,EAAWR,EAAc,EAEzBS,EAAO,GAEP9M,EAAQ,WACR8M,EAAO,GACPD,EAAWR,EAAc,EACzB,IAAK,IAAItZ,EAAI,EAAGA,EAAI4Z,EAAW5Z,IAC3B+Z,EAAK/Z,GAAK,CAACA,GAEf+Z,EAAKH,GAAa,GAClBG,EAAKF,GAAW,QAWhB,GAHAL,EAAOD,GACPA,EAAOE,EAASK,MAEHF,EAAb,CAIA,GAAIL,IAASM,EAAS,MAEtB,GAAIN,EAAOQ,EAAK9Z,OACRuZ,IAASI,GACTG,EAAK7Z,KAAK6Z,EAAKP,GAAMQ,OAAOD,EAAKR,GAAM,SAG1C,CACD,GAAIA,IAASQ,EAAK9Z,OAAQ,MAAM,IAAIY,MAAM,qBAC1CkZ,EAAK7Z,KAAK6Z,EAAKP,GAAMQ,OAAOD,EAAKP,GAAM,KAE3CG,EAAOzZ,KAAK+Z,MAAMN,EAAQI,EAAKR,IAE3BQ,EAAK9Z,SAAY,GAAK6Z,GAAaA,EAAW,IAE9CA,SAlBA7M,IAwBR,OAAO0M,EAwLUO,CAAU3G,EAAI4F,eAAgBC,GAEvC7F,EAAIuF,aACJvF,EAAI8F,OAhDU,SAAUA,EAAQ9T,GAehC,IAZA,IAEsB4U,EAAOC,EACrBC,EAHJC,EAAY,IAAIC,MAAMlB,EAAOpZ,QAC7Bua,EAAOnB,EAAOpZ,OAASsF,EAOvBkV,EAAU,CAAC,EAAG,EAAG,EAAG,GACpBC,EAAQ,CAAC,EAAG,EAAG,EAAG,GAElBC,EAAU,EACLC,EAAO,EAAGA,EAAO,EAAGA,IACzB,IAAK,IAAIC,EAAQJ,EAAQG,GAAOC,EAAQL,EAAMK,GAASH,EAAME,GAX3CT,EAYRU,EAZeT,EAYRO,EAXbN,OAAAA,EAAAA,EAAahB,EAAOyB,MAAMV,EAAU7U,GAAQ6U,EAAU,GAAK7U,GAC/D+U,EAAU1a,OAAOqa,MAAMK,EAAW,CAACH,EAAQ5U,EAAOA,GAAOyU,OAAOK,IAW5DM,IAIR,OAAOL,EA0BMS,CAAYxH,EAAI8F,OAAQ9F,EAAIhO,QAG7C6S,EAAQ7E,KAAO6E,EAAQ7E,IAAIA,IAG3ByH,EAAa,WACb,IAAIC,EAAQ,GAGZ,OAFAA,EAAMC,SAAW/C,EAAGR,WAEZI,OAAOC,aAAaiD,EAAMC,WAC9B,IAAK,IACDD,EAAM5c,KAAO,MAtJV,SAAU8c,GACrB,IAiB4BF,EA+C5B,OADAE,EAAMC,MAAQjD,EAAGR,WACTwD,EAAMC,OACV,KAAK,IACDD,EAAME,QAAU,MAlEP,SAAUJ,GACP9C,EAAGR,WAAnB,IACIiB,EAAOtB,EAAaa,EAAGR,YAC3BsD,EAAMjC,SAAWJ,EAAKhZ,OAAO,EAAG,GAChCqb,EAAMK,eAAiBpE,EAAU0B,EAAKhZ,OAAO,EAAG,IAChDqb,EAAMM,UAAY3C,EAAK1D,QACvB+F,EAAMO,kBAAoB5C,EAAK1D,QAE/B+F,EAAMQ,UAAYtD,EAAGF,eAErBgD,EAAMS,kBAAoBvD,EAAGR,WAE7BsD,EAAMU,WAAaxD,EAAGR,WAEtBS,EAAQwD,KAAOxD,EAAQwD,IAAIX,GAqDvBY,CAAWV,GACX,MACJ,KAAK,IACDA,EAAME,QAAU,OArDIJ,EAsDRE,GArDVW,QAAUtD,IAChBJ,EAAQ2D,KAAO3D,EAAQ2D,IAAId,GAqDvB,MACJ,KAAK,EACDE,EAAME,QAAU,MApDP,SAAUJ,GAEP9C,EAAGR,WACnBsD,EAAMe,SAAW7D,EAAGP,UAAU,IAC9BqD,EAAMgB,OAASzD,IACfJ,EAAQ8D,KAAO9D,EAAQ8D,IAAIjB,GAgDvBkB,CAAWhB,GACX,MACJ,KAAK,IACDA,EAAME,QAAU,MAhDN,SAAUe,GACxB,IAAiCnB,EAcjB9C,EAAGR,WACnByE,EAAMC,WAAalE,EAAGL,KAAK,GAC3BsE,EAAME,SAAWnE,EAAGL,KAAK,GAEhB,aADDsE,EAAMC,YAjBmBpB,EAmBRmB,EAlBLjE,EAAGR,WACnBsD,EAAMsB,QAAUpE,EAAGR,WACnBsD,EAAMuB,WAAarE,EAAGF,eACtBgD,EAAMU,WAAaxD,EAAGR,WACtBS,EAAQqE,KAAOrE,EAAQqE,IAAIC,UAAYtE,EAAQqE,IAAIC,SAASzB,IAGvC,SAAUA,GAC/BA,EAAM0B,QAAUnE,IAEhBJ,EAAQqE,KAAOrE,EAAQqE,IAAIxB,EAAMoB,aAAejE,EAAQqE,IAAIxB,EAAMoB,YAAYpB,GAW1E2B,CAAmBR,GA0BvBS,CAAY1B,GACZ,cAEAA,EAAME,QAAU,UAxBF,SAAUJ,GAC5BA,EAAMvD,KAAOc,IACbJ,EAAQmE,SAAWnE,EAAQmE,QAAQtB,GAuB/B6B,CAAgB3B,IAmEhB4B,CAAS9B,GACT,MACJ,IAAK,IACDA,EAAM5c,KAAO,MACboa,EAASwC,GACT,MACJ,IAAK,IACDA,EAAM5c,KAAO,MACb+Z,EAAQ4E,KAAO5E,EAAQ4E,IAAI/B,GAC3B,cAEA,MAAM,IAAIpa,MAAM,oBAAsBoa,EAAMC,SAAS5Z,SAAS,KAGtE,GAAI0V,EAGA,OAFAC,GAAWA,SACXD,GAAc,GAIC,QAAfiE,EAAM5c,MAAgBuV,WAAWoH,EAAY,KAjMnC,WACd,IAAIiC,EAAM,GAGV,GAFAA,EAAIC,IAAM/E,EAAGL,KAAK,GAClBmF,EAAIE,IAAMhF,EAAGL,KAAK,GACF,QAAZmF,EAAIC,IAAe,MAAM,IAAIrc,MAAM,mBACvCoc,EAAI1X,MAAQ4S,EAAGF,eACfgF,EAAIzX,OAAS2S,EAAGF,eAEhB,IAAIW,EAAOtB,EAAaa,EAAGR,YAC3BsF,EAAIG,QAAUxE,EAAK1D,QACnB+H,EAAII,SAAWnG,EAAU0B,EAAKhZ,OAAO,EAAG,IACxCqd,EAAIlE,OAASH,EAAK1D,QAClB+H,EAAIK,QAAUpG,EAAU0B,EAAKhZ,OAAO,EAAG,IAEvCqd,EAAIM,QAAUpF,EAAGR,WACjBsF,EAAIO,iBAAmBrF,EAAGR,WACtBsF,EAAIG,UACJH,EAAIQ,IAAMpF,EAAQ,GAAM4E,EAAIK,QAAU,IAE1ClF,EAAQ6E,KAAO7E,EAAQ6E,IAAIA,GAkL3BS,GACA9J,WAAWoH,EAAY,IAwkB/B,OAlkBe,SAAW2C,GACtB,IAaIC,EACAX,EAdA5S,EAAU,CAEVwT,KAAM,EACNC,KAAM,EACNC,KAAM,KACNC,KAAM,KAENC,IAAK,KACLC,IAAK,MAET,IAAK,IAAIC,KAAKR,EAAStT,EAAQ8T,GAAKR,EAAKQ,GACrC9T,EAAQ0T,MAAQ1T,EAAQ2T,OAAM3T,EAAQ+T,OAAQ,GAKlD,IAAIC,EAAY,KACZC,GAAU,EAEVC,EAAe,KACfC,EAAQ,KACRlD,EAAiB,KACjBmD,EAAyB,KACzBC,EAAqB,KACrBC,EAAQ,KACRC,EAAU,KAEVC,GAAU,EAGVC,GAAa,EAEbC,EAAS,GACTC,EAAe,GAEfC,EAAM5U,EAAQ4U,SACc,IAArB5U,EAAQ6U,YACf7U,EAAQ6U,WAAcD,EAAIE,aAAa,kBAAyD,KAArCF,EAAIE,aAAa,kBAEhF,IA4PYC,EAEAC,EAaAC,EArCJtf,EACAuf,EAcAC,EAMAvK,EAsCAwK,EAgJJjV,EAAQ8D,EAAKoR,EAASC,EAjbtBC,EAAiBvV,EAAQwV,eAAe,UAAYxV,EAAQyV,OAAS,KACrEC,EAAa1V,EAAQwV,eAAe,cAAgBxV,EAAQ2V,WAAa,EACzEC,EAAoB5V,EAAQwV,eAAe,aAAexV,EAAQ6V,UAAY,OAC9EC,GAAoB9V,EAAQwV,eAAe,uBAAwBxV,EAAQ+V,mBAC3EC,IAAkBF,KAAoB9V,EAAQwV,eAAe,sBAAuBxV,EAAQiW,mBAC5FC,EAAqBlW,EAAQwV,eAAe,sBAAwBxV,EAAQmW,mBAAqB,GACjGC,EAA8BpW,EAAQwV,eAAe,gCAAkCxV,EAAQqW,6BAA+B,wBAC9HC,EAA8BtW,EAAQwV,eAAe,gCAAkCxV,EAAQuW,6BAA+B,oBAE9H3T,EAAQ,WACRsR,EAAe,KACfC,EAAQ,KACRE,EAAqBpD,EACrBA,EAAiB,KACjBqD,EAAQ,MAKRkC,EAAU,WACV,IACI3I,EAAS0F,EAAQxF,GAErB,MAAO0I,GACHC,EAAY,WAShBC,EAAW,SAAS5N,EAAGC,GACvB7I,EAAOjF,MAAQ6N,EAAI6N,KACnBzW,EAAOhF,OAAS6N,EAAI4N,KACpBvB,EAAQ5gB,MAAMoiB,SAAa9N,EAAI6N,KAAuB,KAEtDtB,EAAUpa,MAAQ6N,EAClBuM,EAAUna,OAAS6N,EACnBsM,EAAU7gB,MAAMyG,MAAQ6N,EAAI,KAC5BuM,EAAU7gB,MAAM0G,OAAS6N,EAAI,KAC7BsM,EAAUjV,WAAW,MAAMyW,aAAa,EAAG,EAAG,EAAG,EAAG,EAAG,IAgBvDC,EAAiB,SAAU7Y,EAAKtI,EAAQohB,GACxC,GAAIA,GAAQhB,EAAiB,CACzB,IACUiB,EAAK9c,EAAKe,EADhBC,EAAS+a,EAETlW,EAAQ+T,MACHU,GAODta,GAAO6F,EAAQyT,KAAOzT,EAAQ2T,KAAOxY,GAAUyb,KAC/Czb,GAAkByb,KAElBK,EADQjX,EAAQwT,KAAOoD,KACT1Y,EAAMtI,GAAWoK,EAAQ0T,KAAOkD,MAC9C1b,EAAQiF,EAAOjF,MAAQ0b,OAVvBzc,EAAO6F,EAAQyT,KAAOzT,EAAQ2T,KAAOxY,EAGrC8b,EADOjX,EAAQwT,KACDtV,EAAMtI,EAAUoK,EAAQ0T,KACtCxY,EAAQiF,EAAOjF,QAsBnBf,GAAOgG,EAAOhF,OAASA,IAAWsZ,EAAamC,KAAqB,GACpEK,EAAQ/Y,EAAMtI,EAAUuK,EAAOjF,OAAUuZ,EAAamC,KAAqB,GAC3E1b,EAAQiF,EAAOjF,OAASuZ,EAAamC,KAAqB,GAC1Dzb,GAAUsZ,EAAamC,KAAqB,GAGhD3S,EAAIO,UAAY4R,EAChBnS,EAAIyD,SAASuP,EAAK9c,EAAKe,EAAQ+b,EAAK9b,GAEpC8I,EAAIO,UAAY8R,EAChBrS,EAAIyD,SAAS,EAAGvN,EAAK8c,EAAK9b,KAI9Bub,EAAc,SAAUQ,GAaxBlD,EAAYkD,EACZtE,EAAM,CACF1X,MAAO0Z,EAAI1Z,MACXC,OAAQyZ,EAAIzZ,QAEhBuZ,EAAS,GAhBLzQ,EAAIO,UAAY,QAChBP,EAAIyD,SAAS,EAAG,EAAG1H,EAAQ4T,IAAM5T,EAAQ4T,IAAMhB,EAAI1X,MAAO8E,EAAQ6T,IAAM7T,EAAQ6T,IAAMjB,EAAIzX,QAC1F8I,EAAIS,YAAc,MAClBT,EAAIW,UAAY,EAChBX,EAAI8C,OAAO,EAAG,GACd9C,EAAI+C,OAAOhH,EAAQ4T,IAAM5T,EAAQ4T,IAAMhB,EAAI1X,MAAO8E,EAAQ6T,IAAM7T,EAAQ6T,IAAMjB,EAAIzX,QAClF8I,EAAI8C,OAAO,EAAG/G,EAAQ6T,IAAM7T,EAAQ6T,IAAMjB,EAAIzX,QAC9C8I,EAAI+C,OAAOhH,EAAQ4T,IAAM5T,EAAQ4T,IAAMhB,EAAI1X,MAAO,GAClD+I,EAAIgD,UA0BRkQ,EAAY,WACP7C,IACLI,EAAO7e,KAAK,CACIwX,KAAMiH,EAAMtO,aAAa,EAAG,EAAG4M,EAAI1X,MAAO0X,EAAIzX,QAC9Cic,MAAOjD,IAEvBQ,EAAa9e,KAAK,CAAE2F,EAAG,EAAGC,EAAG,MAmF7B4b,GACI1hB,GAAI,EACJuf,EAAiB,EAcjBC,EAAY,SAAU5S,GACtB5M,GAAQ4M,EAER6S,KAIIL,GAAW,EAEXC,EAAe,WACO,OAAlBO,GACAA,EAAcX,GAClBM,KAEyB,IAArBU,GAA8BV,EAAiB,EAC/CD,KAEAF,GAAW,EACXP,GAAU,IAIdS,EAAS,WAET,GADAF,EAAWP,EACX,CAEAW,EAAU,GACV,IAAIiC,EAA0B,GAAlB1C,EAAO/e,GAAGyhB,MACjBA,IAAOA,EAAQ,KAGA,IAlChBzhB,EADe,EACH+e,EAAO9e,QAAU8e,EAAO9e,QAmCpCwhB,GAAS1B,EACTnM,WAAWyL,EAAcoC,IAEzB7N,WAAW0L,EAAQmC,KAS3BhC,EAAW,WACX,IAAI7Z,GACJ5F,EAAIyN,SAASzN,EAAG,KAER+e,EAAO9e,OAAS,IACpBD,EAAI,GAGJA,EAAI,IACJA,EAAI,GAGR4F,EAASoZ,EAAahf,GAEtB2f,EAAUjV,WAAW,MAAMiX,aAAa5C,EAAO/e,GAAG0X,KAAM9R,EAAOC,EAAGD,EAAOE,GACzEwI,EAAIa,yBAA2B,OAC/Bb,EAAI5B,UAAUiT,EAAW,EAAG,IAazB,CACHiC,KAAM,WACEvD,IAEIhU,EAAQ4T,KAAO5T,EAAQ6T,KAC3B5P,EAAItB,MAAMiU,KAAmBA,MAG7B5W,EAAQ6U,UACRjK,KAGAjV,EAAI,EACJyf,OAGRxK,KAnFAA,EAiCO,WACEmK,GAAUxL,WAAW0L,EAAQ,IAkDtCuC,KA3BO,WACPhD,GAAU,EACV5J,KA0BA6M,MAvBQ,WACRjD,GAAU,GAuBVA,QAASA,EACTkD,cAAevC,EACfwC,cAAe,WAAa,OAAOhiB,GACnC+e,OAAQ,WAAa,OAAOA,GAC5B9e,OAAQ,WAAa,OAAO8e,EAAO9e,QACnCgiB,QAAS,SAAWC,GAChBliB,EAAIkiB,EACJzC,OAKR0C,EAAmB,SAAUd,GAC7BD,EAAexD,EAAOrV,IAAKqV,EAAOlG,KAAKzX,OAAQohB,IAG/Ce,EAAY,aAMZC,EAAe,SAAU7f,EAAI6e,GAC7B,OAAO,SAAUpG,GACbzY,EAAGyY,GACHkH,EAAiBd,KAKrBjJ,EAAU,CACV6E,IAAKoF,GAlPG,SAAUC,GAElBtB,GADA/D,EAAMqF,GACO/c,MAAO0X,EAAIzX,WAiPxBoW,IAAKyG,GA9OG,SAAUzG,GAClB4F,IACAvU,IACAsR,EAAe3C,EAAIJ,kBAAoBI,EAAIF,kBAAoB,KAC/D8C,EAAQ5C,EAAIH,UACZH,EAAiBM,EAAIN,kBA0OrBS,IAAKsG,EAAaD,GAElB3F,IAAK,CAEDC,SAAU2F,EAAaD,IAE3B7O,IAAK8O,GAnOG,SAAU9O,GACboL,IAAOA,EAAQgB,EAAUjV,WAAW,OAEzC,IAAI6X,EAAUxD,EAAO9e,OAGjBsY,EAAKhF,EAAIsF,QAAUtF,EAAI2F,IAAM+D,EAAIQ,IAmBjC8E,EAAU,IACiB,IAAvB7D,EAI+B,OAA3BD,EACHE,EAAMgD,aAAa5C,EAAON,GAAwB/G,KAAM,EAAG,GAE3DiH,EAAMzR,UAAU0R,EAAQlG,QAASkG,EAAQjG,OAAQiG,EAAQrZ,MAAOqZ,EAAQpZ,QAGzEiZ,EAAyB8D,EAAU,EAGZ,IAAvB7D,GAIAC,EAAMzR,UAAU0R,EAAQlG,QAASkG,EAAQjG,OAAQiG,EAAQrZ,MAAOqZ,EAAQpZ,SAOhF,IAAIgd,EAAU7D,EAAMtO,aAAakD,EAAImF,QAASnF,EAAIoF,OAAQpF,EAAIhO,MAAOgO,EAAI/N,QAGzE+N,EAAI8F,OAAOxa,SAAQ,SAAU4jB,EAAOziB,GAE5ByiB,IAAUlE,IACViE,EAAQ9K,KAAS,EAAJ1X,EAAQ,GAAKuY,EAAGkK,GAAO,GACpCD,EAAQ9K,KAAS,EAAJ1X,EAAQ,GAAKuY,EAAGkK,GAAO,GACpCD,EAAQ9K,KAAS,EAAJ1X,EAAQ,GAAKuY,EAAGkK,GAAO,GACpCD,EAAQ9K,KAAS,EAAJ1X,EAAQ,GAAK,QAIlC2e,EAAMgD,aAAaa,EAASjP,EAAImF,QAASnF,EAAIoF,QAExCmG,IACDxQ,EAAItB,MAAMiU,KAAmBA,MAC7BnC,GAAa,GAKbqB,IACA7R,EAAI5B,UAAUiT,EAAW,EAAG,GAC5BQ,EAAmB9V,EAAQ6U,WAG/BN,EAAUrL,KAsJe,GACzByJ,IAAK,SAAU/B,GAEXuG,IACAW,GAAiB,GACT9X,EAAQ4T,KAAO5T,EAAQ6T,MAC3B1T,EAAOjF,MAAQ0X,EAAI1X,MAAQ0b,KAC3BzW,EAAOhF,OAASyX,EAAIzX,OAASyb,MAEjCS,EAAOE,OACPtD,GAAU,EACNoE,IACAA,GAAczD,KAMtB2C,GAAO,WACP,IAAI/d,EAASob,EAAI0D,WAEbC,EAAMpkB,SAASC,cAAc,OACjC+L,EAAShM,SAASC,cAAc,UAChC6P,EAAM9D,EAAOE,WAAW,MACxBgV,EAAUlhB,SAASC,cAAc,OAEjCkhB,EAAYnhB,SAASC,cAAc,UAEnCmkB,EAAIrd,MAAQiF,EAAOjF,MAAQ0Z,EAAI1Z,MAC/Bqd,EAAIpd,OAASgF,EAAOhF,OAASyZ,EAAIzZ,OACjCka,EAAQ5gB,MAAMoiB,SAAWjC,EAAI1Z,MAAQ,KAErCqd,EAAItkB,UAAY,QAChBohB,EAAQphB,UAAY,gBACpBskB,EAAIrf,YAAYiH,GAChBoY,EAAIrf,YAAYmc,GAEZ7b,IACAA,EAAOgf,aAAaD,EAAK3D,GACzBpb,EAAOE,YAAYkb,IAGnB5U,EAAQ4T,KAAO5T,EAAQ6T,KAAK8C,EAAS3W,EAAQ4T,IAAK5T,EAAQ6T,KAC9D4E,IAAY,GAGZ7B,GAAmB,WAQnB,OANI5W,EAAQ0Y,WAAa9F,GAAOA,EAAI1X,MAAQ8E,EAAQ0Y,UACxC1Y,EAAQ0Y,UAAY9F,EAAI1X,MAGxB,GAMZud,IAAc,EACdJ,IAAgB,EAEhBM,GAAa,SAASvT,GACtB,OAAI6O,IACUoE,GAAVjT,IACiB,EAErB6O,GAAU,EACVS,EAAS,GACT9R,IACAwR,EAAyB,KACzBC,EAAqB,KACrBC,EAAQ,KACRC,EAAU,MAEH,IAGX,MAAO,CAEHiD,KAAMH,EAAOG,KACbC,MAAOJ,EAAOI,MACdC,cAAeL,EAAOK,cACtBE,QAASP,EAAOO,QAGhBgB,WAAmB,WAAa,OAAOvB,EAAO3C,UAC9CmE,YAAmB,WAAa,OAAOrE,GACvCsE,WAAmB,WAAa,OAAO3Y,GACvCyW,iBAAmB,WAAa,OAAOA,MACvCmC,YAAmB,WAAa,OAAO9E,GACvC+E,cAAmB,WAAa,OAAOhZ,EAAQ6U,WAC/CoE,WAAmB,WAAa,OAAO5B,EAAOzhB,UAC9CsjB,kBAAmB,WAAa,OAAO7B,EAAOM,iBAC9CwB,SAAU,SAAStT,EAAIT,EAASgU,EAAWC,GACvC,GAAKV,GAAWvT,GAAhB,CAEAwH,EAAUyM,EACV1M,GAAc,EAEd,IAAI3D,EAAI,IAAIsQ,eAEZtQ,EAAEuQ,KAAK,MAAO1T,GAAK,GAEf,qBAAsBmD,EACtBA,EAAEwQ,iBAAiB,sCAId,iBAAkBxQ,EACvBA,EAAEyQ,aAAe,cAKjBzQ,EAAE0Q,iBAAiB,iBAAkB,kBAGzC1Q,EAAE2Q,YAAc,WAEPlB,IAAalB,MAEtBvO,EAAErD,OAAS,SAASrR,GACG,KAAfgD,KAAKsiB,QACLlD,EAAY,kBAGV,aAAcpf,OAChBA,KAAKuiB,SAAW,IAAIC,QAAQxiB,KAAKyiB,cAAcja,UAAUka,IAAItM,OAAOC,cAAcsM,KAAK,KAE3F,IAAI5M,EAAO/V,KAAKuiB,SACZxM,EAAKpW,WAAW3B,QAAQ,eAAiB,IACzC+X,EAAO,IAAIvD,WAAWuD,IAG1BkG,EAAS,IAAInG,EAAOC,GACpB9D,WAAWiN,EAAS,IAExBxN,EAAEoQ,WAAa,SAAU9kB,GACjBA,EAAE4lB,kBACFnD,EAAeziB,EAAE6lB,OAAQ7lB,EAAE8lB,OAAO,GAEtChB,GAAcA,EAAW9kB,IAE7B0U,EAAEqR,QAAU,WAAa3D,EAAY,QACrC1N,EAAEsR,SAENC,KAAM,SAAUnV,EAAUgU,EAAYC,GAClC/hB,KAAK6hB,SAASvE,EAAIE,aAAa,qBAAuBF,EAAI/O,IAAKT,EAAUgU,EAAYC,IAEzFmB,SAAU,SAAS3Q,EAAKzE,GACfuT,GAAWvT,KACXqT,IAAalB,KAClBhE,EAAS,IAAInG,EAAOvD,GACpBN,WAAWiN,EAAS,KAExBiE,MAAO,WACH9N,GAAc,GAElB+N,iBAzeiB,SAASpG,EAAO/Y,GAC5BoZ,EAAaL,SAIM,IAAb/Y,EAAOC,IACdmZ,EAAaL,GAAO9Y,EAAID,EAAOC,QAEX,IAAbD,EAAOE,IACdkZ,EAAaL,GAAO7Y,EAAIF,EAAOE,IAP/BkZ,EAAaL,GAAS/Y,MApcZ,mBAAXof,QAAyBA,OAAOC,IACvCD,OAAO,GAAIlO,GACe,iBAAZC,EACdA,EAAiBD,IAEjBD,EAAKqO,SAAWpO,uBCrEdqO,GACN,GAAuB,iBAAZC,EACPA,EAAiBD,SACd,GAAsB,mBAAXH,QAAyBA,OAAOC,IAC9CD,OAAO,GAAIG,OACR,EAEmB,oBAAX5Z,OACHA,YACqB,IAAX8Z,EACVA,EACmB,oBAATC,KACVA,KAEA3jB,MAEN4jB,IAAMJ,OAEb,WAEC,OAAM,SAAUK,EAAEC,EAAGC,EAAG9gB,YACXyS,EAAE9U,EAAGojB,GACV,IAAKD,EAAEnjB,GAAI,CACP,IAAKkjB,EAAEljB,GAAI,CACP,IAAIiV,OAAgC5O,EACpC,IAAK+c,GAAKnO,EAAG,OAAOA,EAAEjV,GAAC,GACvB,GAAIvC,EAAG,OAAOA,EAAEuC,GAAC,GACjB,IAAI4iB,EAAI,IAAItkB,MAAM,uBAAyB0B,EAAI,KAC/C,MAAM4iB,EAAEzL,KAAO,mBAAoByL,EAEvC,IAAIS,EAAIF,EAAEnjB,GAAK,CACXxB,QAAS,IAEb0kB,EAAEljB,GAAG,GAAG6L,KAAKwX,EAAE7kB,SAAS,SAASpC,GAC7B,IAAIiL,EAAI6b,EAAEljB,GAAG,GAAG5D,GAChB,OAAO0Y,EAAEzN,GAAQjL,KAClBinB,EAAGA,EAAE7kB,QAASykB,EAAGC,EAAGC,EAAG9gB,GAE9B,OAAO8gB,EAAEnjB,GAAGxB,QAGhB,IADA,IAAIf,OAAgC4I,EAC3Bid,EAAI,EAAGA,EAAIjhB,EAAE3E,OAAQ4lB,IAAKxO,EAAEzS,EAAEihB,IACvC,OAAOxO,EAtBL,CAuBJ,CACE,EAAG,CAAC,SAASyO,EAAShlB,EAAQC,YACjBglB,IACLpkB,KAAKqkB,QAAUrkB,KAAKqkB,SAAW,GAC/BrkB,KAAKskB,cAAgBtkB,KAAKskB,oBAAiBrd,WAqKtCsd,EAAWC,GAChB,MAAsB,mBAARA,WAOTC,EAASD,GACd,MAAsB,iBAARA,GAA4B,OAARA,WAG7BE,EAAYF,GACjB,YAAe,IAARA,EAhLXrlB,EAAOC,QAAUglB,EACjBA,EAAaA,aAAeA,EAC5BA,EAAatS,UAAUuS,aAAUpd,EACjCmd,EAAatS,UAAUwS,mBAAgBrd,EACvCmd,EAAaO,oBAAsB,GACnCP,EAAatS,UAAU8S,gBAAkB,SAAS3c,GAC9C,GAkKsB,iBAlKRA,GAAMA,EAAI,GAAKwD,MAAMxD,GAAI,MAAM4c,UAAU,+BAEvD,OADA7kB,KAAKskB,cAAgBrc,EACdjI,MAEXokB,EAAatS,UAAUgT,KAAO,SAASpoB,GACnC,IAAIqoB,EAAItO,EAASnE,EAAK9R,EAAMnC,EAAG2mB,EAE/B,GADKhlB,KAAKqkB,UAASrkB,KAAKqkB,QAAU,IACrB,UAAT3nB,KACKsD,KAAKqkB,QAAQY,OAASR,EAASzkB,KAAKqkB,QAAQY,SAAWjlB,KAAKqkB,QAAQY,MAAM3mB,QAAQ,CAEnF,IADAymB,EAAKG,UAAU,cACGhmB,MACd,MAAM6lB,EAEN,IAAI5F,EAAM,IAAIjgB,MAAM,yCAA2C6lB,EAAK,KAEpE,MADA5F,EAAIrW,QAAUic,EACR5F,EAKlB,GAAIuF,EADJjO,EAAUzW,KAAKqkB,QAAQ3nB,IACG,OAAO,EACjC,GAAI6nB,EAAW9N,GACX,OAAQyO,UAAU5mB,QACd,KAAK,EACDmY,EAAQhK,KAAKzM,MACb,MACJ,KAAK,EACDyW,EAAQhK,KAAKzM,KAAMklB,UAAU,IAC7B,MACJ,KAAK,EACDzO,EAAQhK,KAAKzM,KAAMklB,UAAU,GAAIA,UAAU,IAC3C,cAEA1kB,EAAOoY,MAAM9G,UAAUqH,MAAM1M,KAAKyY,UAAW,GAC7CzO,EAAQ6B,MAAMtY,KAAMQ,QAEzB,GAAIikB,EAAShO,GAIhB,IAHAjW,EAAOoY,MAAM9G,UAAUqH,MAAM1M,KAAKyY,UAAW,GAE7C5S,GADA0S,EAAYvO,EAAQ0C,SACJ7a,OACXD,EAAI,EAAGA,EAAIiU,EAAKjU,IAAK2mB,EAAU3mB,GAAGia,MAAMtY,KAAMQ,GAEvD,OAAO,GAEX4jB,EAAatS,UAAUqT,YAAc,SAASzoB,EAAM0oB,GAChD,IAAIC,EACJ,IAAKd,EAAWa,GAAW,MAAMP,UAAU,+BAoB3C,OAnBK7kB,KAAKqkB,UAASrkB,KAAKqkB,QAAU,IAC9BrkB,KAAKqkB,QAAQiB,aAAatlB,KAAK8kB,KAAK,cAAepoB,EAAM6nB,EAAWa,EAASA,UAAYA,EAASA,SAAWA,GAC5GplB,KAAKqkB,QAAQ3nB,GACT+nB,EAASzkB,KAAKqkB,QAAQ3nB,IAAQsD,KAAKqkB,QAAQ3nB,GAAM6B,KAAK6mB,GAC1DplB,KAAKqkB,QAAQ3nB,GAAQ,CAACsD,KAAKqkB,QAAQ3nB,GAAO0oB,GAFtBplB,KAAKqkB,QAAQ3nB,GAAQ0oB,EAG1CX,EAASzkB,KAAKqkB,QAAQ3nB,MAAWsD,KAAKqkB,QAAQ3nB,GAAM6oB,SAIhDF,EAHCX,EAAY1kB,KAAKskB,eAGdF,EAAaO,oBAFb3kB,KAAKskB,gBAIJe,EAAI,GAAKrlB,KAAKqkB,QAAQ3nB,GAAM4B,OAAS+mB,IAC1CrlB,KAAKqkB,QAAQ3nB,GAAM6oB,QAAS,EAC5B9kB,QAAQwkB,MAAM,mIAA8IjlB,KAAKqkB,QAAQ3nB,GAAM4B,QAClJ,mBAAlBmC,QAAQ+kB,OACf/kB,QAAQ+kB,SAIbxlB,MAEXokB,EAAatS,UAAUhR,GAAKsjB,EAAatS,UAAUqT,YACnDf,EAAatS,UAAU/Q,KAAO,SAASrE,EAAM0oB,GACzC,IAAKb,EAAWa,GAAW,MAAMP,UAAU,+BAC3C,IAAIY,GAAQ,WAEHC,IACL1lB,KAAK2lB,eAAejpB,EAAMgpB,GACrBD,IACDA,GAAQ,EACRL,EAAS9M,MAAMtY,KAAMklB,YAK7B,OAFAQ,EAAEN,SAAWA,EACbplB,KAAKc,GAAGpE,EAAMgpB,GACP1lB,MAEXokB,EAAatS,UAAU6T,eAAiB,SAASjpB,EAAM0oB,GACnD,IAAIQ,EAAMpjB,EAAUlE,EAAQD,EAC5B,IAAKkmB,EAAWa,GAAW,MAAMP,UAAU,+BAC3C,IAAK7kB,KAAKqkB,UAAYrkB,KAAKqkB,QAAQ3nB,GAAO,OAAOsD,KAIjD,GAFA1B,GADAsnB,EAAO5lB,KAAKqkB,QAAQ3nB,IACN4B,OACdkE,GAAW,EACPojB,IAASR,GAAYb,EAAWqB,EAAKR,WAAaQ,EAAKR,WAAaA,SAC7DplB,KAAKqkB,QAAQ3nB,GAChBsD,KAAKqkB,QAAQsB,gBAAgB3lB,KAAK8kB,KAAK,iBAAkBpoB,EAAM0oB,QAChE,GAAIX,EAASmB,GAAO,CACvB,IAAKvnB,EAAIC,EAAQD,KAAM,GACnB,GAAIunB,EAAKvnB,KAAO+mB,GAAYQ,EAAKvnB,GAAG+mB,UAAYQ,EAAKvnB,GAAG+mB,WAAaA,EAAU,CAC3E5iB,EAAWnE,EACX,MAGR,GAAImE,EAAW,EAAG,OAAOxC,KACL,IAAhB4lB,EAAKtnB,QACLsnB,EAAKtnB,OAAS,SACP0B,KAAKqkB,QAAQ3nB,IAEpBkpB,EAAK3nB,OAAOuE,EAAU,GAEtBxC,KAAKqkB,QAAQsB,gBAAgB3lB,KAAK8kB,KAAK,iBAAkBpoB,EAAM0oB,GAEvE,OAAOplB,MAEXokB,EAAatS,UAAU+T,mBAAqB,SAASnpB,GACjD,IAAIopB,EAAKd,EACT,IAAKhlB,KAAKqkB,QAAS,OAAOrkB,KAC1B,IAAKA,KAAKqkB,QAAQsB,eAGd,OAFyB,IAArBT,UAAU5mB,OAAc0B,KAAKqkB,QAAU,GAClCrkB,KAAKqkB,QAAQ3nB,WAAcsD,KAAKqkB,QAAQ3nB,GAC1CsD,KAEX,GAAyB,IAArBklB,UAAU5mB,OAAc,CACxB,IAAKwnB,KAAO9lB,KAAKqkB,QACD,mBAARyB,GACJ9lB,KAAK6lB,mBAAmBC,GAI5B,OAFA9lB,KAAK6lB,mBAAmB,kBACxB7lB,KAAKqkB,QAAU,GACRrkB,KAGX,GAAIukB,EADJS,EAAYhlB,KAAKqkB,QAAQ3nB,IAErBsD,KAAK2lB,eAAejpB,EAAMsoB,QACvB,GAAIA,EAAS,KACTA,EAAU1mB,QAAQ0B,KAAK2lB,eAAejpB,EAAMsoB,EAAUA,EAAU1mB,OAAS,IAGpF,cADO0B,KAAKqkB,QAAQ3nB,GACbsD,MAEXokB,EAAatS,UAAUkT,UAAY,SAAStoB,GAKxC,OAHKsD,KAAKqkB,SAAYrkB,KAAKqkB,QAAQ3nB,GAC1B6nB,EAAWvkB,KAAKqkB,QAAQ3nB,IAAc,CAACsD,KAAKqkB,QAAQ3nB,IAClDsD,KAAKqkB,QAAQ3nB,GAAMyc,QAFkB,IAKpDiL,EAAatS,UAAUiU,cAAgB,SAASrpB,GAC5C,GAAIsD,KAAKqkB,QAAS,CACd,IAAI2B,EAAahmB,KAAKqkB,QAAQ3nB,GAC9B,GAAI6nB,EAAWyB,GAAa,OAAO,EAC9B,GAAIA,EAAY,OAAOA,EAAW1nB,OAE3C,OAAO,GAEX8lB,EAAa2B,cAAgB,SAASE,EAASvpB,GAC3C,OAAOupB,EAAQF,cAAcrpB,KAkBlC,IACH,EAAG,CAAC,SAASynB,EAAShlB,EAAQC,GAC1B,IAAI8mB,EAAIC,EAASC,EAAMC,EAAUC,EACjCA,EAAKC,UAAUC,UAAUC,cACzBJ,EAAWE,UAAUF,SAASI,cAE9BL,EAAiB,QADjBF,EAAKI,EAAGI,MAAK,gGAAmG,CAAC,KAAM,UAAW,IACxH,IAAe7pB,SAAS8pB,cAClCR,EAAU,CACNjS,KAAgB,YAAVgS,EAAG,GAAmBA,EAAG,GAAKA,EAAG,GACvCU,QAASR,GAAQS,WAAqB,UAAVX,EAAG,IAAkBA,EAAG,GAAKA,EAAG,GAAKA,EAAG,IACpEG,SAAU,CACNnS,KAAMoS,EAAGI,MAAK,oBAAuB,OAASJ,EAAGI,MAAK,sBAAyBL,EAASK,MAAK,kBAAqB,CAAC,UAAU,MAG7HP,EAAQjS,OAAQ,EACxBiS,EAAQA,EAAQjS,KAAOpI,SAASqa,EAAQS,QAAS,MAAO,EACxDT,EAAQE,SAASF,EAAQE,SAASnS,OAAQ,EAC1C/U,EAAOC,QAAU+mB,GAClB,IACH,EAAG,CAAC,SAAShC,EAAShlB,EAAQC,GAC1B,IAAIglB,EAAc0C,EAAKX,EAanBY,EAAU,GAAG7I,eACblgB,EAAU,GAAGA,SAAW,SAASF,GAC7B,IAAK,IAAIO,EAAI,EAAG4lB,EAAIjkB,KAAK1B,OAAQD,EAAI4lB,EAAG5lB,IACpC,GAAIA,KAAK2B,MAAQA,KAAK3B,KAAOP,EAAM,OAAOO,EAE9C,OAAO,GAEX8a,EAAQ,GAAGA,MACfiL,EAAeD,EAAQ,UAAUC,aACjC+B,EAAUhC,EAAQ,oBAClB2C,EAAG,SAAYE,GACX,IAAI/S,EAAUgT,WAmBLrD,EAAIlb,GACT,IAAIwe,EAAMpB,EAAKxoB,EAOf,IAAKwoB,KANL9lB,KAAKmnB,SAAU,EACfnnB,KAAK0I,QAAU,GACf1I,KAAKod,OAAS,GACdpd,KAAKonB,YAAc,GACnBpnB,KAAKqnB,cAAgB,GACrBrnB,KAAKsnB,WAAW5e,GACJuL,EACR3W,EAAQ2W,EAAS6R,GACiB,OAA7BoB,EAAOlnB,KAAK0I,SAASod,KACtBoB,EAAKpB,GAAOxoB,GA2TxB,OAjXqC,SAAS2E,EAAOC,GACjD,IAAK,IAAI4jB,KAAO5jB,EACR6kB,EAAQta,KAAKvK,EAAQ4jB,KAAM7jB,EAAM6jB,GAAO5jB,EAAO4jB,aAG9CyB,IACLvnB,KAAKgH,YAAc/E,EAEvBslB,EAAKzV,UAAY5P,EAAO4P,UACxB7P,EAAM6P,UAAY,IAAIyV,EACtBtlB,EAAMulB,UAAYtlB,EAAO4P,UAe7B2V,CAAO7D,EAAKoD,GACZ/S,EAAW,CACPyT,aAAc,gBACdC,QAAS,EACTC,OAAQ,EACRC,WAAY,UACZ7V,QAAS,GACTpO,MAAO,KACPC,OAAQ,KACRikB,YAAa,MACbC,OAAO,EACPC,QAAQ,GAEZf,EAAgB,CACZnH,MAAO,IACP5c,MAAM,GAkBV0gB,EAAI9R,UAAUmW,UAAY,SAASnC,EAAKxoB,GAEpC,GADA0C,KAAK0I,QAAQod,GAAOxoB,EACA,MAAhB0C,KAAKkoB,UAA4B,UAARpC,GAA2B,WAARA,GAC5C,OAAO9lB,KAAKkoB,QAAQpC,GAAOxoB,GAGnCsmB,EAAI9R,UAAUwV,WAAa,SAAS5e,GAChC,IAAIod,EAAKqC,EAAS7qB,EAElB,IAAKwoB,KADLqC,EAAU,GACEzf,EACHqe,EAAQta,KAAK/D,EAASod,KAC3BxoB,EAAQoL,EAAQod,GAChBqC,EAAQ5pB,KAAKyB,KAAKioB,UAAUnC,EAAKxoB,KAErC,OAAO6qB,GAEXvE,EAAI9R,UAAUsW,SAAW,SAASzZ,EAAOjG,GACrC,IAAIsU,EAAO8I,EAMX,IAAKA,KALU,MAAXpd,IACAA,EAAU,KAEdsU,EAAQ,IACF8K,YAAc9nB,KAAK0I,QAAQof,YACrBb,EACRjK,EAAM8I,GAAOpd,EAAQod,IAAQmB,EAAcnB,GAQ/C,GAN0B,MAAtB9lB,KAAK0I,QAAQ9E,OACb5D,KAAKioB,UAAU,QAAStZ,EAAM/K,OAEP,MAAvB5D,KAAK0I,QAAQ7E,QACb7D,KAAKioB,UAAU,SAAUtZ,EAAM9K,QAEV,oBAAdwkB,WAA2C,OAAdA,WAAsB1Z,aAAiB0Z,UAC3ErL,EAAMjH,KAAOpH,EAAMoH,UAChB,GAAwC,oBAA7BuS,0BAAyE,OAA7BA,0BAAqC3Z,aAAiB2Z,0BAA6D,oBAA1BC,uBAAmE,OAA1BA,uBAAkC5Z,aAAiB4Z,sBAC3O7f,EAAQxF,KACR8Z,EAAMjH,KAAO/V,KAAKwoB,eAAe7Z,GAEjCqO,EAAMlU,QAAU6F,MAEjB,CAAA,GAAwB,MAApBA,EAAM8Z,WASb,MAAM,IAAIvpB,MAAM,iBARhB,GAAIwJ,EAAQxF,KAAM,CACd,IAAIwlB,EAAI1oB,KAAK0O,aAAaC,GAC1BqO,EAAMjH,KAAO2S,EAAE3S,KACfiH,EAAM8K,YAAcY,EAAEZ,iBAEtB9K,EAAMrO,MAAQA,EAKtB,OAAO3O,KAAKod,OAAO7e,KAAKye,IAE5B4G,EAAI9R,UAAU6W,OAAS,WACnB,IAAOC,EAAGC,EAAYC,EACtB,GAAI9oB,KAAKmnB,QACL,MAAM,IAAIjoB,MAAM,mBAEpB,GAA0B,MAAtBc,KAAK0I,QAAQ9E,OAAwC,MAAvB5D,KAAK0I,QAAQ7E,OAC3C,MAAM,IAAI3E,MAAM,mDAcpB,GAZAc,KAAKmnB,SAAU,EACfnnB,KAAK+oB,UAAY,EACjB/oB,KAAKgpB,eAAiB,EACtBhpB,KAAKipB,WAAU,WACX,IAAIC,EAAGC,EAAKhB,EAEZ,IADAA,EAAU,GACDe,EAAI,EAAGC,EAAMnpB,KAAKod,OAAO9e,OAAQ,GAAK6qB,EAAMD,EAAIC,EAAMD,EAAIC,EAAS,GAAKA,IAAQD,IAAMA,EAC3Ff,EAAQ5pB,KAAK,MAEjB,OAAO4pB,GACT1b,KAAKzM,MACP6oB,EAAa7oB,KAAKopB,gBACiB,IAA/BppB,KAAK0I,QAAQ2gB,cACbrpB,KAAKspB,uBAEL,IAASV,EAAI,EAAGE,EAAMD,EAAY,GAAKC,EAAMF,EAAIE,EAAMF,EAAIE,EAAS,GAAKA,IAAQF,IAAMA,EACnF5oB,KAAKspB,kBAKb,OADAtpB,KAAK8kB,KAAK,SACH9kB,KAAK8kB,KAAK,WAAY,IAEjClB,EAAI9R,UAAUqR,MAAQ,WAYlB,OAXAnjB,KAAKqnB,cAAcnqB,SAAQ,SAASqsB,GAChCA,EAAOC,eAEXxpB,KAAKqnB,cAAgB,GAErBrnB,KAAKonB,YAAYlqB,SAAQ,SAASqsB,GAC9BA,EAAOC,eAEXxpB,KAAKonB,YAAc,GAEnBpnB,KAAKmnB,SAAU,EACRnnB,KAAK8kB,KAAK,UAErBlB,EAAI9R,UAAUsX,aAAe,WACzB,IAAOP,EAAYM,EAAKhB,EAQQsB,EAahC,OApBAZ,EAAahiB,KAAKC,IAAI9G,KAAK0I,QAAQif,QAAS3nB,KAAKod,OAAO9e,mBAEpD6pB,EAAU,GACV,IAAK,IAAIe,EAAIC,EAAMnpB,KAAKonB,YAAY9oB,OAAQ6qB,GAAON,EAAaK,EAAIL,EAAaK,EAAIL,EAAYM,GAAON,EAAaK,IAAMA,IACvHf,EAAQ5pB,KAAK2qB,GAEjB,OAAOf,GACR7P,MAAMtY,MAAM9C,SAAiBusB,EAY9BzpB,KAXS,SAAS3B,GACZ,IAAIkrB,EAQJ,OAPAE,EAAMvoB,IAAI,mBAAqB7C,IAC/BkrB,EAAS,IAAIG,OAAOD,EAAM/gB,QAAQgf,eAC3BiC,UAAY,SAASvpB,GAGxB,OAFAqpB,EAAMpC,cAAcppB,OAAOwrB,EAAMpC,cAAcrpB,QAAQurB,GAAS,GAChEE,EAAMrC,YAAY7oB,KAAKgrB,GAChBE,EAAMG,cAAcxpB,EAAM2V,OAE9B0T,EAAMrC,YAAY7oB,KAAKgrB,MAG/BV,GAEXjF,EAAI9R,UAAU8X,cAAgB,SAAS5M,GACnC,IAAOkM,EAAGC,EAKV,GAJAnpB,KAAKkB,IAAI,SAAW8b,EAAMjf,MAAQ,eAAiBiC,KAAKqnB,cAAc/oB,OAAS,WAC/E0B,KAAKgpB,iBACLhpB,KAAK8kB,KAAK,WAAY9kB,KAAKgpB,eAAiBhpB,KAAKod,OAAO9e,QACxD0B,KAAKipB,WAAWjM,EAAMjf,OAASif,GACI,IAA/Bhd,KAAK0I,QAAQ2gB,gBACbrpB,KAAK0I,QAAQ2gB,cAAgBrM,EAAMqM,cACnCrpB,KAAKkB,IAAI,2BACLlB,KAAKod,OAAO9e,OAAS,GACrB,IAAS4qB,EAAI,EAAGC,EAAMnpB,KAAKonB,YAAY9oB,OAAQ,GAAK6qB,EAAMD,EAAIC,EAAMD,EAAIC,EAAS,GAAKA,IAAQD,IAAMA,EAChGlpB,KAAKspB,kBAIjB,OAAItrB,EAAQyO,KAAKzM,KAAKipB,WAAY,OAAS,EAChCjpB,KAAKspB,kBAELtpB,KAAK6pB,mBAGpBjG,EAAI9R,UAAU+X,gBAAkB,WAC5B,IAAI9T,EAAMiH,EAAO3e,EAAGsQ,EAAOua,EAAGY,EAAG7F,EAAG3R,EAAKyX,EAAMC,EAAMC,EAAMhmB,EAAQimB,EAAMf,EAAKL,EAAMqB,EAGpF,IAFA7X,EAAM,EAED4W,EAAI,EAAGa,GADZZ,EAAMnpB,KAAKipB,YACY3qB,OAAQ4qB,EAAIa,EAAMb,IAErC5W,KADA0K,EAAQmM,EAAID,IACEnT,KAAKzX,OAAS,GAAK0e,EAAMoN,SAAWpN,EAAMqN,OAO5D,IALA/X,GAAO0K,EAAMoN,SAAWpN,EAAMqN,OAC9BrqB,KAAKkB,IAAI,iCAAmC2F,KAAKb,MAAMsM,EAAM,KAAO,MACpEyD,EAAO,IAAIvD,WAAWF,GACtBrO,EAAS,EAEJ6lB,EAAI,EAAGE,GADZlB,EAAO9oB,KAAKipB,YACY3qB,OAAQwrB,EAAIE,EAAMF,IAGtC,IAAKzrB,EAAI4lB,EAAI,EAAGgG,GADhBE,GADAnN,EAAQ8L,EAAKgB,IACA/T,MACezX,OAAQ2lB,EAAIgG,EAAM5rB,IAAM4lB,EAChDiG,EAAOC,EAAK9rB,GACZ0X,EAAKzV,IAAI4pB,EAAMjmB,GACX5F,IAAM2e,EAAMjH,KAAKzX,OAAS,EAC1B2F,GAAU+Y,EAAMqN,OAEhBpmB,GAAU+Y,EAAMoN,SAkB5B,OAdAzb,EAAQ,IAAI+D,KAAK,CAACqD,GAAO,CACrBrZ,KAAM,cAGVsD,KAAKqnB,cAAcnqB,SAAQ,SAASqsB,GAChCA,EAAOC,eAEXxpB,KAAKqnB,cAAgB,GAErBrnB,KAAKonB,YAAYlqB,SAAQ,SAASqsB,GAC9BA,EAAOC,eAEXxpB,KAAKonB,YAAc,GAEZpnB,KAAK8kB,KAAK,WAAYnW,EAAOoH,IAExC6N,EAAI9R,UAAUwX,gBAAkB,WAC5B,IAAItM,EAAOsN,EAAMf,EACjB,GAAgC,IAA5BvpB,KAAKonB,YAAY9oB,UAIjB0B,KAAK+oB,WAAa/oB,KAAKod,OAAO9e,QAQlC,OALA0e,EAAQhd,KAAKod,OAAOpd,KAAK+oB,aACzBQ,EAASvpB,KAAKonB,YAAY7T,QAC1B+W,EAAOtqB,KAAKuqB,QAAQvN,GACpBhd,KAAKkB,IAAI,mBAAqBopB,EAAKvsB,MAAQ,GAAK,OAASiC,KAAKod,OAAO9e,QACrE0B,KAAKqnB,cAAc9oB,KAAKgrB,GACjBA,EAAOiB,YAAYF,IAE9B1G,EAAI9R,UAAU0W,eAAiB,SAAS7b,GACpC,OAAOA,EAAI+B,aAAa,EAAG,EAAG1O,KAAK0I,QAAQ9E,MAAO5D,KAAK0I,QAAQ7E,QAAQkS,MAE3E6N,EAAI9R,UAAUpD,aAAe,SAASC,GAClC,IAAIhC,EACgB,MAAhB3M,KAAKkoB,UACLloB,KAAKkoB,QAAUrrB,SAASC,cAAc,UACtCkD,KAAKkoB,QAAQtkB,MAAQ5D,KAAK0I,QAAQ9E,MAClC5D,KAAKkoB,QAAQrkB,OAAS7D,KAAK0I,QAAQ7E,QAOvC8I,EAAM3M,KAAKkoB,QAAQnf,WAAW,MAC9B,IAAI0hB,EAAS,QACSxjB,IAAlB2C,OAAO6gB,SACP7gB,OAAO6gB,OAAS,IAGpB9d,EAAIpB,UAAU,EAAG,EAAGvL,KAAKkoB,QAAQtkB,MAAO5D,KAAKkoB,QAAQrkB,QACrD8I,EAAI5B,UAAU4D,EAAO,EAAG,GAQxB,IANA,IAAIoH,EAAO/V,KAAKwoB,eAAe7b,GAC3B+d,EAAK,EACLC,GAAQ,EACRC,EAAQ,EACRC,EAAS,EAEJxsB,EAAI,EAAGA,EAAI0X,EAAKzX,OAAQD,GAAK,EAAG,CACrC,IAAI4O,EAAS8I,EAAK1X,EAAI,IAAM,GAAO0X,EAAK1X,EAAI,IAAM,EAAM0X,EAAK1X,EAAI,GACjEusB,GAAS7U,EAAK1X,EAAI,GAClBwsB,IAAW9U,EAAK1X,GAAK0X,EAAK1X,EAAI,IAAM,GACN,IAA1BosB,EAAOzsB,QAAQiP,IACfwd,EAAOlsB,KAAK0O,IAEqB,IAAjCrD,OAAO6gB,OAAOzsB,QAAQiP,IACtBrD,OAAO6gB,OAAOlsB,KAAK0O,GAEH,MAAhB8I,EAAK1X,EAAI,KACTssB,GAAQ,GA2BhB,OAvBIA,IAMAD,EAAME,EAAQC,EAAS,MAAW,UAKtCle,EAAIO,UAAY,IAAMwd,EAAG/qB,SAAS,IAAImrB,SAAS,EAAG,KAClDne,EAAIyD,SAAS,EAAG,EAAGpQ,KAAK0I,QAAQ9E,MAAO5D,KAAK0I,QAAQ7E,QACpD8I,EAAI5B,UAAU4D,EAAO,EAAG,GAUjB,CACHoH,KAHM/V,KAAKwoB,eAAe7b,GAI1Bmb,YAAc6C,EAAQD,EAAK,OAGnC9G,EAAI9R,UAAUyY,QAAU,SAASvN,GAC7B,IAAIjf,EAAOusB,EAeX,GAbAA,EAAO,CACHvsB,MAFJA,EAAQiC,KAAKod,OAAOpf,QAAQgf,GAGxBnF,KAAM9Z,IAAUiC,KAAKod,OAAO9e,OAAS,EACrCwhB,MAAO9C,EAAM8C,MACbgI,YAAa9K,EAAM8K,YACnBlkB,MAAO5D,KAAK0I,QAAQ9E,MACpBC,OAAQ7D,KAAK0I,QAAQ7E,OACrBmO,QAAShS,KAAK0I,QAAQsJ,QACtBgW,OAAQhoB,KAAK0I,QAAQsf,OACrBqB,cAAerpB,KAAK0I,QAAQ2gB,cAC5BzB,OAAQ5nB,KAAK0I,QAAQkf,OACrBmD,YAA8B,WAAjB5E,EAAQjS,MAEP,MAAd8I,EAAMjH,KACNuU,EAAKvU,KAAOiH,EAAMjH,UACf,GAAqB,MAAjBiH,EAAMlU,QACbwhB,EAAKvU,KAAO/V,KAAKwoB,eAAexL,EAAMlU,aACnC,CAAA,GAAmB,MAAfkU,EAAMrO,MAKb,MAAM,IAAIzP,MAAM,iBAJhB,IAAIwpB,EAAI1oB,KAAK0O,aAAasO,EAAMrO,OAChC2b,EAAKvU,KAAO2S,EAAE3S,KACduU,EAAKxC,YAAcY,EAAEZ,YAIzB,OAAOwC,GAEX1G,EAAI9R,UAAU5Q,IAAM,WAChB,IAAIV,EAEJ,GADAA,EAAO,GAAK0kB,UAAU5mB,OAAS6a,EAAM1M,KAAKyY,UAAW,GAAK,GACrDllB,KAAK0I,QAAQqf,MAGlB,OAAOtnB,QAAQS,IAAIoX,MAAM7X,QAASD,IAE/BojB,EA1VR,CA2VDQ,GACFjlB,EAAOC,QAAU0nB,GAClB,CACC,mBAAoB,EACpB7mB,OAAQ,KAEb,GAAI,CAAC,GA3lBF,CA2lBM,YC9lBH+qB,UAAiBpX,cAgBdqX,GACR3pB,QAjBDtB,KACckrB,eAAiB,iBAD/BlrB,KAEcmrB,gBAAkB,eAFhCnrB,KAIKorB,qBAA+B,EAJpCprB,KAKKqrB,oBAA8B,EALnCrrB,KAccmhB,aAAuB,EAKpCnhB,KAAK0T,OAAOG,UAAUnQ,IAAI,iBAE1B1D,KAAKG,YAAY,SAEjBH,KAAKirB,SAAWA,EAEhBjrB,KAAKsrB,cAAgB7uB,EAAc,KAAM,UACzCuD,KAAKsrB,cAAc/tB,UAAYyC,KAAKmrB,gBAEpCnrB,KAAKurB,YAAc,IAAIxY,EAEvB/S,KAAKwrB,aAAiC/uB,EAAc,MAAO,SAE3DuD,KAAKyrB,YAAchvB,EAAc,MAAO,QACxCuD,KAAKyrB,YAAYluB,UAAY,iCAE7ByC,KAAK0rB,kBAAoBjvB,EAAc,MAAO,cAC9CuD,KAAK0rB,kBAAkBnuB,UAAY,oCAEnCyC,KAAK2rB,UAAYlvB,EAAc,MAAO,aAEtCuD,KAAK4rB,WAAanvB,EAAc,IAAK,QACrCuD,KAAK4rB,WAAWruB,UAAY,OAC5ByC,KAAK4rB,WAAW/hB,iBAAiB,aAAW,KACpB7J,KAAK4rB,WAAYC,KAAO7rB,KAAKwrB,aAAajd,OAGlEvO,KAAK4B,YACD5B,KAAKsrB,cACLtrB,KAAKurB,YACLvrB,KAAKwrB,aACLxrB,KAAKyrB,YACLzrB,KAAK0rB,kBACL1rB,KAAK2rB,UACL3rB,KAAK4rB,YAGT5rB,KAAKmhB,aAAc,EAGhBwH,OAAOmD,GACV9rB,KAAKqrB,oBAAqB,EAC1BrrB,KAAKorB,qBAAsB,EAC3BprB,KAAKyB,OAEiC,QAAlCzB,KAAKirB,SAASc,gBACd/rB,KAAKgsB,UAAUF,IAGf9rB,KAAKisB,aAAajsB,KAAKirB,SAAStc,OAAO,GAAO,EAAMmd,EAAQ9rB,KAAKtC,QAAQ6M,KAAKvK,OAC9EA,KAAKqrB,oBAAqB,GAI1BW,UAAUF,GACd,IAAIxO,EAAM,IAAI4O,EAAA9W,GAAJ,CAAa,CACnBkI,IAAKtd,KAAKirB,SAAStc,MAAM7D,cAG7B9K,KAAKmsB,QAAU7O,EAkFfA,EAAI2F,MAhFM,KACNjjB,KAAKmsB,QAAU,KAEXnsB,KAAKorB,sBACLprB,KAAKqrB,oBAAqB,EAC1BrrB,KAAKosB,YAET,MAAM9b,EAAStQ,KAAKirB,SAASoB,OACvBC,EAAa,IAAI/pB,EAAU,IAAII,EAAM2N,EAAO1N,MAAQ0N,EAAO1M,MAAQ,EAAI0M,EAAO1M,MAAQ,OAAQ0M,EAAOhK,GAAqB,IAAfgK,EAAO1M,OAAe,IAAIjB,EAAqB,KAAf2N,EAAO1M,MAA6B,IAAf0M,EAAO1M,QAC7K,IAAI2oB,EAAU,IAAIL,EAAAzI,GAAJ,CAAQ,CAClBkE,QAAS,EACT3V,QAAS,EACTgW,QAAQ,EACRpkB,MAAQkoB,EAAwCQ,EAAW1oB,MAA1C5D,KAAKirB,SAASuB,SAAS5oB,MACxCC,OAASioB,EAAyCQ,EAAWzoB,OAA3C7D,KAAKirB,SAASuB,SAAS3oB,OACzCkkB,OAAO,EACP7kB,MAAM,IAGNoP,EAAMgL,EAAIqE,aACd3hB,KAAKurB,YAAYrY,gBAAgB,EAAI,EAAGZ,GAExC,IAAIma,EAAepuB,IACfif,EAAIgD,QAAQjiB,GAEZ2B,KAAKisB,aAAa3O,EAAIkE,cAAc,GAAM,EAAOsK,GAASpjB,IACtD,IAAIkJ,EAAM,IAAIxD,MACdwD,EAAI/H,iBAAiB,QAAM,KACvB,GAAI7J,KAAKorB,oBAGL,OAFAprB,KAAKqrB,oBAAqB,OAC1BrrB,KAAKosB,WAITG,EAAQnE,SAASxW,EAAK,CAClBkO,MAAmC,GAA5BxC,EAAIgE,aAAajjB,GAAGyhB,OAAc,KAG7C9f,KAAKurB,YAAYjY,SAEjBjV,IACUiU,EACNia,EAAQ5D,SAGR8D,EAAYpuB,MAGpBuT,EAAIrD,IAAM7F,EAAQ,GAAGhJ,QAI7B6sB,EAAQzrB,GAAG,YAAamN,IACpB,IAAIvO,EAAML,IAAImP,gBAAgBP,GAC9BjO,KAAKtC,QAAQ,CACT,CACI+b,MAAO,MACP/Z,IAAKA,KAIbM,KAAKqrB,oBAAqB,KAG9BkB,EAAQzrB,GAAG,SAAO,KACdd,KAAKqrB,oBAAqB,EAC1BrrB,KAAKosB,cAGTG,EAAQzrB,GAAG,YAAa+R,IACpB7S,KAAKurB,YAAY1Y,SAAW,EAAI,EAAe,EAAXA,EAAe,EAE/C7S,KAAKorB,qBACLmB,EAAQpJ,WAIhBsJ,EAAY,UAGCxlB,GAAS,KACtBjH,KAAKmsB,QAAU,KACfnsB,KAAKqrB,oBAAqB,EAC1BrrB,KAAKosB,cAILH,aAAajP,EAAsDtT,EAAoBgjB,EAAoBZ,EAAiBhe,GAChI,IAAIlR,EAAoB,GACpB+vB,EAAiBD,EAAY,EAAI,EACjCrZ,EAAU,EAEVuZ,EAAK,CAAIltB,EAAa+Z,EAAe1b,KACrCsV,IACAzW,EAAImB,GAAS,KAAE2B,QAAK+Z,GAChBpG,IAAYsZ,GACZ7e,EAASlR,IAIbiwB,EAAe,IAAIpkB,EAAO,CAC1BhG,KAAMzC,KAAKirB,SAASuB,SAAS/pB,KAC7BiH,UAAWA,IAGfsK,EAAOsE,MAAMuU,GAEb,IAAIC,EAAK,IAAIrkB,EAAO,CAChBhG,KAAMzC,KAAKirB,SAAS8B,UACpBrjB,UAAWA,IAGfojB,EAAGtb,iBACCwL,EACAhd,KAAKirB,SAAS+B,SAAW,IAAMnmB,KAAK0J,GACpCvQ,KAAKirB,SAAS8B,UAAUtpB,UAAU,GAAGF,MAAMvD,KAAKirB,SAASgC,UAAUxpB,UAAU,KAGjF,IAAI6M,EAAStQ,KAAKirB,SAASoB,OAE3B,IAAIa,EAAa,IAAIzkB,EAAO,CACxBhG,KAAMqpB,EAAQ,IAAInpB,EAAqB,KAAf2N,EAAO1M,MAA6B,IAAf0M,EAAO1M,OAAe5D,KAAKirB,SAASuB,SAAS/pB,KAC1FiH,UAAWA,IAuBf,GApBc,GAAVoiB,EACAoB,EAAWte,iBACPke,EACA,IAAInqB,EAAM,GACV,IAAIJ,EAAU,IAAII,EAAM2N,EAAO1N,MAAQ0N,EAAO1M,MAAQ,EAAI0M,EAAO1M,MAAQ,OAAQ0M,EAAOhK,GAAqB,IAAfgK,EAAO1M,OAAe,IAAIjB,EAAqB,KAAf2N,EAAO1M,MAA6B,IAAf0M,EAAO1M,SAI9JspB,EAAWte,iBACPke,EACA,IAAInqB,EAAM,GACV3C,KAAKirB,SAASuB,UAGtBU,EAAWniB,UAAU8hB,EAAc,IAAIlqB,EAAM,IAE7CuqB,EAAWrf,YAAYI,IACnB2e,EAAMvtB,IAAImP,gBAAgBP,GAAO,SAAU,MAG3Cye,EAAW,CACX,IAAIS,EAAa,IAAI1kB,EAAO,CACxBhG,KAAMzC,KAAKirB,SAASuB,SAAS/pB,KAC7BiH,UAAWA,IAGfyjB,EAAWve,iBACPke,EACA,IAAInqB,EAAM,GACV3C,KAAKirB,SAASuB,UAGlBW,EAAWpiB,UAAU8hB,EAAc,IAAIlqB,EAAM,IAE7CwqB,EAAW5f,UAAY,iBACvB4f,EAAWjc,mBAAmB,IAAIvO,EAAM,GAAIwqB,EAAWvpB,MAAO,SAE9DupB,EAAWtf,YAAYI,IACnB2e,EAAMvtB,IAAImP,gBAAgBP,GAAO,SAAU,OAK/CvQ,QAAQ0vB,GAMZ,IAAIC,EALJrtB,KAAKurB,YAAY7pB,OACjB/D,EAAYqC,KAAK2rB,WACjBhuB,EAAYqC,KAAK4rB,YACjB5rB,KAAKsrB,cAAc/tB,UAAYyC,KAAKkrB,eACpClrB,KAAK2rB,UAAUhqB,UAAY,GAG3ByrB,EAAYlwB,SAAO,CAAEowB,EAAQ9Q,KACzB,IAAI+Q,EAAI9wB,EAAc,SAAU,UAChC8wB,EAAEpwB,MAAMyG,MAAS,EAAIwpB,EAAY9uB,OAAS,IAAO,IACjDivB,EAAEhwB,UAAY+vB,EAAO7T,MACf8T,EAAG7tB,IAAM4tB,EAAO5tB,IACtB6tB,EAAE1jB,iBAAiB,SAAO,KACtB7J,KAAKwrB,aAAajd,IAAM+e,EAAO5tB,IAE/B,IAAI8tB,EAAKxtB,KAAK2rB,UAAU9pB,SACxB,IAAK,IAAIxD,EAAI,EAAGA,EAAImvB,EAAGlvB,OAAQD,IAC3BmvB,EAAGnvB,GAAGwV,UAAU4Z,OAAO,WAG3BF,EAAE1Z,UAAUnQ,IAAI,cAGpB1D,KAAK2rB,UAAU/pB,YAAY2rB,GAEjB,IAAN/Q,IACA6Q,EAAcE,MAItBvtB,KAAKwrB,aAAand,OAAM,KACpBrO,KAAKwB,iBAAiBwK,UAAYhM,KAAKwB,iBAAiBksB,aACxD1tB,KAAKwrB,aAAand,OAAS,MAG/Bgf,EAAYM,QAGTlsB,OACHzB,KAAKurB,YAAY9pB,OACjBzB,KAAKurB,YAAY/X,QACjBxT,KAAKsrB,cAAc/tB,UAAYyC,KAAKmrB,gBACpC3tB,EAAYwC,KAAK2rB,WACjBnuB,EAAYwC,KAAK4rB,YACjBpuB,EAAYwC,KAAK0rB,mBACjB1rB,KAAKwrB,aAAajd,IAAM,GACxBvO,KAAK4rB,WAAWgC,aAAa,WAAY5tB,KAAKirB,SAAS4C,UACvD9wB,EAAciD,KAAKwrB,cAAexrB,KAAKirB,SAAS6C,WAChDxsB,MAAMG,OAGHC,KAAKqsB,GAAiB,GACrBA,IAAU/tB,KAAKmhB,YACf7f,MAAMI,OAGN1B,KAAKosB,WAINA,WACH,GAAIpsB,KAAKqrB,mBAIL,OAHArrB,KAAKorB,qBAAsB,EAC3BprB,KAAKmsB,SAAWnsB,KAAKmsB,QAAQhJ,QAC7BxlB,EAAYqC,KAAK0rB,oBACV,EAGX,IAAI8B,EAAKxtB,KAAK2rB,UAAU9pB,SACxB,IAAK,IAAIxD,EAAI,EAAGA,EAAImvB,EAAGlvB,OAAQD,IACrBmvB,EAAGnvB,GAAIqB,KAAOL,IAAIiP,gBAAsBkf,EAAGnvB,GAAIqB,KAKzD,OAFAM,KAAKO,UAAU,SACfP,KAAK0B,MAAK,IACH,mBCtVHssB,GAAAA,EAAAA,EACJ,KAAG,IAAP,OADQA,EAAAA,EAEN,GAAG,IAAL,KAFQA,EAAAA,EAGH,MAAG,IAAR,QAHQA,EAAAA,EAIJ,KAAG,IAAP,QAJQA,IAAAA,EAAI,WAOHC,sBAILrkB,OAAOC,iBAAiB,WAAW7M,GAAKixB,EAAWC,SAASlxB,EAAEmxB,UAAW,IACzEvkB,OAAOC,iBAAiB,SAAS7M,GAAKixB,EAAWC,SAASlxB,EAAEmxB,UAAW,kBAGtDrI,GACjB,OAAO9lB,KAAKkuB,SAASpI,KAAQ,cAGdsI,EAAcC,GAC7B,OAAQruB,KAAK+J,OAAOqkB,IAASpuB,KAAK+J,OAAOskB,qBAGpBvI,GACrB,OAAOA,GAAO,IAAMA,GAAO,IAjBtBmI,EACMC,SAAuC,SCNpCI,UAAeltB,cAIrBC,GACRC,MAAMD,GALPrB,KACKuuB,OAAiB,EADtBvuB,KAEKwuB,cAAwB,EAMzBC,OAAOC,GACV1uB,KAAKuuB,OAAQ,EACRvuB,KAAKwuB,cACNxuB,KAAK2uB,wBAILC,QACA5uB,KAAKuuB,OACLvuB,KAAK0f,OACL1f,KAAKuuB,OAAQ,EACbvuB,KAAK2uB,yBAEL3uB,KAAKwuB,cAAe,EAIpBG,wBACJ3uB,KAAKwuB,cAAe,EACpBG,sBAAsB3uB,KAAK4uB,MAAMrkB,KAAKvK,cCjBxC6uB,UAAetsB,cAIL0oB,GACR3pB,MAAM,IAAIqB,EAAS,IAAIA,GACvB3C,KAAKirB,SAAWA,EAChBjrB,KAAK8uB,aAGEjf,aACP,OAAO7P,KAAKyC,KAAKgB,UAAU,GAGpBoM,WAAOA,GACd7P,KAAKyC,KAAOoN,EAAOzM,MAAM,GAGtBoQ,QACHxT,KAAKwC,SAAW,IAAIG,EAAM,GAC1B3C,KAAKyC,KAAO,IAAIE,EAAM3C,KAAKirB,SAAS8D,UAAUtsB,KAAKqE,IAAM,GAGlDkoB,gBACP,OAAOhvB,KAAKkD,OAGT4rB,aACH9uB,KAAKivB,QAAUjvB,KAAKkD,OAGbgsB,aACP,OAAOlvB,KAAKivB,QAGTE,WACH,IAAIvyB,EAAM,EAgCV,OA9BIoD,KAAK4D,MAAQ5D,KAAKirB,SAAS8B,UAAU7oB,IACrClE,KAAK2E,eAAe3E,KAAKirB,SAAS8B,UAAU7oB,GAC5CtH,GAAO,GAGPoD,KAAK6D,OAAS7D,KAAKirB,SAAS8B,UAAU5oB,IACtCnE,KAAK4E,gBAAgB5E,KAAKirB,SAAS8B,UAAU5oB,GAC7CvH,GAAO,GAGPoD,KAAKkE,EAAI,IACTlE,KAAKkE,EAAI,EACTtH,GAAO,GAGPoD,KAAKmE,EAAI,IACTnE,KAAKmE,EAAI,EACTvH,GAAO,GAGPoD,KAAK4F,OAAS5F,KAAKirB,SAAS8B,UAAU5oB,IACtCnE,KAAK4F,OAAS5F,KAAKirB,SAAS8B,UAAU5oB,EACtCvH,GAAO,IAGPoD,KAAK2F,MAAQ3F,KAAKirB,SAAS8B,UAAU7oB,IACrClE,KAAK2F,MAAQ3F,KAAKirB,SAAS8B,UAAU7oB,EACrCtH,GAAO,IAGJA,SAIFwyB,UAAiBd,cAkBde,GACR/tB,MAAM7E,EAAc,MAAO,aAnB5BuD,KAGKsvB,eAAyB,EAH9BtvB,KAIKuvB,YAAsB,EAJ3BvvB,KAKKwvB,gBAAkB,EALvBxvB,KASKyvB,cAA6B,OATlCzvB,KAeK0vB,cAAwB,EAM5B1vB,KAAKG,YAAY,UACjBH,KAAKG,YAAY,eACjBH,KAAKG,YAAY,mBACjBH,KAAKG,YAAY,eACjBH,KAAKG,YAAY,aAKjBH,KAAK2vB,SAAWN,EAChBrvB,KAAKsQ,OAAS,IAAIue,EAAO7uB,MACzBA,KAAK4vB,SAAW,IAAI5E,EAAShrB,MAE7BA,KAAK2O,MAA0BlS,EAAc,MAAO,SACpDuD,KAAK2O,MAAMxR,MAAMoM,gBAAkB,WAEnCvJ,KAAK6vB,QAAU,IAAIpnB,EAAO,CACtBgB,UAAU,IAGdzJ,KAAK4B,YAAY5B,KAAK2O,MAAO3O,KAAK6vB,QAAQhnB,QAE1ChM,SAASizB,KAAKluB,YAAY5B,KAAK4vB,SAASruB,WAExCvB,KAAK6vB,QAAQhmB,iBAAiB,YAAa7J,KAAKsK,UAAUC,KAAKvK,OAC/DA,KAAK6vB,QAAQhmB,iBAAiB,YAAa7J,KAAKwK,UAAUD,KAAKvK,OAE/DA,KAAK6vB,QAAQhnB,OAAOgB,iBAAiB,aAAc7M,IAClB,QAAvBgD,KAAKyvB,eAAkD,SAAvBzvB,KAAKyvB,eACvCzyB,EAAE+yB,oBAIVlzB,SAASizB,KAAKjmB,iBAAiB,WAAS,KACpC,IAAImmB,EAAKhwB,KAAKyvB,cACdzvB,KAAKyvB,cAAgB,OACV,SAAPO,IACAhwB,KAAKyuB,OAAO,WACZzuB,KAAKO,UAAU,iBAIvB1D,SAASizB,KAAKjmB,iBAAiB,YAAU,KACrC,IAAImmB,EAAKhwB,KAAKyvB,cACdzvB,KAAKyvB,cAAgB,OACV,SAAPO,IACAhwB,KAAKyuB,OAAO,YACZzuB,KAAKO,UAAU,iBAKvBqJ,OAAOC,iBAAiB,WAAW7M,GAAKgD,KAAKiwB,eAAejzB,EAAEmxB,WAG9DnuB,KAAK8tB,UAAY9tB,KAAK2vB,SAAS7B,UAG3BmC,eAAenK,GACfmI,EAAWiC,WAAWpK,KAEtB9lB,KAAKsQ,OAAOpM,GAAK+pB,EAAWkC,KAAKnC,EAAKroB,MAAOqoB,EAAKprB,MAClD5C,KAAKsQ,OAAOnM,GAAK8pB,EAAWkC,KAAKnC,EAAK7jB,KAAM6jB,EAAK5jB,IACjDpK,KAAKsQ,OAAO6e,WACZnvB,KAAKyuB,OAAO,cAITzB,eACP,OAAOhtB,KAAKwvB,gBAGLhD,eACP,OAAOxsB,KAAKsQ,OAAO0e,UAEZ3C,aACX,OAAOrsB,KAAKsQ,OAGD8f,iBACP,OAAOpwB,KAAKuvB,YAGTd,OAAOC,GACVptB,MAAMmtB,OAAOC,GACb1uB,KAAKO,UAAU,SAAUmuB,GAGtB2B,mBACHrwB,KAAKswB,cAAgBtwB,KAAKuwB,UAGpB7Q,OAG4B,IAA9B1f,KAAK2vB,SAASa,aACdxwB,KAAK6vB,QAAQvkB,QAGiB,IAA9BtL,KAAK2vB,SAASa,cACdxwB,KAAK6vB,QAAQjf,KAAK,cAAgB5Q,KAAK2vB,SAASa,YAAc,KAE9DxwB,KAAK6vB,QAAQtiB,UAAY,kBACS,WAA9BvN,KAAK2vB,SAASc,YACdzwB,KAAK6vB,QAAQxe,iBAAiBrR,KAAKsQ,OAAQ,SAER,WAA9BtQ,KAAK2vB,SAASc,aACnBzwB,KAAK6vB,QAAQzf,SAASpQ,KAAKsQ,OAAQ,UAK3CtQ,KAAK6vB,QAAQtiB,UAAY,cACzB,IAAID,EAAsC,KAAvB,EAAItN,KAAKowB,YAE5B,GAAIpwB,KAAK2vB,SAASe,gBAAiB,CAC/B,IAAIxgB,EAAQ5C,EAAY,GAAM,EAE9BtN,KAAK6vB,QAAQpiB,SAAW,CAAC5G,KAAKC,IAAI9G,KAAK6vB,QAAQjsB,MAAO5D,KAAK6vB,QAAQhsB,QAAU,KAE3C,WAA9B7D,KAAK2vB,SAASc,aACdzwB,KAAK6vB,QAAQte,iBAAiBvR,KAAKsQ,OAAQ,QAAShD,GAGxDtN,KAAK6vB,QAAQ5f,SACT,IAAI1N,EACAvC,KAAKsQ,OAAO9N,SAASe,MAAM+J,GAC3BtN,KAAKsQ,OAAO7N,KAAKqB,KAAKwJ,IAE1B,QACAA,EACA4C,GAIJlQ,KAAK2vB,SAASgB,gBACd3wB,KAAK6vB,QAAQxf,WAAWrQ,KAAKsQ,OAAQhD,GAErCtN,KAAK6vB,QAAQ/mB,QAAQ8nB,eAAiB,GAuCnCC,gBACP,OAAO,IAAItuB,EAAU,IAAII,EAAM,GAAI3C,KAAKitB,WAGjCA,gBACP,OAAO,IAAItqB,EAAM3C,KAAK2O,MAAM/K,MAAO5D,KAAK2O,MAAM9K,QAIvCkrB,gBACP,OAAO,IAAIxsB,EAAU,IAAII,EAAM,GAAI3C,KAAK+sB,WAGjCA,gBACP,OAAO,IAAIpqB,EAAM3C,KAAK6vB,QAAQjsB,MAAO5D,KAAK6vB,QAAQhsB,QAG3CitB,mBACP,OAAOnuB,EAAMG,aAAa9C,KAAKuB,UAAUiL,yBAGjC8jB,mBACR,OAAOtwB,KAAKsvB,cAGJgB,iBAAa9kB,GACrBxL,KAAKsvB,cAAgB9jB,EAGjBxL,KAAKuB,UAAUpE,MAAM4zB,SADrBvlB,EACgC,SAGA,GAIjCR,KAAKlG,EAAiBksB,GAAwB,GACjD,IAAIC,EAAejxB,KAAKuB,UAAUyK,UAAYhM,KAAKuB,UAAUmsB,aACzC1tB,KAAKuB,UAAUsK,WAAa7L,KAAKuB,UAAU2vB,YAE/DlxB,KAAKuB,UAAUyK,UAAY,EAC3BhM,KAAKuB,UAAUsK,WAAa,EAC5B,IAAIslB,EAAa,IAEqC,IAAlDnxB,KAAK2O,MAAMxR,MAAMi0B,UAAUpzB,QAAQ,aACnCmzB,EAAanxB,KAAK2O,MAAMxR,MAAMi0B,UAAUxmB,OACpC5K,KAAK2O,MAAMxR,MAAMi0B,UAAUpzB,QAAQ,aAI3C8G,EAASA,GAAU9E,KAAKowB,WACxBpwB,KAAKuvB,YAAczqB,EACnB9E,KAAK6vB,QAAQ7kB,KAAKlG,GAClB9E,KAAK2O,MAAMxR,MAAMi0B,UAAY,SAAWtsB,EAAS,IAAMA,EAAS,IAEhE9E,KAAK2O,MAAMxR,MAAMi0B,WAAaD,EAE9B,IAAIluB,EAAIjD,KAAK2O,MAAMnC,wBAEnB,GAAe,IAAXvJ,EAAEL,KAAY,CACd,IAAIyuB,EAAUxK,WAAW7mB,KAAK2O,MAAMxR,MAAMyF,MAAQ,OAClDyuB,GAAWpuB,EAAEL,KAEb5C,KAAK2O,MAAMxR,MAAMyF,KAAOyuB,EAAU,KAGtC,GAAc,IAAVpuB,EAAEJ,IAAW,CACb,IAAIwuB,EAAUxK,WAAW7mB,KAAK2O,MAAMxR,MAAM0F,KAAO,OACjDwuB,GAAWpuB,EAAEJ,IAEb7C,KAAK2O,MAAMxR,MAAM0F,IAAMwuB,EAAU,KAGrCL,GAAgBhxB,KAAKyuB,OAAO,QAE5BzuB,KAAKuB,UAAUyK,UAAYilB,EAAejxB,KAAKuB,UAAUmsB,aACzD1tB,KAAKuB,UAAUsK,WAAaolB,EAAejxB,KAAKwB,iBAAiB0vB,YAG9DI,SACHtxB,KAAKswB,cAAe,EACpBtwB,KAAKgL,KAAuB,IAAlBhL,KAAKowB,YAGZmB,UACHvxB,KAAKswB,cAAe,EACpBtwB,KAAKgL,KAAKhL,KAAKowB,WAAa,KAGzBG,QAAQxC,GAAiB,EAAMiD,GAAwB,GAC1D,GAAKhxB,KAAK2O,QAIL3O,KAAKswB,cAAiBvC,GAA3B,CAIA/tB,KAAKswB,cAAe,EAOpB,IAAIkB,EAAKxxB,KAAKuB,UAAUiL,wBACpBilB,EAAczxB,KAAK6vB,QAAQjsB,MAA3B6tB,EAA0CzxB,KAAK6vB,QAAQhsB,OAEvD6tB,EAAKF,EAAG5tB,MAAQ6tB,EAChBE,EAAKH,EAAG3tB,OAAS4tB,EACjBjO,EAAI3c,KAAKC,IAAI4qB,EAAIC,GAIrB3xB,KAAKgL,KAAKwY,EAAGwN,IA8BVjiB,OAAO6iB,EAAcZ,GAAwB,GACrChxB,KAAKwvB,qBACJvoB,IAAR2qB,IAAmBA,EAAM5xB,KAAKwvB,iBAElCxvB,KAAKwvB,gBAAkBoC,GAE+B,IAAlD5xB,KAAK2O,MAAMxR,MAAMi0B,UAAUpzB,QAAQ,aACnCgC,KAAK2O,MAAMxR,MAAMi0B,UAAYpxB,KAAK2O,MAAMxR,MAAMi0B,UAAUxmB,OACpD,EACA5K,KAAK2O,MAAMxR,MAAMi0B,UAAUpzB,QAAQ,aAI3C,IAAI6zB,EAAK7xB,KAAK2O,MAAMxR,MAAMi0B,UAE1BpxB,KAAK2O,MAAMxR,MAAMyF,KAAO,MACxB5C,KAAK2O,MAAMxR,MAAM0F,IAAM,MAEvB,IAAIJ,EAAOE,EAAMG,aAAa9C,KAAK2O,OAE/BmjB,EAAKnvB,EAAMG,aAAa9C,KAAK2O,MAAMnC,yBAEvCxM,KAAK2O,MAAMxR,MAAMi0B,UAAYS,EAAK,WAAaD,EAAM,OAErD,IAAI3uB,EAAIV,EAAUwvB,eAAe/xB,KAAK2O,MAAMnC,yBACxCwlB,EAAQ/uB,EAAEoC,QAAQoC,SAASlE,MAAM,IAAIZ,EAAM3C,KAAKuB,UAAUsK,WAAY7L,KAAKuB,UAAUyK,YAEzFhM,KAAK2O,MAAMxR,MAAMyF,KAAOovB,EAAM9tB,EAAI,KAClClE,KAAK2O,MAAMxR,MAAM0F,IAAMmvB,EAAM7tB,EAAI,KAEjC1B,EAAKwC,SAAShC,EAAER,KAAKgB,UAAUquB,IAC/B9xB,KAAK6vB,QAAQ3mB,OAAOzG,GAAM,GAkB1BzC,KAAKuwB,SAAQ,EAAOS,GACpBhxB,KAAKsQ,OAAO6e,WACZ6B,GAAgBhxB,KAAKyuB,OAAO,UAGrBX,cAAUA,GACjB/wB,EAAciD,KAAK2O,OAAQmf,GAC3B9tB,KAAK6vB,QAAQnmB,WAAaokB,EAE1B9tB,KAAKiyB,YAAcnE,EACnB9tB,KAAKO,UAAU,kBAAmBP,KAAKiyB,aAGhCnE,gBACP,OAAO9tB,KAAKiyB,YAGTC,iBAAiBvgB,GACpB,SAAKA,GAAoC,UAA5BA,EAAKjV,KAAK2V,MAAM,KAAK,IAAkBrS,KAAK0vB,gBAIzD1vB,KAAK+rB,gBAA8C,QAA5Bpa,EAAKjV,KAAK2V,MAAM,KAAK,GAAe,MAAQ,MACnErS,KAAKmyB,UAAYxgB,EAAKuC,KAAKke,UAAU,EAAGzgB,EAAKuC,KAAKme,YAAY,MAAQ,YAAcryB,KAAK+rB,gBAEzF/rB,KAAK0vB,cAAe,EACpBjnB,EAAO6pB,YAAY3gB,EAAM3R,KAAKuyB,uBAAuBhoB,KAAKvK,OAAO,IAC1D,GAGHuyB,uBAAuB5jB,GACvB3O,KAAK2O,MAAMJ,KACXlP,IAAIiP,gBAAgBtO,KAAK2O,MAAMJ,KAGnCvO,KAAK6vB,QAAQ3mB,OAAOvG,EAAMG,aAAa6L,IAAQ,GAC/C3O,KAAK6vB,QAAQvkB,QAEbtL,KAAK2O,MAAM/K,MAAQ+K,EAAM/K,MACzB5D,KAAK2O,MAAM9K,OAAS8K,EAAM9K,OAC1B7D,KAAK2O,MAAMJ,IAAMI,EAAMJ,IAEvBvO,KAAKsQ,OAAOkD,QACZxT,KAAKuwB,SAAQ,GAAM,GACnBvwB,KAAK+O,OAAO,GAAG,GAEf/O,KAAKO,UAAU,cAAeP,KAAK2O,MAAMJ,KACzCvO,KAAKyuB,OAAO,gBACZzuB,KAAK0vB,cAAe,EAGjB8C,iBACH,IAAItsB,EAAI,IAAIuC,EAAO,CAAEhG,KAAME,EAAMG,aAAa9C,KAAK2O,SACnDzI,EAAE4C,QAAQuC,OAAM,EAAI,GACpBnF,EAAE6E,UAAU/K,KAAK2O,MAAO,IAAIpM,EAAU,IAAII,EAAM,GAAIA,EAAMG,aAAa9C,KAAK2O,OAAOvL,MAAM,IAAIT,GAAM,EAAI,MACvGuD,EAAE4C,QAAQ0W,aAAa,EAAG,EAAG,EAAG,EAAG,EAAG,GAEtCxf,KAAK0vB,cAAe,EACpBxpB,EAAEgI,aAAa0D,IACX5R,KAAKyyB,WAAW7gB,GAAK,UACtB3K,GAAW,GAGXyrB,eACH,IAAIxsB,EAAI,IAAIuC,EAAO,CAAEhG,KAAME,EAAMG,aAAa9C,KAAK2O,SACnDzI,EAAE4C,QAAQuC,MAAM,GAAG,GACnBnF,EAAE6E,UAAU/K,KAAK2O,MAAO,IAAIpM,EAAU,IAAII,EAAM,GAAIA,EAAMG,aAAa9C,KAAK2O,OAAOvL,MAAM,IAAIT,EAAM,GAAG,MACtGuD,EAAE4C,QAAQ0W,aAAa,EAAG,EAAG,EAAG,EAAG,EAAG,GAEtCxf,KAAK0vB,cAAe,EACpBxpB,EAAEgI,aAAa0D,IACX5R,KAAKyyB,WAAW7gB,GAAK,UACtB3K,GAAW,GAGVwrB,WAAW9jB,EAAyBtF,GACpCrJ,KAAK2O,MAAMJ,KACXlP,IAAIiP,gBAAgBtO,KAAK2O,MAAMJ,KAGnCvO,KAAK2O,MAAMN,OAAM,KACbrO,KAAK+O,QAAQ/O,KAAKgtB,UAAU,GACxB3jB,EACArJ,KAAKsQ,OAAOjK,GAAKrG,KAAK+sB,UAAU7oB,EAAIlE,KAAKsQ,OAAOjK,GAGhDrG,KAAKsQ,OAAOhK,GAAKtG,KAAK+sB,UAAU5oB,EAAInE,KAAKsQ,OAAOhK,GAEpDtG,KAAKO,UAAU,cAAeP,KAAK2O,MAAMJ,KACzCvO,KAAKyuB,OAAO,UACZzuB,KAAK0vB,cAAe,GAGxB1vB,KAAK2O,MAAMJ,IAAMI,EAAMJ,IAGpBokB,qBACH3yB,KAAK4vB,SAASjH,QAAO,GAGlBiK,eAYH5yB,KAAK4vB,SAASjH,QAAO,GAGdkF,eACP,OAAO7tB,KAAKmyB,UAGL5jB,UACP,OAAOvO,KAAK2O,MAAMJ,KAAO,KAGtBskB,iBACH7yB,KAAKsQ,OAAOjN,OAASrD,KAAK+uB,UAAU1rB,OACpCrD,KAAKsQ,OAAO6e,WACZnvB,KAAKyuB,OAAO,eAGTqE,YAAYrwB,GACfzC,KAAKsQ,OAAO7N,KAAO,IAAIE,EAAMF,GAC7BzC,KAAKsQ,OAAO6e,WACZnvB,KAAKyuB,OAAO,iBAETsE,cACH,OAAO/yB,KAAKsQ,OAAO7N,KAGhBuwB,YAAYxwB,GACfxC,KAAKsQ,OAAOjN,OAASb,EAErBxC,KAAKyuB,OAAO,iBAETwE,wBAAwBxwB,GAC3BzC,KAAKsQ,OAAO7N,KAAOA,EAEnBzC,KAAKyuB,OAAO,iBAERyE,eAAehvB,EAAWC,GACb,IAAIxB,EAAMuB,EAAGC,GAC9B,GAAInE,KAAKsQ,OAAO/J,cAAc,IAAI5D,EAAMuB,EAAGC,IAAK,CAgB5C,OAFqBnE,KAAKsQ,OAAOjN,OAAOiF,WAAW,IAAI3F,EAAMuB,EAAGC,KAAOnE,KAAKsQ,OAAOT,OAAO3L,EAElE,SAAW,OAGnC,MAAO,MAIPsG,UAAUtG,EAAWC,GACzB,IAAIgvB,EAASnzB,KAAKkzB,eAAehvB,EAAGC,GACpCnE,KAAKyvB,cAAgB0D,EAEM,SAAvBnzB,KAAKyvB,eACLzvB,KAAKO,UAAU,eAGnBP,KAAKozB,YAAc,IAAIzwB,EAAMuB,EAAGC,GAChCnE,KAAKsQ,OAAOwe,aAEZ9uB,KAAKqzB,aAAerzB,KAAKsQ,OAAO7L,mBAAmBzE,KAAKszB,gBAAgBtzB,KAAKozB,cAAc7vB,MAAMvD,KAAKozB,aAGlG9oB,UAAUpG,EAAWC,GAEzB,IAAIgvB,EAASnzB,KAAKyvB,cAKlB,GAJe,SAAX0D,IACAA,EAASnzB,KAAKkzB,eAAehvB,EAAGC,IAGrB,SAAXgvB,EACAnzB,KAAK6vB,QAAQhnB,OAAO1L,MAAMktB,OAAS,YAElC,GAAe,WAAX8I,EAAqB,CAC1B,IAAII,EAAKrvB,EAAIlE,KAAKsQ,OAAOjK,GACrBmtB,EAAKrvB,EAAInE,KAAKsQ,OAAOhK,GACrBmtB,GAASF,GAAMC,EACnBxzB,KAAK6vB,QAAQhnB,OAAO1L,MAAMktB,OAASoJ,EAAQ,cAAgB,mBAG3DzzB,KAAK6vB,QAAQhnB,OAAO1L,MAAMktB,OAAS,UAIvC,GAA2B,SAAvBrqB,KAAKyvB,cAAT,CAGK,GAA2B,SAAvBzvB,KAAKyvB,cAA0B,CACpC,IAAI/G,EAAI,IAAI/lB,EAAMuB,EAAGC,GAAGZ,MAAMvD,KAAKozB,aACnCpzB,KAAKsQ,OAAO9N,SAAWxC,KAAKsQ,OAAO4e,OAAO1sB,SAASsB,KAAK4kB,GACxD1oB,KAAKsQ,OAAO6e,WACZnvB,KAAKozB,YAAc,IAAIzwB,EAAMuB,EAAGC,GAChCnE,KAAKsQ,OAAOwe,iBAEgB,WAAvB9uB,KAAKyvB,eACVzvB,KAAK0zB,cAAcxvB,EAAGC,GAG1BnE,KAAKsQ,OAAOtK,MAAMhG,KAAK2vB,SAASgE,YAChC3zB,KAAKyuB,OAAO,eAGR6E,gBAAgB9sB,GACpB,IAAItC,EAAIsC,EAAEtC,EACNC,EAAIqC,EAAErC,EAEV,OAAID,EAAIlE,KAAKsQ,OAAOjK,GACZlC,EAAInE,KAAKsQ,OAAOhK,GACT,KAGA,KAIPnC,EAAInE,KAAKsQ,OAAOhK,GACT,KAGA,KAKXotB,cAAcxvB,EAAWC,GAC7B,IAAIE,EAAS9B,EAAUqxB,eAAe5zB,KAAKszB,gBAAgB,IAAI3wB,EAAMuB,EAAGC,KAExE,GAAKnE,KAAK2vB,SAASgE,WASd,CACD,IAAI1wB,EAAIV,EAAUsxB,QAAQ,IAAIlxB,EAAMuB,EAAGC,GAAGL,KAAK9D,KAAKqzB,cAAerzB,KAAKsQ,OAAOjN,QAC/EJ,EAAE4B,aAAaR,EAAQ,GAEvBrE,KAAKsQ,OAAO9K,sBAAsBvC,EAAGjD,KAAK+uB,WAC1C/uB,KAAKsQ,OAAO6e,eAde,CAC3BnvB,KAAK8zB,aAAe9zB,KAAKsQ,OAAO7L,mBAAmBJ,GAAQd,MAAMvD,KAAKqzB,cAC3DrzB,KAAKsQ,OAAO7N,KAAKS,OAA5B,IAEID,EAAIV,EAAUsxB,QAAQ,IAAIlxB,EAAMuB,EAAGC,GAAInE,KAAK8zB,cAEhD9zB,KAAKsQ,OAAOzK,gBAAgB5C,EAAGoB,EAAQrE,KAAK+uB,WAC5C/uB,KAAKsQ,OAAO6e,mBCltBX4E,UAAgBzF,cAab7rB,EAAawoB,GACrB3pB,MAAM7E,EAAc,MAAO,YAd5BuD,KAUKg0B,SAAyC,OAM7Ch0B,KAAKG,YAAY,iBAEjBgB,EAAaL,GAAG,gBAAc,IAAQd,KAAKi0B,kBAE3Cj0B,KAAKirB,SAAWA,EAChBjrB,KAAKirB,SAASnqB,GAAG,UAAW4tB,IACxB1uB,KAAKyuB,OAAO,YAAcC,MAE9B1uB,KAAKirB,SAASnqB,GAAG,eAAgByN,IAC7BvO,KAAK2O,MAAMJ,IAAMA,KAErBvO,KAAKirB,SAASnqB,GAAG,mBAAoBozB,IACjCl0B,KAAK8tB,UAAYoG,KASrBl0B,KAAKsU,MAAQ7R,EAEbzC,KAAKuB,UAAUpE,MAAMyG,MAAQnB,EAAKyB,EAAI,KACtClE,KAAKuB,UAAUpE,MAAM0G,OAAUpB,EAAK0B,EAAI,EAAK,KAC7CnE,KAAKuB,UAAUpE,MAAMg3B,SAAW1xB,GAAM9C,WAEtCK,KAAKo0B,KAAO,IAAI3rB,EAAO,CACnBhG,KAAMA,EAAKqB,KAAK,IAAInB,EAAM,EAAG,MAEjC3C,KAAKo0B,KAAKvrB,OAAOlM,UAAY,OAC7BqD,KAAKo0B,KAAKvrB,OAAO1L,MAAMg3B,OAAS,IAChCn0B,KAAKo0B,KAAKvrB,OAAO1L,MAAMqF,SAAW,WAElCxC,KAAKq0B,OAAS,IAAI5rB,EAAO,CACrBhG,KAAMA,IAEVzC,KAAKq0B,OAAOxrB,OAAOlM,UAAY,SAC/BqD,KAAKo0B,KAAKvrB,OAAO1L,MAAMg3B,OAAS,IAChCn0B,KAAKq0B,OAAOxrB,OAAO1L,MAAMqF,SAAW,WAEpCxC,KAAK2O,MAA0BlS,EAAc,MAAO,SACpDuD,KAAK2O,MAAMxR,MAAMqF,SAAW,WAC5BxC,KAAK2O,MAAMxR,MAAMoM,gBAAkB,WAC/B0hB,EAAS1c,MACTvO,KAAK2O,MAAMJ,IAAM0c,EAAS1c,KAE9BvO,KAAK2O,MAAMxR,MAAMqF,SAAW,WAExBC,EAAKuF,OAAO,IAAIrF,EAAM,OACtB3C,KAAKs0B,gBAAkB,IAAI7rB,EAAO,CAAEhG,KAAM,IAAIE,EAAM,MACpD3C,KAAKs0B,gBAAgBpjB,mBAAmB,IAAIvO,EAAM,EAAG,GAAI,GAAI,WAC7D3C,KAAKs0B,gBAAgBpjB,mBAAmB,IAAIvO,EAAM,EAAG,GAAI,GAAI,mBAC7D3C,KAAKs0B,gBAAgBzrB,OAAOlM,UAAY,mBAG5CqD,KAAKu0B,UAAY93B,EAAc,MAAO,aAEtCuD,KAAKw0B,YAAc/3B,EAAc,MAAO,QACxCuD,KAAKw0B,YAAYj3B,UAAYkF,EAAKyB,EAAI,IAAMzB,EAAK0B,EACjDnE,KAAKuB,UAAUkzB,MAAQz0B,KAAKw0B,YAAYj3B,UAExCyC,KAAK00B,aAAej4B,EAAc,SAAU,UAC5CuD,KAAK00B,aAAan3B,UAAY,IAC9ByC,KAAK00B,aAAa7qB,iBAAiB,SAAO,KACtC7J,KAAKO,UAAU,oBAGnBP,KAAKu0B,UAAU3yB,YAAY5B,KAAKw0B,aAChCx0B,KAAKu0B,UAAU3yB,YAAY5B,KAAK00B,cAEhC10B,KAAK4B,YAAY5B,KAAK2O,MAAO3O,KAAKo0B,KAAKvrB,OAAQ7I,KAAKq0B,OAAOxrB,OAAS7I,KAAKs0B,iBAAmBt0B,KAAKs0B,gBAAgBzrB,QAAW,KAAM7I,KAAKu0B,WAEvIv0B,KAAKuB,UAAUsI,iBAAiB,cAAY,KACxClM,EAAYqC,KAAKu0B,cAGrBv0B,KAAKuB,UAAUsI,iBAAiB,cAAY,KACxCrM,EAAYwC,KAAKu0B,cAGrB/2B,EAAYwC,KAAKu0B,WAEjBv0B,KAAK8tB,WAAY,EAGVrrB,WACP,OAAOzC,KAAKsU,MAGT2f,gBACHjgB,EAAOsE,MAAMtY,KAAKq0B,QAGZ3U,OACFiV,EAAchF,SAASc,cAAgBzwB,KAAKg0B,WAC5Ch0B,KAAKg0B,SAAWh0B,KAAKirB,SAAS0E,SAASc,YAEvCzwB,KAAKi0B,gBAEiB,WAAlBj0B,KAAKg0B,UACLh0B,KAAKo0B,KAAK9oB,QACVtL,KAAKo0B,KAAKhkB,SAAS,IAAI7N,EAAU,IAAII,EAAM,EAAG3C,KAAKyC,KAAK0B,GAAI,IAAIxB,EAAM3C,KAAKyC,KAAKyB,EAAG,IAAK,WACpFlE,KAAKs0B,iBACL92B,EAAYwC,KAAKs0B,gBAAgBzrB,UAIrC7I,KAAKo0B,KAAKxjB,KAAK,WACf5Q,KAAKo0B,KAAK7mB,UAAY,kBACtBvN,KAAKo0B,KAAK/iB,iBAAiB,IAAI9O,EAAU,IAAII,EAAM,GAAI3C,KAAKyC,MAAO,SACnEzC,KAAKo0B,KAAK7mB,UAAY,cAClBvN,KAAKs0B,iBACL32B,EAAYqC,KAAKs0B,gBAAgBzrB,UAK7C,IAAIwC,EAAQrL,KAAKyC,KAAKgB,UAAUzD,KAAKirB,SAASuB,SAAS/pB,MACvDzC,KAAK2O,MAAMxR,MAAMi0B,UAAY,SAAW/lB,EAAMnH,EAAI,IAAMmH,EAAMlH,EAAI,YAAcnE,KAAKirB,SAAS+B,SAAW,OAGzG,IAAIxmB,EAAI,IAAI7D,EAAM,GAClB6D,EAAEhD,SAASxD,KAAKirB,SAASuB,SAAShqB,SAASY,MAAMiI,IAEjD,IAAIupB,EAAK,IAAIjyB,EACTkkB,WAAW7mB,KAAKirB,SAAStc,MAAMxR,MAAMyF,MAAQ,OAC7CikB,WAAW7mB,KAAKirB,SAAStc,MAAMxR,MAAM0F,KAAO,QAGhD+xB,EAAG3vB,SAAS,EAAIjF,KAAKirB,SAASmF,YAE9B5pB,EAAE9C,IAAIkxB,EAAGxxB,MAAMiI,IAEfrL,KAAK2O,MAAMxR,MAAMyF,KAAO4D,EAAEtC,EAAI,KAC9BlE,KAAK2O,MAAMxR,MAAM0F,IAAM2D,EAAErC,EAAI,KAGtB2pB,cAAUA,GACjB/wB,EAAciD,KAAK2O,OAAQmf,GAC3B9tB,KAAKiyB,YAAcnE,EAGZA,gBACP,OAAO9tB,KAAKiyB,mBCrKP4C,UAAiBzzB,cAMd6pB,GACR3pB,MAAM7E,EAAc,MAAO,aAP5BuD,KACK80B,SAAsB,GAD3B90B,KAGa+0B,QAAkB,GAH/B/0B,KAIKsU,MAAgB,EAKpBtU,KAAKG,YAAY,cACjBH,KAAKG,YAAY,mBAEjBH,KAAKirB,SAAWA,EAGT+J,gBACP,IAAIp4B,EAAM,GAMV,OAJAoD,KAAK80B,SAAS53B,SAAQ+3B,IAClBr4B,EAAI2B,KAAK02B,EAAQxyB,KAAKyB,MAGnBtH,EAGJs4B,eAAezyB,GAClB,IAAI+D,EAAI,IAAIutB,EAAQtxB,EAAMzC,KAAKirB,UAC/BzkB,EAAE1F,GAAG,gBAAiBd,KAAKm1B,cAAc5qB,KAAKvK,KAAMwG,IACpDA,EAAEjF,UAAUpE,MAAMqF,SAAW,WAE7BxC,KAAK4B,YAAY4E,GACjBrI,EACI6B,KAAK80B,SACLtuB,GAAC,CACA5D,EAAM+C,IAAU/C,EAAKH,KAAK0B,EAAIwB,EAAMlD,KAAK0B,IAE9CnE,KAAK2oB,SAEL3oB,KAAKO,UAAU,kBAAmBP,KAAKg1B,WAGnCG,cAAcF,GAClBr3B,EAAaoC,KAAK80B,SAAUG,GAC5Bj1B,KAAKoC,YAAY6yB,GACjBj1B,KAAK2oB,SAEL3oB,KAAKO,UAAU,kBAAmBP,KAAKg1B,WAGhCpxB,YACP,OAAO5D,KAAKsU,MAGLzQ,aACP,OAAO7D,KAAK80B,SAAS,GAAK90B,KAAK80B,SAAS,GAAGryB,KAAK0B,EAAI,EAGhDwkB,SACJ,IAAIyM,EAAWp1B,KAAK+0B,QAEpB/0B,KAAK80B,SAAS53B,SAAQ+3B,IAClBA,EAAQ1zB,UAAUpE,MAAMwI,MAAQyvB,EAAW,KAC3CA,GAAYH,EAAQxyB,KAAKyB,EAAIlE,KAAK+0B,WAGtC/0B,KAAKsU,MAAQ8gB,EACbp1B,KAAKO,UAAU,aAAc60B,UCrExBC,UAAoBj0B,cAIjBk0B,EAAkBC,EAAkBjiB,EAAcmG,EAAgB,GAAI9c,EAAoB,IAClG2E,MAAM7E,EAAc,MAAO,eAAiBE,IAE5CqD,KAAKG,YAAY,SACjBH,KAAKG,YAAY,UAEjBH,KAAKw1B,aAAe/4B,EAAc,MAAO,qBACzCuD,KAAKw1B,aAAaj4B,UAAYkc,EAC9BzZ,KAAKw1B,aAAar4B,MAAMqF,SAAW,WAEnCxC,KAAKy1B,cAAkCh5B,EAAc,QAAS,sBAC9DuD,KAAKy1B,cAAc/4B,KAAO,QAC1BsD,KAAKy1B,cAAc3uB,IAAMwuB,EAAS31B,WAClCK,KAAKy1B,cAAcptB,IAAMktB,EAAS51B,WAClCK,KAAKy1B,cAAcniB,KAAOA,EAAK3T,WAC/BK,KAAKy1B,cAAct4B,MAAMqF,SAAW,WAEpCxC,KAAKy1B,cAAc5rB,iBAAiB,SAAO,KACvC7J,KAAKO,UAAU,QAASsmB,WAAW7mB,KAAKy1B,cAAcn4B,WAG1D0C,KAAKy1B,cAAc5rB,iBAAiB,UAAQ,KACxC7J,KAAKO,UAAU,SAAUsmB,WAAW7mB,KAAKy1B,cAAcn4B,WAG3D0C,KAAK4B,YAAY5B,KAAKw1B,aAAcx1B,KAAKy1B,eAGlCn4B,YACP,OAAOupB,WAAW7mB,KAAKy1B,cAAcn4B,OAG9BA,UAAMA,GACb0C,KAAKy1B,cAAcn4B,MAAQA,EAAMqC,YCjCzC,IAAI+1B,EAAI9rB,OACH8rB,EAAEC,eACHD,EAAEC,aAAe,CACbC,QAAS,SAAUC,GACf,OAAKA,GAAS71B,KAAKke,eAAe2X,GAG3BC,SAASj5B,SAASk5B,OAAOC,QAAQ,IAAIC,OAAO,gBAAkBC,OAAOL,GAAMG,QAAO,cAAgB,QAAU,sCAAuC,OAF/I,MAIflQ,IAAK,SAAUqQ,GACX,OAAOL,SAASj5B,SAASk5B,OAAOC,QAAO,oBAAsB,IAAI3jB,MAAK,gCAAiC8jB,KAE3GC,QAAS,SAAUP,EAAMQ,GAChBR,IAGLh5B,SAASk5B,OAASG,OAAOL,GAAQ,IAAMK,OAAOG,GAAU,kDACxDr2B,KAAK1B,OAASzB,SAASk5B,OAAOrP,MAAK,OAAQpoB,SAE/CA,OAAQ,EACRg4B,WAAY,SAAUT,GACbA,GAAS71B,KAAKke,eAAe2X,KAGlCh5B,SAASk5B,OAASG,OAAOL,GAAQ,mDACjC71B,KAAK1B,WAET4f,eAAgB,SAAU2X,GACtB,OAAQ,IAAII,OAAO,cAAgBC,OAAOL,GAAMG,QAAO,cAAgB,QAAU,WAAYO,KAAK15B,SAASk5B,UAGnHL,EAAEC,aAAar3B,QAAUzB,SAASk5B,OAAOrP,MAAK,QAAWgP,EAAEC,cAAcr3B,YA2B7Ek4B,EAxBc,CACV71B,IAAK,SAAUmlB,EAAK/Q,GAEhB,YAAY9N,IAAR8N,GACA4gB,aAAazX,eAAe4H,GADFjmB,KAAKC,MAAM61B,aAAaC,QAAQ9P,KAI1D6P,aAAaS,QAAQtQ,EAAKjmB,KAAK42B,UAAU1hB,IAClCA,IAGfzU,IAAK,SAAUwlB,EAAKxoB,GAChBq4B,aAAaS,QAAQtQ,EAAKjmB,KAAK42B,UAAUn5B,KAE7CmwB,OAAQ,SAAU3H,GACd6P,aAAaW,WAAWxQ,IAE5B4Q,OAAQ,SAAU5Q,GACd,OAAO6P,aAAazX,eAAe4H,IAEvCxa,MAAO,WACHqqB,aAAarqB,gBC3DRqrB,UAAuB/iB,gBA8E5BtS,QA9EDtB,KACK4lB,KACJ,CACI,gBACI,CACI,yCACA,oBAER,eACI,CACI,mEACA,8EACA,wBAER,YACI,CACI,+EACA,0CAER,WACI,CACI,wEACA,kIAER,aACI,CACI,oCACA,mCAER,gBACI,CACI,sEACA,oDACA,iFACA,uCACA,4CACA,mGAER,gBACI,CACI,sJACA,8FAER,gBACI,CACI,8DAER,cACI,CACI,mBACA,sBACA,yBACA,gCACA,wCACA,wEAER,YACI,CACI,0CACA,wFACA,qBACA,uBAER,YACI,CACI,iBAER,WACI,CACI,gFAERgR,QACI,CACI,gBAOZ52B,KAAK0T,OAAOG,UAAUnQ,IAAI,mBAE1B,IAAImzB,EAAoB,GAEpBC,EAAKr6B,EAAc,MACvBq6B,EAAGv5B,UAAY,gBACfs5B,EAAGt4B,KAAKu4B,GAER,IAAK,IAAIC,KAAS/2B,KAAK4lB,KAAM,CACzB,IAAIoR,EAAKv6B,EAAc,MACvBu6B,EAAGz5B,UAAYw5B,EAEf,IAAIE,EAAKx6B,EAAc,MAEvBuD,KAAK4lB,KAAKmR,GAAO75B,SAASu2B,IACtB,IAAIyD,EAAKz6B,EAAc,MACvBy6B,EAAG35B,UAAYk2B,EACfwD,EAAGr1B,YAAYs1B,MAGnBL,EAAGt4B,KAAKy4B,GACRH,EAAGt4B,KAAK04B,GAGZj3B,KAAK4B,eAAei1B,IC3GrB,ICMHM,QCFSC,UAAuBxjB,gBAE5BtS,QACAtB,KAAK0T,OAAOG,UAAUnQ,IAAI,mBAG9BjC,OACIzB,KAAK2B,UAAY,GACjB3B,KAAKwB,iBAAiBrE,MAAMk6B,WAAa,GACzC,IAAIP,EAAKr6B,EAAc,MACvBq6B,EAAGv5B,UAAY,aAEf,IAAI+5B,EAAY76B,EAAc,OAAQ,QACtC66B,EAAUztB,iBAAiB,SAAO,KAC9B7J,KAAKwB,iBAAiBrE,MAAMk6B,WAAa,OACzCr3B,KAAKzC,UFlBb,49FEmBQyC,KAAKwB,iBAAiBwK,UAAY,KAEtCsrB,EAAU/5B,UAAY,aAEtB,IAAIuyB,EAAOrzB,EAAc,OACzBqzB,EAAKnuB,UACD,4GAEiBrC,EAAA,SAFjB,8HAMJwwB,EAAKnuB,WAAa,sEAGlBmuB,EAAKluB,YAAY01B,GAEjBt3B,KAAK4B,YAAYk1B,EAAIhH,GAErBxuB,MAAMG,cCrCD81B,UAAyB3jB,gBAyB9BtS,QAzBDtB,KACKw3B,QACJ,CACI,QACA,QACA,sBALLx3B,KAQKy3B,OACJ,CACI,cACA,aACA,YACA,iBACA,aACA,SACA,SACA,MACA,cACA,aACA,gBACA,iBAKJz3B,KAAK0T,OAAOG,UAAUnQ,IAAI,qBAE1B1D,KAAK2B,UAAY,sBAEjB3B,KAAK2B,WAAa,4EAClB3B,KAAK2B,WAAa3B,KAAKw3B,QAAQnf,OAAOrY,KAAKy3B,QAAQ9U,KAAK,QAExD3iB,KAAK2B,WAAa,kIF3BV+1B,IACZP,EAAS11B,aGNAk2B,UAAiB53B,cAGd8vB,GACRvuB,QAJDtB,KACK43B,SAAmB,KAKvB53B,KAAKG,YAAY,QACjBH,KAAKG,YAAY,aAEjBtD,SAASgN,iBAAiB,YAAa7M,IACnCA,EAAE+yB,iBACF/yB,EAAEyB,qBAGN5B,SAASgN,iBAAiB,WAAY7M,IAClCA,EAAE+yB,iBACF/yB,EAAEyB,qBAGN5B,SAASgN,iBAAiB,aAAc7M,IACpCA,EAAE+yB,iBACF/yB,EAAEyB,kBAEGuB,KAAK43B,WACN53B,KAAK43B,SAAW/H,EAAQtyB,WAG5BI,EAAYkyB,GACZA,EAAQtyB,UAAY,YACpBsyB,EAAQ1yB,MAAMg3B,OAAS,OAEvB1zB,QAAQS,IAAIlB,KAAK43B,aAGrB/6B,SAASgN,iBAAiB,aAAc7M,IACpCA,EAAE+yB,iBACF/yB,EAAEyB,kBAEEzB,EAAE66B,SAAWhI,IACbryB,EAAYqyB,GACZA,EAAQtyB,UAAYyC,KAAK43B,SACzB/H,EAAQ1yB,MAAMg3B,OAAS,GACvBn0B,KAAK43B,SAAW,KAChB53B,KAAKO,UAAU,iBAIvB1D,SAASgN,iBAAiB,QAAS7M,IAC/BA,EAAE+yB,iBACF/yB,EAAEyB,kBAEEzB,EAAE86B,aAAaC,MAAMz5B,QACrB0B,KAAKO,UAAU,OAAQvD,EAAE86B,aAAaC,MAAM,IAGhDv6B,EAAYqyB,GACZA,EAAQtyB,UAAYyC,KAAK43B,SACzB/H,EAAQ1yB,MAAMg3B,OAAS,GACvBn0B,KAAK43B,SAAW,eC1DNI,UAAuBvkB,cAC7BwkB,GACR32B,QACAtB,KAAKuB,UAAUsS,UAAUnQ,IAAI,SAE7B1D,KAAKG,YAAY,UAEb83B,GACAj4B,KAAKc,GAAG,SAAUm3B,GAGtBj4B,KAAKuB,UAAUsI,iBAAiB,SAAO,KACnC7J,KAAKO,UAAU,SAAU,gBCLxB23B,UAA2B92B,cAIxB+2B,GACR72B,QACAtB,KAAK6I,OAAS,IAAIJ,EAAO,CAAEhG,KAAM01B,IACjCn4B,KAAKuB,UAAYvB,KAAK6I,OAAOA,OAC7B7I,KAAKG,YAAY,UAEjBH,KAAKuB,UAAUsI,iBAAiB,SAAO,KACnC,IAAI6e,EAAI,IAAI0P,EAAmBp4B,KAAKoU,UACpCsU,EAAE5nB,GAAG,UAAWsT,IACZpU,KAAKO,UAAU,SAAU6T,MAE7BvX,SAASw7B,eAAe,aAAaz2B,YAAY8mB,EAAEnnB,WACnDmnB,EAAEjnB,UAIC2S,aAASA,GACC,OAAbA,IACApU,KAAKwU,UAAYJ,EACjBJ,EAAOiB,sBAAsBb,EAAUpU,KAAK6I,SAIzCuL,eACP,OAAOpU,KAAKwU,iBAId4jB,UAA2BJ,cAQjBrjB,GACRrT,QATRtB,KAMYuuB,OAAiB,EAIrBvuB,KAAKuB,UAAUsS,UAAUnQ,IAAI,gBAC7B1D,KAAK2U,aAAeA,EAEpB,IAAI2jB,EAAU77B,EAAc,MAAO,WAC/B87B,EAAW97B,EAAc,MAAO,YAGpCuD,KAAKw4B,cAAgB,IAAI/vB,EAAO,CAAEhG,KAAM,IAAIE,EAAM,OAClD3C,KAAKw4B,cAAc3vB,OAAOgL,UAAUnQ,IAAI,WACxCsQ,EAAOiB,sBAAsBjV,KAAK2U,aAAc3U,KAAKw4B,eACrDF,EAAQ12B,YAAY5B,KAAKw4B,cAAc3vB,QAGvC,IAAI4vB,EAAYh8B,EAAc,MAAO,OAEjCi8B,EAAcj8B,EAAc,OAAQ,SACxCi8B,EAAYn7B,UAAY,UACxBk7B,EAAU72B,YAAY82B,GAEtB,IAAIC,EAAel8B,EAAc,UACjCk8B,EAAaj1B,IAAItG,EAAoB,gBAAiB,KACtDu3B,EAAchF,SAASiJ,cAAc17B,SAAS27B,IAC1CF,EAAaj1B,IAAItG,EAAoBy7B,EAAO3kB,KAAMrU,KAAK42B,UAAUoC,QAErEJ,EAAU72B,YAAY+2B,GAEtB,IAAI1V,EAAOxmB,EAAc,UACzBwmB,EAAK1lB,UAAY,mBACjB0lB,EAAKpZ,iBAAiB,SAAO,KACrB8uB,EAAar7B,QACb0C,KAAK2U,aAAe9U,KAAKC,MAAM64B,EAAar7B,OAC5C0C,KAAK84B,eAAeC,MAAQ/4B,KAAK2U,aAAaP,SAC9CpU,KAAKuuB,OAAQ,MAGrBkK,EAAU72B,YAAYqhB,GAEtB,IAAI+V,EAAYv8B,EAAc,UAC9Bu8B,EAAUz7B,UAAY,wBACtBy7B,EAAUnvB,iBAAiB,SAAO,KAC1B8uB,EAAar7B,OACbq3B,EAAchF,SAASiJ,cAAcD,EAAaM,cAAgB,GAAKj5B,KAAK2U,aAC5EgkB,EAAaO,gBAAgB,GAAG57B,MAAQuC,KAAK42B,UAAUz2B,KAAK2U,cAC5DggB,EAAcwE,gBAEdC,MAAM,0DAGdX,EAAU72B,YAAYo3B,GAEtB,IAAIK,EAAU58B,EAAc,UAC5B48B,EAAQ97B,UAAY,qBACpB87B,EAAQxvB,iBAAiB,SAAO,KAC5B,IAAIqK,EAAOolB,OAAO,wBACL,OAATplB,IAEQA,EAGJygB,EAAchF,SAASiJ,cAAcW,MAAKV,GAAUA,EAAO3kB,KAAKuS,gBAAkBvS,EAAKuS,gBACvF2S,MAAM,gCAENp5B,KAAK2U,aAAaT,KAAOA,EACzBygB,EAAchF,SAASiJ,cAAcr6B,KAAKyB,KAAK2U,cAC/CggB,EAAcwE,eACdR,EAAaj1B,IAAItG,EAAoB8W,EAAMrU,KAAK42B,UAAUz2B,KAAK2U,gBAC/DgkB,EAAaM,cAAgBtE,EAAchF,SAASiJ,cAAct6B,QATtE86B,MAAM,6BAadX,EAAU72B,YAAYy3B,GAEtB,IAAIG,EAAe/8B,EAAc,UACjC+8B,EAAaj8B,UAAY,qBACzBi8B,EAAa3vB,iBAAiB,SAAO,KACjC,GAAI8uB,EAAar7B,OAASm8B,QAAQ,gDAAiD,CAC/E,IAAI17B,EAAQ46B,EAAaM,cAAgB,EACzCtE,EAAchF,SAASiJ,cAAc36B,OAAOF,EAAO,GACnD42B,EAAcwE,eACdR,EAAalL,OAAO1vB,EAAQ,OAGpC06B,EAAU72B,YAAY43B,GAEtBjB,EAAS32B,YAAY62B,GAGrBz4B,KAAK84B,eAAiB,IAAIY,EAAe,IAAI/2B,EAAM,IAAK,IAAK3C,KAAK2U,cAClE3U,KAAK84B,eAAeh4B,GAAG,UAAWi4B,IAC9B/4B,KAAK2U,aAAaP,SAAW2kB,KAEjC/4B,KAAK84B,eAAeh4B,GAAG,eAAgBmM,IACnCjN,KAAK25B,YAAYr8B,MAAQ2P,KAE7BsrB,EAAS32B,YAAY5B,KAAK84B,eAAev3B,WAGzCvB,KAAK25B,YAAcl9B,EAAc,SACjCuD,KAAK25B,YAAYj9B,KAAO,QACxBsD,KAAK25B,YAAYr8B,MAAQ0C,KAAK84B,eAAec,iBAC7C55B,KAAK25B,YAAY9vB,iBAAiB,UAAQ,KACtC7J,KAAK84B,eAAec,iBAAmB55B,KAAK25B,YAAYr8B,SAE5Di7B,EAAS32B,YAAY5B,KAAK25B,aAG1B,IAAIE,EAAYp9B,EAAc,MAAO,OAEjCiH,EAAMjH,EAAc,UACxBiH,EAAInG,UAAY,WAChBmG,EAAImG,iBAAiB,SAAO,KACxB7J,KAAK84B,eAAegB,aAExBD,EAAUj4B,YAAY8B,GAEtB,IAAI+pB,EAAShxB,EAAc,UAC3BgxB,EAAOlwB,UAAY,cACnBkwB,EAAO5jB,iBAAiB,SAAO,KAC3B7J,KAAK84B,eAAeiB,gBAExBF,EAAUj4B,YAAY6rB,GAEtB,IAAIuM,EAAcv9B,EAAc,UAChCu9B,EAAYz8B,UAAY,yBACxBy8B,EAAYnwB,iBAAiB,SAAO,KAChC7J,KAAK84B,eAAemB,qBAExBJ,EAAUj4B,YAAYo4B,GACtBzB,EAAS32B,YAAYi4B,GAGrB75B,KAAKk6B,YAAc,IAAI7E,EAAY,EAAG,IAAK,EAAG,QAAS,eACvDr1B,KAAKk6B,YAAY58B,MAAQqX,EAAaR,MAEtCnU,KAAKk6B,YAAYp5B,GAAG,SAAO,KACvBd,KAAK2U,aAAaR,MAAQnU,KAAKk6B,YAAY58B,MAC3C0C,KAAKuuB,OAAQ,KAEjBgK,EAAS32B,YAAY5B,KAAKk6B,YAAY34B,WAGtC,IAAI44B,EAAU19B,EAAc,MAAO,OAE/B29B,EAAK39B,EAAc,SAAU,MACjC29B,EAAG78B,UAAY,KACf68B,EAAGvwB,iBAAiB,SAAO,KACvB7J,KAAKO,UAAU,SAAUP,KAAK2U,cAC9B3U,KAAK0B,UAGT,IAAI24B,EAAS59B,EAAc,SAAU,UACrC49B,EAAO98B,UAAY,SACnB88B,EAAOxwB,iBAAiB,SAAO,KAC3B7J,KAAK0B,UAGTy4B,EAAQv4B,YAAYy4B,GACpBF,EAAQv4B,YAAYw4B,GACpB7B,EAAS32B,YAAYu4B,GAGrBn6B,KAAK4B,YACD02B,EACAC,GAGJv4B,KAAK4uB,QAGFjb,UACE3T,KAAK84B,eAAewB,YACrBt6B,KAAK0B,OAILktB,SACA5uB,KAAK84B,eAAevK,OAASvuB,KAAKuuB,SAClCva,EAAOiB,sBAAsBjV,KAAK2U,aAAc3U,KAAKw4B,eACrDx4B,KAAK84B,eAAepZ,OACpB1f,KAAKuuB,OAAQ,GAGjBI,uBAAqB,IAAO3uB,KAAK4uB,iBAInC8K,UAAuBt4B,cAUbqB,EAAa2R,GACrB9S,MAAM,kBAXdtB,KAEYu6B,aAA8B,GAF1Cv6B,KAOWuuB,OAAiB,EAP5BvuB,KAQYw6B,OAAyB,GAK7Bx6B,KAAKG,YAAY,UACjBH,KAAKG,YAAY,qBAEjBH,KAAKy6B,eAAiB,IAAIhyB,EAAO,MAAEhG,IAEnC5F,SAASgN,iBAAiB,WAAS,KAC/BoI,YAAU,IAAOjS,KAAK06B,SAAW,MAAM,MAG3C79B,SAASgN,iBAAiB,YAAU,KAChCoI,YAAU,IAAOjS,KAAK06B,SAAW,MAAM,MAG3C79B,SAASgN,iBAAiB,YAAa7J,KAAK26B,KAAKpwB,KAAKvK,OACtDnD,SAASgN,iBAAiB,YAAa7J,KAAK26B,KAAKpwB,KAAKvK,OAEtDA,KAAK4B,YAAY5B,KAAKy6B,eAAe5xB,QACrC7I,KAAK+4B,MAAQ3kB,EAASA,SAASwmB,MAAI,CAAE/kB,EAAG0X,IAAM1X,EAAEjP,IAAM2mB,EAAE3mB,MAGjDmyB,UAAMA,GACb/4B,KAAKw6B,OAASzB,EACd/4B,KAAKu6B,aAAar9B,SAASO,IACvBuC,KAAKoC,YAAY3E,MAErBuC,KAAKu6B,aAAev6B,KAAK+4B,MAAMrW,IAAI1iB,KAAK66B,WAAWtwB,KAAKvK,OACxDA,KAAK86B,gBAAgB96B,KAAKu6B,aAAa,IACvCv6B,KAAK4B,eAAe5B,KAAKu6B,cAGlBxB,YACP,OAAO/4B,KAAKw6B,OAGJ52B,YACR,OAAO5D,KAAKy6B,eAAe72B,MAGnBC,aACR,OAAO7D,KAAKy6B,eAAe52B,OAGnBk3B,iBACR,OAAO/6B,KAAK4D,MAAQ5D,KAAK6D,OAGrBm3B,eAAeC,EAA0BC,GAC7Cl7B,KAAK06B,SAAWO,EAChBj7B,KAAKm7B,YAAcD,EACnBl7B,KAAKo7B,eAAiBtvB,SAASmvB,EAAY99B,MAAMyF,MACjD5C,KAAK86B,gBAAgBG,GAGjBH,gBAAgBG,GAChBj7B,KAAKq7B,cACLr7B,KAAKq7B,YAAYxnB,UAAU4Z,OAAO,WAClCztB,KAAKq7B,YAAYl+B,MAAMg3B,OAAS,KAEpCn0B,KAAKq7B,YAAcJ,EACnBj7B,KAAKq7B,YAAYxnB,UAAUnQ,IAAI,WAC/B1D,KAAKq7B,YAAYl+B,MAAMg3B,OAAS,IAChCn0B,KAAKO,UAAU,cAAeP,KAAKq7B,YAAY7d,aAAa,UAGxDqd,WAAWS,GACf,IAAIr4B,EAAIjD,KAAKy6B,eAAeh4B,KAAKyB,EAAIlE,KAAKy6B,eAAeh4B,KAAK0B,EAC1Do3B,EAAO9+B,EAAc,MAAO,QAUhC,OATA8+B,EAAKp+B,MAAMyF,MAAQK,EAAIq4B,EAAK10B,KAAKjH,WAAa,KAC9C47B,EAAK3N,aAAa,QAAS0N,EAAKruB,OAChCsuB,EAAKp+B,MAAMq+B,gBAAkBF,EAAKruB,MAClCsuB,EAAK1xB,iBAAiB,aAAc7M,IAChCgD,KAAKg7B,eAAeO,EAAMv+B,EAAEk+B,YAEhCK,EAAK1xB,iBAAiB,cAAe7M,IACjCgD,KAAKg7B,eAAeO,EAAMv+B,EAAEy+B,QAAQ,GAAGP,YAEpCK,EAGA3B,qBAAiB3sB,GACpBjN,KAAKq7B,cACLr7B,KAAKq7B,YAAYzN,aAAa,QAAS3gB,GACvCjN,KAAKq7B,YAAYl+B,MAAMq+B,gBAAkBvuB,EACzCjN,KAAKyuB,UAIFmL,uBACP,OAAO55B,KAAKq7B,YAAY7d,aAAa,SAG9B8c,iBACP,QAASt6B,KAAK06B,SAGVC,KAAK39B,GACT,GAAIgD,KAAK06B,SAAU,CACf,IAAIQ,EAAUl+B,aAAamP,WAAanP,EAAEk+B,QAAUl+B,EAAEy+B,QAAQ,GAAGP,QAC7Dl+B,aAAa0+B,YACb1+B,EAAE+yB,iBAEN,IAAIzsB,EAAOtD,KAAKm7B,YAAcD,EAC1Bh3B,EAAIlE,KAAKo7B,eAAiB93B,EAC9BY,EAAI2C,KAAKwB,IAAI,EAAGnE,GAChBA,EAAI2C,KAAKC,IAAI9G,KAAK+6B,WAAY72B,GAC9BlE,KAAK06B,SAASv9B,MAAMyF,KAAOsB,EAAEvE,WAAa,KAC1CK,KAAKyuB,UAILA,SACJzuB,KAAKw6B,OAASx6B,KAAKu6B,aAAa7X,KAAK6Y,IAC1B,CACH30B,IAAKkF,SAASyvB,EAAKp+B,MAAMyF,MAAS5C,KAAK+6B,WACvC9tB,MAAOsuB,EAAK/d,aAAa,aAIjCxd,KAAKuuB,OAAQ,EAEbvuB,KAAKO,UAAU,SAAUP,KAAK+4B,OAG3BrZ,OACH1L,EAAOiB,sBAAsB,CAAEd,MAAO,IAAKC,SAAUpU,KAAK+4B,MAAO7kB,KAAM,IAAMlU,KAAKy6B,gBAClFz6B,KAAKuuB,OAAQ,EAGVuL,UAEH95B,KAAKu6B,aAAaK,MAAI,CAAE/kB,EAAG0X,IAAMzhB,SAAS+J,EAAE1Y,MAAMyF,MAAQkJ,SAASyhB,EAAEpwB,MAAMyF,QAG3E,IAAIumB,EAAMnpB,KAAKq7B,aAAer7B,KAAKu6B,aAAa,GAC5CrD,EAAKl3B,KAAKu6B,aAAav8B,QAAQmrB,GAG/BllB,EAASizB,EAAKl3B,KAAKu6B,aAAaj8B,OAAS,EAAI,GAAI,EACjDq9B,EAAU37B,KAAK66B,WAAW,CAC1B5tB,MAAO,QACPrG,KAAMkF,SAASqd,EAAIhsB,MAAMyF,MAAQkJ,SAAS9L,KAAKu6B,aAAarD,EAAKjzB,GAAQ9G,MAAMyF,OAAS,EAAK5C,KAAK+6B,aAGtG/6B,KAAKu6B,aAAah8B,KAAKo9B,GACvB37B,KAAK4B,YAAY+5B,GACjB37B,KAAK86B,gBAAgBa,GACrB37B,KAAKyuB,SAGFsL,aAEH,GAAiC,IAA7B/5B,KAAKu6B,aAAaj8B,OAClB,OAIJ0B,KAAKu6B,aAAaK,MAAI,CAAE/kB,EAAG0X,IAAMzhB,SAAS+J,EAAE1Y,MAAMyF,MAAQkJ,SAASyhB,EAAEpwB,MAAMyF,QAG3E,IAAIg5B,EAAW57B,KAAKq7B,c/BhMEx9B,E+BgMwBmC,KAAKu6B,c/B/L1C18B,EAAMS,OAAS,OADFT,E+BkMtBD,EAAaoC,KAAKu6B,aAAcqB,GAChC57B,KAAKoC,YAAYw5B,GACjB57B,KAAK86B,gBAAgB96B,KAAKu6B,aAAa,IACvCv6B,KAAKyuB,SAGFwL,kBAEHj6B,KAAKu6B,aAAaK,MAAI,CAAE/kB,EAAG0X,IAAMzhB,SAAS+J,EAAE1Y,MAAMyF,MAAQkJ,SAASyhB,EAAEpwB,MAAMyF,QAE3E5C,KAAKu6B,aAAar9B,SAAO,CAAEq+B,EAAMl9B,KAC7Bk9B,EAAKp+B,MAAMyF,MAASvE,GAAK2B,KAAKu6B,aAAaj8B,OAAS,GAAO0B,KAAK+6B,YAAap7B,WAAa,QAG9FK,KAAKyuB,gBCpYAkG,UAAsBvzB,cAmCnBG,GACRD,MAAMC,GApCPvB,KAeK67B,YAAsB,EAf3B77B,KAgBK87B,aAAuB,EAsB3B97B,KAAK+7B,eACL/nB,EAAOvR,KAAOkyB,EAAchF,SAASqM,WACrCv7B,QAAQS,IAAIyzB,EAAchF,SAASqM,YACnCh8B,KAAKi8B,gBACLj8B,KAAKirB,SAAW,IAAImE,EAASuF,EAAchF,UAC3C3vB,KAAK80B,SAAW,IAAID,EAAS70B,KAAKirB,UAElCjrB,KAAK4B,YAAY5B,KAAKirB,SAAUjrB,KAAK80B,UAErCH,EAAchF,SAASuM,aAAah/B,SAAQuF,IACxCzC,KAAK80B,SAASI,eAAe,IAAIvyB,EAAMF,OAG3CzC,KAAK80B,SAASh0B,GAAG,mBAAoBk0B,IACjCL,EAAchF,SAASuM,aAAelH,EACtCL,EAAcwE,kBAGlBvvB,OAAOC,iBAAiB,SAAU7J,KAAKm8B,aAAa5xB,KAAKvK,OACzDA,KAAK80B,SAASh0B,GAAG,aAAcd,KAAKm8B,aAAa5xB,KAAKvK,OACtDmB,EAAaL,GAAG,SAAUd,KAAKm8B,aAAa5xB,KAAKvK,OAEjDA,KAAKirB,SAASnqB,GAAG,mBAAoBmxB,IAC7BA,EACAjyB,KAAKo8B,gBAAgBvoB,UAAUnQ,IAAI,WAEnC1D,KAAKo8B,gBAAgBvoB,UAAU4Z,OAAO,WAG1CkH,EAAchF,SAAS7B,UAAYmE,EACnC0C,EAAcwE,kBAElBn5B,KAAKm8B,eAELn8B,KAAKq8B,YACD5/B,EAAc,QAAS,cAE3BuD,KAAKq8B,YAAY9+B,UAAY,YAC7ByC,KAAKq8B,YAAYl/B,MAAMktB,OAAS,UAChCrqB,KAAKq8B,YAAYzO,aAAa,MAAO,aAErC,IAAI0O,EAAW,IAAI3E,EAAS33B,KAAKq8B,aACjCC,EAASx7B,GAAG,QAAQ6Q,IAChB3R,KAAKu8B,SAAS5qB,MAElB2qB,EAASx7B,GAAG,aAAW,KACdd,KAAK87B,aACNn+B,EAAYqC,KAAKq8B,gBAIzBx/B,SAASizB,KAAKluB,YAAY5B,KAAKq8B,cAER,ehCvH3B,IAAI/V,EAAK1c,OAAO2c,UAAUC,UAgBtBgW,EAAOlW,EAAGtoB,QAAQ,SACtB,GAAIw+B,EAAO,EAEP,OAAO1wB,SAASwa,EAAG8L,UAAUoK,EAAO,EAAGlW,EAAGtoB,QAAQ,IAAKw+B,IAAQ,IAInE,GADclW,EAAGtoB,QAAQ,YACX,EAAG,CAEb,IAAIy+B,EAAKnW,EAAGtoB,QAAQ,OACpB,OAAO8N,SAASwa,EAAG8L,UAAUqK,EAAK,EAAGnW,EAAGtoB,QAAQ,IAAKy+B,IAAM,IAG/D,IAAIC,EAAOpW,EAAGtoB,QAAQ,SACtB,OAAI0+B,EAAO,GAEA5wB,SAASwa,EAAG8L,UAAUsK,EAAO,EAAGpW,EAAGtoB,QAAQ,IAAK0+B,IAAQ,IgCuF3DC,IAA6BhI,EAAchF,SAASiN,cACpDhzB,OAAOwvB,MACH,gXAGJzE,EAAchF,SAASiN,aAAc,EACrCjI,EAAcwE,gBAIf0D,aAAalrB,GAChB3R,KAAKirB,SAASiH,iBAAiBvgB,yBAI/B6kB,EAAQl2B,IAAI,WAAYq0B,EAAchF,UAGlCoM,eACJ,IAAIrmB,EAAI8gB,EAAQ71B,IAAI,WAAY,IAEhC,IAAK,IAAImlB,KAAO6O,EAAchF,SACtBja,EAAEwI,eAAe4H,IACF,OAAXpQ,EAAEoQ,KACF6O,EAAchF,SAAS7J,GAAOpQ,EAAEoQ,IAK5C6O,EAAcwE,eAGV8C,gBACJj8B,KAAK88B,KAAOrgC,EAAc,MAAO,QAEjC,IAAI8/B,EACA9/B,EAAc,QAAS,kBAE3B8/B,EAASv9B,GAAK,YACdu9B,EAAS7/B,KAAO,OAChB6/B,EAAS1yB,iBAAiB,UAAU7M,IAC5Bu/B,EAASxE,OAASwE,EAASxE,MAAM,IACjC/3B,KAAKu8B,SAASA,EAASxE,MAAM,OAIrC/3B,KAAK+8B,cAAgBtgC,EAAc,QAAS,uBAC5CuD,KAAK+8B,cAAcx/B,UAAY,eAC/ByC,KAAK+8B,cAAcn7B,YAAY26B,GAC/Bv8B,KAAK88B,KAAKl7B,YAAY5B,KAAK+8B,eAE3B/8B,KAAKg9B,iBAAmBvgC,EAAc,SAAU,kBAChDuD,KAAKg9B,iBAAiBpP,aAAa,SAAU,iBAC7C5tB,KAAKg9B,iBAAiBpP,aAAa,WAAY,KAC7C5tB,KAAGg9B,iBAAiBz/B,UAAYyC,KAAKg9B,iBAAiBxf,aACpD,UAEJxd,KAAKg9B,iBAAiBnzB,iBAClB,QACA7J,KAAKi9B,WAAW1yB,KAAKvK,OAEzBA,KAAK88B,KAAKl7B,YAAY5B,KAAKg9B,kBAE3B,IAAI1sB,EAAS7T,EAAc,SAAU,kBACjCygC,EAASzgC,EAAc,SAAU,kBACrC6T,EAAO/S,UAAY,SACnB2/B,EAAO3/B,UAAY,SACnB+S,EAAOuD,UAAUspB,OAAO,UAAkD,WAAvCxI,EAAchF,SAASc,aAC1DyM,EAAOrpB,UAAUspB,OAAO,UAAkD,WAAvCxI,EAAchF,SAASc,aAC1DngB,EAAOzG,iBAAiB,SAAO,KAC3ByG,EAAOuD,UAAUnQ,IAAI,WACrBw5B,EAAOrpB,UAAU4Z,OAAO,WACxBkH,EAAchF,SAASc,YAAc,SACrCzwB,KAAKirB,UAAYjrB,KAAKirB,SAASwD,OAAO,iBACtCkG,EAAcwE,kBAElB+D,EAAOrzB,iBAAiB,SAAO,KAC3ByG,EAAOuD,UAAU4Z,OAAO,WACxByP,EAAOrpB,UAAUnQ,IAAI,WACrBixB,EAAchF,SAASc,YAAc,SACrCzwB,KAAKirB,UAAYjrB,KAAKirB,SAASwD,OAAO,iBACtCkG,EAAcwE,kBAElBn5B,KAAK88B,KAAKl7B,YAAY0O,GACtBtQ,KAAK88B,KAAKl7B,YAAYs7B,GAGtB,IAAIE,EAAU,IAAI/H,EACd,EACA,EACA,IACA,oBACA,qBAEJ+H,EAAQt8B,GAAG,QAASd,KAAKq9B,gBAAgB9yB,KAAKvK,OAC9Co9B,EAAQt8B,GAAG,UAAQ,IAAQ6zB,EAAcwE,iBACzCiE,EAAQ9/B,MAAQ,EAAIq3B,EAAchF,SAASa,YAC3CxwB,KAAK88B,KAAKl7B,YAAYw7B,EAAQ77B,WAE9B,IAAI+7B,EAAU7gC,EAAc,MAAO,gBAC/B8gC,EAAY9gC,EAAc,MAAO,aACrC8gC,EAAUhgC,UAAY,QACtB+/B,EAAQ17B,YAAY27B,GACpB,IAAIhM,EAAU90B,EAAc,SAAU,WACtC80B,EAAQh0B,UAAY,IACpBg0B,EAAQ1nB,iBAAiB,SAAO,IAAQ7J,KAAKirB,SAASsG,YACtD,IAAID,EAAS70B,EAAc,SAAU,UACrC60B,EAAO/zB,UAAY,IACnB+zB,EAAOznB,iBAAiB,SAAO,IAAQ7J,KAAKirB,SAASqG,WACrD,IAAIf,EAAU9zB,EAAc,SAAU,WACtC8zB,EAAQhzB,UAAY,MACpBgzB,EAAQ1mB,iBAAiB,SAAO,IAAQ7J,KAAKirB,SAASsF,YACtD+M,EAAQ17B,YAAY2uB,GACpB+M,EAAQ17B,YAAY0vB,GACpBgM,EAAQ17B,YAAY2vB,GACpBvxB,KAAK88B,KAAKl7B,YAAY07B,GAEtB,IAAIE,EAAU,IAAInI,GAAY,IAAM,IAAK,EAAG,WAAY,iBACxDmI,EAAQ18B,GAAG,SAAU8wB,IACb/qB,KAAKE,IAAI6qB,EAAM,KAAO,EACtBA,EAAM,GACC/qB,KAAKE,IAAI6qB,EAAM,KAAO,EAC7BA,GAAM,GACC/qB,KAAKE,IAAI6qB,IAAQ,EACxBA,EAAM,EACC/qB,KAAKE,IAAI6qB,EAAM,MAAQ,EAC9BA,EAAM,IACC/qB,KAAKE,IAAI6qB,EAAM,MAAQ,IAC9BA,GAAM,KAGV5xB,KAAKy9B,YAAY7L,MAErB4L,EAAQlgC,MAAQ,EAChB0C,KAAK88B,KAAKl7B,YAAY47B,EAAQj8B,WAE9BvB,KAAK09B,YAAcjhC,EAAc,SAAU,aAC3CuD,KAAK09B,YAAYngC,UAAY,cAC7ByC,KAAK09B,YAAY7zB,iBACb,QACA7J,KAAKwyB,eAAejoB,KAAKvK,OAE7BA,KAAK88B,KAAKl7B,YAAY5B,KAAK09B,aAE3B19B,KAAK29B,YAAclhC,EAAc,SAAU,aAC3CuD,KAAK29B,YAAYpgC,UAAY,gBAC7ByC,KAAK29B,YAAY9zB,iBAAiB,QAAS7J,KAAK0yB,aAAanoB,KAAKvK,OAClEA,KAAK88B,KAAKl7B,YAAY5B,KAAK29B,aAE3B39B,KAAKo8B,gBAAkB3/B,EAAc,SAAU,aAC/CuD,KAAKo8B,gBAAgB7+B,UAAY,YACjCyC,KAAKo8B,gBAAgBvyB,iBAAiB,SAAO,KACzC7J,KAAKirB,SAAS6C,WAAa9tB,KAAKirB,SAAS6C,aAEzC6G,EAAchF,SAAS7B,WACvB9tB,KAAKo8B,gBAAgBvoB,UAAUnQ,IAAI,WAEvC1D,KAAK88B,KAAKl7B,YAAY5B,KAAKo8B,iBAE3Bp8B,KAAK49B,kBAAoBnhC,EAAc,SAAU,aACjDuD,KAAK49B,kBAAkBrgC,UAAY,eACnCyC,KAAK49B,kBAAkB/zB,iBACnB,QACA7J,KAAK69B,kBAAkBtzB,KAAKvK,MAAM,IAEtCA,KAAK69B,mBAAkB,GACvB79B,KAAK88B,KAAKl7B,YAAY5B,KAAK49B,mBAE3B,IAAIE,EAAarhC,EAAc,SAAU,aACzCqhC,EAAWvgC,UAAY,mBACvBugC,EAAWj0B,iBAAiB,QAAS7J,KAAK+9B,iBAAiBxzB,KAAKvK,OAChEA,KAAK88B,KAAKl7B,YAAYk8B,GAEtB99B,KAAKg+B,aAAevhC,EAAc,SAAU,aAC5CuD,KAAKg+B,aAAazgC,UAAY,aAC9ByC,KAAKg+B,aAAan0B,iBACd,QACA7J,KAAKi+B,aAAa1zB,KAAKvK,MAAM,IAEjCA,KAAKi+B,cAAa,GAClBj+B,KAAK88B,KAAKl7B,YAAY5B,KAAKg+B,cAE3B,IAAInL,EAAiBp2B,EAAc,SAAU,aAC7Co2B,EAAet1B,UAAY,SAC3Bs1B,EAAehpB,iBAAiB,QAAS7J,KAAK6yB,eAAetoB,KAAKvK,OAClEA,KAAK88B,KAAKl7B,YAAYixB,GAEtB,IAAIC,EAAcr2B,EAAc,SAAU,aAC1Cq2B,EAAYv1B,UAAY,WACxBu1B,EAAYjpB,iBAAiB,QAAS7J,KAAK8yB,YAAYvoB,KAAKvK,OAC5DA,KAAK88B,KAAKl7B,YAAYkxB,GAEtB,IAAIoL,EAAOzhC,EAAc,SAAU,QACnCyhC,EAAK3gC,UAAY,4BACjB2gC,EAAKr0B,iBAAiB,QAAS7J,KAAKm+B,iBAAiB5zB,KAAKvK,OAC1DA,KAAK88B,KAAKl7B,YAAYs8B,GACtB/8B,EAAaL,GAAG,oBAAkB,KAC1B6zB,EAAchF,SAASgE,WACvBuK,EAAKrqB,UAAUnQ,IAAI,WAEnBw6B,EAAKrqB,UAAU4Z,OAAO,cAG9BtsB,EAAaZ,UAAU,oBAGvBP,KAAKo+B,aAAkC3hC,EAAc,SAAU,QAC/DuD,KAAKo+B,aAAap/B,GAAK,eACvBgB,KAAK88B,KAAKl7B,YAAY5B,KAAKo+B,cAE3B,IAAIC,EAAc,KACd,IAAI/rB,EAAMtS,KAAKo+B,aAAa11B,QAAQpK,OACpC,IAAK,IAAID,EAAI,EAAGA,EAAIiU,EAAKjU,IACrB2B,KAAKo+B,aAAa11B,QAAQ+kB,OAAO,GAGrCztB,KAAKo+B,aAAa16B,IAAItG,EAAoB,YAAa,SACvD4C,KAAKo+B,aAAa16B,IAAItG,EAAoB,eAAgB,UAC1Du3B,EAAchF,SAASiJ,cAAc17B,SAAS27B,IAC1C74B,KAAKo+B,aAAa16B,IAAItG,EAAoBy7B,EAAO3kB,KAAMrU,KAAK42B,UAAUoC,QAE1E74B,KAAKo+B,aAAa16B,IAAItG,EAAoB,yBAA0B,cAGxEihC,IAEA,IAAIC,EAAkB7hC,EAAc,QAAS,mBAC7C6hC,EAAgB5hC,KAAO,QACvB4hC,EAAgBhhC,MAAQ0W,EAAO/G,MAC/BqxB,EAAgBz0B,iBAAiB,UAAQ,KACrCmK,EAAO/G,MAAQqxB,EAAgBhhC,SAEnCE,EAAY8gC,GACZt+B,KAAK88B,KAAKl7B,YAAY08B,GAEtB,IAAIC,EAAqB,IAAIrG,EAAmB,IAAIv1B,EAAM,KAC1D47B,EAAmBnqB,SAAWJ,EAAOI,SACrCmqB,EAAmBh9B,UAAU5E,UAAY,kBACzC4hC,EAAmBz9B,GAAG,UAAW6T,IAC7B4pB,EAAmBnqB,SAAWO,EAC9BX,EAAOI,SAAWO,EAClB0pB,IACAr+B,KAAKo+B,aAAanF,cAAgBj5B,KAAKo+B,aAAa11B,QAAQpK,OAAS,KAEzEigC,EAAmB78B,OACnB1B,KAAK88B,KAAKl7B,YAAY28B,EAAmBh9B,WAEzCvB,KAAKo+B,aAAav0B,iBAAiB,UAAQ,KACP,UAA5B7J,KAAKo+B,aAAa9gC,OAClBK,EAAY2gC,GACZC,EAAmB78B,OACnB1B,KAAKo+B,aAAavqB,UAAUnQ,IAAI,QAChCsQ,EAAOtX,KAAO,SACqB,aAA5BsD,KAAKo+B,aAAa9gC,OACzBE,EAAY8gC,GACZC,EAAmB98B,OACnBzB,KAAKo+B,aAAavqB,UAAUnQ,IAAI,QAChCsQ,EAAOtX,KAAO,YACqB,SAA5BsD,KAAKo+B,aAAa9gC,OACzBE,EAAY8gC,GACZC,EAAmB78B,OACnB1B,KAAKo+B,aAAavqB,UAAU4Z,OAAO,QACnCzZ,EAAOtX,KAAO,SAEdc,EAAY8gC,GACZC,EAAmB78B,OACnB1B,KAAKo+B,aAAavqB,UAAU4Z,OAAO,QACnCzZ,EAAOtX,KAAO,WACdsX,EAAOI,SAAWvU,KAAKC,MAAME,KAAKo+B,aAAalF,gBAAgB,GAAG57B,OAClEihC,EAAmBnqB,SAAWJ,EAAOI,aAK7C,IAAIoqB,EAAe,IAAInJ,EAAY,EAAG,GAAK,IAAM,cAAe,QAChEmJ,EAAalhC,MAAQ0W,EAAOvR,KAC5B+7B,EAAa19B,GAAG,SAAUxD,IACtB0W,EAAOvR,KAAOnF,KAElBkhC,EAAa19B,GAAG,UAAQ,KACpB6zB,EAAchF,SAASqM,WAAawC,EAAalhC,MACjDq3B,EAAcwE,kBAElBn5B,KAAK88B,KAAKl7B,YAAY48B,EAAaj9B,WAGnC,IAAIqxB,EAAen2B,EAAc,SAAU,8BAC3Cm2B,EAAar1B,UAAY,gBACzBq1B,EAAa/oB,iBAAiB,QAAS7J,KAAK4yB,aAAaroB,KAAKvK,OAC9DA,KAAK88B,KAAKl7B,YAAYgxB,GACtB5yB,KAAK4B,YAAY5B,KAAK88B,MAItB,IAAInU,EAASlsB,EAAc,SAAU,8BACrCksB,EAAOprB,UAAY,gBAEnBorB,EAAO9e,iBAAiB,QAAS7J,KAAK2yB,mBAAmBpoB,KAAKvK,OAC9DA,KAAK88B,KAAKl7B,YAAY+mB,GAEtB3oB,KAAK4B,YAAY5B,KAAK88B,MAGlBtK,iBACJxyB,KAAKirB,SAASuH,iBAGVE,eACJ1yB,KAAKirB,SAASyH,eAGVG,iBACJ7yB,KAAKirB,SAAS4H,iBAGVC,cACJ,IAAI2L,EACA,0BACAz+B,KAAKirB,SAASgC,UAAU/oB,EAAEvE,WAC1B,IACAK,KAAKirB,SAASgC,UAAU9oB,EAAExE,WAH1B,6BAMAK,KAAKirB,SAASuB,SAAS5oB,MACvB,IACA5D,KAAKirB,SAASuB,SAAS3oB,OARvB,6GAYA66B,EAAU90B,OAAO0vB,OAAOmF,GAC5B,GAAgB,OAAZC,GAAoBjzB,MAAMK,SAAS4yB,IACnC,OAGJ,IAAIj8B,EAAOqJ,SAAS4yB,GAEhBA,EAAQC,SAAS,MACjBl8B,EAAOzC,KAAKirB,SAASgC,UAAU/oB,GAAKzB,EAAO,KACpCi8B,EAAQC,SAAS,QACxBl8B,EAAOzC,KAAKirB,SAASgC,UAAU9oB,GAAK1B,EAAO,MAG/CzC,KAAKirB,SAAS6H,YAAYrwB,GAGtB07B,mBACJxJ,EAAchF,SAASgE,YAAcgB,EAAchF,SAASgE,WAC5DgB,EAAcwE,eACdh4B,EAAaZ,UAAU,oBAGnB08B,aACAj9B,KAAK67B,YAELjjB,MAAMgmB,KAAK5+B,KAAK88B,KAAKj7B,UAAU3E,SAAQ+E,IAC9BA,EAAM4R,UAAUvR,SAAS,UACZL,EAAO9E,MAAMO,QAAU,WAI7CsC,KAAKg9B,iBAAiBnpB,UAAUnQ,IAAI,WACpC1D,KAAKg9B,iBAAiBz/B,UAAYyC,KAAKg9B,iBAAiBxf,aACpD,cAGJ5E,MAAMgmB,KAAK5+B,KAAK88B,KAAKj7B,UAAU3E,SAAQ+E,IACrBA,EAAO9E,MAAMO,QAAU,MAGzCF,EAAYX,SAAS+L,cAAc,qBACnCpL,EAAYX,SAAS+L,cAAc,sBAEH,UAA5B5I,KAAKo+B,aAAa9gC,MAClBK,EAAYd,SAAS+L,cAAc,qBACA,aAA5B5I,KAAKo+B,aAAa9gC,OACzBK,EAAYd,SAAS+L,cAAc,sBAGvC5I,KAAKg9B,iBAAiBnpB,UAAU4Z,OAAO,WACvCztB,KAAKg9B,iBAAiBz/B,UAAYyC,KAAKg9B,iBAAiBxf,aACpD,WAIRxd,KAAK67B,YAAc77B,KAAK67B,WAGpBlJ,qBACJ3yB,KAAKirB,SAAS0H,qBAEVC,eACJ5yB,KAAKirB,SAAS2H,eAIViL,kBAAkBgB,GAA0B,GAC5CA,IACAlK,EAAchF,SAASe,iBAAmBiE,EAAchF,SAASe,iBAGjEiE,EAAchF,SAASe,gBACvB1wB,KAAK49B,kBAAkB/pB,UAAUnQ,IAAI,WAErC1D,KAAK49B,kBAAkB/pB,UAAU4Z,OAAO,WAG5CztB,KAAKirB,UAAYjrB,KAAKirB,SAASwD,OAAO,gBACtCkG,EAAcwE,eAGV8E,aAAaY,GAA0B,GACvCA,IACAlK,EAAchF,SAASgB,eAAiBgE,EAAchF,SAASgB,eAG/DgE,EAAchF,SAASgB,cACvB3wB,KAAKg+B,aAAanqB,UAAUnQ,IAAI,WAEhC1D,KAAKg+B,aAAanqB,UAAU4Z,OAAO,WAGvCztB,KAAKirB,UAAYjrB,KAAKirB,SAASwD,OAAO,gBACtCkG,EAAcwE,eAGVkE,gBAAgBzgB,GACpB+X,EAAchF,SAASa,YAAc,EAAI5T,EACzC5c,KAAKirB,SAASwD,OAAO,oBAGjBgP,YAAY7L,GAChB5xB,KAAKirB,SAASlc,OAAO6iB,GAGjBmM,mBACJ,IAAIW,EAAU90B,OAAO0vB,OACjB,kHAGJ,GAAgB,OAAZoF,EAEA,OAGJ,IAAIj8B,EAAOqJ,SAAS4yB,GAEhBjzB,MAAMhJ,IAASA,GAAQ,EACvB22B,MAAM,2CAENp5B,KAAK80B,SAASI,eAAe,IAAIvyB,EAAMF,IAIvC85B,SAAS5qB,GACR3R,KAAKirB,SAASiH,iBAAiBvgB,KAI/B3R,KAAK87B,cACN97B,KAAK87B,aAAc,EACnB97B,KAAKyB,OACLjE,EAAYwC,KAAKq8B,aACjBr8B,KAAKq8B,YAAYyC,gBAAgB,OACjC9+B,KAAKq8B,YAAYl/B,MAAMktB,OAAS,IAGE,QAAlCrqB,KAAKirB,SAASc,iBACdvuB,EAAYwC,KAAK09B,aACjBlgC,EAAYwC,KAAK29B,eAEjBhgC,EAAYqC,KAAK09B,aACjB//B,EAAYqC,KAAK29B,cAIhBhJ,EAAchF,SAASoP,mBACvBpK,EAAchF,SAASqP,kBAExBtH,IACA/C,EAAchF,SAASoP,mBAAoB,EAC3CpK,EAAchF,SAASqP,iBAAkB,EACzCrK,EAAcwE,iBAIdgD,eACJ,IAAI8C,EAAYp4B,KAAKwB,IACjBrI,KAAK80B,SAASlxB,MACd5D,KAAK88B,KAAKtwB,wBAAwB5I,OAEtC5D,KAAKirB,SAAS1pB,UAAUpE,MAAMyG,MAAQ,eAAiBq7B,EAAY,MACnEj/B,KAAKirB,SAASoF,mBAEMrwB,KAAK80B,SAASjxB,OAAS7D,KAAK80B,SAASC,SAxkBpDJ,EAkBchF,SAAqB,CACxCuM,aAAc,CAAC,GAAI,GAAI,GAAI,KAC3B1L,YAAa,GACbC,YAAa,SACbC,iBAAiB,EACjB5C,WAAW,EACXiR,mBAAmB,EACnBnC,aAAa,EACboC,iBAAiB,EACjBrO,eAAe,EACfgD,YAAY,EACZqI,WAAY,IACZpD,cAAe5kB,EAAOC,SACtBirB,eAAe,GA8iBvBt1B,OAAOC,iBAAiB,QAAQ,WAC5BokB,EAAWkR,aACLv1B,OAAQiM,EAAI,IAAI8e,EAAc93B,SAASw7B,eAAe,yBNxmB5DlB,EAAW,IAAIC,EACfv6B,SAASizB,KAAKluB,YAAYu1B,EAAS51B,WACnC1E,SAASw7B,eAAe,aAAaxuB,iBAAiB,SAAO,KACzD6tB,OAGJ,IAAI0H,EAAW,IAAIzI,EACnB95B,SAASw7B,eAAe,iBAAiBxuB,iBAAiB,SAAO,KAC7Du1B,EAAS39B,UAEb5E,SAASizB,KAAKluB,YAAYw9B,EAAS79B,WAEnC1E,SAASw7B,eAAe,eAAexuB,iBAAiB,SAAO,KAC3DhN,SAASw7B,eAAe,aAAal7B,MAAM0G,OAAS,OACpDhH,SAAS+L,cAA2B,eAAezL,MAAM0G,OAAS,OAClErG,EAAYX,SAASw7B,eAAe,WACpCl3B,EAAaZ,UAAU,aAG3B,IAAI8+B,EAAa,IAAI9H,EACrB16B,SAASw7B,eAAe,mBAAmBxuB,iBAAiB,SAAO,KAC/Dw1B,EAAW59B,UAEf5E,SAASizB,KAAKluB,YAAYy9B,EAAW99B,WMklBrC+9B","sources":["src/js/util.ts","node_modules/@parcel/runtime-js/lib/helpers/bundle-manifest.js","node_modules/@parcel/runtime-js/lib/runtime-e40c3a846ecac404.js","node_modules/@parcel/runtime-js/lib/runtime-2ce72568efd00bc2.js","src/js/eventclass.ts","src/js/widget.ts","src/js/rectangle.ts","src/js/point.ts","src/js/canvas.ts","src/js/progressbar.ts","src/js/fractionalprogressbar.ts","src/js/dialog.ts","src/js/closabledialog.ts","src/js/borders.ts","src/js/supergif.js","src/js/gif.js","src/js/renderer.ts","src/js/keymanager.ts","src/js/drawer.ts","src/js/cropview.ts","src/js/preview.ts","src/js/previews.ts","src/js/labeledslider.ts","src/js/storage.ts","src/js/whatsnew.ts","src/js/privacypolicy.ts","src/js/footer.ts","src/js/tutorial.ts","src/js/supporters.ts","src/js/dragdrop.ts","src/js/inputdialog.ts","src/js/gradientedit.ts","src/js/avatarcropper.ts"],"sourcesContent":["export type SortFunction<T> = (a: T, b: T) => boolean;\n\nexport function createElement(type: string, className: string = \"\"): HTMLElement {\n    let ret = document.createElement(type);\n    ret.className = className;\n    return ret;\n}\n\n// https://codepen.io/gapcode/pen/vEJNZN\nexport function getIEVersion(): boolean | number {\n    var ua = window.navigator.userAgent;\n\n    // Test values; Uncomment to check result …\n\n    // IE 10\n    // ua = 'Mozilla/5.0 (compatible; MSIE 10.0; Windows NT 6.2; Trident/6.0)';\n\n    // IE 11\n    // ua = 'Mozilla/5.0 (Windows NT 6.3; Trident/7.0; rv:11.0) like Gecko';\n\n    // Edge 12 (Spartan)\n    // ua = 'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/39.0.2171.71 Safari/537.36 Edge/12.0';\n\n    // Edge 13\n    // ua = 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/46.0.2486.0 Safari/537.36 Edge/13.10586';\n\n    var msie = ua.indexOf('MSIE ');\n    if (msie > 0) {\n        // IE 10 or older => return version number\n        return parseInt(ua.substring(msie + 5, ua.indexOf('.', msie)), 10);\n    }\n\n    var trident = ua.indexOf('Trident/');\n    if (trident > 0) {\n        // IE 11 => return version number\n        var rv = ua.indexOf('rv:');\n        return parseInt(ua.substring(rv + 3, ua.indexOf('.', rv)), 10);\n    }\n\n    var edge = ua.indexOf('Edge/');\n    if (edge > 0) {\n        // Edge (IE 12+) => return version number\n        return parseInt(ua.substring(edge + 5, ua.indexOf('.', edge)), 10);\n    }\n\n    // other browser\n    return false;\n}\n\nexport function makePixelated(e: HTMLImageElement | HTMLCanvasElement, pixelate: boolean = true): void {\n    if (pixelate) {\n        let types = [\"optimizeSpeed\", \"crisp-edges\", \"-moz-crisp-edges\", \"-webkit-optimize-contrast\", \"optimize-contrast\", \"pixelated\"];\n        types.forEach(type => e.style[\"image-rendering\"] = type);\n    }\n    else {\n        e.style[\"image-rendering\"] = \"\";\n    }\n}\n\nexport function createOptionElement(text: string, value: string): HTMLOptionElement {\n    let ret = document.createElement(\"option\");\n    ret.innerText = text;\n    ret.value = value;\n\n    return ret;\n}\n\nexport function hideElement(element: HTMLElement): void {\n    element.style.display = \"none\";\n}\n\nexport function showElement(element: HTMLElement): void {\n    element.style.display = \"\";\n}\n\nexport function element_isScrolledTo(element: HTMLElement, allowPartial: boolean = false) {\n    let height = element.getBoundingClientRect().height;\n    let top = element.offsetTop;\n    let bottom = top + height;\n\n    let parent = element.parentElement;\n    let parentHeight = parent.getBoundingClientRect().height;\n    let scrollTop = parent.scrollTop;\n\n    if (allowPartial) {\n        return !(scrollTop + parentHeight <= top || scrollTop >= bottom);\n    }\n    else {\n        return !(scrollTop + parentHeight < bottom || scrollTop > top);\n    }\n}\n\nexport function element_scrollIntoView(element: HTMLElement, align: \"top\" | \"center\" | \"bottom\"): void {\n    let height = element.getBoundingClientRect().height;\n    let top = element.offsetTop;\n    let bottom = top + height;\n\n    let parent = element.parentElement;\n    let parentHeight = parent.getBoundingClientRect().height;\n    let scrollHeight = parent.scrollHeight;\n\n    switch (align) {\n        case \"top\":\n            parent.scrollTop = top;\n            break;\n        case \"center\":\n            parent.scrollTop = parentHeight / 2 - height / 2;\n            break;\n        case \"bottom\":\n            parent.scrollTop = bottom - parentHeight;\n            break;\n    }\n}\n\nexport function element_scrollIntoViewIfNeeded(element: HTMLElement, align: \"top\" | \"center\" | \"bottom\", allowPartial: boolean): void {\n    if (!element_isScrolledTo(element, allowPartial)) {\n        element_scrollIntoView(element, align);\n    }\n}\n\nexport function endsWith(str: string, endsWith: string): boolean {\n    if (endsWith.length > str.length) {\n        return false;\n    }\n\n    return str.substr(str.length - endsWith.length) === endsWith;\n}\n\nexport function emptyFn() { }\n\nexport function array_contains<T>(array: T[], item: T): boolean {\n    return array.indexOf(item) !== -1;\n}\n\nexport function array_remove<T>(array: T[], item: T): { item: T, index: number, existed: boolean } {\n    let index = array.indexOf(item);\n    if (index !== -1) {\n        array.splice(index, 1);\n        return { item, index, existed: true };\n    }\n\n    return { item, index: -1, existed: false };\n}\n\nexport function array_remove_all<T>(array: T[], item: T): { item: T, indexes: number[], existed: boolean } {\n    let indexes = [];\n\n    let index;\n\n    while ((index = array.indexOf(item)) !== -1) {\n        indexes.push(index);\n        array.splice(index, 1);\n    }\n\n    return { item, indexes: indexes, existed: indexes.length > 0 };\n}\n\nexport function array_item_at<T>(array: T[], index: number): T {\n    if (index >= array.length) {\n        return array[index % array.length];\n    }\n    else if (index < 0) {\n        return array[array.length - (-index % array.length)];\n    }\n    else {\n        return array[index];\n    }\n}\n\nexport function array_remove_at<T>(array: T[], index: number): { item: T, index: number, existed: boolean } {\n    if (index !== -1) {\n        return { item: array.splice(index, 1)[0], index, existed: true };\n    }\n\n    return { item: null, index: -1, existed: false };\n}\n\nexport function array_insert<T>(array: T[], item: T, index_or_fn: number | SortFunction<T>): { item: T, index: number } {\n    if (typeof index_or_fn === \"number\") {\n        array.splice(index_or_fn, 0, item);\n        return { item: item, index: index_or_fn };\n    }\n    else {\n        for (let i = 0; i < array.length; i++) {\n            if (index_or_fn(item, array[i])) {\n                array.splice(i, 0, item);\n                return { item: item, index: i };\n            }\n        }\n\n        array.push(item);\n        return { item: item, index: array.length - 1 };\n    }\n\n}\n\nexport function array_copy<T>(array: T[]): T[] {\n    return array.slice();\n}\n\nexport function array_shuffle<T>(array: T[]): void {\n    let i = 0;\n    let j = 0;\n    let temp = null;\n\n    for (i = array.length - 1; i > 0; i -= 1) {\n        j = Math.floor(Math.random() * (i + 1));\n        temp = array[i];\n        array[i] = array[j];\n        array[j] = temp;\n    }\n}\n\nexport function array_insert_random<T>(array: T[], item: T): { index: number, item: T } {\n    let index = Math.floor(Math.random() * (array.length + 1));\n    return array_insert(array, item, index);\n}\n\nexport function array_last<T>(array: T[]): T {\n    return array[array.length - 1];\n}\n\nexport function array_swap<T>(array: T[], a: number | T, b: number | T): void {\n    if (typeof (a) !== \"number\") {\n        a = array.indexOf(a);\n    }\n\n    if (typeof (b) !== \"number\") {\n        b = array.indexOf(b);\n    }\n\n    let temp = array[a];\n    array[a] = array[b];\n    array[b] = temp;\n}\n\nexport function stopProp(e: MouseEvent): void {\n    e.stopPropagation();\n}\n\nexport function getRainbowColor(n: number): string {\n    let r = ~~(255 * (n < 0.5 ? 1 : 1 - 2 * (n - 0.5)));\n    let g = ~~(255 * (n < 0.5 ? 2 * n : 1));\n    let b = ~~(255 * (n > 0.5 ? 2 * (n - 0.5) : 0));\n    let color = \"rgb(\" + r + \",\" + g + \",\" + b + \")\";\n    return color;\n}\n\nexport function getCurrentMs(): number {\n    return Date.now();\n}\n\nexport function sign(n: number): number {\n    return (n > 0 ? 1 : (n < 0 ? -1 : 0));\n}","\"use strict\";\n\nvar mapping = {};\n\nfunction register(pairs) {\n  var keys = Object.keys(pairs);\n\n  for (var i = 0; i < keys.length; i++) {\n    mapping[keys[i]] = pairs[keys[i]];\n  }\n}\n\nfunction resolve(id) {\n  var resolved = mapping[id];\n\n  if (resolved == null) {\n    throw new Error('Could not resolve bundle with id ' + id);\n  }\n\n  return resolved;\n}\n\nmodule.exports.register = register;\nmodule.exports.resolve = resolve;","module.exports = new __parcel__URL__(require('./helpers/bundle-manifest').resolve(\"lebXy\")).toString();","require('./helpers/bundle-manifest').register(JSON.parse(\"{\\\"e4llg\\\":\\\"index.3e6cdede.js\\\",\\\"lebXy\\\":\\\"tut.5ffefec4.png\\\"}\"));","import { array_remove } from \"./util\";\n\nexport class EventClass {\n    private events: Map<string, { fn: Function, id: string }[]> = new Map<string, { fn: Function, id: string }[]>();\n\n    constructor() {\n        // poopie\n    }\n\n    protected createEvent(event: string) {\n        if (!this.events.has(event)) {\n            this.events.set(event, []);\n        }\n    }\n\n    public emitEvent(event: string, ...args: any[]): void {\n        if (!this.events.has(event)) {\n            console.warn(\"event not yet created: \" + event);\n            this.events.set(event, []);\n        }\n\n        this.events.get(event).forEach(o => o.fn(...args));\n    }\n\n    public on(event: string, fn: Function, id: string = \"[unidentified]\") {\n        if (!this.events.has(event)) {\n            console.warn(\"event not yet created: \" + event);\n            this.events.set(event, []);\n        }\n\n        this.events.get(event).push({ fn, id });\n    }\n\n    public once(event: string, fn: Function, id: string = \"[unidentified oneshot]\") {\n        if (!this.events.has(event)) {\n            console.warn(\"event not yet created: \" + event);\n            this.events.set(event, []);\n        }\n\n        let wrapper =\n        {\n            fn: () => {\n                fn();\n                array_remove(this.events.get(event), wrapper);\n            },\n            id\n        };\n\n        this.events.get(event).push(wrapper);\n    }\n\n    public debugEvent(event: string) {\n        if (!this.events.has(event)) {\n            console.warn(\"event not yet created: \" + event);\n            this.events.set(event, []);\n        }\n\n        console.log(\"ids registered to event `\" + event + \"`:\");\n        this.events.get(event).forEach(o => console.log(o.id));\n    }\n}\n\nexport let GlobalEvents = new EventClass();","import { createElement } from \"./util\";\nimport { EventClass } from \"./eventclass\";\n\nexport class Widget extends EventClass {\n    public container: HTMLElement;\n    protected contentContainer: HTMLElement;\n\n    constructor(className_or_container?: string | HTMLElement) {\n        super();\n\n        if (className_or_container) {\n            if (typeof (className_or_container) === \"string\") {\n                this.container = createElement(\"div\", className_or_container);\n            }\n            else {\n                this.container = className_or_container;\n            }\n        }\n        else {\n            this.container = createElement(\"div\");\n        }\n\n        this.contentContainer = this.container;\n    }\n\n    public show(): void {\n        this.container.style.display = \"\";\n    }\n\n    public hide(): void {\n        this.container.style.display = \"none\";\n    }\n\n    public set innerHTML(innerHTML: string) {\n        this.contentContainer.innerHTML = innerHTML;\n    }\n\n    public get innerHTML(): string {\n        return this.contentContainer.innerHTML;\n    }\n\n    public set innerText(innerText: string) {\n        this.contentContainer.innerText = innerText;\n    }\n\n    public get innerText(): string {\n        return this.contentContainer.innerText;\n    }\n\n    public appendChild(...children: (HTMLElement | Widget | null)[]): void {\n        if (children.length === 1) {\n            this.appendHelper(this.contentContainer, children[0]);\n        }\n        else {\n            let frag = document.createDocumentFragment();\n\n            children.forEach(child => {\n                this.appendHelper(frag, child);\n            });\n\n            this.contentContainer.appendChild(frag);\n        }\n    }\n\n    private appendHelper(parent: Node, child: (HTMLElement | Widget)): void {\n        if (child instanceof HTMLElement) {\n            parent.appendChild(child);\n        }\n        else if (child) {\n            parent.appendChild(child.container);\n        }\n    }\n\n    public removeChild(child: HTMLElement | Widget): boolean {\n        if (!this.hasChild(child)) {\n            return false;\n        }\n\n        if (child instanceof HTMLElement) {\n            this.contentContainer.removeChild(child);\n        }\n        else {\n            this.contentContainer.removeChild(child.container);\n        }\n\n        return true;\n    }\n\n    public hasChild(child: HTMLElement | Widget) {\n        if (child instanceof HTMLElement) {\n            return this.contentContainer.contains(child);\n        }\n        else {\n            return this.contentContainer.contains(child.container);\n        }\n    }\n}","import { Point } from \"./point\";\n\nexport type RectAnchor = \"ne\" | \"nw\" | \"se\" | \"sw\";\n\nexport class Rectangle\n{\n    public position : Point;\n    public size : Point;\n\n    constructor(position : Point, size : Point)\n    {\n        this.position = position;\n        this.size = size;\n    }\n\n    public static fromClientRect(rect : ClientRect | DOMRect) : Rectangle {\n        return new Rectangle(new Point(rect.left, rect.top), Point.fromSizeLike(rect));\n    }\n\n    public expand(multiplier : number) : Rectangle\n    {\n        let r = this.copy();\n        let newSize = r.size.times(multiplier);\n        let center = r.center;\n        let diff = newSize.minus(r.size);\n        r.position.subtract(diff.dividedBy(2));\n        r.size.add(diff);\n        r.center = center;\n        return r;\n    }\n\n    public get isSquare() : boolean\n    {\n        return this.width === this.height;\n    }\n\n    public plus(operand : Rectangle) : Rectangle\n    {\n        return new Rectangle(this.position.plus(operand.position), this.size.plus(operand.size));\n    }\n\n    public times(operand : Rectangle | number) : Rectangle\n    {\n        if (typeof(operand) === \"number\")\n        {\n            return new Rectangle(this.position.times(operand), this.size.times(operand));\n        }\n        else\n        {\n            return new Rectangle(this.position.times(operand.position), this.size.times(operand.size));\n        }\n    }\n\n    public translated(offset : Point) : Rectangle\n    {\n        return new Rectangle(this.position.plus(offset), this.size.copy());\n    }\n\n    public toString() : string\n    {\n        return \"(\" + this.x + \", \" + this.y + \", \" + this.width + \", \" + this.height + \")\";\n    }\n\n    public fitInside(rect : Rectangle, anchor : RectAnchor) : void\n    {\n        let ar = rect.aspectRatio;\n        let startPoint = this.getPointFromAnchor(anchor).copy();\n\n        if (ar > this.aspectRatio)\n        {\n            // wider //\n            this.width *= rect.height / this.height;\n            this.height = rect.height;\n        }\n        else\n        {\n            // taller //\n            this.height *= rect.width / this.width;\n            this.width = rect.width;\n        }\n\n        this.setPointFromAnchor(anchor, startPoint);\n    }\n\n    public setWidthKeepAR(width : number) : void\n    {\n        let ar = this.width / width;\n        this.width = width;\n        this.height = this.height / ar;\n    }\n\n    public setHeightKeepAR(height : number) : void\n    {\n        let ar = this.height / height;\n        this.height = height;\n        this.width = this.width / ar;\n    }\n\n    public expandToward(anchor : RectAnchor, factor : number) : void\n    {\n        switch (anchor)\n        {\n            case \"ne\":\n                let bl = this.bottomLeft;\n                this.size.multiply(factor);\n                this.bottomLeft = bl;\n                break;\n            case \"nw\":\n                let br = this.bottomRight;\n                this.size.multiply(factor);\n                this.bottomRight = br;\n                break;\n            case \"se\":\n                let tl = this.topLeft;\n                this.size.multiply(factor);\n                this.topLeft = tl;\n                break;\n            case \"sw\":\n                let tr = this.topRight;\n                this.size.multiply(factor);\n                this.topRight = tr;\n                break;\n        }\n    }\n\n    public fitInsideGreedyCenter(rect : Rectangle, boundingRect : Rectangle)\n    {\n        let ar = rect.aspectRatio;\n        let center = this.center.copy(); // just being careful\n        let size = this.size.copy();\n\n        if (ar > 1)\n        {\n            // wider //\n            this.height *= rect.width / this.width;\n            this.width = rect.width;\n        }\n        else\n        {\n            // taller //\n            this.width *= rect.height / this.height;\n            this.height = rect.height;\n        }\n\n        this.center = center;\n\n        if (!boundingRect.containsRect(this))\n        {\n            if (this.right > boundingRect.right)\n            {\n                this.setWidthKeepAR((boundingRect.right - center.x) * 2);\n                this.center = center;\n            }\n            if (this.bottom > boundingRect.bottom)\n            {\n                this.setHeightKeepAR((boundingRect.bottom - center.y) * 2);\n                this.center = center;\n            }\n            if (this.left < boundingRect.left)\n            {\n                this.setWidthKeepAR((center.x - boundingRect.left) * 2);\n                this.center = center;\n            }\n            if (this.top < boundingRect.top)\n            {\n                this.setHeightKeepAR((center.y - boundingRect.top) * 2);\n                this.center = center;\n            }\n        }\n    }\n\n    public fitInsideGreedy(rect : Rectangle, anchor : RectAnchor, boundingRect : Rectangle) : void\n    {\n        let ar = rect.aspectRatio;\n        let startPoint = this.getPointFromAnchor(anchor).copy();\n\n        if (ar > 1)\n        {\n            // wider //\n            this.height *= rect.width / this.width;\n            this.width = rect.width;\n        }\n        else\n        {\n            // taller //\n            this.width *= rect.height / this.height;\n            this.height = rect.height;\n        }\n\n        this.setPointFromAnchor(anchor, startPoint);\n\n        if (!boundingRect.containsRect(this))\n        {\n            if (this.right > boundingRect.right)\n            {\n                this.setWidthKeepAR(boundingRect.right - this.left);\n                this.setPointFromAnchor(anchor, startPoint);\n            }\n            if (this.bottom > boundingRect.bottom)\n            {\n                this.setHeightKeepAR(boundingRect.bottom - this.top);\n                this.setPointFromAnchor(anchor, startPoint);\n            }\n            if (this.left < boundingRect.left)\n            {\n                this.setWidthKeepAR(this.right - boundingRect.left);\n                this.setPointFromAnchor(anchor, startPoint);\n            }\n            if (this.top < boundingRect.top)\n            {\n                this.setHeightKeepAR(this.bottom - boundingRect.top);\n                this.setPointFromAnchor(anchor, startPoint);\n            }\n        }\n    }\n\n    public copy() : Rectangle\n    {\n        return new Rectangle(this.position.copy(), this.size.copy());\n    }\n\n    public mirror(r : Rectangle) : void\n    {\n        this.position = r.position;\n        this.size = r.size;\n    }\n\n    public getPointFromAnchor(anchor : RectAnchor)\n    {\n        switch (anchor)\n        {\n            case \"nw\": return this.topLeft;\n            case \"ne\": return this.topRight;\n            case \"sw\": return this.bottomLeft;\n            case \"se\": return this.bottomRight;\n        }\n    }\n\n    public setPointFromAnchor(anchor : RectAnchor, point : Point)\n    {\n        switch (anchor)\n        {\n            case \"nw\": this.topLeft = point; break;\n            case \"ne\": this.topRight = point; break;\n            case \"sw\": this.bottomLeft = point; break;\n            case \"se\": this.bottomRight = point; break;\n        }\n    }\n\n    public static anchorOpposite(anchor : RectAnchor) : RectAnchor\n    {\n        switch (anchor)\n        {\n            case \"nw\": return \"se\";\n            case \"ne\": return \"sw\";\n            case \"sw\": return \"ne\";\n            case \"se\": return \"nw\";\n        }\n    }\n\n    public get aspectRatio() : number\n    {\n        return this.width / this.height;\n    }\n\n    public round(aboutCenter : boolean = false) : void\n    {\n        if (aboutCenter)\n        {\n            let c = this.center;\n            this.size.round();\n            this.center = c.rounded;\n        }\n        else\n        {\n            this.position.round();\n            this.size.round();\n        }\n    }\n\n    public get rounded() : Rectangle\n    {\n        return new Rectangle(this.position.rounded, this.size.rounded);\n    }\n\n    public get local() : Rectangle\n    {\n        return new Rectangle(new Point(0), this.size.copy());\n    }\n    \n    public get x() : number\n    {\n        return this.position.x;\n    }\n\n    public set x(x : number)\n    {\n        this.position.x = x;\n    }\n\n    public get y() : number\n    {\n        return this.position.y;\n    }\n\n    public set y(y : number)\n    {\n        this.position.y = y;\n    }\n    \n    public get left() : number\n    {\n        return this.position.x;\n    }\n\n    public set left(left : number)\n    {\n        this.position.x = left;\n    }\n\n    public get top() : number\n    {\n        return this.position.y;\n    }\n\n    public set top(top : number)\n    {\n        this.position.y = top;\n    }\n\n    public get width() : number\n    {\n        return this.size.x;\n    }\n\n    public set width(width : number)\n    {\n        this.size.x = width;\n    }\n\n    public get height() : number\n    {\n        return this.size.y;\n    }\n\n    public set height(height : number)\n    {\n        this.size.y = height;\n    }\n\n    public get right() : number\n    {\n        return this.x + this.width;\n    }\n\n    public set right(right : number)\n    {\n        this.x = right - this.width;\n    }\n\n    public get bottom() : number\n    {\n        return this.y + this.height;\n    }\n\n    public set bottom(bottom : number)\n    {\n        this.y = bottom - this.height;\n    }\n\n    public get topLeft() : Point\n    {\n        return this.position;\n    }\n\n    public set topLeft(topLeft : Point)\n    {\n        this.position = topLeft;\n    }\n\n    public get topRight() : Point\n    {\n        return this.position.plus(new Point(this.width, 0));\n    }\n\n    public set topRight(topRight : Point)\n    {\n        this.position = topRight.minus(new Point(this.width, 0));\n    }\n\n    public get bottomLeft() : Point\n    {\n        return this.position.plus(new Point(0, this.height));\n    }\n\n    public set bottomLeft(bottomLeft : Point)\n    {\n        this.position = bottomLeft.minus(new Point(0, this.height));\n    }\n\n    public get bottomRight() : Point\n    {\n        return this.position.plus(this.size);\n    }\n\n    public set bottomRight(bottomRight : Point)\n    {\n        this.position = bottomRight.minus(this.size);\n    }\n\n    public get center() : Point\n    {\n        return this.position.plus(this.size.times(1/2));\n    }\n\n    public set center(center : Point)\n    {\n        this.position = center.minus(this.size.times(1/2));\n    }\n\n    public get cx() : number\n    {\n        return this.center.x;\n    }\n\n    public set cx(cx : number)\n    {\n        this.position.x = cx - this.size.x / 2;\n    }\n\n    public get cy() : number\n    {\n        return this.center.y;\n    }\n\n    public set cy(cy : number)\n    {\n        this.position.y = cy - this.size.y / 2;\n    }\n\n    public containsPoint(p : Point) : boolean\n    {\n        return (\n            p.x >= this.x && p.x <= this.right &&\n            p.y >= this.y && p.y <= this.bottom\n        );\n    }\n\n    public containsRect(r : Rectangle) : boolean\n    {\n        return this.containsPoint(r.topLeft) && this.containsPoint(r.bottomRight);\n    }\n\n    /**\n     * @param r Rectangle to test for intersection with this one.\n     * @returns Whether or not the rectangles intersect. If they are just touching, will return `false`.\n     */\n    public intersects(r : Rectangle) : boolean\n    {\n        return !(r.left >= this.right || \n            r.right <= this.left || \n            r.top >= this.bottom ||\n            r.bottom <= this.top)\n    }\n    \n    public static between(p1 : Point, p2 : Point) : Rectangle\n    {\n        let pos = new Point(Math.min(p1.x, p2.x), Math.min(p1.y, p2.y));\n        let size = new Point(Math.abs(p1.x - p2.x), Math.abs(p1.y - p2.y));\n        return new Rectangle(pos, size);\n    }\n}","import { Rectangle } from \"./rectangle\";\n\n/**\n * A class to represent a two-dimensional point in space, or something that would benefit from a similar treatment.\n *\n * Any functions that are said to return a copy do not modify the original point.\n *\n * Any operations such as [[times]] that act on two points will perform their operations element-wise. So, in the example of [[times]], the x-coordinates will be multiplied together and the y-coordinates will be multiplied together.\n */\nexport class Point\n{\n    /** The x-coordinate of the point. */\n    public x : number;\n\n    /** The y-coordinate of the point. */\n    public y : number;\n\n    /**\n     * Creates a new Point.\n     * @param x The x-coordinate of the point. If not defined, both x and y will be set to 0.\n     * @param y The y-coordinate of the point. If not defined, the x value will be used in its place.\n     */\n    constructor(x? : number, y? : number)\n    {\n        if (x === undefined)\n        {\n            this.x = 0;\n            this.y = 0;\n        }\n        else if (y === undefined)\n        {\n            this.x = x;\n            this.y = x;\n        }\n        else\n        {\n            this.x = x;\n            this.y = y;\n        }\n    }\n    \n    public static fromSizeLike(sizeLike : { width : number, height : number}) : Point\n    {\n        return new Point(sizeLike.width, sizeLike.height);\n    }\n    \n    public static fromPointLike(pointLike : { x : number, y : number}) : Point\n    {\n        return new Point(pointLike.x, pointLike.y);\n    }\n\n    public toRectangle(offset? : Point) : Rectangle\n    {\n        return new Rectangle(offset || new Point(0), this.copy());\n    }\n\n    /**\n     * @returns A copy of the point with y set to 0.\n     */\n    public get xOnly() : Point\n    {\n        return new Point(this.x, 0);\n    }\n\n    /**\n     * @returns A copy of the point with x set to 0.\n     */\n    public get yOnly() : Point\n    {\n        return new Point(0, this.y);\n    }\n\n    /**\n     * @returns A copy of the point scaled so that the magnitude of its x-coordinate is 1.\n     */\n    public get unitX() : Point\n    {\n        return new Point(this.x > 0 ? 1 : -1, this.y / this.x);\n    }\n\n    /**\n     * @returns A copy of the point scaled so that the magnitude of its y-coordinate is 1.\n     */\n    public get unitY() : Point\n    {\n        return new Point(this.x / this.y, this.y > 0 ? 1 : -1);\n    }\n\n    /**\n     * @returns A copy of the point with both coordinates inverted (multiplied by -1).\n     */\n    public get inverted() : Point\n    {\n        return this.times(-1);\n    }\n\n    /**\n     * @param x The magnitude of the horizontal scaling.\n     * @returns A copy of the point, inverted and scaled so that the magnitude of its x-coordinate is the passed value.\n     */\n    public reverseByX(x : number) : void\n    {\n        let offset = this.unitX.inverted.times(x);\n        this.x = offset.x;\n        this.y = offset.y;\n    }\n\n    /**\n     * @param x The magnitude of the vertical scaling.\n     * @returns A copy of the point, inverted and scaled so that the magnitude of its y-coordinate is the passed value.\n     */\n    public reverseByY(y : number) : void\n    {\n        let offset = this.unitY.inverted.times(y);\n        this.x = offset.x;\n        this.y = offset.y;\n    }\n\n    /**\n     * @param array The array from which to construct the point. Should be in the format [ x, y ]. Any elements beyond the second will be ignored.\n     * @returns A new point, the constructor called using the array as an argument list.\n     */\n    public static fromArray(array : number[]) : Point\n    {\n        return new Point(...array);\n    }\n\n    /**\n     * Used to generate a point from an index within a rectangular shape and the width of that rectangle. Like translating a tile index to a tile location.\n     * @param index The 0-based index to translate into a point.\n     * @param width The width of the rectangle.\n     */\n    public static fromIndex(index : number, width : number) : Point\n    {\n        return new Point(index % width, ~~(index / width));\n    }\n\n    /**\n     * Creates a unit vector from a given angle.\n     * @param radians The angle in radians.\n     */\n    public static fromAngle(radians : number) : Point\n    {\n        return new Point(Math.cos(radians), Math.sin(radians));\n    }\n\n    /**\n     * @param p The point with which to test equality.\n     * @returns Whether or not the two points have equal x and y values.\n     */\n    public equals(p : Point) : boolean\n    {\n        return this.x === p.x && this.y === p.y;\n    }\n\n    /**\n     * @returns A copy of the point.\n     */\n    public copy() : Point\n    {\n        return new Point(this.x, this.y);\n    }\n\n    /**\n     * Modifies the point so that its coordinates are rounded to the nearest integer using Math.round.\n     */\n    public round() : void\n    {\n        this.x = Math.round(this.x);\n        this.y = Math.round(this.y);\n    }\n\n    /**\n     * @returns A copy of the point with its coordinates rounded via Math.round.\n     */\n    public get rounded() : Point\n    {\n        return new Point(Math.round(this.x), Math.round(this.y));\n    }\n\n    /**\n     * @param n A number or other point by which to multiply the point.\n     * @returns A copy of the point multiplied by the given value.\n     */\n    public times(n : number | Point) : Point\n    {\n        let ret = this.copy();\n        ret.multiply(n);\n        return ret;\n    }\n\n    /**\n     * Multiplies the point by the given value.\n     * @param n A number or other point by which to multiply the point.\n     */\n    public multiply(n : number | Point) : void\n    {\n        if (n instanceof Point)\n        {\n            this.x *= n.x;\n            this.y *= n.y;\n        }\n        else\n        {\n            this.x *= n;\n            this.y *= n;\n        }\n    }\n\n    /**\n     * @param n A number or other point by which to divide the point.\n     * @returns A copy of the point divided by the given value.\n     */\n    public dividedBy(n : number | Point) : Point\n    {\n        let ret = this.copy();\n        ret.divideBy(n);\n        return ret;\n    }\n\n    /**\n     * Divides the point by the given value.\n     * @param n A number or other point by which to divide the point.\n     */\n    public divideBy(n : number | Point) : void\n    {\n        if (n instanceof Point)\n        {\n            this.x /= n.x;\n            this.y /= n.y;\n        }\n        else\n        {\n            this.x /= n;\n            this.y /= n;\n        }\n    }\n\n    /**\n     * @param n A number or other point to be added to the point.\n     * @returns A copy of the point summed with the given value.\n     */\n    public plus(n : number | Point) : Point\n    {\n        let ret = this.copy();\n        ret.add(n);\n        return ret;\n    }\n    \n    /**\n     * Adds the given point to this point.\n     * @param n A number or other point to be added to this point.\n     */\n    public add(n : number | Point) : void\n    {\n        if (n instanceof Point)\n        {\n            this.x += n.x;\n            this.y += n.y;\n        }\n        else\n        {\n            this.x += n;\n            this.y += n;\n        }\n    }\n\n    /**\n     * @param n A number or other point to be subtracted from the point.\n     * @returns A copy of the difference between this point and the given point.\n     */\n    public minus(n : number | Point) : Point\n    {\n        let ret = this.copy();\n        ret.subtract(n);\n        return ret;\n    }\n\n    /**\n     * Subtracts the given point from this point.\n     * @param n A number or other point to be subtracted from this point.\n     */\n    public subtract(n : number | Point) : void\n    {\n        if (n instanceof Point)\n        {\n            this.x -= n.x;\n            this.y -= n.y;\n        }\n        else\n        {\n            this.x -= n;\n            this.y -= n;\n        }\n    }\n\n    /**\n     * @returns A copy of this point with its coordinates multiplied by themselves.\n     */\n    public get squared() : Point\n    {\n        return this.times(this);\n    }\n\n    /**\n     * @returns The sum of the point's two coordinates.\n     */\n    public get sum() : number\n    {\n        return this.x + this.y;\n    }\n\n    /**\n     * @returns The smaller of the point's two coordinates.\n     */\n    public get min() : number\n    {\n        return Math.min(this.x, this.y);\n    }\n\n    /**\n     * @returns The larger of the point's two coordinates.\n     */\n    public get max() : number\n    {\n        return Math.max(this.x, this.y);\n    }\n\n    /**\n     * @param p The point to get the distance to.\n     * @returns The distance between this and the given point.\n     */\n    public distanceTo(p : Point) : number\n    {\n        return Math.sqrt(this.minus(p).squared.sum);\n    }\n\n    /**\n     * @returns A string in the format (x, y).\n     */\n    public toString() : string\n    {\n        return \"(\" + this.x + \", \" + this.y + \")\";\n    }\n\n    /**\n     * @returns A length-2 array of the form [ x, y ].\n     */\n    public toArray() : number[]\n    {\n        return [ this.x, this.y ];\n    }\n}","import { Point } from \"./point\";\nimport { array_contains } from \"./util\";\nimport { Rectangle } from \"./rectangle\";\n\ntype CanvasOptions =\n    {\n        canvasElement?: HTMLCanvasElement,\n        size?: Point,\n        align?:\n        {\n            horizontal: boolean,\n            vertical: boolean\n        },\n        deepCalc?: boolean,\n        pixelated?: boolean,\n        opaque?: boolean\n    };\n\ntype CanvasTextBaseline = \"top\" | \"hanging\" | \"middle\" | \"alphabetic\" | \"ideographic\" | \"bottom\";\ntype CanvasTextAlign = \"start\" | \"end\" | \"left\" | \"right\" | \"center\";\n\ntype MouseMoveFn = (pos: Point, isDown: boolean, lastPos: Point, originalPos: Point, e: MouseEvent) => any;\ntype MouseDownFn = (pos: Point, e: MouseEvent) => any;\ntype MouseUpFn = (pos: Point, originalPos: Point, e: MouseEvent) => any;\ntype MouseLeaveFn = (pos: Point, e: MouseEvent) => any;\n\ntype Drawable = HTMLImageElement | Canvas | HTMLCanvasElement;\n\ntype CanvasMouse =\n    {\n        isDown: boolean,\n        lastPos: { x: number, y: number },\n        originalPos: { x: number, y: number },\n        events:\n        {\n            move: MouseMoveFn[],\n            down: MouseDownFn[],\n            up: MouseUpFn[],\n            leave: MouseLeaveFn[]\n        }\n    };\n\nexport class Canvas {\n    canvas: HTMLCanvasElement;\n    translation: Point;\n    align: { horizontal: boolean, vertical: boolean };\n    usingDeepCalc: boolean;\n    mouse: CanvasMouse;\n    offset: Point;\n    public readonly context: CanvasRenderingContext2D;\n\n    constructor(options: CanvasOptions = {}) {\n        options = options || {}\n\n        if (!options.canvasElement) {\n            options.canvasElement = document.createElement(\"canvas\");\n        }\n        else if (typeof (options.canvasElement) === \"string\") {\n            options.canvasElement = document.querySelector(options.canvasElement);\n        }\n\n        this.canvas = options.canvasElement;\n        this.context = this.canvas.getContext(\"2d\", { alpha: !options.opaque });\n\n        options.size = options.size || new Point(1);\n        this.resize(options.size, false);\n\n        this.translation = new Point(0);\n\n        this.align =\n        {\n            horizontal: (options.align && options.align.horizontal) || false,\n            vertical: (options.align && options.align.vertical) || false\n        }\n\n        if (this.align.horizontal || this.align.vertical) {\n            //this.canvas.style.transformOrigin = \"center\";\n            //this.canvas.style.position = \"absolute\";\n\n            /*if (this.align.horizontal && this.align.vertical)\n            {\n                this.canvas.style.transform = \"translate(-50%, -50%)\";\n                this.canvas.style.left = \"50%\";\n                this.canvas.style.top = \"50%\";\n            }\n            else if (this.align.horizontal)\n            {\n                this.canvas.style.transform = \"translateX(-50%)\";\n                this.canvas.style.left = \"50%\";\n            }\n            else // vertical\n            {\n                this.canvas.style.transform = \"translateY(-50%)\";\n                this.canvas.style.top = \"50%\";\n            }*/\n        }\n        else {\n            this.canvas.style.transformOrigin = \"top left\";\n        }\n\n        this.usingDeepCalc = options.deepCalc || false;\n        this.pixelated = options.pixelated || false;\n\n        if (this.usingDeepCalc) {\n            this.deepCalcPosition();\n            window.addEventListener(\"resize\", this.deepCalcPosition);\n        }\n\n        this.mouse =\n        {\n            isDown: false,\n            lastPos: null,\n            originalPos: { x: -1, y: -1 },\n            events:\n            {\n                move: [],\n                down: [],\n                up: [],\n                leave: []\n            }\n        };\n\n        this.canvas.addEventListener(\"mousemove\", this.mouseMove.bind(this));\n        this.canvas.addEventListener(\"touchmove\", this.mouseMove.bind(this));\n        this.canvas.addEventListener(\"mousedown\", this.mouseDown.bind(this));\n        this.canvas.addEventListener(\"touchstart\", this.mouseDown.bind(this));\n        this.canvas.addEventListener(\"mouseup\", this.mouseUp.bind(this));\n        this.canvas.addEventListener(\"touchend\", this.mouseUp.bind(this));\n        this.canvas.addEventListener(\"mouseleave\", this.mouseLeave.bind(this));\n        this.canvas.addEventListener(\"touchcancel\", this.mouseLeave.bind(this));\n    }\n\n    public addEventListener(eventName: \"mouseup\", fn: MouseUpFn): void;\n    public addEventListener(eventName: \"mousedown\", fn: MouseDownFn): void;\n    public addEventListener(eventName: \"mousemove\", fn: MouseMoveFn): void;\n    public addEventListener(eventName: \"mouseleave\", fn: MouseLeaveFn): void;\n    public addEventListener(eventName: string, fn: Function): void {\n        if (array_contains([\"mouseup\", \"mousedown\", \"mousemove\", \"mouseleave\"], eventName)) {\n            this.mouse.events[eventName.substr(5)].push(fn);\n        }\n    }\n\n    public resize(size: Point, redraw: boolean) {\n        let c: HTMLCanvasElement;\n\n        if (redraw) {\n            c = <HTMLCanvasElement>this.canvas.cloneNode();\n        }\n\n        this.canvas.width = size.x;\n        this.canvas.height = size.y;\n\n        if (redraw) {\n            this.drawImage(c, new Point(0));\n        }\n    }\n\n    public zoom(amount: number | Point) {\n        let x: number;\n        let y: number;\n\n        if (typeof (amount) === \"number\") {\n            x = amount;\n            y = amount;\n        }\n        else {\n            x = amount.x;\n            y = amount.y;\n        }\n\n        this.canvas.style[\"transform\"] = \"scale(\" + x + \", \" + y + \")\";\n    }\n\n    public zoomToFit(size: Point) {\n        let wRatio = size.x / this.width;\n        let hRatio = size.y / this.height;\n\n        if (wRatio < hRatio) {\n            this.zoom(wRatio);\n        }\n        else {\n            this.zoom(hRatio);\n        }\n    }\n\n    public scale(amount: number | Point) {\n        return this.zoom(amount);\n    }\n\n    public clear() {\n        this.context.clearRect(-this.translation.x, -this.translation.y, this.canvas.width, this.canvas.height);\n    }\n\n    private deepCalcPosition() {\n        let z = <HTMLElement>this.canvas, x = 0, y = 0, c;\n\n        while (z && !isNaN(z.offsetLeft) && !isNaN(z.offsetTop)) {\n            c = window.getComputedStyle(z, null);\n            x += z.offsetLeft - z.scrollLeft + (c ? parseInt(c.getPropertyValue('border-left-width'), 10) : 0);\n            y += z.offsetTop - z.scrollTop + (c ? parseInt(c.getPropertyValue('border-top-width'), 10) : 0);\n            z = <HTMLElement>z.offsetParent;\n        }\n\n        this.offset = new Point(x, y);\n    }\n\n    private posFromEvent(e: MouseEvent | TouchEvent): Point {\n        let ret = new Point();\n\n        if (e instanceof MouseEvent) {\n            ret = new Point(e.pageX, e.pageY);\n        }\n        else {\n            ret = new Point(e.changedTouches[0].pageX, e.changedTouches[0].pageY);\n        }\n\n        if (this.usingDeepCalc) {\n            this.deepCalcPosition();\n        }\n\n        let bounds = this.canvas.getBoundingClientRect();\n\n        let o = this.usingDeepCalc ? this.offset.copy() : new Point(bounds.left, bounds.top);\n\n        if (this.align.horizontal && o.x > 0) {\n            o.x = (2 * o.x - bounds.width) / 2;\n        }\n\n        if (this.align.vertical && o.y > 0) {\n            o.y = (2 * o.y - bounds.height) / 2;\n        }\n\n        ret.subtract(o);\n        ret.multiply(this.size.dividedBy(new Point(bounds.width, bounds.height)));\n\n        return ret;\n    }\n\n    public get size(): Point {\n        return new Point(this.canvas.width, this.canvas.height);\n    }\n\n    private mouseMove(e: MouseEvent): void {\n        let pos = this.posFromEvent(e);\n        if (!this.mouse.lastPos) this.mouse.lastPos = pos;\n        if (!this.mouse.isDown) this.mouse.originalPos = pos;\n\n        this.mouse.events.move.forEach(fn => {\n            let event = fn.call(\n                this,\n                pos.x,\n                pos.y,\n                this.mouse.isDown,\n                this.mouse.lastPos.x,\n                this.mouse.lastPos.y,\n                this.mouse.originalPos.x,\n                this.mouse.originalPos.y,\n                e\n            );\n\n            if (event !== false) {\n                this.mouse.lastPos = pos;\n            }\n        });\n    }\n\n    private mouseDown(e: MouseEvent): void {\n        let pos = this.posFromEvent(e);\n        this.mouse.isDown = true;\n        this.mouse.lastPos = pos;\n        this.mouse.originalPos = pos;\n\n        this.mouse.events.down.forEach(fn => {\n            fn.call(this, pos.x, pos.y, e);\n        });\n    }\n\n    private mouseUp(e: MouseEvent): void {\n        let pos = this.posFromEvent(e);\n        this.mouse.isDown = false;\n\n        this.mouse.events.up.forEach(fn => {\n            fn.call(this, pos.x, pos.y, this.mouse.originalPos.x, this.mouse.originalPos.y, e);\n        });\n\n        this.mouse.lastPos = pos;\n    }\n\n    private mouseLeave(e: MouseEvent): void {\n        let pos = this.posFromEvent(e);\n\n        this.mouse.events.leave.forEach(fn => {\n            fn.call(this, pos.x, pos.y, e);\n        });\n    }\n\n    public set pixelated(bool: boolean) {\n        bool = !bool;\n\n        let ctx = this.context;\n        (<any>ctx).mozImageSmoothingEnabled = bool;\n        (<any>ctx).webkitImageSmoothingEnabled = bool;\n        //(<any>ctx).msImageSmoothingEnabled = bool;\n        (<any>ctx).imageSmoothingEnabled = bool;\n\n        if (!bool) {\n            let types = [\"optimizeSpeed\", \"crisp-edges\", \"-moz-crisp-edges\", \"-webkit-optimize-contrast\", \"optimize-contrast\", \"pixelated\"];\n\n            types.forEach(type => this.canvas.style[\"image-rendering\"] = type);\n        }\n        else {\n            this.canvas.style[\"image-rendering\"] = \"\";\n        }\n        //this.canvas.style.msInterpolationMode = \"nearest-neighbor\";\n    }\n\n    public get width(): number { return this.canvas.width; }\n    public get height(): number { return this.canvas.height; }\n\n    public get opacity(): number { return this.context.globalAlpha; }\n    public set opacity(opacity: number) { this.context.globalAlpha = opacity; }\n\n    public get color(): string { return <string>this.context.fillStyle; }\n    public set color(val: string) {\n        if (val === undefined) return;\n\n        this.context.fillStyle = val;\n        this.context.strokeStyle = val;\n    }\n\n    public get font(): string { return this.context.font; }\n    public set font(val: string) {\n        if (val === undefined) return;\n\n        this.context.font = val;\n    }\n\n    public get lineWidth(): number { return this.context.lineWidth; }\n    public set lineWidth(val: number) {\n        if (val === undefined) return;\n\n        this.context.lineWidth = val;\n    }\n\n    public get blendMode(): string { return this.context.globalCompositeOperation; }\n    public set blendMode(val: string) { this.context.globalCompositeOperation = val; }\n\n    public get lineDash(): number[] { return this.context.getLineDash(); }\n    public set lineDash(dash: number[]) { this.context.setLineDash(dash); }\n\n    public createBlob(callback: (blob: Blob) => any, mimeType?: string): void {\n        this.canvas.toBlob(function (blob) {\n            callback(blob);\n        }, mimeType);\n    }\n\n    public createImage(callback: (image: HTMLImageElement) => any, mimeType?: string, autoRevoke: boolean = true) {\n        this.canvas.toBlob(function (blob) {\n            let ret = new Image();\n\n            ret.onload = () => {\n                callback(ret);\n                ret.onload = null;\n                autoRevoke && URL.revokeObjectURL(ret.src);\n            };\n\n            let url = URL.createObjectURL(blob);\n            ret.src = url;\n        }, mimeType);\n    }\n\n    public get imageData(): ImageData {\n        return this.context.getImageData(0, 0, this.width, this.height);\n    }\n\n    public drawImage(image: Drawable, position: Point | Rectangle): void {\n        if (image instanceof Canvas) {\n            image = image.canvas;\n        }\n\n        if (position instanceof Point) {\n            this.context.drawImage(image, position.x, position.y);\n        }\n        else {\n            this.context.drawImage(image, position.x, position.y, position.width, position.height);\n        }\n    }\n\n    public drawCroppedImage(image: Drawable, position: Point | Rectangle, cropRegion: Rectangle): void {\n        if (image instanceof Canvas) {\n            image = image.canvas;\n        }\n\n        if (position instanceof Point) {\n            this.context.drawImage(image, cropRegion.x, cropRegion.y, cropRegion.width, cropRegion.height, position.x, position.y, cropRegion.width, cropRegion.height);\n        }\n        else {\n            this.context.drawImage(image, cropRegion.x, cropRegion.y, cropRegion.width, cropRegion.height, position.x, position.y, position.width, position.height);\n        }\n    }\n\n    public drawRotatedCroppedImage(image: Drawable, rotate: number, anchor: Point, position: Point | Rectangle, cropRegion: Rectangle): void {\n        if (image instanceof Canvas) {\n            image = image.canvas;\n        }\n\n        var ctx = this.context;\n\n        ctx.save();\n        ctx.translate(position.x + anchor.x, position.y + anchor.y);\n        ctx.rotate(rotate);\n\n        if (position instanceof Point) {\n            ctx.drawImage(image, cropRegion.x, cropRegion.y, cropRegion.width, cropRegion.height, -anchor.x, -anchor.y, image.width, image.height);\n        }\n        else {\n            ctx.drawImage(image, cropRegion.x, cropRegion.y, cropRegion.width, cropRegion.height, -anchor.x, -anchor.y, position.width, position.height);\n        }\n\n        ctx.restore();\n    }\n\n    public fillWithImage(image: Drawable, resizeCanvasToFit: boolean): void {\n        if (resizeCanvasToFit) {\n            this.resize(new Point(image.width, image.height), false);\n        }\n\n        this.drawImage(image, new Point(0));\n    }\n\n    public drawLine(start: Point, end: Point, color?: string, lineWidth?: number): void {\n        this.color = color;\n        this.lineWidth = lineWidth;\n\n        this.context.beginPath();\n        this.context.moveTo(start.x, start.y);\n        this.context.lineTo(end.x, end.y);\n        this.context.stroke();\n    }\n    public drawArc(center: Point, radius: number, startAngle: number, endAngle: number, color?: string, lineWidth?: number): void {\n        this.color = color;\n        this.lineWidth = lineWidth;\n\n        this.context.beginPath();\n        this.context.arc(center.x, center.y, radius, startAngle, endAngle);\n        this.context.stroke();\n    }\n    public drawRect(rect: Rectangle, color: string, lineWidth: number, sharp: boolean = true): void {\n        this.color = color;\n        this.lineWidth = lineWidth;\n\n        if (sharp) {\n            rect = rect.translated(new Point(0.5));\n        }\n\n        this.context.strokeRect(rect.x, rect.y, rect.width, rect.height);\n    }\n    public fillRect(rect: Rectangle, color: string): void {\n        this.color = color;\n\n        this.context.fillRect(rect.x, rect.y, rect.width, rect.height);\n    }\n\n    public drawBanner(circle: any, lineWidth: number) {\n/*         this.drawLine(new Point(circle.left - (circle.width / 5 + circle.width / 13.33), circle.cy), new Point(circle.left, circle.cy), \"#ff00cc\", lineWidth);\n        this.drawArc(circle.center, circle.width / 2, Math.PI, 1.5 * Math.PI, \"#ff00cc\", lineWidth);\n        this.drawArc(circle.center, circle.width / 2, 1.5 * Math.PI, 2 * Math.PI, \"#ff00cc\", lineWidth);\n        this.drawLine(new Point(circle.right, circle.cy), new Point(circle.right + (circle.width * 2.4) + (circle.width / 13.33), circle.cy), \"#ff00cc\", lineWidth);\n        this.drawLine(new Point(circle.right + (circle.width * 2.4) + (circle.width / 13.33), circle.cy), new Point(circle.right + (circle.width * 2.4) + (circle.width / 13.33), circle.cy - (circle.width * 1.5)), \"#ff00cc\", lineWidth);\n        this.drawLine(new Point(circle.right + (circle.width * 2.4) + (circle.width / 13.33), circle.cy - (circle.width * 1.5)), new Point(circle.left - (circle.width / 5 + circle.width / 13.33), circle.cy - (circle.width * 1.5)), \"#ff00cc\", lineWidth);\n        this.drawLine(new Point(circle.left - (circle.width / 5 + circle.width / 13.33), circle.cy - (circle.width * 1.5)), new Point(circle.left - (circle.width / 5 + circle.width / 13.33), circle.cy), \"#ff00cc\", lineWidth); */\n        this.context.beginPath()\n        this.context.moveTo(circle.left - (circle.width / 5 + circle.width / 13.33), circle.cy)\n        this.context.lineTo(circle.left, circle.cy)\n        this.context.arc(circle.center.x, circle.center.y, circle.width / 2, Math.PI, 1.5 * Math.PI, false)\n        this.context.arc(circle.center.x, circle.center.y, circle.width / 2, 1.5 * Math.PI, 2 * Math.PI, false)\n        this.context.lineTo(circle.right + (circle.width * 2.4) + (circle.width / 13.33), circle.cy)\n        this.context.lineTo(circle.right + (circle.width * 2.4) + (circle.width / 13.33), circle.cy - (circle.width * 1.5))\n        this.context.lineTo(circle.left - (circle.width / 5 + circle.width / 13.33), circle.cy - (circle.width * 1.5))\n        this.context.lineTo(circle.left - (circle.width / 5 + circle.width / 13.33), circle.cy)\n        this.context.lineWidth = lineWidth\n        this.context.strokeStyle = \"yellow\"\n        this.context.stroke()\n\n        this.context.beginPath()\n        this.context.moveTo(circle.left - (circle.width / 13.33), circle.cy)\n        this.context.arc(circle.center.x, circle.center.y, circle.width / 2 + (circle.width / 13.33), Math.PI, 1.5 * Math.PI, false)\n        this.context.arc(circle.center.x, circle.center.y, circle.width / 2 + (circle.width / 13.33), 1.5 * Math.PI, 2 * Math.PI, false)\n        this.context.strokeStyle = \"red\"\n        this.context.stroke()\n    }\n\n\n    // https://stackoverflow.com/a/7838871\n    public drawRoundedRect(rect: Rectangle, radius: number, color: string, lineWidth: number, sharp: boolean = true): void {\n        this.color = color;\n        this.lineWidth = lineWidth;\n\n        if (sharp) {\n            rect = rect.translated(new Point(0.5));\n        }\n\n        if (rect.width < 2 * radius) radius = rect.width / 2;\n        if (rect.height < 2 * radius) radius = rect.height / 2;\n\n        this.context.beginPath();\n        this.context.moveTo(rect.x + radius, rect.y);\n        this.context.arcTo(rect.right, rect.y, rect.right, rect.bottom, radius);\n        this.context.arcTo(rect.right, rect.bottom, rect.x, rect.bottom, radius);\n        this.context.arcTo(rect.x, rect.bottom, rect.x, rect.y, radius);\n        this.context.arcTo(rect.x, rect.y, rect.right, rect.y, radius);\n        this.context.closePath();\n        this.context.stroke();\n    }\n    public fillRoundedRect(rect: Rectangle, radius: number, color: string, sharp: boolean = true): void {\n        this.color = color;\n\n        if (sharp) {\n            rect = rect.translated(new Point(0.5));\n        }\n\n        if (rect.width < 2 * radius) radius = rect.width / 2;\n        if (rect.height < 2 * radius) radius = rect.height / 2;\n\n        this.context.beginPath();\n        this.context.moveTo(rect.x + radius, rect.y);\n        this.context.arcTo(rect.right, rect.y, rect.right, rect.bottom, radius);\n        this.context.arcTo(rect.right, rect.bottom, rect.x, rect.bottom, radius);\n        this.context.arcTo(rect.x, rect.bottom, rect.x, rect.y, radius);\n        this.context.arcTo(rect.x, rect.y, rect.right, rect.y, radius);\n        this.context.closePath();\n        this.context.fill();\n    }\n\n    public fill(color: string): void {\n        this.fillRect(new Rectangle(new Point(0), this.size), color);\n    }\n\n    public fillText(text: string, position: Point, color: string, baseline?: CanvasTextBaseline, align?: CanvasTextAlign, font?: string): void {\n        this.color = color;\n\n        if (font) {\n            this.font = font;\n        }\n        if (baseline) {\n            this.context.textBaseline = baseline;\n        }\n        if (align) {\n            this.context.textAlign = align;\n        }\n\n        this.context.fillText(text, position.x, position.y);\n    }\n\n    public fillCircle(position: Point, radius: number, color: string): void {\n        this.color = color;\n\n        this.context.beginPath();\n        this.context.arc(position.x, position.y, radius, 0, 2 * Math.PI, false);\n        this.context.fill();\n    }\n\n    public fillCircleInSquare(position: Point, diameter: number, color: string) {\n        this.color = color;\n\n        this.context.beginPath();\n        this.context.arc(position.x + diameter / 2, position.y + diameter / 2, diameter / 2, 0, 2 * Math.PI, false);\n        this.context.fill();\n    }\n\n    public drawCircleInSquare(position: Point, diameter: number, color, lineWidth): void {\n        this.color = color;\n        this.lineWidth = lineWidth;\n\n        this.context.beginPath();\n        this.context.arc(position.x + diameter / 2, position.y + diameter / 2, diameter / 2, 0, 2 * Math.PI, false);\n        this.context.stroke();\n    }\n\n    public fillCircleInRect(rect: Rectangle, color: string): void {\n        if (rect.isSquare) {\n            return this.fillCircleInSquare(rect.position, rect.width, color);\n        }\n\n        this.color = color;\n\n        this.context.beginPath();\n        this.context.ellipse(rect.x, rect.y, rect.width / 2, rect.height / 2, 0, 0, Math.PI * 2);\n        this.context.fill();\n    }\n\n    public drawCircleInRect(rect: Rectangle, color?: string, lineWidth?: number): void {\n        if (rect.isSquare) {\n            return this.drawCircleInSquare(rect.position, rect.width, color, lineWidth);\n        }\n\n        this.color = color;\n        this.lineWidth = lineWidth;\n\n        this.context.beginPath();\n        this.context.ellipse(rect.x, rect.y, rect.width / 2, rect.height / 2, 0, 0, Math.PI * 2);\n        this.context.stroke();\n    }\n\n    public drawRotatedImage(image: Drawable, rotate: number, position: Point | Rectangle): void {\n        if (image instanceof Canvas) {\n            image = image.canvas;\n        }\n\n        let w: number;\n        let h: number;\n\n        if (position instanceof Point) {\n            w = image.width;\n            h = image.height;\n        }\n        else {\n            w = position.width;\n            h = position.height;\n        }\n\n        this.context.save();\n        this.context.translate(position.x + w / 2, position.y + h / 2);\n        this.context.rotate(rotate);\n        this.context.drawImage(image, -w / 2, -h / 2, w, h);\n        this.context.restore();\n    }\n\n    public static fileToImage(file: File, callback: (image: HTMLImageElement) => any, autoRevoke: boolean = true) {\n        let img = new Image();\n\n        img.onload = () => {\n            callback(img);\n            if (autoRevoke) {\n                window.URL.revokeObjectURL(img.src);\n            }\n        };\n\n        img.src = window.URL.createObjectURL(file);\n    }\n}\n\n// from https://developer.mozilla.org/en-US/docs/Web/API/HTMLCanvasElement/toBlob\nif (!HTMLCanvasElement.prototype.toBlob) {\n    Object.defineProperty(HTMLCanvasElement.prototype, 'toBlob', {\n        value: function (callback, type, quality) {\n            var canvas = this;\n            setTimeout(function () {\n                var binStr = atob(canvas.toDataURL(type, quality).split(',')[1]),\n                    len = binStr.length,\n                    arr = new Uint8Array(len);\n\n                for (var i = 0; i < len; i++) {\n                    arr[i] = binStr.charCodeAt(i);\n                }\n\n                callback(new Blob([arr], { type: type || 'image/png' }));\n            });\n        }\n    });\n}","import { Widget } from \"./widget\";\nimport { createElement } from \"./util\";\n\nexport class ProgressBar extends Widget {\n    private progressElement: HTMLElement;\n    private _progress: number;\n\n    constructor() {\n        super(createElement(\"div\", \"progressBar\"));\n\n        this.progressElement = createElement(\"div\", \"progress\");\n        this.progressElement.style.height = \"100%\";\n\n        this.progress = 0;\n\n        this.appendChild(this.progressElement);\n    }\n\n    // 0 to 1 //\n    public set progress(progress: number) {\n        this._progress = progress;\n        this.progressElement.style.width = (progress * 100) + \"%\";\n    }\n\n    public get progress(): number {\n        return this._progress;\n    }\n}","import { ProgressBar } from \"./progressbar\";\n\ninterface FractionPart {\n    fractionsOfWhole: number;\n    internalSteps: number;\n    counter: number;\n}\n\nexport class FractionalProgressBar extends ProgressBar {\n    private fractionParts: FractionPart[] = [];\n    private totalFractions: number = 0;\n\n    constructor() {\n        super();\n    }\n\n    public addFractionPart(fractionsOfWhole: number, internalSteps: number) {\n        this.fractionParts.push({ fractionsOfWhole, internalSteps, counter: 0 });\n        this.totalFractions += fractionsOfWhole;\n    }\n\n    public step() {\n        if (this.fractionParts.length > 0) {\n            this.fractionParts[0].counter++;\n            this.progress += (1 / this.fractionParts[0].internalSteps) * (this.fractionParts[0].fractionsOfWhole);\n            if (this.fractionParts[0].counter === this.fractionParts[0].internalSteps) {\n                this.fractionParts.shift();\n            }\n        }\n    }\n\n    public reset() {\n        this.fractionParts = [];\n        this.progress = 0;\n    }\n}","import { Widget } from \"./widget\";\nimport { createElement, stopProp } from \"./util\";\n\nexport abstract class Dialog extends Widget {\n    protected dialog: HTMLElement;\n\n    constructor() {\n        super(\"dialog-backdrop\");\n\n        this.dialog = createElement(\"div\", \"dialog\");\n        this.dialog.addEventListener(\"click\", stopProp);\n        this.container.appendChild(this.dialog);\n        this.contentContainer = this.dialog;\n\n        this.container.addEventListener(\"click\", () => {\n            this.dismiss();\n        });\n\n        this.hide();\n    }\n\n    public show(): void {\n        super.show();\n        this.contentContainer.scrollTop = 0;\n    }\n    \n    public abstract dismiss(): void;\n}","import { Dialog } from \"./dialog\";\nimport { createElement } from \"./util\";\n\nexport class ClosableDialog extends Dialog {\n    private innerContent: HTMLElement;\n\n    constructor() {\n        super();\n\n        this.dialog.classList.add(\"closable\");\n\n        let close = createElement(\"div\", \"close\");\n        close.innerText = \"❌\";\n        close.addEventListener(\"click\", () => {\n            this.hide();\n        });\n        this.appendChild(close);\n\n        this.innerContent = createElement(\"div\", \"innerContent\");\n        this.appendChild(this.innerContent);\n        this.contentContainer = this.innerContent;\n    }\n\n    public dismiss(): void {\n        this.hide();\n    }\n}","import { GlobalEvents } from \"./eventclass\";\nimport { Point } from \"./point\";\nimport { Canvas } from \"./canvas\";\n\nexport type GradientStop = {\n    pos: number,\n    color: string\n};\n\nexport type GradientInfo = {\n    name: string,\n    gradient: GradientStop[],\n    angle: number\n};\n\nexport class Border {\n    public static get defaults(): GradientInfo[] {\n        return [\n            {\n                name: \"LGBT Pride\",\n                angle: 0,\n                gradient: [\n                    { pos: 0/5, color: \"#FF0018\" },\n                    { pos: 1/5, color: \"#FFA52C\" },\n                    { pos: 2/5, color: \"#FFFF41\" },\n                    { pos: 3/5, color: \"#008018\" },\n                    { pos: 4/5, color: \"#0000F9\" },\n                    { pos: 5/5, color: \"#86007D\" },\n                ]\n            },\n            {\n                name: \"Trans Pride\",\n                angle: 0,\n                gradient: [\n                    { pos: 0, color: \"#55CDFC\" },\n                    { pos: 0.25, color: \"#F7A8B8\" },\n                    { pos: 0.5, color: \"#FFFFFF\" },\n                    { pos: 0.75, color: \"#F7A8B8\" },\n                    { pos: 1, color: \"#55CDFC\" }\n                ]\n            },\n            {\n                name: \"Nonbinary Pride\",\n                angle: 0,\n                gradient: [\n                    { pos: 0/3, color: \"#FFF430\" },\n                    { pos: 1/3, color: \"#FFFFFF\" },\n                    { pos: 2/3, color: \"#9C59D1\" },\n                    { pos: 3/3, color: \"#000000\" },\n                ]\n            },\n        ];\n    }\n\n    private static _type: \"none\" | \"solid\" | \"gradient\" = \"none\";\n    private static _size: number = 0.05;\n    private static _color: string = \"#FFAA00\";\n    private static _gradient: GradientInfo = Border.defaults[0];\n    private static _shape: \"circle\" | \"square\" = \"circle\";\n\n    public static get type() : \"none\" | \"solid\" | \"gradient\" {\n        return this._type;\n    }\n\n    public static set type(type: \"none\" | \"solid\" | \"gradient\") {\n        this._type = type;\n        GlobalEvents.emitEvent(\"borderchange\");\n    }\n\n    public static get size() : number {\n        return this._size;\n    }\n\n    public static set size(size: number) {\n        this._size = size;\n        GlobalEvents.emitEvent(\"borderchange\");\n    }\n\n    public static set color(color: string) {\n        this._color = color;\n        GlobalEvents.emitEvent(\"borderchange\");\n    }\n\n    public static get color(): string {\n        return this._color;\n    }\n\n    public static set gradient(gradient: GradientInfo) {\n        this._gradient = gradient;\n        GlobalEvents.emitEvent(\"borderchange\");\n    }\n\n    public static get gradient(): GradientInfo {\n        return this._gradient;\n    }\n\n    public static set shape(shape: \"circle\" | \"square\") {\n        this._shape = shape;\n        GlobalEvents.emitEvent(\"borderchange\");\n    }\n\n    public static get shape(): \"circle\" | \"square\" {\n        return this._shape;\n    }\n\n    public static applyGradientToCanvas(gradientInfo : GradientInfo, canvas : Canvas) {\n        let a1 = (-270 - gradientInfo.angle) * Math.PI / 180;\n        let a2 = (-270 - (gradientInfo.angle + 180)) * Math.PI / 180;\n        \n        // https://math.stackexchange.com/questions/2468060/find-x-y-coordinates-of-a-square-given-an-angle-alpha\n        let p1 = new Point(\n            0.5 / Math.max(Math.abs(Math.cos(a1)), Math.abs(Math.sin(a1))) * Math.cos(a1),\n            0.5 / Math.max(Math.abs(Math.cos(a1)), Math.abs(Math.sin(a1))) * Math.sin(a1),\n        ).times(canvas.size).plus(canvas.size.dividedBy(2));\n        \n        let p2 = new Point(\n            0.5 / Math.max(Math.abs(Math.cos(a2)), Math.abs(Math.sin(a2))) * Math.cos(a2),\n            0.5 / Math.max(Math.abs(Math.cos(a2)), Math.abs(Math.sin(a2))) * Math.sin(a2),\n        ).times(canvas.size).plus(canvas.size.dividedBy(2));\n\n        // swap y values here since geometric y is inverted relative to screen y //\n        let gradient = canvas.context.createLinearGradient(p1.x, p2.y, p2.x, p1.y);\n        gradientInfo.gradient.forEach((def) => {\n            gradient.addColorStop(def.pos, def.color);\n        });\n        canvas.context.fillStyle = gradient;\n        canvas.context.fillRect(0, 0, canvas.width, canvas.height);\n    }\n\n    public static apply(canvas : Canvas) : void {\n        canvas.clear();\n\n        if (this.type === \"none\" || this.size === 0) {\n            return;\n        } else if (this.type === \"solid\") {\n            canvas.fill(this.color);\n            canvas.blendMode = \"destination-out\";\n            canvas.fillCircleInRect(canvas.size.toRectangle().expand(1 - this.size), \"white\");\n            canvas.blendMode = \"source-over\";\n        } else if (this.type === \"gradient\") {\n            this.applyGradientToCanvas(this.gradient, canvas);\n            canvas.blendMode = \"destination-out\";\n            if (this.shape === \"circle\") {\n                canvas.fillCircleInRect(canvas.size.toRectangle().expand(1 - this.size), \"white\");\n            } else {\n                canvas.fillRect(canvas.size.toRectangle().expand(1 - this.size), \"white\");\n            }\n            canvas.blendMode = \"source-over\";\n        }\n    }\n}","/*\n\tSuperGif\n\n\tExample usage:\n\n\t\t<img src=\"./example1_preview.gif\" rel:animated_src=\"./example1.gif\" width=\"360\" height=\"360\" rel:auto_play=\"1\" />\n\n\t\t<script type=\"text/javascript\">\n\t\t\t$$('img').each(function (img_tag) {\n\t\t\t\tif (/.*\\.gif/.test(img_tag.src)) {\n\t\t\t\t\tvar rub = new SuperGif({ gif: img_tag } );\n\t\t\t\t\trub.load();\n\t\t\t\t}\n\t\t\t});\n\t\t</script>\n\n\tImage tag attributes:\n\n\t\trel:animated_src -\tIf this url is specified, it's loaded into the player instead of src.\n\t\t\t\t\t\t\tThis allows a preview frame to be shown until animated gif data is streamed into the canvas\n\n\t\trel:auto_play -\t\tDefaults to 1 if not specified. If set to zero, a call to the play() method is needed\n\n\tConstructor options args\n\n\t\tgif \t\t\t\tRequired. The DOM element of an img tag.\n\t\tloop_mode\t\t\tOptional. Setting this to false will force disable looping of the gif.\n\t\tauto_play \t\t\tOptional. Same as the rel:auto_play attribute above, this arg overrides the img tag info.\n\t\tmax_width\t\t\tOptional. Scale images over max_width down to max_width. Helpful with mobile.\n \t\ton_end\t\t\t\tOptional. Add a callback for when the gif reaches the end of a single loop (one iteration). The first argument passed will be the gif HTMLElement.\n\t\tloop_delay\t\t\tOptional. The amount of time to pause (in ms) after each single loop (iteration).\n\t\tdraw_while_loading\tOptional. Determines whether the gif will be drawn to the canvas whilst it is loaded.\n\t\tshow_progress_bar\tOptional. Only applies when draw_while_loading is set to true.\n\n\tInstance methods\n\n\t\t// loading\n\t\tload( callback )\t\tLoads the gif specified by the src or rel:animated_src sttributie of the img tag into a canvas element and then calls callback if one is passed\n\t\tload_url( src, callback )\tLoads the gif file specified in the src argument into a canvas element and then calls callback if one is passed\n\n\t\t// play controls\n\t\tplay -\t\t\t\tStart playing the gif\n\t\tpause -\t\t\t\tStop playing the gif\n\t\tmove_to(i) -\t\tMove to frame i of the gif\n\t\tmove_relative(i) -\tMove i frames ahead (or behind if i < 0)\n\n\t\t// getters\n\t\tget_canvas\t\t\tThe canvas element that the gif is playing in. Handy for assigning event handlers to.\n\t\tget_playing\t\t\tWhether or not the gif is currently playing\n\t\tget_loading\t\t\tWhether or not the gif has finished loading/parsing\n\t\tget_auto_play\t\tWhether or not the gif is set to play automatically\n\t\tget_length\t\t\tThe number of frames in the gif\n\t\tget_current_frame\tThe index of the currently displayed frame of the gif\n\n\t\tFor additional customization (viewport inside iframe) these params may be passed:\n\t\tc_w, c_h - width and height of canvas\n\t\tvp_t, vp_l, vp_ w, vp_h - top, left, width and height of the viewport\n\n\t\tA bonus: few articles to understand what is going on\n\t\t\thttp://enthusiasms.org/post/16976438906\n\t\t\thttp://www.matthewflickinger.com/lab/whatsinagif/bits_and_bytes.asp\n\t\t\thttp://humpy77.deviantart.com/journal/Frame-Delay-Times-for-Animated-GIFs-214150546\n\n*/\n(function (root, factory) {\n    if (typeof define === 'function' && define.amd) {\n        define([], factory);\n    } else if (typeof exports === 'object') {\n        module.exports = factory();\n    } else {\n        root.SuperGif = factory();\n    }\n}(this, function () {\n    var shouldAbort = false;\n    var abortFn = null;\n    \n    // Generic functions\n    var bitsToNum = function (ba) {\n        return ba.reduce(function (s, n) {\n            return s * 2 + n;\n        }, 0);\n    };\n\n    var byteToBitArr = function (bite) {\n        var a = [];\n        for (var i = 7; i >= 0; i--) {\n            a.push( !! (bite & (1 << i)));\n        }\n        return a;\n    };\n\n    // Stream\n    /**\n     * @constructor\n     */\n    // Make compiler happy.\n    var Stream = function (data) {\n        this.data = data;\n        this.len = this.data.length;\n        this.pos = 0;\n\n        this.readByte = function () {\n            if (this.pos >= this.data.length) {\n                throw new Error('Attempted to read past end of stream.');\n            }\n            if (data instanceof Uint8Array)\n                return data[this.pos++];\n            else\n                return data.charCodeAt(this.pos++) & 0xFF;\n        };\n\n        this.readBytes = function (n) {\n            var bytes = [];\n            for (var i = 0; i < n; i++) {\n                bytes.push(this.readByte());\n            }\n            return bytes;\n        };\n\n        this.read = function (n) {\n            var s = '';\n            for (var i = 0; i < n; i++) {\n                s += String.fromCharCode(this.readByte());\n            }\n            return s;\n        };\n\n        this.readUnsigned = function () { // Little-endian.\n            var a = this.readBytes(2);\n            return (a[1] << 8) + a[0];\n        };\n    };\n\n    var lzwDecode = function (minCodeSize, data) {\n        // TODO: Now that the GIF parser is a bit different, maybe this should get an array of bytes instead of a String?\n        var pos = 0; // Maybe this streaming thing should be merged with the Stream?\n        var readCode = function (size) {\n            var code = 0;\n            for (var i = 0; i < size; i++) {\n                if (data.charCodeAt(pos >> 3) & (1 << (pos & 7))) {\n                    code |= 1 << i;\n                }\n                pos++;\n            }\n            return code;\n        };\n\n        var output = [];\n\n        var clearCode = 1 << minCodeSize;\n        var eoiCode = clearCode + 1;\n\n        var codeSize = minCodeSize + 1;\n\n        var dict = [];\n\n        var clear = function () {\n            dict = [];\n            codeSize = minCodeSize + 1;\n            for (var i = 0; i < clearCode; i++) {\n                dict[i] = [i];\n            }\n            dict[clearCode] = [];\n            dict[eoiCode] = null;\n\n        };\n\n        var code;\n        var last;\n\n        while (true) {\n            last = code;\n            code = readCode(codeSize);\n\n            if (code === clearCode) {\n                clear();\n                continue;\n            }\n            if (code === eoiCode) break;\n\n            if (code < dict.length) {\n                if (last !== clearCode) {\n                    dict.push(dict[last].concat(dict[code][0]));\n                }\n            }\n            else {\n                if (code !== dict.length) throw new Error('Invalid LZW code.');\n                dict.push(dict[last].concat(dict[last][0]));\n            }\n            output.push.apply(output, dict[code]);\n\n            if (dict.length === (1 << codeSize) && codeSize < 12) {\n                // If we're at the last code and codeSize is 12, the next code will be a clearCode, and it'll be 12 bits long.\n                codeSize++;\n            }\n        }\n\n        // I don't know if this is technically an error, but some GIFs do it.\n        //if (Math.ceil(pos / 8) !== data.length) throw new Error('Extraneous LZW bytes.');\n        return output;\n    };\n\n\n    // The actual parsing; returns an object with properties.\n    var parseGIF = function (st, handler) {\n        handler || (handler = {});\n\n        // LZW (GIF-specific)\n        var parseCT = function (entries) { // Each entry is 3 bytes, for RGB.\n            var ct = [];\n            for (var i = 0; i < entries; i++) {\n                ct.push(st.readBytes(3));\n            }\n            return ct;\n        };\n\n        var readSubBlocks = function () {\n            var size, data;\n            data = '';\n            do {\n                size = st.readByte();\n                data += st.read(size);\n            } while (size !== 0);\n            return data;\n        };\n\n        var parseHeader = function () {\n            var hdr = {};\n            hdr.sig = st.read(3);\n            hdr.ver = st.read(3);\n            if (hdr.sig !== 'GIF') throw new Error('Not a GIF file.'); // XXX: This should probably be handled more nicely.\n            hdr.width = st.readUnsigned();\n            hdr.height = st.readUnsigned();\n\n            var bits = byteToBitArr(st.readByte());\n            hdr.gctFlag = bits.shift();\n            hdr.colorRes = bitsToNum(bits.splice(0, 3));\n            hdr.sorted = bits.shift();\n            hdr.gctSize = bitsToNum(bits.splice(0, 3));\n\n            hdr.bgColor = st.readByte();\n            hdr.pixelAspectRatio = st.readByte(); // if not 0, aspectRatio = (pixelAspectRatio + 15) / 64\n            if (hdr.gctFlag) {\n                hdr.gct = parseCT(1 << (hdr.gctSize + 1));\n            }\n            handler.hdr && handler.hdr(hdr);\n        };\n\n        var parseExt = function (block) {\n            var parseGCExt = function (block) {\n                var blockSize = st.readByte(); // Always 4\n                var bits = byteToBitArr(st.readByte());\n                block.reserved = bits.splice(0, 3); // Reserved; should be 000.\n                block.disposalMethod = bitsToNum(bits.splice(0, 3));\n                block.userInput = bits.shift();\n                block.transparencyGiven = bits.shift();\n\n                block.delayTime = st.readUnsigned();\n\n                block.transparencyIndex = st.readByte();\n\n                block.terminator = st.readByte();\n\n                handler.gce && handler.gce(block);\n            };\n\n            var parseComExt = function (block) {\n                block.comment = readSubBlocks();\n                handler.com && handler.com(block);\n            };\n\n            var parsePTExt = function (block) {\n                // No one *ever* uses this. If you use it, deal with parsing it yourself.\n                var blockSize = st.readByte(); // Always 12\n                block.ptHeader = st.readBytes(12);\n                block.ptData = readSubBlocks();\n                handler.pte && handler.pte(block);\n            };\n\n            var parseAppExt = function (block) {\n                var parseNetscapeExt = function (block) {\n                    var blockSize = st.readByte(); // Always 3\n                    block.unknown = st.readByte(); // ??? Always 1? What is this?\n                    block.iterations = st.readUnsigned();\n                    block.terminator = st.readByte();\n                    handler.app && handler.app.NETSCAPE && handler.app.NETSCAPE(block);\n                };\n\n                var parseUnknownAppExt = function (block) {\n                    block.appData = readSubBlocks();\n                    // FIXME: This won't work if a handler wants to match on any identifier.\n                    handler.app && handler.app[block.identifier] && handler.app[block.identifier](block);\n                };\n\n                var blockSize = st.readByte(); // Always 11\n                block.identifier = st.read(8);\n                block.authCode = st.read(3);\n                switch (block.identifier) {\n                    case 'NETSCAPE':\n                        parseNetscapeExt(block);\n                        break;\n                    default:\n                        parseUnknownAppExt(block);\n                        break;\n                }\n            };\n\n            var parseUnknownExt = function (block) {\n                block.data = readSubBlocks();\n                handler.unknown && handler.unknown(block);\n            };\n\n            block.label = st.readByte();\n            switch (block.label) {\n                case 0xF9:\n                    block.extType = 'gce';\n                    parseGCExt(block);\n                    break;\n                case 0xFE:\n                    block.extType = 'com';\n                    parseComExt(block);\n                    break;\n                case 0x01:\n                    block.extType = 'pte';\n                    parsePTExt(block);\n                    break;\n                case 0xFF:\n                    block.extType = 'app';\n                    parseAppExt(block);\n                    break;\n                default:\n                    block.extType = 'unknown';\n                    parseUnknownExt(block);\n                    break;\n            }\n        };\n\n        var parseImg = function (img) {\n            var deinterlace = function (pixels, width) {\n                // Of course this defeats the purpose of interlacing. And it's *probably*\n                // the least efficient way it's ever been implemented. But nevertheless...\n                var newPixels = new Array(pixels.length);\n                var rows = pixels.length / width;\n                var cpRow = function (toRow, fromRow) {\n                    var fromPixels = pixels.slice(fromRow * width, (fromRow + 1) * width);\n                    newPixels.splice.apply(newPixels, [toRow * width, width].concat(fromPixels));\n                };\n\n                // See appendix E.\n                var offsets = [0, 4, 2, 1];\n                var steps = [8, 8, 4, 2];\n\n                var fromRow = 0;\n                for (var pass = 0; pass < 4; pass++) {\n                    for (var toRow = offsets[pass]; toRow < rows; toRow += steps[pass]) {\n                        cpRow(toRow, fromRow)\n                        fromRow++;\n                    }\n                }\n\n                return newPixels;\n            };\n\n            img.leftPos = st.readUnsigned();\n            img.topPos = st.readUnsigned();\n            img.width = st.readUnsigned();\n            img.height = st.readUnsigned();\n\n            var bits = byteToBitArr(st.readByte());\n            img.lctFlag = bits.shift();\n            img.interlaced = bits.shift();\n            img.sorted = bits.shift();\n            img.reserved = bits.splice(0, 2);\n            img.lctSize = bitsToNum(bits.splice(0, 3));\n\n            if (img.lctFlag) {\n                img.lct = parseCT(1 << (img.lctSize + 1));\n            }\n\n            img.lzwMinCodeSize = st.readByte();\n\n            var lzwData = readSubBlocks();\n\n            img.pixels = lzwDecode(img.lzwMinCodeSize, lzwData);\n\n            if (img.interlaced) { // Move\n                img.pixels = deinterlace(img.pixels, img.width);\n            }\n\n            handler.img && handler.img(img);\n        };\n\n        var parseBlock = function () {\n            var block = {};\n            block.sentinel = st.readByte();\n\n            switch (String.fromCharCode(block.sentinel)) { // For ease of matching\n                case '!':\n                    block.type = 'ext';\n                    parseExt(block);\n                    break;\n                case ',':\n                    block.type = 'img';\n                    parseImg(block);\n                    break;\n                case ';':\n                    block.type = 'eof';\n                    handler.eof && handler.eof(block);\n                    break;\n                default:\n                    throw new Error('Unknown block: 0x' + block.sentinel.toString(16)); // TODO: Pad this with a 0.\n            }\n\n            if (shouldAbort) {\n                abortFn && abortFn();\n                shouldAbort = false;\n                return;\n            }\n\n            if (block.type !== 'eof') setTimeout(parseBlock, 0);\n        };\n\n        var parse = function () {\n            parseHeader();\n            setTimeout(parseBlock, 0);\n        };\n\n        parse();\n    };\n\n    var SuperGif = function ( opts ) {\n        var options = {\n            //viewport position\n            vp_l: 0,\n            vp_t: 0,\n            vp_w: null,\n            vp_h: null,\n            //canvas sizes\n            c_w: null,\n            c_h: null\n        };\n        for (var i in opts ) { options[i] = opts[i] }\n        if (options.vp_w && options.vp_h) options.is_vp = true;\n\n        var stream;\n        var hdr;\n\n        var loadError = null;\n        var loading = false;\n\n        var transparency = null;\n        var delay = null;\n        var disposalMethod = null;\n        var disposalRestoreFromIdx = null;\n        var lastDisposalMethod = null;\n        var frame = null;\n        var lastImg = null;\n\n        var playing = true;\n        var forward = true;\n\n        var ctx_scaled = false;\n\n        var frames = [];\n        var frameOffsets = []; // elements have .x and .y properties\n\n        var gif = options.gif;\n        if (typeof options.auto_play == 'undefined')\n            options.auto_play = (!gif.getAttribute('rel:auto_play') || gif.getAttribute('rel:auto_play') == '1');\n\n        var onEndListener = (options.hasOwnProperty('on_end') ? options.on_end : null);\n        var loopDelay = (options.hasOwnProperty('loop_delay') ? options.loop_delay : 0);\n        var overrideLoopMode = (options.hasOwnProperty('loop_mode') ? options.loop_mode : 'auto');\n        var drawWhileLoading = (options.hasOwnProperty('draw_while_loading') ? options.draw_while_loading : true);\n        var showProgressBar = drawWhileLoading ? (options.hasOwnProperty('show_progress_bar') ? options.show_progress_bar : true) : false;\n        var progressBarHeight = (options.hasOwnProperty('progressbar_height') ? options.progressbar_height : 25);\n        var progressBarBackgroundColor = (options.hasOwnProperty('progressbar_background_color') ? options.progressbar_background_color : 'rgba(255,255,255,0.4)');\n        var progressBarForegroundColor = (options.hasOwnProperty('progressbar_foreground_color') ? options.progressbar_foreground_color : 'rgba(255,0,22,.8)');\n\n        var clear = function () {\n            transparency = null;\n            delay = null;\n            lastDisposalMethod = disposalMethod;\n            disposalMethod = null;\n            frame = null;\n        };\n\n        // XXX: There's probably a better way to handle catching exceptions when\n        // callbacks are involved.\n        var doParse = function () {\n            try {\n                parseGIF(stream, handler);\n            }\n            catch (err) {\n                doLoadError('parse');\n            }\n        };\n\n        var doText = function (text) {\n            toolbar.innerHTML = text; // innerText? Escaping? Whatever.\n            toolbar.style.visibility = 'visible';\n        };\n\n        var setSizes = function(w, h) {\n            canvas.width = w * get_canvas_scale();\n            canvas.height = h * get_canvas_scale();\n            toolbar.style.minWidth = ( w * get_canvas_scale() ) + 'px';\n\n            tmpCanvas.width = w;\n            tmpCanvas.height = h;\n            tmpCanvas.style.width = w + 'px';\n            tmpCanvas.style.height = h + 'px';\n            tmpCanvas.getContext('2d').setTransform(1, 0, 0, 1, 0, 0);\n        };\n\n        var setFrameOffset = function(frame, offset) {\n            if (!frameOffsets[frame]) {\n                frameOffsets[frame] = offset;\n                return;\n            }\n            if (typeof offset.x !== 'undefined') {\n                frameOffsets[frame].x = offset.x;\n            }\n            if (typeof offset.y !== 'undefined') {\n                frameOffsets[frame].y = offset.y;\n            }\n        };\n\n        var doShowProgress = function (pos, length, draw) {\n            if (draw && showProgressBar) {\n                var height = progressBarHeight;\n                var left, mid, top, width;\n                if (options.is_vp) {\n                    if (!ctx_scaled) {\n                        top = (options.vp_t + options.vp_h - height);\n                        height = height;\n                        left = options.vp_l;\n                        mid = left + (pos / length) * options.vp_w;\n                        width = canvas.width;\n                    } else {\n                        top = (options.vp_t + options.vp_h - height) / get_canvas_scale();\n                        height = height / get_canvas_scale();\n                        left = (options.vp_l / get_canvas_scale() );\n                        mid = left + (pos / length) * (options.vp_w / get_canvas_scale());\n                        width = canvas.width / get_canvas_scale();\n                    }\n                    //some debugging, draw rect around viewport\n                    if (false) {\n                        if (!ctx_scaled) {\n                            var l = options.vp_l, t = options.vp_t;\n                            var w = options.vp_w, h = options.vp_h;\n                        } else {\n                            var l = options.vp_l/get_canvas_scale(), t = options.vp_t/get_canvas_scale();\n                            var w = options.vp_w/get_canvas_scale(), h = options.vp_h/get_canvas_scale();\n                        }\n                        ctx.rect(l,t,w,h);\n                        ctx.stroke();\n                    }\n                }\n                else {\n                    top = (canvas.height - height) / (ctx_scaled ? get_canvas_scale() : 1);\n                    mid = ((pos / length) * canvas.width) / (ctx_scaled ? get_canvas_scale() : 1);\n                    width = canvas.width / (ctx_scaled ? get_canvas_scale() : 1 );\n                    height /= ctx_scaled ? get_canvas_scale() : 1;\n                }\n\n                ctx.fillStyle = progressBarBackgroundColor;\n                ctx.fillRect(mid, top, width - mid, height);\n\n                ctx.fillStyle = progressBarForegroundColor;\n                ctx.fillRect(0, top, mid, height);\n            }\n        };\n\n        var doLoadError = function (originOfError) {\n            var drawError = function () {\n                ctx.fillStyle = 'black';\n                ctx.fillRect(0, 0, options.c_w ? options.c_w : hdr.width, options.c_h ? options.c_h : hdr.height);\n                ctx.strokeStyle = 'red';\n                ctx.lineWidth = 3;\n                ctx.moveTo(0, 0);\n                ctx.lineTo(options.c_w ? options.c_w : hdr.width, options.c_h ? options.c_h : hdr.height);\n                ctx.moveTo(0, options.c_h ? options.c_h : hdr.height);\n                ctx.lineTo(options.c_w ? options.c_w : hdr.width, 0);\n                ctx.stroke();\n            };\n\n            loadError = originOfError;\n            hdr = {\n                width: gif.width,\n                height: gif.height\n            }; // Fake header.\n            frames = [];\n            drawError();\n        };\n\n        var doHdr = function (_hdr) {\n            hdr = _hdr;\n            setSizes(hdr.width, hdr.height)\n        };\n\n        var doGCE = function (gce) {\n            pushFrame();\n            clear();\n            transparency = gce.transparencyGiven ? gce.transparencyIndex : null;\n            delay = gce.delayTime;\n            disposalMethod = gce.disposalMethod;\n            // We don't have much to do with the rest of GCE.\n        };\n\n        var pushFrame = function () {\n            if (!frame) return;\n            frames.push({\n                            data: frame.getImageData(0, 0, hdr.width, hdr.height),\n                            delay: delay\n                        });\n            frameOffsets.push({ x: 0, y: 0 });\n        };\n\n        var doImg = function (img) {\n            if (!frame) frame = tmpCanvas.getContext('2d');\n\n            var currIdx = frames.length;\n\n            //ct = color table, gct = global color table\n            var ct = img.lctFlag ? img.lct : hdr.gct; // TODO: What if neither exists?\n\n            /*\n            Disposal method indicates the way in which the graphic is to\n            be treated after being displayed.\n\n            Values :    0 - No disposal specified. The decoder is\n                            not required to take any action.\n                        1 - Do not dispose. The graphic is to be left\n                            in place.\n                        2 - Restore to background color. The area used by the\n                            graphic must be restored to the background color.\n                        3 - Restore to previous. The decoder is required to\n                            restore the area overwritten by the graphic with\n                            what was there prior to rendering the graphic.\n\n                            Importantly, \"previous\" means the frame state\n                            after the last disposal of method 0, 1, or 2.\n            */\n            if (currIdx > 0) {\n                if (lastDisposalMethod === 3) {\n                    // Restore to previous\n                    // If we disposed every frame including first frame up to this point, then we have\n                    // no composited frame to restore to. In this case, restore to background instead.\n                    if (disposalRestoreFromIdx !== null) {\n                    \tframe.putImageData(frames[disposalRestoreFromIdx].data, 0, 0);\n                    } else {\n                    \tframe.clearRect(lastImg.leftPos, lastImg.topPos, lastImg.width, lastImg.height);\n                    }\n                } else {\n                    disposalRestoreFromIdx = currIdx - 1;\n                }\n\n                if (lastDisposalMethod === 2) {\n                    // Restore to background color\n                    // Browser implementations historically restore to transparent; we do the same.\n                    // http://www.wizards-toolkit.org/discourse-server/viewtopic.php?f=1&t=21172#p86079\n                    frame.clearRect(lastImg.leftPos, lastImg.topPos, lastImg.width, lastImg.height);\n                }\n            }\n            // else, Undefined/Do not dispose.\n            // frame contains final pixel data from the last frame; do nothing\n\n            //Get existing pixels for img region after applying disposal method\n            var imgData = frame.getImageData(img.leftPos, img.topPos, img.width, img.height);\n\n            //apply color table colors\n            img.pixels.forEach(function (pixel, i) {\n                // imgData.data === [R,G,B,A,R,G,B,A,...]\n                if (pixel !== transparency) {\n                    imgData.data[i * 4 + 0] = ct[pixel][0];\n                    imgData.data[i * 4 + 1] = ct[pixel][1];\n                    imgData.data[i * 4 + 2] = ct[pixel][2];\n                    imgData.data[i * 4 + 3] = 255; // Opaque.\n                }\n            });\n\n            frame.putImageData(imgData, img.leftPos, img.topPos);\n\n            if (!ctx_scaled) {\n                ctx.scale(get_canvas_scale(),get_canvas_scale());\n                ctx_scaled = true;\n            }\n\n            // We could use the on-page canvas directly, except that we draw a progress\n            // bar for each image chunk (not just the final image).\n            if (drawWhileLoading) {\n                ctx.drawImage(tmpCanvas, 0, 0);\n                drawWhileLoading = options.auto_play;\n            }\n\n            lastImg = img;\n        };\n\n        var player = (function () {\n            var i = -1;\n            var iterationCount = 0;\n\n            var showingInfo = false;\n            var pinned = false;\n\n            /**\n             * Gets the index of the frame \"up next\".\n             * @returns {number}\n             */\n            var getNextFrameNo = function () {\n                var delta = (forward ? 1 : -1);\n                return (i + delta + frames.length) % frames.length;\n            };\n\n            var stepFrame = function (amount) { // XXX: Name is confusing.\n                i = i + amount;\n\n                putFrame();\n            };\n\n            var step = (function () {\n                var stepping = false;\n\n                var completeLoop = function () {\n                    if (onEndListener !== null)\n                        onEndListener(gif);\n                    iterationCount++;\n\n                    if (overrideLoopMode !== false || iterationCount < 0) {\n                        doStep();\n                    } else {\n                        stepping = false;\n                        playing = false;\n                    }\n                };\n\n                var doStep = function () {\n                    stepping = playing;\n                    if (!stepping) return;\n\n                    stepFrame(1);\n                    var delay = frames[i].delay * 10;\n                    if (!delay) delay = 100; // FIXME: Should this even default at all? What should it be?\n\n                    var nextFrameNo = getNextFrameNo();\n                    if (nextFrameNo === 0) {\n                        delay += loopDelay;\n                        setTimeout(completeLoop, delay);\n                    } else {\n                        setTimeout(doStep, delay);\n                    }\n                };\n\n                return function () {\n                    if (!stepping) setTimeout(doStep, 0);\n                };\n            }());\n\n            var putFrame = function () {\n                var offset;\n                i = parseInt(i, 10);\n\n                if (i > frames.length - 1){\n                    i = 0;\n                }\n\n                if (i < 0){\n                    i = 0;\n                }\n\n                offset = frameOffsets[i];\n\n                tmpCanvas.getContext(\"2d\").putImageData(frames[i].data, offset.x, offset.y);\n                ctx.globalCompositeOperation = \"copy\";\n                ctx.drawImage(tmpCanvas, 0, 0);\n            };\n\n            var play = function () {\n                playing = true;\n                step();\n            };\n\n            var pause = function () {\n                playing = false;\n            };\n\n\n            return {\n                init: function () {\n                    if (loadError) return;\n\n                    if ( ! (options.c_w && options.c_h) ) {\n                        ctx.scale(get_canvas_scale(),get_canvas_scale());\n                    }\n\n                    if (options.auto_play) {\n                        step();\n                    }\n                    else {\n                        i = 0;\n                        putFrame();\n                    }\n                },\n                step: step,\n                play: play,\n                pause: pause,\n                playing: playing,\n                move_relative: stepFrame,\n                current_frame: function() { return i; },\n                frames: function() { return frames },\n                length: function() { return frames.length },\n                move_to: function ( frame_idx ) {\n                    i = frame_idx;\n                    putFrame();\n                }\n            }\n        }());\n\n        var doDecodeProgress = function (draw) {\n            doShowProgress(stream.pos, stream.data.length, draw);\n        };\n\n        var doNothing = function () {};\n        /**\n         * @param{boolean=} draw Whether to draw progress bar or not; this is not idempotent because of translucency.\n         *                       Note that this means that the text will be unsynchronized with the progress bar on non-frames;\n         *                       but those are typically so small (GCE etc.) that it doesn't really matter. TODO: Do this properly.\n         */\n        var withProgress = function (fn, draw) {\n            return function (block) {\n                fn(block);\n                doDecodeProgress(draw);\n            };\n        };\n\n\n        var handler = {\n            hdr: withProgress(doHdr),\n            gce: withProgress(doGCE),\n            com: withProgress(doNothing),\n            // I guess that's all for now.\n            app: {\n                // TODO: Is there much point in actually supporting iterations?\n                NETSCAPE: withProgress(doNothing)\n            },\n            img: withProgress(doImg, true),\n            eof: function (block) {\n                //toolbar.style.display = '';\n                pushFrame();\n                doDecodeProgress(false);\n                if ( ! (options.c_w && options.c_h) ) {\n                    canvas.width = hdr.width * get_canvas_scale();\n                    canvas.height = hdr.height * get_canvas_scale();\n                }\n                player.init();\n                loading = false;\n                if (load_callback) {\n                    load_callback(gif);\n                }\n\n            }\n        };\n\n        var init = function () {\n            var parent = gif.parentNode;\n\n            var div = document.createElement('div');\n            canvas = document.createElement('canvas');\n            ctx = canvas.getContext('2d');\n            toolbar = document.createElement('div');\n\n            tmpCanvas = document.createElement('canvas');\n\n            div.width = canvas.width = gif.width;\n            div.height = canvas.height = gif.height;\n            toolbar.style.minWidth = gif.width + 'px';\n\n            div.className = 'jsgif';\n            toolbar.className = 'jsgif_toolbar';\n            div.appendChild(canvas);\n            div.appendChild(toolbar);\n\n            if (parent) {\n                parent.insertBefore(div, gif);\n                parent.removeChild(gif);\n            }\n\n            if (options.c_w && options.c_h) setSizes(options.c_w, options.c_h);\n            initialized=true;\n        };\n\n        var get_canvas_scale = function() {\n            var scale;\n            if (options.max_width && hdr && hdr.width > options.max_width) {\n                scale = options.max_width / hdr.width;\n            }\n            else {\n                scale = 1;\n            }\n            return scale;\n        }\n\n        var canvas, ctx, toolbar, tmpCanvas;\n        var initialized = false;\n        var load_callback = false;\n\n        var load_setup = function(callback) {\n            if (loading) return false;\n            if (callback) load_callback = callback;\n            else load_callback = false;\n\n            loading = true;\n            frames = [];\n            clear();\n            disposalRestoreFromIdx = null;\n            lastDisposalMethod = null;\n            frame = null;\n            lastImg = null;\n\n            return true;\n        }\n\n        return {\n            // play controls\n            play: player.play,\n            pause: player.pause,\n            move_relative: player.move_relative,\n            move_to: player.move_to,\n\n            // getters for instance vars\n            get_frames       : function() { return player.frames() },\n            get_playing      : function() { return playing },\n            get_canvas       : function() { return canvas },\n            get_canvas_scale : function() { return get_canvas_scale() },\n            get_loading      : function() { return loading },\n            get_auto_play    : function() { return options.auto_play },\n            get_length       : function() { return player.length() },\n            get_current_frame: function() { return player.current_frame() },\n            load_url: function(src,callback,onprogress,onabort){\n                if (!load_setup(callback)) return;\n\n                abortFn = onabort;\n                shouldAbort = false;\n\n                var h = new XMLHttpRequest();\n                // new browsers (XMLHttpRequest2-compliant)\n                h.open('GET', src, true);\n\n                if ('overrideMimeType' in h) {\n                    h.overrideMimeType('text/plain; charset=x-user-defined');\n                }\n\n                // old browsers (XMLHttpRequest-compliant)\n                else if ('responseType' in h) {\n                    h.responseType = 'arraybuffer';\n                }\n\n                // IE9 (Microsoft.XMLHTTP-compliant)\n                else {\n                    h.setRequestHeader('Accept-Charset', 'x-user-defined');\n                }\n\n                h.onloadstart = function() {\n                    // Wait until connection is opened to replace the gif element with a canvas to avoid a blank img\n                    if (!initialized) init();\n                };\n                h.onload = function(e) {\n                    if (this.status != 200) {\n                        doLoadError('xhr - response');\n                    }\n                    // emulating response field for IE9\n                    if (!('response' in this)) {\n                        this.response = new VBArray(this.responseText).toArray().map(String.fromCharCode).join('');\n                    }\n                    var data = this.response;\n                    if (data.toString().indexOf(\"ArrayBuffer\") > 0) {\n                        data = new Uint8Array(data);\n                    }\n\n                    stream = new Stream(data);\n                    setTimeout(doParse, 0);\n                };\n                h.onprogress = function (e) {\n                    if (e.lengthComputable) {\n                        doShowProgress(e.loaded, e.total, true);\n                    }\n                    onprogress && onprogress(e);\n                };\n                h.onerror = function() { doLoadError('xhr'); };\n                h.send();\n            },\n            load: function (callback, onprogress, onabort) {\n                this.load_url(gif.getAttribute('rel:animated_src') || gif.src, callback, onprogress, onabort);\n            },\n            load_raw: function(arr, callback) {\n                if (!load_setup(callback)) return;\n                if (!initialized) init();\n                stream = new Stream(arr);\n                setTimeout(doParse, 0);\n            },\n            abort: function() {\n                shouldAbort = true;\n            },\n            set_frame_offset: setFrameOffset\n        };\n    };\n\n    return SuperGif;\n}));\n\n\n","// gif.js 0.2.0 - https://github.com/jnordberg/gif.js\n(function(f) {\n    if (typeof exports === \"object\" && typeof module !== \"undefined\") {\n        module.exports = f()\n    } else if (typeof define === \"function\" && define.amd) {\n        define([], f)\n    } else {\n        var g;\n        if (typeof window !== \"undefined\") {\n            g = window\n        } else if (typeof global !== \"undefined\") {\n            g = global\n        } else if (typeof self !== \"undefined\") {\n            g = self\n        } else {\n            g = this\n        }\n        g.GIF = f()\n    }\n})(function() {\n    var define, module, exports;\n    return function e(t, n, r) {\n        function s(o, u) {\n            if (!n[o]) {\n                if (!t[o]) {\n                    var a = typeof require == \"function\" && require;\n                    if (!u && a) return a(o, !0);\n                    if (i) return i(o, !0);\n                    var f = new Error(\"Cannot find module '\" + o + \"'\");\n                    throw f.code = \"MODULE_NOT_FOUND\", f\n                }\n                var l = n[o] = {\n                    exports: {}\n                };\n                t[o][0].call(l.exports, function(e) {\n                    var n = t[o][1][e];\n                    return s(n ? n : e)\n                }, l, l.exports, e, t, n, r)\n            }\n            return n[o].exports\n        }\n        var i = typeof require == \"function\" && require;\n        for (var o = 0; o < r.length; o++) s(r[o]);\n        return s\n    }({\n        1: [function(require, module, exports) {\n            function EventEmitter() {\n                this._events = this._events || {};\n                this._maxListeners = this._maxListeners || undefined\n            }\n            module.exports = EventEmitter;\n            EventEmitter.EventEmitter = EventEmitter;\n            EventEmitter.prototype._events = undefined;\n            EventEmitter.prototype._maxListeners = undefined;\n            EventEmitter.defaultMaxListeners = 10;\n            EventEmitter.prototype.setMaxListeners = function(n) {\n                if (!isNumber(n) || n < 0 || isNaN(n)) throw TypeError(\"n must be a positive number\");\n                this._maxListeners = n;\n                return this\n            };\n            EventEmitter.prototype.emit = function(type) {\n                var er, handler, len, args, i, listeners;\n                if (!this._events) this._events = {};\n                if (type === \"error\") {\n                    if (!this._events.error || isObject(this._events.error) && !this._events.error.length) {\n                        er = arguments[1];\n                        if (er instanceof Error) {\n                            throw er\n                        } else {\n                            var err = new Error('Uncaught, unspecified \"error\" event. (' + er + \")\");\n                            err.context = er;\n                            throw err\n                        }\n                    }\n                }\n                handler = this._events[type];\n                if (isUndefined(handler)) return false;\n                if (isFunction(handler)) {\n                    switch (arguments.length) {\n                        case 1:\n                            handler.call(this);\n                            break;\n                        case 2:\n                            handler.call(this, arguments[1]);\n                            break;\n                        case 3:\n                            handler.call(this, arguments[1], arguments[2]);\n                            break;\n                        default:\n                            args = Array.prototype.slice.call(arguments, 1);\n                            handler.apply(this, args)\n                    }\n                } else if (isObject(handler)) {\n                    args = Array.prototype.slice.call(arguments, 1);\n                    listeners = handler.slice();\n                    len = listeners.length;\n                    for (i = 0; i < len; i++) listeners[i].apply(this, args)\n                }\n                return true\n            };\n            EventEmitter.prototype.addListener = function(type, listener) {\n                var m;\n                if (!isFunction(listener)) throw TypeError(\"listener must be a function\");\n                if (!this._events) this._events = {};\n                if (this._events.newListener) this.emit(\"newListener\", type, isFunction(listener.listener) ? listener.listener : listener);\n                if (!this._events[type]) this._events[type] = listener;\n                else if (isObject(this._events[type])) this._events[type].push(listener);\n                else this._events[type] = [this._events[type], listener];\n                if (isObject(this._events[type]) && !this._events[type].warned) {\n                    if (!isUndefined(this._maxListeners)) {\n                        m = this._maxListeners\n                    } else {\n                        m = EventEmitter.defaultMaxListeners\n                    }\n                    if (m && m > 0 && this._events[type].length > m) {\n                        this._events[type].warned = true;\n                        console.error(\"(node) warning: possible EventEmitter memory \" + \"leak detected. %d listeners added. \" + \"Use emitter.setMaxListeners() to increase limit.\", this._events[type].length);\n                        if (typeof console.trace === \"function\") {\n                            console.trace()\n                        }\n                    }\n                }\n                return this\n            };\n            EventEmitter.prototype.on = EventEmitter.prototype.addListener;\n            EventEmitter.prototype.once = function(type, listener) {\n                if (!isFunction(listener)) throw TypeError(\"listener must be a function\");\n                var fired = false;\n\n                function g() {\n                    this.removeListener(type, g);\n                    if (!fired) {\n                        fired = true;\n                        listener.apply(this, arguments)\n                    }\n                }\n                g.listener = listener;\n                this.on(type, g);\n                return this\n            };\n            EventEmitter.prototype.removeListener = function(type, listener) {\n                var list, position, length, i;\n                if (!isFunction(listener)) throw TypeError(\"listener must be a function\");\n                if (!this._events || !this._events[type]) return this;\n                list = this._events[type];\n                length = list.length;\n                position = -1;\n                if (list === listener || isFunction(list.listener) && list.listener === listener) {\n                    delete this._events[type];\n                    if (this._events.removeListener) this.emit(\"removeListener\", type, listener)\n                } else if (isObject(list)) {\n                    for (i = length; i-- > 0;) {\n                        if (list[i] === listener || list[i].listener && list[i].listener === listener) {\n                            position = i;\n                            break\n                        }\n                    }\n                    if (position < 0) return this;\n                    if (list.length === 1) {\n                        list.length = 0;\n                        delete this._events[type]\n                    } else {\n                        list.splice(position, 1)\n                    }\n                    if (this._events.removeListener) this.emit(\"removeListener\", type, listener)\n                }\n                return this\n            };\n            EventEmitter.prototype.removeAllListeners = function(type) {\n                var key, listeners;\n                if (!this._events) return this;\n                if (!this._events.removeListener) {\n                    if (arguments.length === 0) this._events = {};\n                    else if (this._events[type]) delete this._events[type];\n                    return this\n                }\n                if (arguments.length === 0) {\n                    for (key in this._events) {\n                        if (key === \"removeListener\") continue;\n                        this.removeAllListeners(key)\n                    }\n                    this.removeAllListeners(\"removeListener\");\n                    this._events = {};\n                    return this\n                }\n                listeners = this._events[type];\n                if (isFunction(listeners)) {\n                    this.removeListener(type, listeners)\n                } else if (listeners) {\n                    while (listeners.length) this.removeListener(type, listeners[listeners.length - 1])\n                }\n                delete this._events[type];\n                return this\n            };\n            EventEmitter.prototype.listeners = function(type) {\n                var ret;\n                if (!this._events || !this._events[type]) ret = [];\n                else if (isFunction(this._events[type])) ret = [this._events[type]];\n                else ret = this._events[type].slice();\n                return ret\n            };\n            EventEmitter.prototype.listenerCount = function(type) {\n                if (this._events) {\n                    var evlistener = this._events[type];\n                    if (isFunction(evlistener)) return 1;\n                    else if (evlistener) return evlistener.length\n                }\n                return 0\n            };\n            EventEmitter.listenerCount = function(emitter, type) {\n                return emitter.listenerCount(type)\n            };\n\n            function isFunction(arg) {\n                return typeof arg === \"function\"\n            }\n\n            function isNumber(arg) {\n                return typeof arg === \"number\"\n            }\n\n            function isObject(arg) {\n                return typeof arg === \"object\" && arg !== null\n            }\n\n            function isUndefined(arg) {\n                return arg === void 0\n            }\n        }, {}],\n        2: [function(require, module, exports) {\n            var UA, browser, mode, platform, ua;\n            ua = navigator.userAgent.toLowerCase();\n            platform = navigator.platform.toLowerCase();\n            UA = ua.match(/(opera|ie|firefox|chrome|version)[\\s\\/:]([\\w\\d\\.]+)?.*?(safari|version[\\s\\/:]([\\w\\d\\.]+)|$)/) || [null, \"unknown\", 0];\n            mode = UA[1] === \"ie\" && document.documentMode;\n            browser = {\n                name: UA[1] === \"version\" ? UA[3] : UA[1],\n                version: mode || parseFloat(UA[1] === \"opera\" && UA[4] ? UA[4] : UA[2]),\n                platform: {\n                    name: ua.match(/ip(?:ad|od|hone)/) ? \"ios\" : (ua.match(/(?:webos|android)/) || platform.match(/mac|win|linux/) || [\"other\"])[0]\n                }\n            };\n            browser[browser.name] = true;\n            browser[browser.name + parseInt(browser.version, 10)] = true;\n            browser.platform[browser.platform.name] = true;\n            module.exports = browser\n        }, {}],\n        3: [function(require, module, exports) {\n            var EventEmitter, GIF, browser, extend = function(child, parent) {\n                    for (var key in parent) {\n                        if (hasProp.call(parent, key)) child[key] = parent[key]\n                    }\n\n                    function ctor() {\n                        this.constructor = child\n                    }\n                    ctor.prototype = parent.prototype;\n                    child.prototype = new ctor;\n                    child.__super__ = parent.prototype;\n                    return child\n                },\n                hasProp = {}.hasOwnProperty,\n                indexOf = [].indexOf || function(item) {\n                    for (var i = 0, l = this.length; i < l; i++) {\n                        if (i in this && this[i] === item) return i\n                    }\n                    return -1\n                },\n                slice = [].slice;\n            EventEmitter = require(\"events\").EventEmitter;\n            browser = require(\"./browser.coffee\");\n            GIF = function(superClass) {\n                var defaults, frameDefaults;\n                extend(GIF, superClass);\n                defaults = {\n                    workerScript: \"gif.worker.js\",\n                    workers: 2,\n                    repeat: 0,\n                    background: \"#00ff00\",\n                    quality: 10,\n                    width: null,\n                    height: null,\n                    transparent: 0x00ff00,\n                    debug: false,\n                    dither: false\n                };\n                frameDefaults = {\n                    delay: 500,\n                    copy: false\n                };\n\n                function GIF(options) {\n                    var base, key, value;\n                    this.running = false;\n                    this.options = {};\n                    this.frames = [];\n                    this.freeWorkers = [];\n                    this.activeWorkers = [];\n                    this.setOptions(options);\n                    for (key in defaults) {\n                        value = defaults[key];\n                        if ((base = this.options)[key] == null) {\n                            base[key] = value\n                        }\n                    }\n                }\n                GIF.prototype.setOption = function(key, value) {\n                    this.options[key] = value;\n                    if (this._canvas != null && (key === \"width\" || key === \"height\")) {\n                        return this._canvas[key] = value\n                    }\n                };\n                GIF.prototype.setOptions = function(options) {\n                    var key, results, value;\n                    results = [];\n                    for (key in options) {\n                        if (!hasProp.call(options, key)) continue;\n                        value = options[key];\n                        results.push(this.setOption(key, value))\n                    }\n                    return results\n                };\n                GIF.prototype.addFrame = function(image, options) {\n                    var frame, key;\n                    if (options == null) {\n                        options = {}\n                    }\n                    frame = {};\n                    frame.transparent = this.options.transparent;\n                    for (key in frameDefaults) {\n                        frame[key] = options[key] || frameDefaults[key]\n                    }\n                    if (this.options.width == null) {\n                        this.setOption(\"width\", image.width)\n                    }\n                    if (this.options.height == null) {\n                        this.setOption(\"height\", image.height)\n                    }\n                    if (typeof ImageData !== \"undefined\" && ImageData !== null && image instanceof ImageData) {\n                        frame.data = image.data\n                    } else if (typeof CanvasRenderingContext2D !== \"undefined\" && CanvasRenderingContext2D !== null && image instanceof CanvasRenderingContext2D || typeof WebGLRenderingContext !== \"undefined\" && WebGLRenderingContext !== null && image instanceof WebGLRenderingContext) {\n                        if (options.copy) {\n                            frame.data = this.getContextData(image)\n                        } else {\n                            frame.context = image\n                        }\n                    } else if (image.childNodes != null) {\n                        if (options.copy) {\n                            var d = this.getImageData(image);\n                            frame.data = d.data;\n                            frame.transparent = d.transparent;\n                        } else {\n                            frame.image = image\n                        }\n                    } else {\n                        throw new Error(\"Invalid image\")\n                    }\n                    return this.frames.push(frame)\n                };\n                GIF.prototype.render = function() {\n                    var i, j, numWorkers, ref;\n                    if (this.running) {\n                        throw new Error(\"Already running\")\n                    }\n                    if (this.options.width == null || this.options.height == null) {\n                        throw new Error(\"Width and height must be set prior to rendering\")\n                    }\n                    this.running = true;\n                    this.nextFrame = 0;\n                    this.finishedFrames = 0;\n                    this.imageParts = function() {\n                        var j, ref, results;\n                        results = [];\n                        for (i = j = 0, ref = this.frames.length; 0 <= ref ? j < ref : j > ref; i = 0 <= ref ? ++j : --j) {\n                            results.push(null)\n                        }\n                        return results\n                    }.call(this);\n                    numWorkers = this.spawnWorkers();\n                    if (this.options.globalPalette === true) {\n                        this.renderNextFrame()\n                    } else {\n                        for (i = j = 0, ref = numWorkers; 0 <= ref ? j < ref : j > ref; i = 0 <= ref ? ++j : --j) {\n                            this.renderNextFrame()\n                        }\n                    }\n\n                    this.emit(\"start\");\n                    return this.emit(\"progress\", 0)\n                };\n                GIF.prototype.abort = function() {\n                    this.activeWorkers.forEach(function(worker) {\n                        worker.terminate();\n                    });\n                    this.activeWorkers = [];\n\n                    this.freeWorkers.forEach(function(worker) {\n                        worker.terminate();\n                    });\n                    this.freeWorkers = [];\n\n                    this.running = false;\n                    return this.emit(\"abort\")\n                };\n                GIF.prototype.spawnWorkers = function() {\n                    var j, numWorkers, ref, results;\n                    numWorkers = Math.min(this.options.workers, this.frames.length);\n                    (function() {\n                        results = [];\n                        for (var j = ref = this.freeWorkers.length; ref <= numWorkers ? j < numWorkers : j > numWorkers; ref <= numWorkers ? j++ : j--) {\n                            results.push(j)\n                        }\n                        return results\n                    }).apply(this).forEach(function(_this) {\n                        return function(i) {\n                            var worker;\n                            _this.log(\"spawning worker \" + i);\n                            worker = new Worker(_this.options.workerScript);\n                            worker.onmessage = function(event) {\n                                _this.activeWorkers.splice(_this.activeWorkers.indexOf(worker), 1);\n                                _this.freeWorkers.push(worker);\n                                return _this.frameFinished(event.data)\n                            };\n                            return _this.freeWorkers.push(worker)\n                        }\n                    }(this));\n                    return numWorkers\n                };\n                GIF.prototype.frameFinished = function(frame) {\n                    var i, j, ref;\n                    this.log(\"frame \" + frame.index + \" finished - \" + this.activeWorkers.length + \" active\");\n                    this.finishedFrames++;\n                    this.emit(\"progress\", this.finishedFrames / this.frames.length);\n                    this.imageParts[frame.index] = frame;\n                    if (this.options.globalPalette === true) {\n                        this.options.globalPalette = frame.globalPalette;\n                        this.log(\"global palette analyzed\");\n                        if (this.frames.length > 2) {\n                            for (i = j = 1, ref = this.freeWorkers.length; 1 <= ref ? j < ref : j > ref; i = 1 <= ref ? ++j : --j) {\n                                this.renderNextFrame()\n                            }\n                        }\n                    }\n                    if (indexOf.call(this.imageParts, null) >= 0) {\n                        return this.renderNextFrame()\n                    } else {\n                        return this.finishRendering()\n                    }\n                };\n                GIF.prototype.finishRendering = function() {\n                    var data, frame, i, image, j, k, l, len, len1, len2, len3, offset, page, ref, ref1, ref2;\n                    len = 0;\n                    ref = this.imageParts;\n                    for (j = 0, len1 = ref.length; j < len1; j++) {\n                        frame = ref[j];\n                        len += (frame.data.length - 1) * frame.pageSize + frame.cursor\n                    }\n                    len += frame.pageSize - frame.cursor;\n                    this.log(\"rendering finished - filesize \" + Math.round(len / 1e3) + \"kb\");\n                    data = new Uint8Array(len);\n                    offset = 0;\n                    ref1 = this.imageParts;\n                    for (k = 0, len2 = ref1.length; k < len2; k++) {\n                        frame = ref1[k];\n                        ref2 = frame.data;\n                        for (i = l = 0, len3 = ref2.length; l < len3; i = ++l) {\n                            page = ref2[i];\n                            data.set(page, offset);\n                            if (i === frame.data.length - 1) {\n                                offset += frame.cursor\n                            } else {\n                                offset += frame.pageSize\n                            }\n                        }\n                    }\n                    image = new Blob([data], {\n                        type: \"image/gif\"\n                    });\n\n                    this.activeWorkers.forEach(function(worker) {\n                        worker.terminate();\n                    });\n                    this.activeWorkers = [];\n\n                    this.freeWorkers.forEach(function(worker) {\n                        worker.terminate();\n                    });\n                    this.freeWorkers = [];\n\n                    return this.emit(\"finished\", image, data)\n                };\n                GIF.prototype.renderNextFrame = function() {\n                    var frame, task, worker;\n                    if (this.freeWorkers.length === 0) {\n                        return;\n                        throw new Error(\"No free workers\")\n                    }\n                    if (this.nextFrame >= this.frames.length) {\n                        return;\n                    }\n                    frame = this.frames[this.nextFrame++];\n                    worker = this.freeWorkers.shift();\n                    task = this.getTask(frame);\n                    this.log(\"starting frame \" + (task.index + 1) + \" of \" + this.frames.length);\n                    this.activeWorkers.push(worker);\n                    return worker.postMessage(task);\n                };\n                GIF.prototype.getContextData = function(ctx) {\n                    return ctx.getImageData(0, 0, this.options.width, this.options.height).data\n                };\n                GIF.prototype.getImageData = function(image) {\n                    var ctx;\n                    if (this._canvas == null) {\n                        this._canvas = document.createElement(\"canvas\");\n                        this._canvas.width = this.options.width;\n                        this._canvas.height = this.options.height\n\n                        /*this._canvas.mozImageSmoothingEnabled = false;\n                        this._canvas.webkitImageSmoothingEnabled = false;\n                        this._canvas.msImageSmoothingEnabled = false;\n                        this._canvas.imageSmoothingEnabled = false;*/\n                    }\n                    ctx = this._canvas.getContext(\"2d\");\n                    var colors = [];\n                    if (window.colors === undefined) {\n                        window.colors = [];\n                    }\n\n                    ctx.clearRect(0, 0, this._canvas.width, this._canvas.height);\n                    ctx.drawImage(image, 0, 0);\n\n                    var data = this.getContextData(ctx);\n                    var bg = 0;\n                    var trans = false;\n                    var green = 0,\n                        violet = 0;\n\n                    for (var i = 0; i < data.length; i += 4) {\n                        var color = (data[i + 0] << 16) | (data[i + 1] << 8) | (data[i + 2]);\n                        green += data[i + 1];\n                        violet += (data[i] + data[i + 2]) / 2;\n                        if (colors.indexOf(color) === -1) {\n                            colors.push(color);\n                        }\n                        if (window.colors.indexOf(color) === -1) {\n                            window.colors.push(color);\n                        }\n                        if (data[i + 3] !== 255) {\n                            trans = true;\n                        }\n                    }\n\n                    if (trans) {\n                        /*for (bg = 0; bg <= 0xffffff; bg++) {\n                            if (colors.indexOf(bg) === -1) {\n                                break;\n                            }\n                        }*/\n                        bg = (green < violet ? 0x00ff00 : 0xff00ff);\n                    } // \"{\\\"x\\\":26,\\\"y\\\":55,\\\"diameter\\\":98}\"\n\n\n\n                    ctx.fillStyle = \"#\" + bg.toString(16).padStart(6, \"0\");\n                    ctx.fillRect(0, 0, this.options.width, this.options.height);\n                    ctx.drawImage(image, 0, 0);\n\n                    /*if (window.xxx === undefined) {\n                        window.xxx = 1;\n                    }*/\n\n                    //console.log((new Canvas(this._canvas)).getImageData().data[38026]);\n\n                    var ret = this.getContextData(ctx);\n                    //console.log(ret[98*97*4+2]);\n                    return {\n                        data: ret,\n                        transparent: (trans ? bg : null)\n                    };\n                };\n                GIF.prototype.getTask = function(frame) {\n                    var index, task;\n                    index = this.frames.indexOf(frame);\n                    task = {\n                        index: index,\n                        last: index === this.frames.length - 1,\n                        delay: frame.delay,\n                        transparent: frame.transparent,\n                        width: this.options.width,\n                        height: this.options.height,\n                        quality: this.options.quality,\n                        dither: this.options.dither,\n                        globalPalette: this.options.globalPalette,\n                        repeat: this.options.repeat,\n                        canTransfer: browser.name === \"chrome\"\n                    };\n                    if (frame.data != null) {\n                        task.data = frame.data\n                    } else if (frame.context != null) {\n                        task.data = this.getContextData(frame.context)\n                    } else if (frame.image != null) {\n                        var d = this.getImageData(frame.image);\n                        task.data = d.data;\n                        task.transparent = d.transparent;\n                    } else {\n                        throw new Error(\"Invalid frame\")\n                    }\n                    return task\n                };\n                GIF.prototype.log = function() {\n                    var args;\n                    args = 1 <= arguments.length ? slice.call(arguments, 0) : [];\n                    if (!this.options.debug) {\n                        return\n                    }\n                    return console.log.apply(console, args)\n                };\n                return GIF\n            }(EventEmitter);\n            module.exports = GIF\n        }, {\n            \"./browser.coffee\": 2,\n            events: 1\n        }]\n    }, {}, [3])(3)\n});\n//# sourceMappingURL=gif.js.map","import { CropView } from \"./cropview\";\nimport { Dialog } from \"./dialog\";\nimport { createElement, hideElement, showElement, makePixelated } from \"./util\";\nimport { FractionalProgressBar } from \"./fractionalprogressbar\";\nimport { Canvas } from \"./canvas\";\nimport { ClosableDialog } from \"./closabledialog\";\nimport { Point } from \"./point\";\nimport { Border } from \"./borders\";\n\nimport SuperGif from './supergif.js'\nimport GIF from './gif.js'\nimport { Rectangle } from \"./rectangle\";\n\ninterface CropOption {\n    label: string;\n    url: string;\n}\n\nexport class Renderer extends ClosableDialog {\n    private readonly renderedString = \"Rendered! yayy\";\n    private readonly renderingString = \"Rendering...\";\n    private readonly cropView: CropView;\n    private shouldStopRendering: boolean = false;\n    private currentlyRendering: boolean = false;\n    private progressBar: FractionalProgressBar;\n    private readonly imageElement: HTMLImageElement;\n    private optionBar: HTMLElement;\n    private headerElement: HTMLElement;\n    private noteElement: HTMLElement;\n    private pleaseWaitElement: HTMLElement;\n    private saveButton: HTMLElement;\n    private loadGif: any;\n    private readonly initialized: boolean = false;\n\n    constructor(cropView: CropView) {\n        super();\n\n        this.dialog.classList.add(\"dialog-render\");\n\n        this.createEvent(\"close\");\n\n        this.cropView = cropView;\n\n        this.headerElement = createElement(\"h1\", \"header\");\n        this.headerElement.innerText = this.renderingString;\n\n        this.progressBar = new FractionalProgressBar();\n\n        this.imageElement = <HTMLImageElement>createElement(\"img\", \"image\");\n\n        this.noteElement = createElement(\"div\", \"note\");\n        this.noteElement.innerText = \"Save as a square for Discord!!\";\n\n        this.pleaseWaitElement = createElement(\"div\", \"pleaseWait\");\n        this.pleaseWaitElement.innerText = \"Aborting render... please wait...\";\n\n        this.optionBar = createElement(\"div\", \"optionBar\");\n\n        this.saveButton = createElement(\"a\", \"save\");\n        this.saveButton.innerText = \"Save\";\n        this.saveButton.addEventListener(\"mouseover\", () => {\n            (<HTMLAnchorElement>this.saveButton).href = this.imageElement.src;\n        });\n\n        this.appendChild(\n            this.headerElement,\n            this.progressBar,\n            this.imageElement,\n            this.noteElement,\n            this.pleaseWaitElement,\n            this.optionBar,\n            this.saveButton\n        );\n\n        this.initialized = true;\n    }\n\n    public render(banner) {\n        this.currentlyRendering = true;\n        this.shouldStopRendering = false;\n        this.show();\n\n        if (this.cropView.currentFileType === \"gif\") {\n            this.renderGif(banner);\n        }\n        else {\n            this.getFrameURLs(this.cropView.image, false, true, banner, this.display.bind(this));\n            this.currentlyRendering = false;\n        }\n    }\n\n    private renderGif(banner): void {\n        let gif = new SuperGif({\n            gif: this.cropView.image.cloneNode()\n        });\n\n        this.loadGif = gif;\n\n        let onload = () => {\n            this.loadGif = null;\n\n            if (this.shouldStopRendering) {\n                this.currentlyRendering = false;\n                this.tryClose();\n            }\n            const circle = this.cropView.Circle\n            const bannerRect = new Rectangle(new Point(circle.left - (circle.width / 5 + circle.width / 13.33), circle.cy - (circle.width * 1.5)), new Point(circle.width * 3.75, circle.width * 1.5))\n            let saveGif = new GIF({\n                workers: 3,\n                quality: 1,\n                dither: false,\n                width: !banner ? this.cropView.cropArea.width : bannerRect.width ,\n                height: !banner ? this.cropView.cropArea.height : bannerRect.height,\n                debug: false,\n                copy: true\n            });\n\n            let len = gif.get_length();\n            this.progressBar.addFractionPart(1 / 6, len);\n\n            let renderFrame = (i: number) => {\n                gif.move_to(i);\n\n                this.getFrameURLs(gif.get_canvas(), true, false, banner, (options) => {\n                    let img = new Image();\n                    img.addEventListener(\"load\", () => {\n                        if (this.shouldStopRendering) {\n                            this.currentlyRendering = false;\n                            this.tryClose();\n                            return;\n                        }\n\n                        saveGif.addFrame(img, {\n                            delay: gif.get_frames()[i].delay * 10 || 10\n                        });\n\n                        this.progressBar.step();\n\n                        i++;\n                        if (i === len) {\n                            saveGif.render();\n                        }\n                        else {\n                            renderFrame(i);\n                        }\n                    });\n                    img.src = options[0].url;\n                });\n            };\n\n            saveGif.on(\"finished\", (blob: Blob) => {\n                let url = URL.createObjectURL(blob);\n                this.display([\n                    {\n                        label: \"GIF\",\n                        url: url\n                    }\n                ]);\n\n                this.currentlyRendering = false;\n            });\n\n            saveGif.on(\"abort\", () => {\n                this.currentlyRendering = false;\n                this.tryClose();\n            });\n\n            saveGif.on(\"progress\", (progress: number) => {\n                this.progressBar.progress = 1 / 6 + progress * 5 / 6;\n\n                if (this.shouldStopRendering) {\n                    saveGif.abort();\n                }\n            });\n\n            renderFrame(0);\n        };\n\n        gif.load(onload, undefined, () => {\n            this.loadGif = null;\n            this.currentlyRendering = false;\n            this.tryClose();\n        });\n    }\n\n    private getFrameURLs(frame: Canvas | HTMLImageElement | HTMLCanvasElement, pixelated: boolean, getCircle: boolean, banner: boolean, callback: (options: CropOption[]) => void): void {\n        let ret: CropOption[] = [];\n        let expectedLength = getCircle ? 2 : 1;\n        let counter = 0;\n\n        let check = (url: string, label: string, index: number) => {\n            counter++;\n            ret[index] = { url, label };\n            if (counter === expectedLength) {\n                callback(ret);\n            }\n        };\n\n        let borderCanvas = new Canvas({\n            size: this.cropView.cropArea.size,\n            pixelated: pixelated\n        });\n\n        Border.apply(borderCanvas);\n\n        let rc = new Canvas({\n            size: this.cropView.outerSize,\n            pixelated: pixelated\n        });\n\n        rc.drawRotatedImage(\n            frame,\n            this.cropView.rotation / 180 * Math.PI,\n            this.cropView.outerSize.dividedBy(2).minus(this.cropView.innerSize.dividedBy(2))\n        );\n\n        var circle = this.cropView.Circle\n\n        let squareCrop = new Canvas({\n            size: banner? new Point(circle.width * 3.75, circle.width * 1.5) : this.cropView.cropArea.size,\n            pixelated: pixelated\n        });\n\n        if (banner == true) {\n            squareCrop.drawCroppedImage(\n                rc,\n                new Point(0),\n                new Rectangle(new Point(circle.left - (circle.width / 5 + circle.width / 13.33), circle.cy - (circle.width * 1.5)), new Point(circle.width * 3.75, circle.width * 1.5))\n                //new Rectangle(new Point(this.circle.left - (this.circle.width / 5 + this.circle.width / 13.33), this.circle.cy - (this.circle.width * 1.5)), new Point(this.circle.width * 3.75, this.circle.width * 1.5))\n            );\n        } else {\n            squareCrop.drawCroppedImage(\n                rc,\n                new Point(0),\n                this.cropView.cropArea\n            );\n        }\n        squareCrop.drawImage(borderCanvas, new Point(0));\n\n        squareCrop.createBlob((blob: Blob) => {\n            check(URL.createObjectURL(blob), \"Square\", 0);\n        });\n\n        if (getCircle) {\n            let circleCrop = new Canvas({\n                size: this.cropView.cropArea.size,\n                pixelated: pixelated\n            });\n\n            circleCrop.drawCroppedImage(\n                rc,\n                new Point(0),\n                this.cropView.cropArea\n            );\n\n            circleCrop.drawImage(borderCanvas, new Point(0));\n\n            circleCrop.blendMode = \"destination-in\";\n            circleCrop.fillCircleInSquare(new Point(0), circleCrop.width, \"white\");\n\n            circleCrop.createBlob((blob: Blob) => {\n                check(URL.createObjectURL(blob), \"Circle\", 1);\n            });\n        }\n    }\n\n    private display(cropOptions: CropOption[]): void {\n        this.progressBar.hide();\n        showElement(this.optionBar);\n        showElement(this.saveButton);\n        this.headerElement.innerText = this.renderedString;\n        this.optionBar.innerHTML = \"\";\n        let firstButton: HTMLElement;\n\n        cropOptions.forEach((option, i) => {\n            let b = createElement(\"button\", \"option\");\n            b.style.width = (1 / cropOptions.length * 100) + \"%\";\n            b.innerText = option.label;\n            (<any>b).url = option.url;\n            b.addEventListener(\"click\", () => {\n                this.imageElement.src = option.url;\n\n                let bs = this.optionBar.children;\n                for (let i = 0; i < bs.length; i++) {\n                    bs[i].classList.remove(\"toggled\");\n                }\n\n                b.classList.add(\"toggled\");\n            });\n\n            this.optionBar.appendChild(b);\n\n            if (i === 0) {\n                firstButton = b;\n            }\n        });\n\n        this.imageElement.onload = () => {\n            this.contentContainer.scrollTop = this.contentContainer.scrollHeight;\n            this.imageElement.onload = null;\n        };\n\n        firstButton.click();\n    }\n\n    public show() {\n        this.progressBar.show();\n        this.progressBar.reset();\n        this.headerElement.innerText = this.renderingString;\n        hideElement(this.optionBar);\n        hideElement(this.saveButton);\n        hideElement(this.pleaseWaitElement);\n        this.imageElement.src = \"\";\n        this.saveButton.setAttribute(\"download\", this.cropView.filename);\n        makePixelated(this.imageElement, !this.cropView.antialias);\n        super.show();\n    }\n\n    public hide(force: boolean = false) {\n        if (force || !this.initialized) {\n            super.hide();\n        }\n        else {\n            this.tryClose();\n        }\n    }\n\n    public tryClose(): boolean {\n        if (this.currentlyRendering) {\n            this.shouldStopRendering = true;\n            this.loadGif && this.loadGif.abort();\n            showElement(this.pleaseWaitElement);\n            return false;\n        }\n\n        let bs = this.optionBar.children;\n        for (let i = 0; i < bs.length; i++) {\n            (<any>bs[i]).url && URL.revokeObjectURL((<any>bs[i]).url);\n        }\n\n        this.emitEvent(\"close\");\n        this.hide(true);\n        return true;\n    }\n}","export enum Keys {\n    left = 37,\n    up = 38,\n    right = 39,\n    down = 40\n}\n\nexport class KeyManager {\n    private static keysDown: { [key: number]: boolean } = {};\n\n    public static initialize(): void {\n        window.addEventListener(\"keydown\", e => KeyManager.keysDown[e.keyCode] = true);\n        window.addEventListener(\"keyup\", e => KeyManager.keysDown[e.keyCode] = false);\n    }\n\n    public static isDown(key: number): boolean {\n        return this.keysDown[key] || false;\n    }\n\n    public static axis(keyP: number, keyN: number): number {\n        return +this.isDown(keyP) - +this.isDown(keyN);\n    }\n\n    public static isArrowKey(key: number): boolean {\n        return key >= 37 && key <= 40;\n    }\n}\n","import { Widget } from \"./widget\";\n\nexport abstract class Drawer extends Widget {\n    private dirty: boolean = false;\n    private frameWaiting: boolean = false;\n\n    constructor(className_or_container?: string | HTMLElement) {\n        super(className_or_container);\n    }\n\n    public update(source: string): void {\n        this.dirty = true;\n        if (!this.frameWaiting) {\n            this.requestAnimationFrame();\n        }\n    }\n\n    private _draw() {\n        if (this.dirty) {\n            this.draw();\n            this.dirty = false;\n            this.requestAnimationFrame();\n        } else {\n            this.frameWaiting = false;\n        }\n    }\n\n    private requestAnimationFrame(): void {\n        this.frameWaiting = true;\n        requestAnimationFrame(this._draw.bind(this));\n    }\n\n    protected abstract draw(): void;\n}","import { Widget } from \"./widget\";\nimport { createElement, makePixelated } from \"./util\";\nimport { Canvas } from \"./canvas\";\nimport { Settings } from \"./avatarcropper\";\nimport { Renderer } from \"./renderer\";\nimport { Point } from \"./point\";\nimport { Rectangle, RectAnchor } from \"./rectangle\";\nimport { KeyManager, Keys } from \"./keymanager\";\nimport { Drawer } from \"./drawer\";\n\ntype MouseAction = \"move\" | \"resize\" | \"new\" | \"none\";\n\nclass Circle extends Rectangle {\n    private cropView: CropView;\n    private _origin: Rectangle;\n\n    constructor(cropView: CropView) {\n        super(new Point(), new Point());\n        this.cropView = cropView;\n        this.saveOrigin();\n    }\n\n    public get radius(): Point {\n        return this.size.dividedBy(2);\n    }\n\n    public set radius(radius: Point) {\n        this.size = radius.times(2);\n    }\n\n    public reset(): void {\n        this.position = new Point(0);\n        this.size = new Point(this.cropView.outerRect.size.min / 2);\n    }\n\n    public get rectangle(): Rectangle {\n        return this.copy();\n    }\n\n    public saveOrigin(): void {\n        this._origin = this.copy();\n    }\n\n    public get origin(): Rectangle {\n        return this._origin;\n    }\n\n    public validate(): number {\n        let ret = 0b00000000;\n\n        if (this.width > this.cropView.outerSize.x) {\n            this.setWidthKeepAR(this.cropView.outerSize.x);\n            ret |= 1;\n        }\n\n        if (this.height > this.cropView.outerSize.y) {\n            this.setHeightKeepAR(this.cropView.outerSize.y);\n            ret |= 2;\n        }\n\n        if (this.x < 0) {\n            this.x = 0;\n            ret |= 4;\n        }\n\n        if (this.y < 0) {\n            this.y = 0;\n            ret |= 8;\n        }\n\n        if (this.bottom > this.cropView.outerSize.y) {\n            this.bottom = this.cropView.outerSize.y;\n            ret |= 16;\n        }\n\n        if (this.right > this.cropView.outerSize.x) {\n            this.right = this.cropView.outerSize.x;\n            ret |= 32;\n        }\n\n        return ret;\n    }\n}\n\nexport class CropView extends Drawer {\n    public readonly image: HTMLImageElement;\n    public readonly overlay: Canvas;\n    private _isZoomFitted: boolean = false;\n    private _zoomFactor: number = 1;\n    private currentRotation = 0;\n    public currentFileType: string;\n    private circle: Circle;\n    private _filename: string;\n    private currentAction: MouseAction = \"none\";\n    private mouseOrigin: Point;\n    private resizeAnchor: Point;\n    private resizeOffset: Point;\n    public readonly settings: Settings;\n    private readonly renderer: Renderer;\n    private loadingImage: boolean = false;\n    private antialiased: boolean;\n\n    constructor(settingsObject: Settings) {\n        super(createElement(\"div\", \"cropView\"));\n\n        this.createEvent(\"update\");\n        this.createEvent(\"imagechange\");\n        this.createEvent(\"antialiaschange\");\n        this.createEvent(\"actionstart\");\n        this.createEvent(\"actionend\");\n\n        //this.on(\"update\", this.renderOverlay.bind(this));\n        //this.once(\"update\", () => console.log(\"sup\"));\n\n        this.settings = settingsObject;\n        this.circle = new Circle(this);\n        this.renderer = new Renderer(this);\n\n        this.image = <HTMLImageElement>createElement(\"img\", \"image\");\n        this.image.style.transformOrigin = \"top left\";\n\n        this.overlay = new Canvas({\n            deepCalc: true\n        });\n\n        this.appendChild(this.image, this.overlay.canvas);\n\n        document.body.appendChild(this.renderer.container);\n\n        this.overlay.addEventListener(\"mousemove\", this.mouseMove.bind(this));\n        this.overlay.addEventListener(\"mousedown\", this.mouseDown.bind(this));\n\n        this.overlay.canvas.addEventListener(\"touchmove\", (e) => {\n            if (!(this.currentAction === \"new\" || this.currentAction === \"none\")) {\n                e.preventDefault();\n            }\n        });\n\n        document.body.addEventListener(\"mouseup\", () => {\n            let ca = this.currentAction;\n            this.currentAction = \"none\";\n            if (ca !== \"none\") {\n                this.update(\"mouseup\");\n                this.emitEvent(\"actionend\");\n            }\n        });\n\n        document.body.addEventListener(\"touchend\", () => {\n            let ca = this.currentAction;\n            this.currentAction = \"none\";\n            if (ca !== \"none\") {\n                this.update(\"touchend\");\n                this.emitEvent(\"actionend\");\n            }\n        });\n\n        // move circle around with arrow keys //\n        window.addEventListener(\"keydown\", e => this.handleKeypress(e.keyCode));\n\n        //this.overlay.mouse.addEventListener(\"leave\", this.overlay.mouse.events.up[0]);\n        this.antialias = this.settings.antialias;\n    }\n\n    private handleKeypress(key: number) {\n        if (KeyManager.isArrowKey(key)) {\n            //console.log( KeyManager.axis(Keys.right, Keys.left))\n            this.circle.x += KeyManager.axis(Keys.right, Keys.left);\n            this.circle.y += KeyManager.axis(Keys.down, Keys.up);\n            this.circle.validate();\n            this.update(\"ketypress\");\n        }\n    }\n\n    public get rotation(): number {\n        return this.currentRotation;\n    }\n\n    public get cropArea(): Rectangle {\n        return this.circle.rectangle;\n    }\n    public get Circle(): Circle {\n    return this.circle\n    }\n    \n    public get zoomFactor(): number {\n        return this._zoomFactor;\n    }\n\n    public update(source: string) {\n        super.update(source);\n        this.emitEvent(\"update\", source);\n    }\n\n    public reactTMToRefresh() {\n        this.isZoomFitted && this.zoomFit();\n    }\n\n    protected draw(): void {\n        //console.log(\"rendering overlay\");\n        // draw mask //\n        if (this.settings.maskOpacity !== 1) {\n            this.overlay.clear();\n        }\n\n        if (this.settings.maskOpacity !== 0) {\n            this.overlay.fill(\"rgba(0,0,0,\" + this.settings.maskOpacity + \")\");\n\n            this.overlay.blendMode = \"destination-out\";\n            if (this.settings.previewMode === \"circle\") {\n                this.overlay.fillCircleInRect(this.circle, \"white\");\n            }\n            else if (this.settings.previewMode === \"square\") {\n                this.overlay.fillRect(this.circle, \"white\");\n            }\n\n        }\n\n        this.overlay.blendMode = \"source-over\";\n        let lineWidth = ~~(1 / this.zoomFactor) + 1;\n\n        if (this.settings.outlinesEnabled) {\n            let sharp = lineWidth % 2 === 1;\n\n            this.overlay.lineDash = [Math.min(this.overlay.width, this.overlay.height) / 100];\n\n            if (this.settings.previewMode === \"circle\") {\n                this.overlay.drawCircleInRect(this.circle, \"white\", lineWidth);\n            }\n\n            this.overlay.drawRect(\n                new Rectangle(\n                    this.circle.position.minus(lineWidth),\n                    this.circle.size.plus(lineWidth)\n                ),\n                \"white\",\n                lineWidth,\n                sharp\n            );\n        }\n\n        if (this.settings.guidesEnabled) {\n            this.overlay.drawBanner(this.circle, lineWidth)\n     \n            this.overlay.context.lineDashOffset = 0;\n        }\n\n        /*let theta = (90 - this.rotation) / 180 * Math.PI;\n        let cot = (t) => 1 / Math.tan(t);\n        \n        let cx = this.outerSize.x / 2;\n        let cy = this.outerSize.y / 2;\n        \n        let circleX = this.circle.cx;\n        let circleY = this.circle.cy;\n\n        let xc = circleX - cx;\n        let yc = cy - circleY;\n\n        //console.log(cx, cy, circleX, circleY, dx, dy);\n\n        (<any>window).z = theta;\n\n        let f = (x) => Math.tan(theta) * x;\n        let fp = (x) => -cot(theta) * x;\n        let yy = yc - fp(xc);\n        let fpc = (x) => -cot(theta) * x + yc + cot(theta) * xc;\n        let ix = yy / (Math.tan(theta) + cot(theta));\n        let iy = fpc(ix);\n\n        console.log(xc, yc);\n\n        this.overlay.drawLine(cx, cy, cx + 500, cy - f(500), \"red\", 2);\n        this.overlay.drawLine(cx, cy, cx - 500, cy - f(-500), \"red\", 2);\n\n        this.overlay.drawLine(cx, cy, cx + 500, cy - fp(500), \"red\", 2);\n        this.overlay.drawLine(cx, cy, cx - 500, cy - fp(-500), \"red\", 2);\n\n        this.overlay.drawLine(circleX, circleY, circleX, circleY + yy, \"green\", 2);\n        this.overlay.drawLine(circleX, circleY, cx + ix, cy - iy, \"blue\", 2);*/\n    }\n\n    // returns size of image (internal res of image) //\n    public get innerRect(): Rectangle {\n        return new Rectangle(new Point(0), this.innerSize);\n    }\n\n    public get innerSize(): Point {\n        return new Point(this.image.width, this.image.height);\n    }\n\n    // returns sizes taking rotation into consideration (internal res of overlay) //\n    public get outerRect(): Rectangle {\n        return new Rectangle(new Point(0), this.outerSize);\n    }\n\n    public get outerSize(): Point {\n        return new Point(this.overlay.width, this.overlay.height);\n    }\n\n    public get apparentSize(): Point {\n        return Point.fromSizeLike(this.container.getBoundingClientRect());\n    }\n\n    private get isZoomFitted(): boolean {\n        return this._isZoomFitted;\n    }\n\n    private set isZoomFitted(z: boolean) {\n        this._isZoomFitted = z;\n\n        if (z) {\n            this.container.style.overflow = \"hidden\";\n        }\n        else {\n            this.container.style.overflow = \"\";\n        }\n    }\n\n    public zoom(factor?: number, shouldUpdate: boolean = true): void {\n        let ogScrollTopP = this.container.scrollTop / this.container.scrollHeight;\n        let ogScrollLeftP = this.container.scrollLeft / this.container.scrollWidth;\n\n        this.container.scrollTop = 0;\n        this.container.scrollLeft = 0;\n        let rotatePart = \"\";\n\n        if (this.image.style.transform.indexOf(\" rotate\") !== -1) {\n            rotatePart = this.image.style.transform.substr(\n                this.image.style.transform.indexOf(\" rotate\")\n            );\n        }\n\n        factor = factor || this.zoomFactor;\n        this._zoomFactor = factor;\n        this.overlay.zoom(factor);\n        this.image.style.transform = \"scale(\" + factor + \",\" + factor + \")\";\n\n        this.image.style.transform += rotatePart;\n\n        let r = this.image.getBoundingClientRect();\n\n        if (r.left !== 0) {\n            let current = parseFloat(this.image.style.left || \"0px\");\n            current -= r.left;\n\n            this.image.style.left = current + \"px\";\n        }\n\n        if (r.top !== 0) {\n            let current = parseFloat(this.image.style.top || \"0px\");\n            current -= r.top;\n\n            this.image.style.top = current + \"px\";\n        }\n\n        shouldUpdate && this.update(\"zoom\");\n\n        this.container.scrollTop = ogScrollTopP * this.container.scrollHeight;\n        this.container.scrollLeft = ogScrollTopP * this.contentContainer.scrollWidth;\n    }\n\n    public zoomIn(): void {\n        this.isZoomFitted = false;\n        this.zoom(this.zoomFactor * 1.1);\n    }\n\n    public zoomOut(): void {\n        this.isZoomFitted = false;\n        this.zoom(this.zoomFactor / 1.1);\n    }\n\n    public zoomFit(force: boolean = true, shouldUpdate: boolean = true): void {\n        if (!this.image) {\n            return;\n        }\n\n        if (!this.isZoomFitted && !force) {\n            return;\n        }\n\n        this.isZoomFitted = true;\n\n        /*if (detectIE() !== false) {\n            zoom(1);\n            return;\n        }*/\n\n        var cr = this.container.getBoundingClientRect();\n        var ir = { width: this.overlay.width, height: this.overlay.height };\n\n        var fw = cr.width / ir.width;\n        var fh = cr.height / ir.height;\n        var f = Math.min(fw, fh);\n\n        //document.getElementById(\"container-canvas\").style[\"width\"] = cr.width + \"px\";\n\n        this.zoom(f, shouldUpdate);\n        //console.log(\"---\");\n        //console.log(\"zoom1: \", nr.height / ir.height);\n\n        /*window.requestAnimationFrame(function() {\n    \n            var delta = container.scrollWidth - container.clientWidth;\n            //console.log(\"dx: \", delta);\n        \n            if (delta > 0) {\n                nr.width -= delta;\n                nr.height -= (ir.height / ir.width) * delta;\n                zoom(nr.height / ir.height);\n                //console.log(\"zoomx: \", nr.height / ir.height);\n            }\n        \n            delta = container.scrollHeight - container.clientHeight;\n            //console.log(\"dy: \", delta);\n        \n            if (delta > 0) {\n                nr.height -= delta;\n                nr.width -= (ir.width / ir.height) * delta;\n        \n                zoom(nr.height / ir.height);\n                //console.log(\"zoomy: \", nr.height / ir.height);\n            }\n    \n        });*/\n    }\n\n    public rotate(deg?: number, shouldUpdate: boolean = true): void {\n        let odeg = this.currentRotation;\n        if (deg === undefined) deg = this.currentRotation;\n\n        this.currentRotation = deg;\n\n        if (this.image.style.transform.indexOf(\" rotate\") !== -1) {\n            this.image.style.transform = this.image.style.transform.substr(\n                0,\n                this.image.style.transform.indexOf(\" rotate\")\n            );\n        }\n\n        let b4 = this.image.style.transform;\n\n        this.image.style.left = \"0px\";\n        this.image.style.top = \"0px\";\n\n        let size = Point.fromSizeLike(this.image);\n\n        let or = Point.fromSizeLike(this.image.getBoundingClientRect());\n\n        this.image.style.transform = b4 + \" rotate(\" + deg + \"deg)\";\n\n        let r = Rectangle.fromClientRect(this.image.getBoundingClientRect());\n        let delta = r.topLeft.inverted.minus(new Point(this.container.scrollLeft, this.container.scrollTop));\n\n        this.image.style.left = delta.x + \"px\";\n        this.image.style.top = delta.y + \"px\";\n\n        size.multiply(r.size.dividedBy(or));\n        this.overlay.resize(size, false);\n\n        /*let circleMagnitude = Math.sqrt(\n            Math.pow(this.overlay.width - circle.cx(), 2) +\n            Math.pow(this.overlay.height - circle.cy(), 2)\n        );\n    \n        let rad = ((deg - 90) / 180) * Math.PI;\n        let orad = ((odeg - 90) / 180) * Math.PI;\n    \n        let cdx = Math.cos(rad) - Math.cos(orad);\n        let cdy = Math.sin(rad) - Math.sin(orad);\n        cdx *= circleMagnitude;\n        cdy *= circleMagnitude;\n    \n        circle.x += cdx;\n        circle.y += cdy;*/\n\n        this.zoomFit(false, shouldUpdate);\n        this.circle.validate();\n        shouldUpdate && this.update(\"rotate\");\n    }\n\n    public set antialias(antialias: boolean) {\n        makePixelated(this.image, !antialias);\n        this.overlay.pixelated = !antialias;\n\n        this.antialiased = antialias;\n        this.emitEvent(\"antialiaschange\", this.antialiased);\n    }\n\n    public get antialias(): boolean {\n        return this.antialiased;\n    }\n\n    public setImageFromFile(file: File): boolean {\n        if (!file || file.type.split(\"/\")[0] !== \"image\" || this.loadingImage) {\n            return false;\n        }\n\n        this.currentFileType = file.type.split(\"/\")[1] === \"gif\" ? \"gif\" : \"png\";\n        this._filename = file.name.substring(0, file.name.lastIndexOf('.')) + \"_cropped.\" + this.currentFileType;\n\n        this.loadingImage = true;\n        Canvas.fileToImage(file, this.setImageFromFileHelper.bind(this), false);\n        return true;\n    }\n\n    private setImageFromFileHelper(image: HTMLImageElement) {\n        if (this.image.src) {\n            URL.revokeObjectURL(this.image.src);\n        }\n\n        this.overlay.resize(Point.fromSizeLike(image), false);\n        this.overlay.clear();\n\n        this.image.width = image.width;\n        this.image.height = image.height;\n        this.image.src = image.src;\n\n        this.circle.reset();\n        this.zoomFit(true, false);\n        this.rotate(0, false);\n\n        this.emitEvent(\"imagechange\", this.image.src);\n        this.update(\"image change\");\n        this.loadingImage = false;\n    }\n\n    public flipHorizontal(): void {\n        let c = new Canvas({ size: Point.fromSizeLike(this.image) });\n        c.context.scale(-1, 1);\n        c.drawImage(this.image, new Rectangle(new Point(0), Point.fromSizeLike(this.image).times(new Point(-1, 1))));\n        c.context.setTransform(1, 0, 0, 1, 0, 0);\n\n        this.loadingImage = true;\n        c.createImage((img) => {\n            this.flipHelper(img, true);\n        }, undefined, false);\n    }\n\n    public flipVertical(): void {\n        let c = new Canvas({ size: Point.fromSizeLike(this.image) });\n        c.context.scale(1, -1);\n        c.drawImage(this.image, new Rectangle(new Point(0), Point.fromSizeLike(this.image).times(new Point(1, -1))));\n        c.context.setTransform(1, 0, 0, 1, 0, 0);\n\n        this.loadingImage = true;\n        c.createImage((img: HTMLImageElement) => {\n            this.flipHelper(img, false);\n        }, undefined, false);\n    }\n\n    private flipHelper(image: HTMLImageElement, horizontal: boolean): void {\n        if (this.image.src) {\n            URL.revokeObjectURL(this.image.src);\n        }\n\n        this.image.onload = () => {\n            this.rotate(-this.rotation, false);\n            if (horizontal) {\n                this.circle.cx = this.outerSize.x - this.circle.cx;\n            }\n            else {\n                this.circle.cy = this.outerSize.y - this.circle.cy;\n            }\n            this.emitEvent(\"imagechange\", this.image.src);\n            this.update(\"flippy\");\n            this.loadingImage = false;\n        };\n\n        this.image.src = image.src;\n    }\n\n    public renderCroppedImage(): void {\n        this.renderer.render(false);\n    }\n\n    public renderBanner(): void {\n    /*     var previous_size = this.getCropSize();\n        var previous_position = this.circle.center\n        var previous_circle = this.circle\n        this.setCropSizewithoutcheck(new Point(\n            ((previous_circle.right + (previous_circle.width * 2.4) + (previous_circle.width / 13.33)) - (previous_circle.left - (previous_circle.width / 5 + previous_circle.width / 13.33))),\n            ((previous_circle.cy) - (previous_circle.cy - (previous_circle.width * 1.5)))\n        ))\n       this.setCropArea(new Point(\n            ((previous_circle.right + (previous_circle.width * 2.4) + (previous_circle.width / 13.33)) + (previous_circle.left - (previous_circle.width / 5 + previous_circle.width / 13.33))) / 2,\n            ((previous_circle.cy) + (previous_circle.cy - (previous_circle.width * 1.5))) / 2\n        ))   */\n        this.renderer.render(true);\n    }\n\n    public get filename(): string {\n        return this._filename;\n    }\n\n    public get src(): string {\n        return this.image.src || null;\n    }\n\n    public centerCropArea(): void {\n        this.circle.center = this.outerRect.center;\n        this.circle.validate();\n        this.update(\"center crop\");\n    }\n\n    public setCropSize(size: number): void {\n        this.circle.size = new Point(size);\n        this.circle.validate();\n        this.update(\"set crop size\");\n    }\n    public getCropSize(): Point {\n        return this.circle.size;\n    }\n\n    public setCropArea(position: Point): void {\n        this.circle.center = position;\n        //this.circle.validate();\n        this.update(\"set crop area\");\n    }\n    public setCropSizewithoutcheck(size: Point): void {\n        this.circle.size = size;\n        //this.circle.validate();\n        this.update(\"set crop size\");\n    }\n    private getMouseAction(x: number, y: number): MouseAction {\n        let mousePoint = new Point(x, y);\n        if (this.circle.containsPoint(new Point(x, y))) {\n            // this logic for non-square crop area (aspect ratio != 1:1)\n            /*let handleSize = this.circle.radius.min / 2;\n            let _rb = (p1, p2) => Rectangle.between(p1, p2);\n            let _con = (r : Rectangle) => r.containsPoint(mousePoint);\n            let grabbing = (p1 : Point, toAdd : Point | number) => _con(_rb(p1, p1.plus(toAdd)));\n            \n            let grabbingHandle = (\n                grabbing(this.circle.topLeft, handleSize) ||\n                grabbing(this.circle.topRight, new Point(-handleSize, handleSize)) ||\n                grabbing(this.circle.bottomLeft, new Point(handleSize, -handleSize)) ||\n                grabbing(this.circle.bottomRight, -handleSize)\n            );*/\n\n            let grabbingHandle = this.circle.center.distanceTo(new Point(x, y)) >= this.circle.radius.x;\n\n            return grabbingHandle ? \"resize\" : \"move\";\n        }\n        else {\n            return \"new\";\n        }\n    }\n\n    private mouseDown(x: number, y: number): void {\n        var action = this.getMouseAction(x, y);\n        this.currentAction = action;\n\n        if (this.currentAction !== \"none\") {\n            this.emitEvent(\"actionstart\");\n        }\n\n        this.mouseOrigin = new Point(x, y);\n        this.circle.saveOrigin();\n\n        this.resizeOffset = this.circle.getPointFromAnchor(this.getCircleAnchor(this.mouseOrigin)).minus(this.mouseOrigin);\n    }\n\n    private mouseMove(x: number, y: number): void {\n        // determine what cursor to show //\n        let action = this.currentAction;\n        if (action === \"none\") {\n            action = this.getMouseAction(x, y);\n        }\n\n        if (action === \"move\") {\n            this.overlay.canvas.style.cursor = \"move\";\n        }\n        else if (action === \"resize\") {\n            let xr = x < this.circle.cx;\n            let yr = y < this.circle.cy;\n            let thing = +xr ^ +yr; // nice\n            this.overlay.canvas.style.cursor = thing ? \"nesw-resize\" : \"nwse-resize\";\n        }\n        else {\n            this.overlay.canvas.style.cursor = \"default\";\n        }\n\n        // actually do stuff //\n        if (this.currentAction === \"none\") {\n            return;\n        }\n        else if (this.currentAction === \"move\") {\n            let d = new Point(x, y).minus(this.mouseOrigin);\n            this.circle.position = this.circle.origin.position.plus(d);\n            this.circle.validate();\n            this.mouseOrigin = new Point(x, y);\n            this.circle.saveOrigin();\n        }\n        else if (this.currentAction === \"resize\") {\n            this.performResize(x, y);\n        }\n\n        this.circle.round(this.settings.resizeLock); // u rite\n        this.update(\"mouse move\");\n    }\n\n    private getCircleAnchor(p: Point): RectAnchor {\n        let x = p.x;\n        let y = p.y;\n\n        if (x > this.circle.cx) {\n            if (y > this.circle.cy) {\n                return \"se\";\n            }\n            else {\n                return \"ne\";\n            }\n        }\n        else {\n            if (y > this.circle.cy) {\n                return \"sw\";\n            }\n            else {\n                return \"nw\";\n            }\n        }\n    }\n\n    private performResize(x: number, y: number) {\n        let anchor = Rectangle.anchorOpposite(this.getCircleAnchor(new Point(x, y)));\n\n        if (!this.settings.resizeLock) {\n            this.resizeAnchor = this.circle.getPointFromAnchor(anchor).minus(this.resizeOffset);\n            let size = this.circle.size.copy();\n\n            let r = Rectangle.between(new Point(x, y), this.resizeAnchor);\n            //r.round();\n            this.circle.fitInsideGreedy(r, anchor, this.outerRect);\n            this.circle.validate();\n        }\n        else {\n            let r = Rectangle.between(new Point(x, y).plus(this.resizeOffset), this.circle.center);\n            r.expandToward(anchor, 2);\n            //r.round();\n            this.circle.fitInsideGreedyCenter(r, this.outerRect);\n            this.circle.validate();\n        }\n    }\n}","import { Widget } from \"./widget\";\nimport { createElement, showElement, hideElement, makePixelated } from \"./util\";\nimport { Canvas } from \"./canvas\";\nimport { CropView } from \"./cropview\";\nimport { Point } from \"./point\";\nimport { Rectangle } from \"./rectangle\";\nimport { Border } from \"./borders\";\nimport { GlobalEvents } from \"./eventclass\";\nimport { Drawer } from \"./drawer\";\nimport { AvatarCropper } from \"./avatarcropper\";\n\nexport class Preview extends Drawer {\n    private mask: Canvas;\n    private border: Canvas;\n    private image: HTMLImageElement;\n    private onlineIndicator: Canvas;\n    private bottomBar: HTMLElement;\n    private sizeDisplay: HTMLElement;\n    private removeButton: HTMLElement;\n    private _size: Point;\n    private cropView: CropView;\n    private lastMode: \"square\" | \"circle\" | \"none\" = \"none\";\n    private antialiased: boolean;\n\n    constructor(size: Point, cropView: CropView) {\n        super(createElement(\"div\", \"preview\"));\n\n        this.createEvent(\"requestremove\");\n\n        GlobalEvents.on(\"borderchange\", () => this.applyGradient());\n\n        this.cropView = cropView;\n        this.cropView.on(\"update\", (source: string) => {\n            this.update(\"preview: \" + source);\n        });\n        this.cropView.on(\"imagechange\", (src: string) => {\n            this.image.src = src;\n        });\n        this.cropView.on(\"antialiaschange\", (aa: boolean) => {\n            this.antialias = aa;\n        });\n        /*this.cropView.on(\"actionstart\", () => {\n            this.image.style.willChange = \"left, top, transform\";\n        });\n        this.cropView.on(\"actionend\", () => {\n            this.image.style.willChange = \"\";\n        });*/\n\n        this._size = size;\n\n        this.container.style.width = size.x + \"px\";\n        this.container.style.height = (size.y + 2) + \"px\";\n        this.container.style.zIndex = (-size).toString();\n\n        this.mask = new Canvas({\n            size: size.plus(new Point(0, 2))\n        });\n        this.mask.canvas.className = \"mask\";\n        this.mask.canvas.style.zIndex = \"2\";\n        this.mask.canvas.style.position = \"absolute\";\n\n        this.border = new Canvas({\n            size: size\n        });\n        this.border.canvas.className = \"border\";\n        this.mask.canvas.style.zIndex = \"1\";\n        this.border.canvas.style.position = \"absolute\";\n\n        this.image = <HTMLImageElement>createElement(\"img\", \"image\");\n        this.image.style.position = \"absolute\";\n        this.image.style.transformOrigin = \"top left\";\n        if (cropView.src) {\n            this.image.src = cropView.src;\n        }\n        this.image.style.position = \"absolute\";\n\n        if (size.equals(new Point(30))) {\n            this.onlineIndicator = new Canvas({ size: new Point(14) });\n            this.onlineIndicator.fillCircleInSquare(new Point(0, 0), 14, \"#2F3136\");\n            this.onlineIndicator.fillCircleInSquare(new Point(2, 2), 10, \"rgb(67,181,129)\");\n            this.onlineIndicator.canvas.className = \"onlineIndicator\";\n        }\n\n        this.bottomBar = createElement(\"div\", \"bottomBar\");\n\n        this.sizeDisplay = createElement(\"div\", \"size\");\n        this.sizeDisplay.innerText = size.x + \"x\" + size.y;\n        this.container.title = this.sizeDisplay.innerText;\n\n        this.removeButton = createElement(\"button\", \"remove\");\n        this.removeButton.innerText = \"✖\";\n        this.removeButton.addEventListener(\"click\", () => {\n            this.emitEvent(\"requestremove\");\n        });\n\n        this.bottomBar.appendChild(this.sizeDisplay);\n        this.bottomBar.appendChild(this.removeButton);\n\n        this.appendChild(this.image, this.mask.canvas, this.border.canvas, (this.onlineIndicator && this.onlineIndicator.canvas) || null, this.bottomBar);\n\n        this.container.addEventListener(\"mouseenter\", () => {\n            showElement(this.bottomBar);\n        });\n\n        this.container.addEventListener(\"mouseleave\", () => {\n            hideElement(this.bottomBar);\n        });\n\n        hideElement(this.bottomBar);\n\n        this.antialias = true;\n    }\n\n    public get size(): Point {\n        return this._size;\n    }\n\n    public applyGradient(): void {\n        Border.apply(this.border);\n    }\n\n    protected draw() {\n        if (AvatarCropper.settings.previewMode !== this.lastMode) {\n            this.lastMode = this.cropView.settings.previewMode;\n\n            this.applyGradient();\n\n            if (this.lastMode === \"square\") {\n                this.mask.clear();\n                this.mask.fillRect(new Rectangle(new Point(0, this.size.y), new Point(this.size.x, 2)), \"#2F3136\");\n                if (this.onlineIndicator) {\n                    hideElement(this.onlineIndicator.canvas);\n                }\n            }\n            else {\n                this.mask.fill(\"#2F3136\");\n                this.mask.blendMode = \"destination-out\";\n                this.mask.fillCircleInRect(new Rectangle(new Point(0), this.size), \"white\");\n                this.mask.blendMode = \"source-over\";\n                if (this.onlineIndicator) {\n                    showElement(this.onlineIndicator.canvas);\n                }\n            }\n        }\n\n        let scale = this.size.dividedBy(this.cropView.cropArea.size);\n        this.image.style.transform = \"scale(\" + scale.x + \",\" + scale.y + \") rotate(\" + this.cropView.rotation + \"deg)\";\n\n\n        let p = new Point(0);\n        p.subtract(this.cropView.cropArea.position.times(scale));\n\n        let dp = new Point(\n            parseFloat(this.cropView.image.style.left || \"0px\"),\n            parseFloat(this.cropView.image.style.top || \"0px\")\n        );\n\n        dp.multiply(1 / this.cropView.zoomFactor);\n\n        p.add(dp.times(scale));\n\n        this.image.style.left = p.x + \"px\";\n        this.image.style.top = p.y + \"px\";\n    }\n\n    public set antialias(antialias: boolean) {\n        makePixelated(this.image, !antialias);\n        this.antialiased = antialias;\n    }\n\n    public get antialias(): boolean {\n        return this.antialiased;\n    }\n}","import { Widget } from \"./widget\";\nimport { Preview } from \"./preview\";\nimport { createElement, array_remove, array_insert } from \"./util\";\nimport { CropView } from \"./cropview\";\nimport { Point } from \"./point\";\n\nexport class Previews extends Widget {\n    private previews: Preview[] = [];\n    private cropView: CropView;\n    public readonly padding: number = 16;\n    private _size: number = 0;\n\n    constructor(cropView: CropView) {\n        super(createElement(\"div\", \"previews\"));\n\n        this.createEvent(\"sizechange\");\n        this.createEvent(\"sizeArrayChange\");\n\n        this.cropView = cropView;\n    }\n\n    public get sizeArray(): number[] {\n        let ret = [];\n\n        this.previews.forEach(preview => {\n            ret.push(preview.size.x);\n        });\n\n        return ret;\n    }\n\n    public addPreviewSize(size: Point) {\n        let p = new Preview(size, this.cropView);\n        p.on(\"requestremove\", this.removePreview.bind(this, p));\n        p.container.style.position = \"absolute\";\n\n        this.appendChild(p);\n        array_insert(\n            this.previews,\n            p,\n            (left, right) => left.size.y > right.size.y\n        );\n        this.render();\n\n        this.emitEvent(\"sizeArrayChange\", this.sizeArray);\n    }\n\n    private removePreview(preview: Preview) {\n        array_remove(this.previews, preview);\n        this.removeChild(preview);\n        this.render();\n\n        this.emitEvent(\"sizeArrayChange\", this.sizeArray);\n    }\n\n    public get width(): number {\n        return this._size;\n    }\n\n    public get height(): number {\n        return this.previews[0] ? this.previews[0].size.y : 0;\n    }\n\n    private render(): void {\n        let runningX = this.padding;\n\n        this.previews.forEach(preview => {\n            preview.container.style.right = runningX + \"px\";\n            runningX += preview.size.x + this.padding;\n        });\n\n        this._size = runningX;\n        this.emitEvent(\"sizechange\", runningX);\n    }\n}","import { Widget } from \"./widget\";\nimport { createElement } from \"./util\";\n\nexport class LabelSlider extends Widget {\n    private labelElement: HTMLElement;\n    private sliderElement: HTMLInputElement;\n\n    constructor(minValue: number, maxValue: number, step: number, label: string = \"\", className: string = \"\") {\n        super(createElement(\"div\", \"labelSlider \" + className));\n\n        this.createEvent(\"slide\");\n        this.createEvent(\"change\");\n\n        this.labelElement = createElement(\"div\", \"labelSlider-label\");\n        this.labelElement.innerText = label;\n        this.labelElement.style.position = \"absolute\";\n\n        this.sliderElement = <HTMLInputElement>createElement(\"input\", \"labelSlider-slider\");\n        this.sliderElement.type = \"range\";\n        this.sliderElement.min = minValue.toString();\n        this.sliderElement.max = maxValue.toString();\n        this.sliderElement.step = step.toString();\n        this.sliderElement.style.position = \"absolute\";\n\n        this.sliderElement.addEventListener(\"input\", () => {\n            this.emitEvent(\"slide\", parseFloat(this.sliderElement.value));\n        });\n\n        this.sliderElement.addEventListener(\"change\", () => {\n            this.emitEvent(\"change\", parseFloat(this.sliderElement.value))\n        });\n\n        this.appendChild(this.labelElement, this.sliderElement);\n    }\n\n    public get value(): number {\n        return parseFloat(this.sliderElement.value);\n    }\n\n    public set value(value: number) {\n        this.sliderElement.value = value.toString();\n    }\n}","/* ************************************************************************\n* Title:    storage.js\n* Author:   Brandon Kemp\n* Purpose:  Provide API for Storage API because reasons\n************************************************************************ */\n\n// polyfill //\nlet w = window as any;\nif (!w.localStorage) {\n    w.localStorage = {\n        getItem: function (sKey) {\n            if (!sKey || !this.hasOwnProperty(sKey)) {\n                return null;\n            }\n            return unescape(document.cookie.replace(new RegExp(\"(?:^|.*;\\\\s*)\" + escape(sKey).replace(/[\\-\\.\\+\\*]/g, \"\\\\$&\") + \"\\\\s*\\\\=\\\\s*((?:[^;](?!;))*[^;]?).*\"), \"$1\"));\n        },\n        key: function (nKeyId) {\n            return unescape(document.cookie.replace(/\\s*\\=(?:.(?!;))*$/, \"\").split(/\\s*\\=(?:[^;](?!;))*[^;]?;\\s*/)[nKeyId]);\n        },\n        setItem: function (sKey, sValue) {\n            if (!sKey) {\n                return;\n            }\n            document.cookie = escape(sKey) + \"=\" + escape(sValue) + \"; expires=Tue, 19 Jan 2038 03:14:07 GMT; path=/\";\n            this.length = document.cookie.match(/\\=/g).length;\n        },\n        length: 0,\n        removeItem: function (sKey) {\n            if (!sKey || !this.hasOwnProperty(sKey)) {\n                return;\n            }\n            document.cookie = escape(sKey) + \"=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/\";\n            this.length--;\n        },\n        hasOwnProperty: function (sKey) {\n            return (new RegExp(\"(?:^|;\\\\s*)\" + escape(sKey).replace(/[\\-\\.\\+\\*]/g, \"\\\\$&\") + \"\\\\s*\\\\=\")).test(document.cookie);\n        }\n    };\n    w.localStorage.length = (document.cookie.match(/\\=/g) || w.localStorage).length;\n}\n\nlet Storage = {\n    get: function (key, def) {\n        // def is default value if key is not found //\n        if (def === undefined) return JSON.parse(localStorage.getItem(key));\n        if (localStorage.hasOwnProperty(key)) {\n            return JSON.parse(localStorage.getItem(key));\n        } else {\n            localStorage.setItem(key, JSON.stringify(def));\n            return def;\n        }\n    },\n    set: function (key, value) {\n        localStorage.setItem(key, JSON.stringify(value));\n    },\n    remove: function (key) {\n        localStorage.removeItem(key);\n    },\n    hasKey: function (key) {\n        return localStorage.hasOwnProperty(key);\n    },\n    clear: function () {\n        localStorage.clear();\n    }\n};\nexport default Storage;","import { createElement } from \"./util\";\nimport { ClosableDialog } from \"./closabledialog\";\n\nexport class WhatsNewDialog extends ClosableDialog {\n    private list =\n        {\n            \"Feburary 2022\":\n                [\n                    \"Bug fixes and preformance improvements\",\n                    \"wow, such update\"\n                ],\n            \"October 2019\":\n                [\n                    \"Added borders for LGBT frends... more/custom borders coming soon\",\n                    \"Added support for custom colored borders, import/export feature coming soon\",\n                    \"Updated some styling\"\n                ],\n            \"July 2019\":\n                [\n                    \"Added functionality for centering, setting size manually, and resize locking\",\n                    \"Bug fixes and performance improvements\"\n                ],\n            \"May 2019\":\n                [\n                    \"Made it so you can move the crop area pixel-by-pixel using arrow keys\",\n                    \"Also I can't make it so you can just put a url of a pic without having a dedicated server which i don't got the munz for sorry\"\n                ],\n            \"April 2019\":\n                [\n                    \"Changed mask to be pixel-accurate\",\n                    \"Added option to show guidelines\"\n                ],\n            \"February 2019\":\n                [\n                    \"rewrote the whole dang thing so its not all in one file anymore lol\",\n                    \"flip image horizontally or vertically (gifs soon)\",\n                    \"antialias toggle (won't affect rendering, which just crops the image directly)\",\n                    \"online indicator preview for discord\",\n                    \"bugfixes and quality of life improvements\",\n                    \"please tell me if you find bugs they probably exist and please tell me how you made them happen\"\n                ],\n            \"December 2018\":\n                [\n                    \"You can remove preview sizes now by clicking in the bottom-right area. The web site will also magically remember your preview sizes between visits.\",\n                    \"Zoom-fit should be imperceptibly faster... also shouldn't show phantom scroll bars anymore\"\n                ],\n            \"November 2018\":\n                [\n                    \"Rotation! Please let me know if u find any bugs with this.\"\n                ],\n            \"August 2018\":\n                [\n                    \"Helpful tutorial\",\n                    \"Better Mask Outline\",\n                    \"Updated Canvas Backend\",\n                    \"Updated Preview Image Backend\",\n                    \"So tell me if you find any weird bugs\",\n                    \"Loading screen so you can't open a file before it's ready for you to\"\n                ],\n            \"July 2018\":\n                [\n                    \"Drag & Drop support - thanx TheRebelG0d\",\n                    \"New rendering where you can pick circle or square after rendering... revolutionary...\",\n                    \"Zoom functionality\",\n                    \"Other stuff probaly\"\n                ],\n            \"June 2018\":\n                [\n                    \"bugfixes cool\"\n                ],\n            \"May 2018\":\n                [\n                    \"GIF support!! wow did you know GIFs work on this ??? at least i hope they do\"\n                ],\n            \"Earlier\":\n                [\n                    \"other stuff\"\n                ]\n        };\n\n    constructor() {\n        super();\n\n        this.dialog.classList.add(\"dialog-whatsNew\");\n\n        let es: HTMLElement[] = [];\n\n        let h1 = createElement(\"h1\");\n        h1.innerText = \"What's New...\";\n        es.push(h1);\n\n        for (let month in this.list) {\n            let h2 = createElement(\"h2\");\n            h2.innerText = month;\n\n            let ul = createElement(\"ul\");\n\n            this.list[month].forEach((thing: string) => {\n                let li = createElement(\"li\");\n                li.innerText = thing;\n                ul.appendChild(li);\n            });\n\n            es.push(h2);\n            es.push(ul);\n        }\n\n        this.appendChild(...es);\n    }\n}","export let PRIVACYPOLICY =\n    \"tl;dr = i use google analytics to see how many people use the site, including how many people use a certain browser, whether people use desktops or phones, etc to help me get an idea of what to focus on when developing/testing the site\\n\\\n\\n\\\nmy awesome Privacy Policy\\n\\\n\\n\\\nThis Privacy Policy describes how your personal information is collected, used, and shared when you visit https://songsing.github.io/avatarcropper/ (the “Site”).\\n\\\n\\n\\\nPERSONAL INFORMATION WE COLLECT\\n\\\n\\n\\\nWhen you visit the Site, we automatically collect certain information about your device, including information about your web browser, and some of the cookies that are installed on your device. Additionally, as you browse the Site, we collect information about the individual web pages that you view (on the Site), what websites or search terms referred you to the Site, and information about how you interact with the Site. We refer to this automatically-collected information as “Device Information.”\\n\\\n\\n\\\nWe collect Device Information using the following technologies:\\n\\\n\\n\\\n    - “Cookies” are data files that are placed on your device or computer and often include an anonymous unique identifier. For more information about cookies, and how to disable cookies, visit http://www.allaboutcookies.org.\\n\\\n    - “Log files” track actions occurring on the Site, and collect data including your browser type, Internet service provider, referring/exit pages, and date/time stamps.\\n\\\n    - “Web beacons,” “tags,” and “pixels” are electronic files used to record information about how you browse the Site.\\n\\\n\\n\\\nHOW DO WE USE YOUR PERSONAL INFORMATION?\\n\\\n\\n\\\ni just like to see how many users on the site\\n\\\n\\n\\\nSHARING YOUR PERSONAL INFORMATION\\n\\\n\\n\\\ni use google analytics\\n\\\nyou can read more about how Google uses your Personal Information here:  https://www.google.com/intl/en/policies/privacy/.  You can also opt-out of Google Analytics here:  https://tools.google.com/dlpage/gaoptout.\\n\\\n\\n\\\nFinally, we may also share your Personal Information to comply with applicable laws and regulations, to respond to a subpoena, search warrant or other lawful request for information we receive, or to otherwise protect our rights.\\n\\\n\\n\\\nDO NOT TRACK\\n\\\nPlease note that we do not alter our Site’s data collection and use practices when we see a Do Not Track signal from your browser.\\n\\\n\\n\\\nYOUR RIGHTS\\n\\\nIf you are a European resident, you have the right to access personal information we hold about you and to ask that your personal information be corrected, updated, or deleted. If you would like to exercise this right, please contact us through the contact information below.\\n\\\n\\n\\\nidk how that will work tho bc all the info is anonymous ??\\n\\\n\\n\\\nCHANGES\\n\\\nWe may update this privacy policy from time to time in order to reflect, for example, changes to our practices or for other operational, legal or regulatory reasons.\\n\\\n\\n\\\nCONTACT US\\n\\\nFor more information about our privacy practices, if you have questions, or if you would like to make a complaint, please contact us by e-mail at songsingfeedback@gmail.com\"","import { WhatsNewDialog } from './whatsnew'\nimport { hideElement } from './util'\nimport { GlobalEvents } from './eventclass'\nimport { TutorialDialog } from './tutorial'\nimport { SupportersDialog } from './supporters'\n\nlet tutorial: TutorialDialog\n\nexport function showTutorial() {\n    tutorial.show()\n}\n\nexport function doFooterThings() {\n    tutorial = new TutorialDialog()\n    document.body.appendChild(tutorial.container)\n    document.getElementById('link-help').addEventListener('click', () => {\n        showTutorial()\n    })\n\n    let whatsNew = new WhatsNewDialog()\n    document.getElementById('link-whatsNew').addEventListener('click', () => {\n        whatsNew.show()\n    })\n    document.body.appendChild(whatsNew.container)\n\n    document.getElementById('closeFooter').addEventListener('click', () => {\n        document.getElementById('container').style.height = '100%'\n        document.querySelector<HTMLElement>('.bigOverlay').style.height = '100%'\n        hideElement(document.getElementById('footer'))\n        GlobalEvents.emitEvent('resize')\n    })\n\n    let supporters = new SupportersDialog()\n    document.getElementById('link-supporters').addEventListener('click', () => {\n        supporters.show()\n    })\n    document.body.appendChild(supporters.container)\n}\n","import { ClosableDialog } from \"./closabledialog\";\nimport { createElement } from \"./util\";\nimport { PRIVACYPOLICY } from \"./privacypolicy\";\n\nexport class TutorialDialog extends ClosableDialog {\n    constructor() {\n        super();\n        this.dialog.classList.add(\"dialog-tutorial\");\n    }\n\n    show() {\n        this.innerHTML = \"\";\n        this.contentContainer.style.userSelect = \"\";\n        let h1 = createElement(\"h1\");\n        h1.innerText = \"Tutorial..\";\n\n        let learnMore = createElement(\"span\", \"link\");\n        learnMore.addEventListener(\"click\", () => {\n            this.contentContainer.style.userSelect = \"text\";\n            this.innerText = PRIVACYPOLICY;\n            this.contentContainer.scrollTop = 0;\n        });\n        learnMore.innerText = \"learn more\";\n\n        let body = createElement(\"div\");\n        body.innerHTML =\n            \"Hello, you can resize the cropping area by dragging on the \"\n            + \"\\\"corners\\\" of the circle/square.<br>\"\n            + \"<img src='\" + require('../images/tut.png') + \"' class='image'><br>\"\n            + \"Thank you, this has been the tutorial.<br>\"\n            + \"Please leave feedback or donate with the links at the bottom!\";\n\n        body.innerHTML += \"<br><br>\" +\n            \"<b>also this site use cookie if u use it u agree to cookie \";\n\n        body.appendChild(learnMore);\n\n        this.appendChild(h1, body);\n\n        super.show();\n    }\n}","import { ClosableDialog } from \"./closabledialog\";\n\nexport class SupportersDialog extends ClosableDialog {\n    private patrons =\n        [\n            \"henby\",\n            \"Jenny\",\n            \"xPraisexAphroditex\"\n        ];\n\n    private donors =\n        [\n            \"Glen Cathey\",\n            \"Betty Glez\",\n            \"Max Abbot\",\n            \"MetalSonicDash\",\n            \"Almxg Levi\",\n            \"Tenkay\",\n            \"PanPan\",\n            \"wtx\",\n            \"Néć[Ř]ø /A/\",\n            \"HabLover22\",\n            \"Anna X. Young\",\n            \"and 4 anons:)\"\n        ];\n\n    constructor() {\n        super();\n        this.dialog.classList.add(\"dialog-supporters\");\n\n        this.innerHTML = \"<h1>Supporters</h1>\";\n\n        this.innerHTML += \"Thanks to these people for donating and contributing to my work!!<br><br>\";\n        this.innerHTML += this.patrons.concat(this.donors).join(\"<br>\");\n\n        this.innerHTML += \"<br><br>I always ask before publishing a name so just let me know if you'd prefer to stay anonymous!<br>ok thx love u\";\n    }\n}","import { showElement, hideElement } from \"./util\";\nimport { EventClass } from \"./eventclass\";\n\nexport class DragDrop extends EventClass {\n    private tempText: string = null;\n\n    constructor(overlay: HTMLElement) {\n        super();\n\n        this.createEvent(\"drop\");\n        this.createEvent(\"dragleave\");\n\n        document.addEventListener(\"dragover\", (e) => {\n            e.preventDefault();\n            e.stopPropagation();\n        });\n\n        document.addEventListener(\"dragend\", (e) => {\n            e.preventDefault();\n            e.stopPropagation();\n        });\n\n        document.addEventListener(\"dragenter\", (e) => {\n            e.preventDefault();\n            e.stopPropagation();\n\n            if (!this.tempText) {\n                this.tempText = overlay.innerText;\n            }\n\n            showElement(overlay);\n            overlay.innerText = \"Drop file\";\n            overlay.style.zIndex = \"9999\";\n\n            console.log(this.tempText);\n        });\n\n        document.addEventListener(\"dragleave\", (e) => {\n            e.preventDefault();\n            e.stopPropagation();\n\n            if (e.target === overlay) {\n                hideElement(overlay);\n                overlay.innerText = this.tempText;\n                overlay.style.zIndex = \"\";\n                this.tempText = null;\n                this.emitEvent(\"dragleave\");\n            }\n        });\n\n        document.addEventListener(\"drop\", (e) => {\n            e.preventDefault();\n            e.stopPropagation();\n\n            if (e.dataTransfer.files.length) {\n                this.emitEvent(\"drop\", e.dataTransfer.files[0]);\n            }\n\n            hideElement(overlay);\n            overlay.innerText = this.tempText;\n            overlay.style.zIndex = \"\";\n            this.tempText = null;\n        });\n    }\n}","import { Dialog } from \"./dialog\";\nimport { emptyFn } from \"./util\";\n\nexport abstract class InputDialog<T> extends Dialog {\n    constructor(onreturn?: (input: T) => void) {\n        super();\n        this.container.classList.add(\"input\");\n\n        this.createEvent(\"return\");\n\n        if (onreturn) {\n            this.on(\"return\", onreturn);\n        }\n\n        this.container.addEventListener(\"click\", () => {\n            this.emitEvent(\"return\", null);\n        });\n    }\n}","import { Widget } from \"./widget\";\nimport { Canvas } from \"./canvas\";\nimport { Point } from \"./point\";\nimport { GradientInfo, Border, GradientStop } from \"./borders\";\nimport { InputDialog } from \"./inputdialog\";\nimport { createElement, array_last, array_remove, createOptionElement } from \"./util\";\nimport { LabelSlider } from \"./labeledslider\";\nimport { AvatarCropper } from \"./avatarcropper\";\n\n// what fucked up design pattern is this //\nexport class GradientEditButton extends Widget {\n    private canvas: Canvas;\n    private _gradient: GradientInfo;\n\n    constructor(resolution: Point) {\n        super();\n        this.canvas = new Canvas({ size: resolution });\n        this.container = this.canvas.canvas;\n        this.createEvent(\"update\");\n\n        this.container.addEventListener(\"click\", () => {\n            let d = new GradientEditDialog(this.gradient);\n            d.on(\"return\", (gradient: GradientInfo) => {\n                this.emitEvent(\"update\", gradient);\n            });\n            document.getElementById(\"container\").appendChild(d.container);\n            d.show();\n        });\n    }\n\n    public set gradient(gradient: GradientInfo) {\n        if (gradient !== null) {\n            this._gradient = gradient;\n            Border.applyGradientToCanvas(gradient, this.canvas);\n        }\n    }\n\n    public get gradient(): GradientInfo {\n        return this._gradient;\n    }\n}\n\nclass GradientEditDialog extends InputDialog<GradientInfo> {\n    private previewCanvas: Canvas;\n    private gradientSlider: GradientSlider;\n    private gradientInfo: GradientInfo;\n    private angleSlider: LabelSlider;\n    private colorSelect: HTMLInputElement;\n    private dirty: boolean = true;\n\n    constructor(gradientInfo: GradientInfo) {\n        super();\n        this.container.classList.add(\"gradientEdit\");\n        this.gradientInfo = gradientInfo;\n\n        let leftCol = createElement(\"div\", \"leftCol\");\n        let rightCol = createElement(\"div\", \"rightCol\");\n\n        // preview canvas //\n        this.previewCanvas = new Canvas({ size: new Point(500) });\n        this.previewCanvas.canvas.classList.add(\"preview\")\n        Border.applyGradientToCanvas(this.gradientInfo, this.previewCanvas);\n        leftCol.appendChild(this.previewCanvas.canvas);\n\n        // presets //\n        let presetRow = createElement(\"div\", \"row\");\n\n        let presetLabel = createElement(\"span\", \"label\");\n        presetLabel.innerText = \"Preset:\";\n        presetRow.appendChild(presetLabel);\n\n        let presetSelect = createElement(\"select\") as HTMLSelectElement;\n        presetSelect.add(createOptionElement(\"Select one...\", \"\"));\n        AvatarCropper.settings.borderPresets.forEach((preset) => {\n            presetSelect.add(createOptionElement(preset.name, JSON.stringify(preset)));\n        });\n        presetRow.appendChild(presetSelect);\n\n        let load = createElement(\"button\");\n        load.innerText = \"Load this preset\";\n        load.addEventListener(\"click\", () => {\n            if (presetSelect.value) {\n                this.gradientInfo = JSON.parse(presetSelect.value);\n                this.gradientSlider.stops = this.gradientInfo.gradient;\n                this.dirty = true;\n            }\n        });\n        presetRow.appendChild(load);\n\n        let overwrite = createElement(\"button\");\n        overwrite.innerText = \"Overwrite this preset\";\n        overwrite.addEventListener(\"click\", () => {\n            if (presetSelect.value) {\n                AvatarCropper.settings.borderPresets[presetSelect.selectedIndex - 1] = this.gradientInfo;\n                presetSelect.selectedOptions[0].value = JSON.stringify(this.gradientInfo);\n                AvatarCropper.saveSettings();\n            }  else {\n                alert(\"Please select a valid preset or save as new preset.\");\n            }\n        });\n        presetRow.appendChild(overwrite);\n\n        let saveNew = createElement(\"button\");\n        saveNew.innerText = \"Save as new preset\";\n        saveNew.addEventListener(\"click\", () => {\n            let name = prompt(\"Name the new preset:\");\n            if (name === null) {\n                // cancelled\n            } else if (!name) {\n                alert(\"That name is invalid.\");\n            } else {\n                if (AvatarCropper.settings.borderPresets.some(preset => preset.name.toLowerCase() === name.toLowerCase())) {\n                    alert(\"That name is already taken.\");\n                } else {\n                    this.gradientInfo.name = name;\n                    AvatarCropper.settings.borderPresets.push(this.gradientInfo);\n                    AvatarCropper.saveSettings();\n                    presetSelect.add(createOptionElement(name, JSON.stringify(this.gradientInfo)));\n                    presetSelect.selectedIndex = AvatarCropper.settings.borderPresets.length; // no - 1 because theres an extra at the beginning of the select\n                }\n            }\n        });\n        presetRow.appendChild(saveNew);\n\n        let deletePreset = createElement(\"button\");\n        deletePreset.innerText = \"Delete this preset\";\n        deletePreset.addEventListener(\"click\", () => {\n            if (presetSelect.value && confirm(\"Are you sure you want to delete this preset?\")) {\n                let index = presetSelect.selectedIndex - 1;\n                AvatarCropper.settings.borderPresets.splice(index, 1);\n                AvatarCropper.saveSettings();\n                presetSelect.remove(index + 1);\n            }\n        });\n        presetRow.appendChild(deletePreset);\n\n        rightCol.appendChild(presetRow);\n\n        // gradient slider //\n        this.gradientSlider = new GradientSlider(new Point(500, 28), this.gradientInfo);\n        this.gradientSlider.on(\"update\", (stops: GradientStop[]) => {\n            this.gradientInfo.gradient = stops;\n        });\n        this.gradientSlider.on(\"colorchange\", (color: string) => {\n            this.colorSelect.value = color;\n        });\n        rightCol.appendChild(this.gradientSlider.container);\n\n        // color select //\n        this.colorSelect = createElement(\"input\") as HTMLInputElement;\n        this.colorSelect.type = \"color\";\n        this.colorSelect.value = this.gradientSlider.currentStopColor;\n        this.colorSelect.addEventListener(\"change\", () => {\n            this.gradientSlider.currentStopColor = this.colorSelect.value;\n        });\n        rightCol.appendChild(this.colorSelect);\n\n        // buttons //\n        let buttonRow = createElement(\"div\", \"row\");\n\n        let add = createElement(\"button\");\n        add.innerText = \"Add stop\";\n        add.addEventListener(\"click\", () => {\n            this.gradientSlider.addStop();\n        });\n        buttonRow.appendChild(add);\n\n        let remove = createElement(\"button\");\n        remove.innerText = \"Remove stop\";\n        remove.addEventListener(\"click\", () => {\n            this.gradientSlider.removeStop();\n        });\n        buttonRow.appendChild(remove);\n\n        let equidistant = createElement(\"button\");\n        equidistant.innerText = \"Make stops equidistant\";\n        equidistant.addEventListener(\"click\", () => {\n            this.gradientSlider.makeEquidistant();\n        });\n        buttonRow.appendChild(equidistant);\n        rightCol.appendChild(buttonRow);\n\n        // angle slider //\n        this.angleSlider = new LabelSlider(0, 360, 1, \"Angle\", \"angleSlider\");\n        this.angleSlider.value = gradientInfo.angle;\n\n        this.angleSlider.on(\"slide\", () => {\n            this.gradientInfo.angle = this.angleSlider.value;\n            this.dirty = true;\n        });\n        rightCol.appendChild(this.angleSlider.container);\n\n        // ok and cancel //\n        let saveRow = createElement(\"div\", \"row\");\n        \n        let ok = createElement(\"button\", \"ok\");\n        ok.innerText = \"OK\";\n        ok.addEventListener(\"click\", () => {\n            this.emitEvent(\"return\", this.gradientInfo);\n            this.hide();\n        });\n\n        let cancel = createElement(\"button\", \"cancel\");\n        cancel.innerText = \"Cancel\";\n        cancel.addEventListener(\"click\", () => {\n            this.hide();\n        });\n\n        saveRow.appendChild(cancel);\n        saveRow.appendChild(ok);\n        rightCol.appendChild(saveRow);\n\n        // finalize //\n        this.appendChild(\n            leftCol,\n            rightCol\n        );\n        \n        this._draw();\n    }\n    \n    public dismiss(): void {\n        if (!this.gradientSlider.isDragging) {\n            this.hide();\n        }\n    }\n\n    private _draw(): void {\n        if (this.gradientSlider.dirty || this.dirty) {\n            Border.applyGradientToCanvas(this.gradientInfo, this.previewCanvas);\n            this.gradientSlider.draw();\n            this.dirty = false;\n        }\n\n        requestAnimationFrame(() => this._draw());\n    }\n}\n\nclass GradientSlider extends Widget {\n    private gradientCanvas: Canvas;\n    private stopElements: HTMLElement[] = [];\n    private lastTouched : HTMLElement;\n    private dragging: HTMLElement;\n    private dragOriginX: number;\n    private elementOriginX: number;\n    public dirty: boolean = true;\n    private _stops: GradientStop[] = [];\n\n    constructor(size: Point, gradient: GradientInfo) {\n        super(\"gradientSlider\");\n\n        this.createEvent(\"update\");\n        this.createEvent(\"currentstopchange\");\n\n        this.gradientCanvas = new Canvas({ size });\n\n        document.addEventListener(\"mouseup\", () => {\n            setTimeout(() => this.dragging = null, 1);\n        });\n\n        document.addEventListener(\"touchend\", () => {\n            setTimeout(() => this.dragging = null, 1);\n        });\n\n        document.addEventListener(\"mousemove\", this.drag.bind(this));\n        document.addEventListener(\"touchmove\", this.drag.bind(this));\n\n        this.appendChild(this.gradientCanvas.canvas);\n        this.stops = gradient.gradient.sort((a, b) => a.pos - b.pos);\n    }\n\n    public set stops(stops: GradientStop[]) {\n        this._stops = stops;\n        this.stopElements.forEach((element) => {\n            this.removeChild(element);\n        });\n        this.stopElements = this.stops.map(this.createStop.bind(this));\n        this.makeLastTouched(this.stopElements[0]);\n        this.appendChild(...this.stopElements);\n    }\n\n    public get stops(): GradientStop[] {\n        return this._stops;\n    }\n\n    private get width() {\n        return this.gradientCanvas.width;\n    }\n\n    private get height() {\n        return this.gradientCanvas.height;\n    }\n\n    private get trackWidth() {\n        return this.width - this.height;\n    }\n\n    private applyMousedown(stopElement: HTMLElement, clientX: number) {\n        this.dragging = stopElement;\n        this.dragOriginX = clientX;\n        this.elementOriginX = parseInt(stopElement.style.left);\n        this.makeLastTouched(stopElement);\n    }\n\n    private makeLastTouched(stopElement: HTMLElement) {\n        if (this.lastTouched) {\n            this.lastTouched.classList.remove(\"current\");\n            this.lastTouched.style.zIndex = \"0\";\n        }\n        this.lastTouched = stopElement;\n        this.lastTouched.classList.add(\"current\");\n        this.lastTouched.style.zIndex = \"1\";\n        this.emitEvent(\"colorchange\", this.lastTouched.getAttribute(\"color\"));\n    }\n\n    private createStop(info : GradientStop) {\n        let r = this.gradientCanvas.size.x - this.gradientCanvas.size.y;\n        let stop = createElement(\"div\", \"stop\");\n        stop.style.left = (r * info.pos).toString() + \"px\";\n        stop.setAttribute(\"color\", info.color);\n        stop.style.backgroundColor = info.color;\n        stop.addEventListener(\"mousedown\", (e) => {\n            this.applyMousedown(stop, e.clientX);\n        });\n        stop.addEventListener(\"touchstart\", (e) => {\n            this.applyMousedown(stop, e.touches[0].clientX);\n        });\n        return stop;\n    }\n\n    public set currentStopColor(color: string) {\n        if (this.lastTouched) {\n            this.lastTouched.setAttribute(\"color\", color);\n            this.lastTouched.style.backgroundColor = color;\n            this.update();\n        }\n    }\n    \n    public get currentStopColor(): string {\n        return this.lastTouched.getAttribute(\"color\");\n    }\n\n    public get isDragging(): boolean {\n        return !!this.dragging;\n    }\n\n    private drag(e: MouseEvent | TouchEvent) {\n        if (this.dragging) {\n            let clientX = e instanceof MouseEvent ? e.clientX : e.touches[0].clientX;\n            if (e instanceof TouchEvent) {\n                e.preventDefault();\n            }\n            let diff = this.dragOriginX - clientX;\n            let x = this.elementOriginX - diff;\n            x = Math.max(0, x);\n            x = Math.min(this.trackWidth, x);\n            this.dragging.style.left = x.toString() + \"px\";\n            this.update();\n        }\n    }\n\n    private update() {\n        this._stops = this.stopElements.map((stop) => {\n            return {\n                pos: parseInt(stop.style.left) / (this.trackWidth),\n                color: stop.getAttribute(\"color\")\n            };\n        });\n\n        this.dirty = true;\n\n        this.emitEvent(\"update\", this.stops);\n    }\n\n    public draw(): void {\n        Border.applyGradientToCanvas({ angle: 270, gradient: this.stops, name: \"\" }, this.gradientCanvas);\n        this.dirty = false;\n    }\n\n    public addStop(): void {\n        // sort elements left to right //\n        this.stopElements.sort((a, b) => parseInt(a.style.left) - parseInt(b.style.left));\n\n        // get reference info //\n        let ref = this.lastTouched || this.stopElements[0];\n        let li = this.stopElements.indexOf(ref);\n\n        // put new stop between ref and something else //\n        let offset = li < this.stopElements.length - 1 ? 1 : -1;\n        let newStop = this.createStop({\n            color: \"white\",\n            pos: (parseInt(ref.style.left) + parseInt(this.stopElements[li + offset].style.left)) / 2 / (this.trackWidth)\n        });\n\n        this.stopElements.push(newStop);\n        this.appendChild(newStop);\n        this.makeLastTouched(newStop);\n        this.update();\n    }\n\n    public removeStop(): void {\n        // don't remove if only 2 //\n        if (this.stopElements.length === 2) {\n            return;\n        }\n\n        // sort elements left to right //\n        this.stopElements.sort((a, b) => parseInt(a.style.left) - parseInt(b.style.left));\n\n        // remove either last touched or last element //\n        let toRemove = this.lastTouched || array_last(this.stopElements);\n\n        array_remove(this.stopElements, toRemove);\n        this.removeChild(toRemove);\n        this.makeLastTouched(this.stopElements[0]);\n        this.update();\n    }\n\n    public makeEquidistant(): void {\n        // sort elements left to right //\n        this.stopElements.sort((a, b) => parseInt(a.style.left) - parseInt(b.style.left));\n\n        this.stopElements.forEach((stop, i) => {\n            stop.style.left = ((i / (this.stopElements.length - 1)) * (this.trackWidth)).toString() + \"px\";\n        });\n\n        this.update();\n    }\n}","import { Widget } from './widget'\nimport { CropView } from './cropview'\nimport { Previews } from './previews'\nimport {\n    createElement,\n    hideElement,\n    showElement,\n    getIEVersion,\n    createOptionElement,\n} from './util'\nimport { LabelSlider } from './labeledslider'\nimport Storage from './storage'\nimport { doFooterThings, showTutorial } from './footer'\nimport { GlobalEvents } from './eventclass'\nimport { TextDialog } from './textdialog'\nimport { DragDrop } from './dragdrop'\nimport { Point } from './point'\nimport { KeyManager } from './keymanager'\nimport { Border, GradientInfo } from './borders'\nimport { Canvas } from './canvas'\nimport { GradientEditButton } from './gradientedit'\n\nexport interface Settings {\n    previewSizes: number[]\n    maskOpacity: number\n    previewMode: 'circle' | 'square'\n    outlinesEnabled: boolean\n    antialias: boolean\n    dismissedTutorial: boolean\n    dismissedIE: boolean\n    dismissedCookie: boolean\n    guidesEnabled: boolean\n    resizeLock: boolean\n    borderSize: number\n    borderPresets: GradientInfo[]\n    bannerEnabled: boolean\n}\n\nexport class AvatarCropper extends Widget {\n    private cropView: CropView\n    private previews: Previews\n\n    private menu: HTMLElement\n    private openFileLabel: HTMLElement\n    private maskOutlineButton: HTMLElement\n    private guidesButton: HTMLElement\n    private toggleMenuButton: HTMLElement\n    private flipHButton: HTMLElement\n    private flipVButton: HTMLElement\n    private antialiasButton: HTMLElement\n    private textOverlay: HTMLLabelElement\n    private borderSelect: HTMLSelectElement;\n\n    private menuToggle: boolean = true\n    private firstOpened: boolean = false\n\n    public static readonly settings: Settings = {\n        previewSizes: [30, 40, 64, 128],\n        maskOpacity: 0.5,\n        previewMode: 'circle',\n        outlinesEnabled: true,\n        antialias: true,\n        dismissedTutorial: false,\n        dismissedIE: false,\n        dismissedCookie: false,\n        guidesEnabled: true,\n        resizeLock: false,\n        borderSize: 0.05,\n        borderPresets: Border.defaults,\n        bannerEnabled: false\n\n    }\n\n    constructor(container: HTMLElement) {\n        super(container)\n\n        this.loadSettings()\n        Border.size = AvatarCropper.settings.borderSize\n        console.log(AvatarCropper.settings.borderSize)\n        this.constructMenu()\n        this.cropView = new CropView(AvatarCropper.settings)\n        this.previews = new Previews(this.cropView)\n\n        this.appendChild(this.cropView, this.previews)\n\n        AvatarCropper.settings.previewSizes.forEach(size => {\n            this.previews.addPreviewSize(new Point(size))\n        })\n\n        this.previews.on('sizeArrayChange', (sizeArray: number[]) => {\n            AvatarCropper.settings.previewSizes = sizeArray\n            AvatarCropper.saveSettings();\n        })\n\n        window.addEventListener('resize', this.handleResize.bind(this))\n        this.previews.on('sizechange', this.handleResize.bind(this))\n        GlobalEvents.on('resize', this.handleResize.bind(this))\n\n        this.cropView.on('antialiaschange', (antialiased: boolean) => {\n            if (antialiased) {\n                this.antialiasButton.classList.add('toggled')\n            } else {\n                this.antialiasButton.classList.remove('toggled')\n            }\n\n            AvatarCropper.settings.antialias = antialiased\n            AvatarCropper.saveSettings();\n        })\n        this.handleResize()\n\n        this.textOverlay = <HTMLLabelElement>(\n            createElement('label', 'bigOverlay')\n        )\n        this.textOverlay.innerText = 'Open file'\n        this.textOverlay.style.cursor = 'pointer'\n        this.textOverlay.setAttribute('for', 'openInput')\n\n        let dragDrop = new DragDrop(this.textOverlay)\n        dragDrop.on('drop', file => {\n            this.openFile(file)\n        })\n        dragDrop.on('dragleave', () => {\n            if (!this.firstOpened) {\n                showElement(this.textOverlay)\n            }\n        })\n\n        document.body.appendChild(this.textOverlay)\n\n        if (getIEVersion() !== false && !AvatarCropper.settings.dismissedIE) {\n            window.alert(\n                \"hey so your browser isn't really supported ... things should still work but they will be slower/ugly due to how internet explorer/edge function (They don't conform to web standards). i'd recommend switching to firefox or chrome!! but you don't have to if you don't want to. this is the only time you'll see this message unless u clear ur cache or something. ok bye\",\n            )\n\n            AvatarCropper.settings.dismissedIE = true\n            AvatarCropper.saveSettings();\n        }\n    }\n\n    public loadFromFile(file: File): void {\n        this.cropView.setImageFromFile(file)\n    }\n\n    public static saveSettings() {\n        Storage.set('settings', AvatarCropper.settings)\n    }\n\n    private loadSettings() {\n        let s = Storage.get('settings', {})\n\n        for (let key in AvatarCropper.settings) {\n            if (s.hasOwnProperty(key)) {\n                if (s[key] !== null) {\n                    AvatarCropper.settings[key] = s[key]\n                }\n            }\n        }\n\n        AvatarCropper.saveSettings();\n    }\n\n    private constructMenu(): void {\n        this.menu = createElement('div', 'menu')\n\n        let openFile = <HTMLInputElement>(\n            createElement('input', 'openInput show')\n        )\n        openFile.id = 'openInput'\n        openFile.type = 'file'\n        openFile.addEventListener('change', e => {\n            if (openFile.files && openFile.files[0]) {\n                this.openFile(openFile.files[0])\n            }\n        })\n\n        this.openFileLabel = createElement('label', 'open half item show')\n        this.openFileLabel.innerText = 'Open File...'\n        this.openFileLabel.appendChild(openFile)\n        this.menu.appendChild(this.openFileLabel)\n\n        this.toggleMenuButton = createElement('button', 'half item show')\n        this.toggleMenuButton.setAttribute('uptext', 'Collapse Menu')\n        this.toggleMenuButton.setAttribute('downtext', '▼')\n        this.toggleMenuButton.innerText = this.toggleMenuButton.getAttribute(\n            'uptext',\n        )\n        this.toggleMenuButton.addEventListener(\n            'click',\n            this.toggleMenu.bind(this),\n        )\n        this.menu.appendChild(this.toggleMenuButton)\n\n        let circle = createElement('button', 'open item half')\n        let square = createElement('button', 'open item half')\n        circle.innerText = 'Circle'\n        square.innerText = 'Squaré'\n        circle.classList.toggle(\"toggled\", AvatarCropper.settings.previewMode === \"circle\");\n        square.classList.toggle(\"toggled\", AvatarCropper.settings.previewMode === \"square\");\n        circle.addEventListener('click', () => {\n            circle.classList.add('toggled')\n            square.classList.remove('toggled')\n            AvatarCropper.settings.previewMode = 'circle'\n            this.cropView && this.cropView.update(\"circle toggle\") // will update previews as well\n            AvatarCropper.saveSettings();\n        })\n        square.addEventListener('click', () => {\n            circle.classList.remove('toggled')\n            square.classList.add('toggled')\n            AvatarCropper.settings.previewMode = 'square'\n            this.cropView && this.cropView.update(\"square toggle\") // will update previews as well\n            AvatarCropper.saveSettings();\n        })\n        this.menu.appendChild(circle)\n        this.menu.appendChild(square)\n        \n\n        let tSlider = new LabelSlider(\n            0,\n            1,\n            0.01,\n            'Mask Transparency',\n            'item transparency',\n        )\n        tSlider.on('slide', this.setTransparency.bind(this))\n        tSlider.on('change', () => AvatarCropper.saveSettings());\n        tSlider.value = 1 - AvatarCropper.settings.maskOpacity\n        this.menu.appendChild(tSlider.container)\n\n        let zoomBar = createElement('div', 'item zoomBar')\n        let zoomLabel = createElement('div', 'zoomLabel')\n        zoomLabel.innerText = 'Zoom:'\n        zoomBar.appendChild(zoomLabel)\n        let zoomOut = createElement('button', 'zoomOut')\n        zoomOut.innerText = '-'\n        zoomOut.addEventListener('click', () => this.cropView.zoomOut())\n        let zoomIn = createElement('button', 'zoomIn')\n        zoomIn.innerText = '+'\n        zoomIn.addEventListener('click', () => this.cropView.zoomIn())\n        let zoomFit = createElement('button', 'zoomFit')\n        zoomFit.innerText = 'Fit'\n        zoomFit.addEventListener('click', () => this.cropView.zoomFit())\n        zoomBar.appendChild(zoomFit)\n        zoomBar.appendChild(zoomIn)\n        zoomBar.appendChild(zoomOut)\n        this.menu.appendChild(zoomBar)\n\n        let rSlider = new LabelSlider(-180, 180, 1, 'Rotation', 'item rotation')\n        rSlider.on('slide', (deg: number) => {\n            if (Math.abs(deg - 90) <= 2) {\n                deg = 90\n            } else if (Math.abs(deg + 90) <= 2) {\n                deg = -90\n            } else if (Math.abs(deg) <= 2) {\n                deg = 0\n            } else if (Math.abs(deg - 180) <= 2) {\n                deg = 180\n            } else if (Math.abs(deg + 180) <= 2) {\n                deg = -180\n            }\n\n            this.setRotation(deg)\n        })\n        rSlider.value = 0\n        this.menu.appendChild(rSlider.container)\n\n        this.flipHButton = createElement('button', 'half item')\n        this.flipHButton.innerText = 'Flip Horiz.'\n        this.flipHButton.addEventListener(\n            'click',\n            this.flipHorizontal.bind(this),\n        )\n        this.menu.appendChild(this.flipHButton)\n\n        this.flipVButton = createElement('button', 'half item')\n        this.flipVButton.innerText = 'Flip Vertical'\n        this.flipVButton.addEventListener('click', this.flipVertical.bind(this))\n        this.menu.appendChild(this.flipVButton)\n\n        this.antialiasButton = createElement('button', 'half item')\n        this.antialiasButton.innerText = 'Antialias'\n        this.antialiasButton.addEventListener('click', () => {\n            this.cropView.antialias = !this.cropView.antialias\n        })\n        if (AvatarCropper.settings.antialias) {\n            this.antialiasButton.classList.add('toggled')\n        }\n        this.menu.appendChild(this.antialiasButton)\n\n        this.maskOutlineButton = createElement('button', 'half item')\n        this.maskOutlineButton.innerText = 'Mask Outline'\n        this.maskOutlineButton.addEventListener(\n            'click',\n            this.toggleMaskOutline.bind(this, true),\n        )\n        this.toggleMaskOutline(false)\n        this.menu.appendChild(this.maskOutlineButton)\n\n        let addPreview = createElement('button', 'half item')\n        addPreview.innerText = 'Add Preview Size'\n        addPreview.addEventListener('click', this.promptAddPreview.bind(this))\n        this.menu.appendChild(addPreview)\n\n        this.guidesButton = createElement('button', 'half item')\n        this.guidesButton.innerText = 'Guidelines'\n        this.guidesButton.addEventListener(\n            'click',\n            this.toggleGuides.bind(this, true),\n        )\n        this.toggleGuides(false)\n        this.menu.appendChild(this.guidesButton)\n\n        let centerCropArea = createElement('button', 'half item')\n        centerCropArea.innerText = 'Center'\n        centerCropArea.addEventListener('click', this.centerCropArea.bind(this))\n        this.menu.appendChild(centerCropArea)\n\n        let setCropSize = createElement('button', 'half item')\n        setCropSize.innerText = 'Set Size'\n        setCropSize.addEventListener('click', this.setCropSize.bind(this))\n        this.menu.appendChild(setCropSize)\n\n        let lock = createElement('button', 'item')\n        lock.innerText = 'Lock Center During Resize'\n        lock.addEventListener('click', this.toggleResizeLock.bind(this))\n        this.menu.appendChild(lock)\n        GlobalEvents.on('resizelockchange', () => {\n            if (AvatarCropper.settings.resizeLock) {\n                lock.classList.add('toggled')\n            } else {\n                lock.classList.remove('toggled')\n            }\n        })\n        GlobalEvents.emitEvent('resizelockchange')\n\n        // create border options //\n        this.borderSelect = <HTMLSelectElement>createElement('select', 'item');\n        this.borderSelect.id = \"borderSelect\";\n        this.menu.appendChild(this.borderSelect);\n\n        let populateBorder = () => {\n            let len = this.borderSelect.options.length;\n            for (let i = 0; i < len; i++) {\n                this.borderSelect.options.remove(0);\n            }\n\n            this.borderSelect.add(createOptionElement(\"No Border\", \"none\"));\n            this.borderSelect.add(createOptionElement(\"Solid Border\", \"solid\"));\n            AvatarCropper.settings.borderPresets.forEach((preset) => {\n                this.borderSelect.add(createOptionElement(preset.name, JSON.stringify(preset)));\n            });\n            this.borderSelect.add(createOptionElement(\"Custom Gradient Border\", \"gradient\"));\n        };\n\n        populateBorder();\n\n        let borderSolidEdit = createElement(\"input\", \"item borderEdit\") as HTMLInputElement;\n        borderSolidEdit.type = \"color\";\n        borderSolidEdit.value = Border.color;\n        borderSolidEdit.addEventListener(\"change\", () => {\n            Border.color = borderSolidEdit.value;\n        });\n        hideElement(borderSolidEdit);\n        this.menu.appendChild(borderSolidEdit);\n\n        let borderGradientEdit = new GradientEditButton(new Point(32));\n        borderGradientEdit.gradient = Border.gradient;\n        borderGradientEdit.container.className = \"item borderEdit\";\n        borderGradientEdit.on(\"update\", (gradientInfo: GradientInfo) => {\n            borderGradientEdit.gradient = gradientInfo;\n            Border.gradient = gradientInfo;\n            populateBorder();\n            this.borderSelect.selectedIndex = this.borderSelect.options.length - 1;\n        });\n        borderGradientEdit.hide();\n        this.menu.appendChild(borderGradientEdit.container);\n\n        this.borderSelect.addEventListener('change', () => {\n            if (this.borderSelect.value === \"solid\") {\n                showElement(borderSolidEdit);\n                borderGradientEdit.hide();\n                this.borderSelect.classList.add(\"edit\");\n                Border.type = \"solid\";\n            } else if (this.borderSelect.value === \"gradient\") {\n                hideElement(borderSolidEdit);\n                borderGradientEdit.show();\n                this.borderSelect.classList.add(\"edit\");\n                Border.type = \"gradient\";\n            } else if (this.borderSelect.value === \"none\") {\n                hideElement(borderSolidEdit);\n                borderGradientEdit.hide();\n                this.borderSelect.classList.remove(\"edit\");\n                Border.type = \"none\";\n            } else {\n                hideElement(borderSolidEdit);\n                borderGradientEdit.hide();\n                this.borderSelect.classList.remove(\"edit\");\n                Border.type = \"gradient\";\n                Border.gradient = JSON.parse(this.borderSelect.selectedOptions[0].value);\n                borderGradientEdit.gradient = Border.gradient;\n            }\n        });\n\n        // create border slider //\n        let borderSlider = new LabelSlider(0, 0.5, 0.01, 'Border Size', 'item')\n        borderSlider.value = Border.size\n        borderSlider.on('slide', (value: number) => {\n            Border.size = value\n        })\n        borderSlider.on('change', () => {\n            AvatarCropper.settings.borderSize = borderSlider.value\n            AvatarCropper.saveSettings();\n        })\n        this.menu.appendChild(borderSlider.container)\n\n\n        let renderBanner = createElement('button', 'item render show half item')\n        renderBanner.innerText = 'Render Banner'\n        renderBanner.addEventListener('click', this.renderBanner.bind(this))\n        this.menu.appendChild(renderBanner)\n        this.appendChild(this.menu)\n\n\n        // create render button //\n        let render = createElement('button', 'item render show half item')\n        render.innerText = 'Render Avatar'\n        render\n        render.addEventListener('click', this.renderCroppedImage.bind(this))\n        this.menu.appendChild(render)\n\n        this.appendChild(this.menu)\n    }\n\n    private flipHorizontal(): void {\n        this.cropView.flipHorizontal()\n    }\n\n    private flipVertical(): void {\n        this.cropView.flipVertical()\n    }\n\n    private centerCropArea(): void {\n        this.cropView.centerCropArea()\n    }\n\n    private setCropSize(): void {\n        let promptStr =\n            'The current picture is ' +\n            this.cropView.innerSize.x.toString() +\n            'x' +\n            this.cropView.innerSize.y.toString() +\n            '\\n' +\n            'The current croparea is ' +\n            this.cropView.cropArea.width +\n            'x' +\n            this.cropView.cropArea.height +\n            '\\n' +\n            'Enter in a size either by specifying a number (like 64) or a percentage of width (50%w) or height (50%h)'\n\n        let sizeStr = window.prompt(promptStr)\n        if (sizeStr === null || isNaN(parseInt(sizeStr))) {\n            return\n        }\n\n        let size = parseInt(sizeStr)\n\n        if (sizeStr.endsWith('%w')) {\n            size = this.cropView.innerSize.x * (size / 100)\n        } else if (sizeStr.endsWith('%h')) {\n            size = this.cropView.innerSize.y * (size / 100)\n        }\n\n        this.cropView.setCropSize(size)\n    }\n\n    private toggleResizeLock(): void {\n        AvatarCropper.settings.resizeLock = !AvatarCropper.settings.resizeLock\n        AvatarCropper.saveSettings();\n        GlobalEvents.emitEvent('resizelockchange')\n    }\n\n    private toggleMenu(): void {\n        if (this.menuToggle) {\n            // showing, need to hide //\n            Array.from(this.menu.children).forEach(child => {\n                if (!child.classList.contains('show')) {\n                    (<HTMLElement>child).style.display = 'none';\n                }\n            });\n\n            this.toggleMenuButton.classList.add('toggled')\n            this.toggleMenuButton.innerText = this.toggleMenuButton.getAttribute(\n                'downtext',\n            )\n        } else {\n            Array.from(this.menu.children).forEach(child => {\n                (<HTMLElement>child).style.display = '';\n            });\n\n            hideElement(document.querySelector(\"input.borderEdit\"));\n            hideElement(document.querySelector(\"canvas.borderEdit\"));\n\n            if (this.borderSelect.value === \"solid\") {\n                showElement(document.querySelector(\"input.borderEdit\"));\n            } else if (this.borderSelect.value === \"gradient\") {\n                showElement(document.querySelector(\"canvas.borderEdit\"));\n            }\n\n            this.toggleMenuButton.classList.remove('toggled')\n            this.toggleMenuButton.innerText = this.toggleMenuButton.getAttribute(\n                'uptext',\n            )\n        }\n\n        this.menuToggle = !this.menuToggle\n    }\n\n    private renderCroppedImage(): void {\n        this.cropView.renderCroppedImage()\n    }\n    private renderBanner(): void{\n        this.cropView.renderBanner()\n    }\n        \n\n    private toggleMaskOutline(actuallyToggle: boolean = true): void {\n        if (actuallyToggle) {\n            AvatarCropper.settings.outlinesEnabled = !AvatarCropper.settings.outlinesEnabled\n        }\n\n        if (AvatarCropper.settings.outlinesEnabled) {\n            this.maskOutlineButton.classList.add('toggled')\n        } else {\n            this.maskOutlineButton.classList.remove('toggled')\n        }\n\n        this.cropView && this.cropView.update(\"mask outline\")\n        AvatarCropper.saveSettings();\n    }\n\n    private toggleGuides(actuallyToggle: boolean = true): void {\n        if (actuallyToggle) {\n            AvatarCropper.settings.guidesEnabled = !AvatarCropper.settings.guidesEnabled\n        }\n\n        if (AvatarCropper.settings.guidesEnabled) {\n            this.guidesButton.classList.add('toggled')\n        } else {\n            this.guidesButton.classList.remove('toggled')\n        }\n\n        this.cropView && this.cropView.update(\"guide toggle\")\n        AvatarCropper.saveSettings();\n    }\n\n    private setTransparency(transparency: number): void {\n        AvatarCropper.settings.maskOpacity = 1 - transparency\n        this.cropView.update(\"set transparenty\")\n    }\n\n    private setRotation(deg: number): void {\n        this.cropView.rotate(deg)\n    }\n\n    private promptAddPreview(): void {\n        let sizeStr = window.prompt(\n            'Enter a custom size\\nDefault sizes are 30, 40, 64, and 128\\nNote: 30 will come with a discord online indicator',\n        )\n\n        if (sizeStr === null) {\n            // cancelled\n            return\n        }\n\n        let size = parseInt(sizeStr)\n\n        if (isNaN(size) || size <= 0) {\n            alert(\"Bad size make sure it's a number over 0\")\n        } else {\n            this.previews.addPreviewSize(new Point(size)) // emits sizeArrayChange event which changes settings so dw\n        }\n    }\n\n    private openFile(file: File): void {\n        if (!this.cropView.setImageFromFile(file)) {\n            return\n        }\n\n        if (!this.firstOpened) {\n            this.firstOpened = true\n            this.show()\n            hideElement(this.textOverlay)\n            this.textOverlay.removeAttribute('for')\n            this.textOverlay.style.cursor = ''\n        }\n\n        if (this.cropView.currentFileType === 'gif') {\n            hideElement(this.flipHButton)\n            hideElement(this.flipVButton)\n        } else {\n            showElement(this.flipHButton)\n            showElement(this.flipVButton)\n        }\n\n        if (\n            !AvatarCropper.settings.dismissedTutorial ||\n            !AvatarCropper.settings.dismissedCookie\n        ) {\n            showTutorial()\n            AvatarCropper.settings.dismissedTutorial = true\n            AvatarCropper.settings.dismissedCookie = true\n            AvatarCropper.saveSettings();\n        }\n    }\n\n    private handleResize(): void {\n        let sideWidth = Math.max(\n            this.previews.width,\n            this.menu.getBoundingClientRect().width,\n        )\n        this.cropView.container.style.width = 'calc(100% - ' + sideWidth + 'px)'\n        this.cropView.reactTMToRefresh()\n\n        let previewHeight = this.previews.height + this.previews.padding * 2\n        //this.menu.style.height = \"calc(100% - \" + previewHeight + \"px)\";\n    }\n}\n\nwindow.addEventListener('load', function() {\n    KeyManager.initialize();\n    (<any>window).a = new AvatarCropper(document.getElementById('container'));\n    doFooterThings();\n})\n"],"names":["$d69b9d93e85a2fdf$export$c8a8987d4410bf2d","type","className","ret","document","createElement","$d69b9d93e85a2fdf$export$644fdc6d38157375","e","pixelate","forEach","style","$d69b9d93e85a2fdf$export$d4d450b2ebd3703e","text","value","innerText","$d69b9d93e85a2fdf$export$7669482c90f5c50f","element","display","$d69b9d93e85a2fdf$export$998191bfdf710c72","$d69b9d93e85a2fdf$export$184b327af57d635d","array","item","index","indexOf","splice","existed","$d69b9d93e85a2fdf$export$f1dd0284330a2fe1","index_or_fn","i","length","push","$d69b9d93e85a2fdf$export$b0a722188a829e2","stopPropagation","$18c11f3350a906ea$export$6503ec6e8aabbaf","$18c11f3350a906ea$export$f7ad0328861e2f03","$18c11f3350a906ea$var$mapping","pairs","keys","Object","id","resolved","Error","module","exports","URL","parcelRequire","resolve","import","meta","url","toString","register","JSON","parse","$85bc7aa400746d55$export$d3c00a209ca72aeb","this","events","Map","createEvent","event","has","set","emitEvent","args","console","warn","get","o","fn","on","once","wrapper","debugEvent","log","$85bc7aa400746d55$export$2d0bddd40d475689","$41ff4ae0c5feea88$export$a829527ff4e4114a","className_or_container","super","container","contentContainer","show","hide","innerHTML","appendChild","children","appendHelper","frag","createDocumentFragment","child","parent","HTMLElement","removeChild","hasChild","contains","$698b015b38b464e3$export$4617fb02663045ef","position","size","rect","$33e992f3907ce80f$export$baf26146a414f24a","left","top","fromSizeLike","expand","multiplier","r","copy","newSize","times","center","diff","minus","subtract","dividedBy","add","isSquare","width","height","plus","operand","translated","offset","x","y","fitInside","anchor","ar","aspectRatio","startPoint","getPointFromAnchor","setPointFromAnchor","setWidthKeepAR","setHeightKeepAR","expandToward","factor","bl","bottomLeft","multiply","br","bottomRight","tl","topLeft","tr","topRight","fitInsideGreedyCenter","boundingRect","containsRect","right","bottom","fitInsideGreedy","mirror","point","round","aboutCenter","c","rounded","local","cx","cy","containsPoint","p","intersects","p1","p2","pos","Math","min","abs","constructor","undefined","sizeLike","pointLike","toRectangle","xOnly","yOnly","unitX","unitY","inverted","reverseByX","reverseByY","static","radians","cos","sin","equals","n","divideBy","squared","sum","max","distanceTo","sqrt","toArray","$f679dedb1fe026aa$export$8d01c972ee8b14a9","options","canvasElement","querySelector","canvas","context","getContext","alpha","opaque","resize","translation","align","horizontal","vertical","transformOrigin","usingDeepCalc","deepCalc","pixelated","deepCalcPosition","window","addEventListener","mouse","isDown","lastPos","originalPos","move","down","up","leave","mouseMove","bind","mouseDown","mouseUp","mouseLeave","eventName","substr","redraw","cloneNode","drawImage","zoom","amount","zoomToFit","wRatio","hRatio","scale","clear","clearRect","z","isNaN","offsetLeft","offsetTop","getComputedStyle","scrollLeft","parseInt","getPropertyValue","scrollTop","offsetParent","posFromEvent","MouseEvent","pageX","pageY","changedTouches","bounds","getBoundingClientRect","call","bool","ctx","mozImageSmoothingEnabled","webkitImageSmoothingEnabled","imageSmoothingEnabled","opacity","globalAlpha","color","fillStyle","val","strokeStyle","font","lineWidth","blendMode","globalCompositeOperation","lineDash","getLineDash","dash","setLineDash","createBlob","callback","mimeType","toBlob","blob","createImage","autoRevoke","Image","onload","revokeObjectURL","src","createObjectURL","imageData","getImageData","image","drawCroppedImage","cropRegion","drawRotatedCroppedImage","rotate","save","translate","restore","fillWithImage","resizeCanvasToFit","drawLine","start","end","beginPath","moveTo","lineTo","stroke","drawArc","radius","startAngle","endAngle","arc","drawRect","sharp","strokeRect","fillRect","drawBanner","circle","PI","drawRoundedRect","arcTo","closePath","fillRoundedRect","fill","fillText","baseline","textBaseline","textAlign","fillCircle","fillCircleInSquare","diameter","drawCircleInSquare","fillCircleInRect","ellipse","drawCircleInRect","drawRotatedImage","w","h","file","img","HTMLCanvasElement","prototype","defineProperty","quality","setTimeout","binStr","atob","toDataURL","split","len","arr","Uint8Array","charCodeAt","Blob","$25f6cdc3c738d814$export$c17561cb55d4db30","progressElement","progress","_progress","$bfbecd96e7064e6b$export$6cac80e085b0bd20","fractionParts","totalFractions","addFractionPart","fractionsOfWhole","internalSteps","counter","step","shift","reset","$e2eeba6b1e27ad46$export$3ddf2d174ce01153","dialog","dismiss","$032d08468c79811f$export$186fadca37999fef","classList","close","innerContent","$0034b23c1dfa322d$export$d8e9c9d63e86d41e","defaults","name","angle","gradient","_type","_size","_color","_gradient","shape","_shape","gradientInfo","a1","a2","createLinearGradient","def","addColorStop","applyGradientToCanvas","root","factory","$200632e5500e5b7d$exports","shouldAbort","abortFn","bitsToNum","ba","reduce","s","byteToBitArr","bite","a","Stream","data","readByte","readBytes","bytes","read","String","fromCharCode","readUnsigned","parseGIF","st","handler","parseCT","entries","ct","readSubBlocks","parseImg","leftPos","topPos","bits","lctFlag","interlaced","sorted","reserved","lctSize","lct","lzwMinCodeSize","lzwData","pixels","minCodeSize","code1","last","readCode","code","output","clearCode","eoiCode","codeSize","dict","concat","apply","lzwDecode","toRow","fromRow","fromPixels","newPixels","Array","rows","offsets","steps","fromRow1","pass","toRow1","slice","deinterlace","parseBlock","block","sentinel","block1","label","extType","disposalMethod","userInput","transparencyGiven","delayTime","transparencyIndex","terminator","gce","parseGCExt","comment","com","ptHeader","ptData","pte","parsePTExt","block2","identifier","authCode","unknown","iterations","app","NETSCAPE","appData","parseUnknownAppExt","parseAppExt","parseUnknownExt","parseExt","eof","hdr","sig","ver","gctFlag","colorRes","gctSize","bgColor","pixelAspectRatio","gct","parseHeader","opts","stream","vp_l","vp_t","vp_w","vp_h","c_w","c_h","i1","is_vp","loadError","loading","transparency","delay1","disposalRestoreFromIdx","lastDisposalMethod","frame","lastImg","playing","ctx_scaled","frames","frameOffsets","gif","auto_play","getAttribute","stepping","completeLoop","doStep","iterationCount","stepFrame","putFrame","toolbar","tmpCanvas","onEndListener","hasOwnProperty","on_end","loopDelay","loop_delay","overrideLoopMode","loop_mode","drawWhileLoading","draw_while_loading","showProgressBar","show_progress_bar","progressBarHeight","progressbar_height","progressBarBackgroundColor","progressbar_background_color","progressBarForegroundColor","progressbar_foreground_color","doParse","err","doLoadError","setSizes","get_canvas_scale","minWidth","setTransform","doShowProgress","draw","mid","originOfError","pushFrame","delay","player","putImageData","init","play","pause","move_relative","current_frame","move_to","frame_idx","doDecodeProgress","doNothing","withProgress","_hdr","currIdx","imgData","pixel","load_callback","parentNode","div","insertBefore","initialized","max_width","load_setup","get_frames","get_playing","get_canvas","get_loading","get_auto_play","get_length","get_current_frame","load_url","onprogress","onabort","XMLHttpRequest","open","overrideMimeType","responseType","setRequestHeader","onloadstart","status","response","VBArray","responseText","map","join","lengthComputable","loaded","total","onerror","send","load","load_raw","abort","set_frame_offset","define","amd","SuperGif","f","$17ff8c6874580310$exports","$parcel$global","self","GIF","e1","t","n1","u","l","o1","require","EventEmitter","_events","_maxListeners","isFunction","arg","isObject","isUndefined","defaultMaxListeners","setMaxListeners","TypeError","emit","er","listeners","error","arguments","addListener","listener","m","newListener","warned","trace","fired","g","removeListener","list","removeAllListeners","key","listenerCount","evlistener","emitter","UA","browser","mode","platform","ua","navigator","userAgent","toLowerCase","match","documentMode","version","parseFloat","GIF1","hasProp","superClass","frameDefaults","base","running","freeWorkers","activeWorkers","setOptions","ctor","__super__","extend","workerScript","workers","repeat","background","transparent","debug","dither","setOption","_canvas","results","addFrame","ImageData","CanvasRenderingContext2D","WebGLRenderingContext","getContextData","childNodes","d","render","j1","numWorkers","ref1","nextFrame","finishedFrames","imageParts","j","ref","spawnWorkers","globalPalette","renderNextFrame","worker","terminate","_this","Worker","onmessage","frameFinished","finishRendering","k","len1","len2","len3","page","ref2","pageSize","cursor","task","getTask","postMessage","colors","bg","trans","green","violet","padStart","canTransfer","$7b658d724869e1da$export$88530751e3977073","cropView","renderedString","renderingString","shouldStopRendering","currentlyRendering","headerElement","progressBar","imageElement","noteElement","pleaseWaitElement","optionBar","saveButton","href","banner","currentFileType","renderGif","getFrameURLs","$parcel$interopDefault","loadGif","tryClose","Circle","bannerRect","saveGif","cropArea","renderFrame","getCircle","expectedLength","check","borderCanvas","rc","outerSize","rotation","innerSize","squareCrop","circleCrop","cropOptions","firstButton","option","b","bs","remove","scrollHeight","click","setAttribute","filename","antialias","force","$99b56ff268561415$export$4b0075e5ea5e1f26","$99b56ff268561415$export$cc2cdd5bf44ddf2","keysDown","keyCode","keyP","keyN","$3da11c8808882d12$export$4071300121a182f5","dirty","frameWaiting","update","source","requestAnimationFrame","_draw","$46b298a86e0bbec2$var$Circle","saveOrigin","outerRect","rectangle","_origin","origin","validate","$46b298a86e0bbec2$export$5485de05ebe315be","settingsObject","_isZoomFitted","_zoomFactor","currentRotation","currentAction","loadingImage","settings","renderer","overlay","body","preventDefault","ca","handleKeypress","isArrowKey","axis","zoomFactor","reactTMToRefresh","isZoomFitted","zoomFit","maskOpacity","previewMode","outlinesEnabled","guidesEnabled","lineDashOffset","innerRect","apparentSize","overflow","shouldUpdate","ogScrollTopP","scrollWidth","rotatePart","transform","current","zoomIn","zoomOut","cr","ir","fw","fh","deg","b4","or","fromClientRect","delta","antialiased","setImageFromFile","_filename","substring","lastIndexOf","fileToImage","setImageFromFileHelper","flipHorizontal","flipHelper","flipVertical","renderCroppedImage","renderBanner","centerCropArea","setCropSize","getCropSize","setCropArea","setCropSizewithoutcheck","getMouseAction","action","mouseOrigin","resizeOffset","getCircleAnchor","xr","yr","thing","performResize","resizeLock","anchorOpposite","between","resizeAnchor","$60cf9f1f57348e13$export$133773870222880f","lastMode","applyGradient","aa","zIndex","mask","border","onlineIndicator","bottomBar","sizeDisplay","title","removeButton","$a198c33e7dd9e5d4$export$463f252fe689999e","dp","$eb73340bff26da56$export$857a1f47e2bf680c","previews","padding","sizeArray","preview","addPreviewSize","removePreview","runningX","$247989f566f6e47f$export$ced5bd70461baef8","minValue","maxValue","labelElement","sliderElement","$0f1e15f1fe50f245$var$w","localStorage","getItem","sKey","unescape","cookie","replace","RegExp","escape","nKeyId","setItem","sValue","removeItem","test","$0f1e15f1fe50f245$export$2e2bcd8739ae039","stringify","hasKey","$09ecd9a8a7445a7b$export$302fa0c957545c7","Earlier","es","h1","month","h2","ul","li","$f1fd6a58d61dc86e$var$tutorial","$f1db1e6c1c2a3d70$export$9080f8affd01f933","userSelect","learnMore","$a2d1b38606729be5$export$8d419a2dccf737d","patrons","donors","$f1fd6a58d61dc86e$export$95644433b98ccf99","$9a67241b5d73893d$export$b4a441ca74fcf9d2","tempText","target","dataTransfer","files","$615a0de6b1b1fa74$export$582bc754b5da294a","onreturn","$17b46f5e858ff132$export$d23bbc7707413690","resolution","$17b46f5e858ff132$var$GradientEditDialog","getElementById","leftCol","rightCol","previewCanvas","presetRow","presetLabel","presetSelect","borderPresets","preset","gradientSlider","stops","overwrite","selectedIndex","selectedOptions","saveSettings","alert","saveNew","prompt","some","deletePreset","confirm","$17b46f5e858ff132$var$GradientSlider","colorSelect","currentStopColor","buttonRow","addStop","removeStop","equidistant","makeEquidistant","angleSlider","saveRow","ok","cancel","isDragging","stopElements","_stops","gradientCanvas","dragging","drag","sort","createStop","makeLastTouched","trackWidth","applyMousedown","stopElement","clientX","dragOriginX","elementOriginX","lastTouched","info","stop","backgroundColor","touches","TouchEvent","newStop","toRemove","menuToggle","firstOpened","loadSettings","borderSize","constructMenu","previewSizes","handleResize","antialiasButton","textOverlay","dragDrop","openFile","msie","rv","edge","$d69b9d93e85a2fdf$export$eb7ff627fa81c42e","dismissedIE","loadFromFile","menu","openFileLabel","toggleMenuButton","toggleMenu","square","toggle","tSlider","setTransparency","zoomBar","zoomLabel","rSlider","setRotation","flipHButton","flipVButton","maskOutlineButton","toggleMaskOutline","addPreview","promptAddPreview","guidesButton","toggleGuides","lock","toggleResizeLock","borderSelect","populateBorder","borderSolidEdit","borderGradientEdit","borderSlider","promptStr","sizeStr","endsWith","from","actuallyToggle","removeAttribute","dismissedTutorial","dismissedCookie","sideWidth","bannerEnabled","initialize","whatsNew","supporters","$f1fd6a58d61dc86e$export$a0713d30f4648630"],"version":3,"file":"index.3e6cdede.js.map"}